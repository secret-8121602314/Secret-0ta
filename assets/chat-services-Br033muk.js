const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/core-services-CiRMA0K5.js","assets/auth-DCYHKito.js","assets/react-vendor-CNZAW3Qf.js","assets/vendor-iG8OWzAa.js","assets/markdown-vendor-q4liMzTk.js","assets/supabase-vendor-CW8WbJgo.js","assets/services-BOnxyvYK.js"])))=>i.map(i=>d[i]);
var X=Object.defineProperty;var Z=(f,e,a)=>e in f?X(f,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):f[e]=a;var I=(f,e,a)=>Z(f,typeof e!="symbol"?e+"":e,a);import{S as L,t as k,c as B,a as A,g as W,b as J,p as z,e as V,d as K}from"./services-BOnxyvYK.js";import{S as ee}from"./core-services-CiRMA0K5.js";import{H as F,a as q,S as b}from"./ai-vendor-DDPwdD9r.js";import{s as te}from"./auth-DCYHKito.js";const ae="modulepreload",oe=function(f){return"/"+f},Q={},P=function(e,a,t){let o=Promise.resolve();if(a&&a.length>0){let i=function(d){return Promise.all(d.map(v=>Promise.resolve(v).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),p=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));o=i(a.map(d=>{if(d=oe(d),d in Q)return;Q[d]=!0;const v=d.endsWith(".css"),S=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${S}`))return;const C=document.createElement("link");if(C.rel=v?"stylesheet":ae,v||(C.as="script"),C.crossOrigin="",C.href=d,p&&C.setAttribute("nonce",p),document.head.appendChild(C),v)return new Promise((E,u)=>{C.addEventListener("load",E),C.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(i){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=i,window.dispatchEvent(n),!n.defaultPrevented)throw i}return o.then(i=>{for(const n of i||[])n.status==="rejected"&&s(n.reason);return e().catch(s)})};var se=(f=>(f.DISCONNECTED="DISCONNECTED",f.CONNECTING="CONNECTING",f.CONNECTED="CONNECTED",f.ERROR="ERROR",f))(se||{});const pe=["What's the latest gaming news?","Which games are releasing soon?","What are the latest game reviews?","Show me the hottest new game trailers."],U={Default:[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"missed_items",title:"Items You May Have Missed",type:"items",instruction:"Based on the player's current progress, identify 2-3 significant items, secrets, or side quests they might have overlooked in areas they have already visited. Provide clear, actionable hints about their locations without giving away the exact solution. Use landmarks and environmental descriptions. Example: 'In the Whispering Caverns, a waterfall hides more than just a damp cave wall.'"},{id:"game_lore",title:"Relevant Lore",type:"story",instruction:"Provide a fascinating, detailed, spoiler-free piece of lore about the game's world, characters, or backstory that is relevant to the player's current situation or recent events. This should be a deep-dive, not a short summary."},{id:"build_guide",title:"Build Guide",type:"strategies",instruction:"Suggest one or two detailed, effective character builds or loadouts using items and skills available up to the current progress point. Be specific about the synergy between components, stat allocation, and how the build excels in the player's current or upcoming challenges."},{id:"next_session_plan",title:"Plan Your Next Session",type:"tips",instruction:"Based on the player's progress and story so far, clearly list 3-4 concrete objectives or tasks they can tackle in their next gameplay session. This should include a mix of main quests, important side quests, and interesting areas to explore next. Provide a brief, compelling reason for each suggestion."}],"Action RPG":[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"quest_log",title:"Active Quests",type:"walkthrough",instruction:"Summarize the active main quest and suggest 2-3 relevant side quests available in the current area. Explain the potential rewards or story connections."},{id:"build_optimization",title:"Build Optimization",type:"strategies",instruction:"Analyze the player's likely stats and gear. Suggest 2-3 specific improvements, like stat allocation changes, better weapon affinities, or spells that synergize with their build."},{id:"boss_strategy",title:"Upcoming Boss Strategy",type:"strategies",instruction:"A significant challenge may lie ahead. **Do not name the upcoming boss or describe its appearance.** Instead, provide clear, actionable tactical advice based on its likely attack patterns and weaknesses. Suggest effective weapon types, armor properties, status effects, and specific strategies (e.g., 'This foe is relentless up close; focus on ranged attacks and stay mobile,' or 'Its armor is vulnerable to fire damage; enchanted weapons will be key.'). The advice should be practical, not metaphorical."},{id:"hidden_paths",title:"Hidden Paths & Secrets",type:"tips",instruction:"Hint at a secret path or hidden area nearby that the player may have missed. **Do not give explicit directions.** Instead, provide a clear clue tied to a specific landmark or environmental feature. The goal is to make the player think 'Aha!' not 'Huh?'. Example: 'The large statue in the Grand Hall seems to be pointing at a specific tapestry on the wall...' or 'Listen for the sound of running water behind the library's northern bookshelf.'"}],RPG:[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"character_building",title:"Character Building",type:"strategies",instruction:"Provide detailed character building advice including stat allocation, skill trees, and class optimization based on the player's current progress and available options."},{id:"combat_strategies",title:"Combat Strategies",type:"strategies",instruction:"Detail effective combat strategies, party composition advice, and tactical approaches for current or upcoming challenges."},{id:"quest_guide",title:"Quest Guide",type:"walkthrough",instruction:"Provide guidance on active quests, including main story quests and important side quests. Include rewards and story connections."},{id:"lore_exploration",title:"Lore Exploration",type:"story",instruction:"Dive deep into the game's lore, world-building, and backstory relevant to the player's current progress without spoiling future revelations."}],"First-Person Shooter":[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"loadout_analysis",title:"Loadout Analysis",type:"strategies",instruction:"Analyze the probable current weapon loadout. Suggest 2 alternative, powerful loadouts (primary, secondary, equipment) for the current situation or map, explaining the strategic advantage of each."},{id:"map_strategies",title:"Map Strategies",type:"strategies",instruction:"Provide 3 key strategic tips for the likely current map or area, focusing on positioning, flanking routes, and objective control."},{id:"enemy_intel",title:"Enemy Intel",type:"tips",instruction:"You'll encounter new threats in this zone. **Do not name the enemy types or describe their appearance in a way that spoils their reveal.** Describe their behavior, attack patterns, and a key vulnerability in a tactical, in-universe way. The advice must be actionable. For example: 'Some hostiles carry volatile canisters on their backs. A well-placed shot could trigger a chain reaction.' or 'Listen for a high-pitched whine; it signals a devastating charge you must evade immediately.'"},{id:"pro_tips",title:"Pro Tips",type:"tips",instruction:"Offer 3 advanced tips or 'pro strats' for this game that a new player might not know, such as movement tricks, ability combos, or unusual weapon uses."}],Strategy:[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"current_board_state",title:"Current State Analysis",type:"strategies",instruction:"Analyze the current game state (e.g., board position, resources, army composition). Provide a high-level summary of strengths, weaknesses, and immediate threats."},{id:"opening_moves",title:"Opening Builds",type:"strategies",instruction:"Describe 2-3 popular and effective opening strategies or build orders for the player's faction or starting position."},{id:"unit_counters",title:"Unit Counters",type:"strategies",instruction:"Intelligence suggests the enemy will deploy units with specific strengths. **Do not name the enemy units.** Instead, describe their function (e.g., 'fast-moving aerial threats', 'heavily armored ground forces') and suggest specific, effective counters from the player's available arsenal. Explain *why* the counter works (e.g., '...because your Stinger units have tracking projectiles that are effective against agile air targets.')."},{id:"economy_guide",title:"Economy Management",type:"tips",instruction:"Provide 3 tips for optimizing resource generation and spending at the player's current stage of the game."}],Adventure:[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"exploration_tips",title:"Exploration Tips",type:"tips",instruction:"Provide helpful exploration tips for the current area, including how to find hidden paths, secrets, and collectibles without explicit spoilers."},{id:"puzzle_solving",title:"Puzzle Solving",type:"strategies",instruction:"Offer guidance on current or recent puzzles, providing hints that lead the player toward the solution without giving it away entirely."},{id:"story_progression",title:"Story Progression",type:"walkthrough",instruction:"Guide the player through story progression, outlining what to do next while maintaining suspense and avoiding future spoilers."},{id:"hidden_secrets",title:"Hidden Secrets",type:"tips",instruction:"Hint at hidden secrets, collectibles, or optional content the player may have missed, using environmental clues and landmarks."}],Simulation:[{id:"goal_suggestions",title:"Goal Suggestions",type:"tips",instruction:"Based on the current state, suggest 3 short-term and 1 long-term goal to work towards. For example, expanding a facility, achieving a milestone, or unlocking a new technology."},{id:"efficiency_tips",title:"Efficiency & Optimization",type:"strategies",instruction:"Provide 3 actionable tips for improving the efficiency of the player's current setup, such as optimizing a production line, improving traffic flow, or managing finances better."},{id:"hidden_mechanics",title:"Hidden Mechanics",type:"tips",instruction:"Explain one non-obvious game mechanic that can significantly impact gameplay, which the player may not be aware of yet."},{id:"disaster_prep",title:"Disaster Prep",type:"strategies",instruction:"Great endeavors are often tested. **Do not name the specific disaster or event.** Hint at a potential future challenge in a thematic way and suggest 2-3 concrete, preventative measures. For example: 'The markets are fickle; diversifying your income streams and building a cash reserve can weather any financial storm.' or 'The earth sometimes trembles. Ensuring your infrastructure is reinforced near fault lines could prevent a catastrophe.'"}],Sports:[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"team_management",title:"Team Management",type:"strategies",instruction:"Analyze the current team composition and suggest 2-3 strategic improvements. Consider player stats, chemistry, formation adjustments, or tactical changes that could enhance performance based on the current season progress."},{id:"training_focus",title:"Training Focus",type:"tips",instruction:"Based on the current team's strengths and weaknesses, recommend specific training priorities. Suggest which players need development, what skills to focus on, and how to prepare for upcoming challenges."},{id:"tactical_analysis",title:"Tactical Analysis",type:"strategies",instruction:"Provide detailed tactical advice for the current situation. This could include formation strategies, player positioning, set-piece tactics, or counter-strategies against specific opponents you've faced or are about to face."},{id:"season_progression",title:"Season Progression",type:"walkthrough",instruction:"Outline the key objectives and milestones for the current season phase. Suggest realistic goals, important matches to focus on, and strategic decisions that could impact the team's long-term success."}],"Multiplayer Shooter":[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"meta_analysis",title:"Meta Analysis",type:"strategies",instruction:"Analyze the current meta and suggest 2-3 effective loadouts or strategies. Consider weapon balance, map-specific tactics, and counter-strategies against popular playstyles in the current meta."},{id:"team_coordination",title:"Team Coordination",type:"strategies",instruction:"Provide advanced team play strategies. Suggest communication tactics, role assignments, positioning strategies, and how to counter common enemy team compositions or strategies."},{id:"map_control",title:"Map Control",type:"strategies",instruction:"Offer detailed map control strategies for the current or upcoming maps. Include key positions, rotation paths, objective control tactics, and how to maintain map dominance."},{id:"skill_development",title:"Skill Development",type:"tips",instruction:"Identify specific skills to improve based on current performance. Suggest aim training routines, movement techniques, game sense improvements, or mechanical skills that could elevate gameplay."}],"Multiplayer Sports":[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"competitive_strategy",title:"Competitive Strategy",type:"strategies",instruction:"Analyze the competitive landscape and suggest strategies for ranked/competitive play. Consider meta shifts, opponent tendencies, and advanced tactics that separate good players from great ones."},{id:"team_synergy",title:"Team Synergy",type:"strategies",instruction:"Provide advice on building effective team compositions and strategies. Suggest player combinations, communication protocols, and how to maximize team chemistry and coordination."},{id:"performance_optimization",title:"Performance Optimization",type:"tips",instruction:"Offer specific tips for improving individual and team performance. Include practice routines, skill development priorities, and how to adapt to different opponents and playstyles."},{id:"ranked_progression",title:"Ranked Progression",type:"walkthrough",instruction:"Outline a strategic approach to climbing ranks. Suggest focus areas, common mistakes to avoid, and how to maintain consistency in competitive matches."}],Racing:[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"vehicle_tuning",title:"Vehicle Tuning",type:"strategies",instruction:"Analyze the current vehicle setup and suggest tuning adjustments. Consider track characteristics, weather conditions, and racing style to recommend optimal configurations for current or upcoming races."},{id:"track_strategy",title:"Track Strategy",type:"strategies",instruction:"Provide detailed racing strategies for current or upcoming tracks. Include braking points, racing lines, overtaking opportunities, and how to handle specific track sections or challenges."},{id:"race_craft",title:"Race Craft",type:"tips",instruction:"Offer advanced racing techniques and strategies. Include defensive driving, overtaking tactics, pit stop strategies, and how to manage tire wear and fuel consumption effectively."},{id:"championship_focus",title:"Championship Focus",type:"walkthrough",instruction:"Outline strategic priorities for the current championship or season. Suggest which races to focus on, points management strategies, and how to maximize championship potential."}],Fighting:[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"character_analysis",title:"Character Analysis",type:"strategies",instruction:"Analyze the current character's strengths, weaknesses, and optimal playstyle. Suggest advanced techniques, combo routes, and how to maximize the character's potential in different matchups."},{id:"matchup_strategy",title:"Matchup Strategy",type:"strategies",instruction:"Provide detailed matchup strategies against common opponents. Include character-specific tactics, counter-strategies, and how to exploit opponent weaknesses while covering your own."},{id:"execution_training",title:"Execution Training",type:"tips",instruction:"Suggest specific training routines to improve execution and consistency. Include combo practice, timing drills, and techniques to master difficult inputs or advanced mechanics."},{id:"tournament_prep",title:"Tournament Prep",type:"tips",instruction:"Outline preparation strategies for competitive play. Include mental preparation, warm-up routines, and how to maintain peak performance during extended tournament sessions."}],"Battle Royale":[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"drop_strategy",title:"Drop Strategy",type:"strategies",instruction:"Analyze optimal landing locations and early-game strategies. Consider loot quality, player density, and how to maximize survival chances while securing good equipment for the mid-game."},{id:"positioning_tactics",title:"Positioning Tactics",type:"strategies",instruction:"Provide advanced positioning strategies for different phases of the match. Include rotation timing, zone management, and how to maintain advantageous positions while avoiding third-party situations."},{id:"loadout_optimization",title:"Loadout Optimization",type:"strategies",instruction:"Suggest optimal weapon combinations and equipment priorities. Consider current meta, personal playstyle, and how to adapt loadouts based on available loot and enemy compositions."},{id:"endgame_strategy",title:"Endgame Strategy",type:"strategies",instruction:"Offer detailed endgame tactics and positioning. Include final circle strategies, engagement timing, and how to maximize win probability in high-pressure final situations."}],MMORPG:[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"class_optimization",title:"Class Optimization",type:"strategies",instruction:"Analyze the current class build and suggest optimizations. Include talent choices, gear priorities, stat allocation, and how to maximize effectiveness for current content and playstyle."},{id:"content_progression",title:"Content Progression",type:"walkthrough",instruction:"Provide a roadmap for progressing through current and upcoming content. Suggest priority activities, gear upgrades, and how to efficiently advance through dungeons, raids, or PvP content."},{id:"economy_management",title:"Economy Management",type:"tips",instruction:"Offer strategies for managing in-game resources and economy. Include gold-making tips, auction house strategies, and how to optimize spending for maximum character progression."},{id:"social_strategies",title:"Social Strategies",type:"tips",instruction:"Suggest approaches for building effective guild relationships and finding groups. Include communication tips, role expectations, and how to become a valuable team member in group content."}],Puzzle:[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"puzzle_patterns",title:"Puzzle Patterns",type:"strategies",instruction:"Identify common puzzle patterns and solution strategies. Provide systematic approaches to different puzzle types and how to recognize key elements that lead to solutions."},{id:"logical_reasoning",title:"Logical Reasoning",type:"strategies",instruction:"Offer advanced logical reasoning techniques and problem-solving methods. Include how to break down complex puzzles, eliminate possibilities, and approach problems systematically."},{id:"time_optimization",title:"Time Optimization",type:"tips",instruction:"Suggest strategies for solving puzzles more efficiently. Include speed-solving techniques, pattern recognition shortcuts, and how to minimize trial-and-error approaches."},{id:"difficulty_progression",title:"Difficulty Progression",type:"tips",instruction:"Outline strategies for tackling increasingly difficult puzzles. Include preparation methods, skill development priorities, and how to build confidence for challenging content."}],Horror:[{id:"story_so_far",title:"Story So Far",type:"story",instruction:"Provide a concise summary of the main plot events that have occurred strictly up to the estimated game progress. Do not mention, hint at, or allude to any future events, characters, or plot twists. The summary should read like a journal entry of what has *already happened*."},{id:"survival_strategies",title:"Survival Strategies",type:"strategies",instruction:"Provide comprehensive survival tactics for the current situation. Include resource management, safe zone identification, and how to navigate dangerous areas while minimizing risk."},{id:"enemy_behavior",title:"Enemy Behavior",type:"strategies",instruction:"Analyze enemy patterns and suggest counter-strategies. Include how to avoid detection, exploit enemy weaknesses, and use the environment to your advantage against threats."},{id:"atmosphere_navigation",title:"Atmosphere Navigation",type:"tips",instruction:"Offer strategies for managing the psychological aspects of horror gameplay. Include how to maintain composure, use audio cues effectively, and navigate tense situations."},{id:"resource_management",title:"Resource Management",type:"tips",instruction:"Suggest optimal resource allocation and conservation strategies. Include inventory management, crafting priorities, and how to maximize survival potential with limited supplies."}]},H={FREE:"free",PRO:"pro",VANGUARD_PRO:"vanguard_pro"},he={[H.FREE]:{text:55,image:25},[H.PRO]:{text:1583,image:328},[H.VANGUARD_PRO]:{text:1583,image:328}},G={USER:"otakon_user",APP_STATE:"otakon_app_state",CONVERSATIONS:"otakon_conversations",GAMES:"otakon_games",WAITLIST:"otakon_waitlist",USAGE:"otakon_usage",PREFERENCES:"otakon_preferences",ONBOARDING:"otakon_onboarding",TRIAL:"otakon_trial"},R="game-hub",x="Game Hub",D=ee.getInstance();class j{static async getCurrentUserId(){try{const{authService:e}=await P(async()=>{const{authService:t}=await import("./core-services-CiRMA0K5.js").then(o=>o.e);return{authService:t}},__vite__mapDeps([0,1,2,3,4,5,6])),a=e.getCurrentUser();return(a==null?void 0:a.authUserId)||null}catch(e){return console.warn("Could not get user ID from auth service:",e),null}}static async getUserTier(){try{const{authService:a}=await P(async()=>{const{authService:o}=await import("./core-services-CiRMA0K5.js").then(s=>s.e);return{authService:o}},__vite__mapDeps([0,1,2,3,4,5,6])),t=a.getCurrentUser();if(t!=null&&t.tier)return t.tier}catch(a){console.warn("Could not get user tier from auth service:",a)}const e=L.get(G.USER,null);return(e==null?void 0:e.tier)||H.FREE}static async canSendTextQuery(){try{const{authService:e}=await P(async()=>{const{authService:s}=await import("./core-services-CiRMA0K5.js").then(i=>i.e);return{authService:s}},__vite__mapDeps([0,1,2,3,4,5,6])),a=e.getCurrentUser();if(!a)return{allowed:!1,reason:"User not authenticated"};const t=a.textCount||0,o=a.textLimit||55;if(t>=o){const s=a.tier||"free";return{allowed:!1,reason:`You've used all ${o} text queries this month. ${s==="free"?"Upgrade to Pro for 1,583 queries!":"Your queries will reset next month."}`,used:t,limit:o}}return{allowed:!0,used:t,limit:o}}catch(e){return console.error("Error checking text query limit:",e),k.error("Failed to check query limit. Please try again."),{allowed:!1,reason:"Failed to check query limit"}}}static async canSendImageQuery(){try{const{authService:e}=await P(async()=>{const{authService:s}=await import("./core-services-CiRMA0K5.js").then(i=>i.e);return{authService:s}},__vite__mapDeps([0,1,2,3,4,5,6])),a=e.getCurrentUser();if(!a)return{allowed:!1,reason:"User not authenticated"};const t=a.imageCount||0,o=a.imageLimit||25;if(t>=o){const s=a.tier||"free";return{allowed:!1,reason:`You've used all ${o} image queries this month. ${s==="free"?"Upgrade to Pro for 328 image queries!":"Your queries will reset next month."}`,used:t,limit:o}}return{allowed:!0,used:t,limit:o}}catch(e){return console.error("Error checking image query limit:",e),k.error("Failed to check query limit. Please try again."),{allowed:!1,reason:"Failed to check query limit"}}}static clearCache(){console.error("üóëÔ∏è [ConversationService] Cache cleared, next read will be fresh"),this.conversationsCache=null}static async getConversations(e=!1){const a=await this.getCurrentUserId();let t={};if(!e&&this.conversationsCache&&Date.now()-this.conversationsCache.timestamp<this.CACHE_TTL)return console.log("üîç [ConversationService] Using cached conversations (age:",Date.now()-this.conversationsCache.timestamp,"ms)"),this.conversationsCache.data;if(a)try{console.log("üîç [ConversationService] Loading conversations from Supabase for user:",a),t=(await D.getConversations(a)).reduce((i,n)=>(i[n.id]=n,i),{}),console.log("üîç [ConversationService] Loaded",Object.keys(t).length,"conversations from Supabase"),this.conversationsCache={data:t,timestamp:Date.now()},Object.keys(t).length>0&&L.set(G.CONVERSATIONS,t)}catch(s){console.error("üîç [ConversationService] Failed to load from Supabase, falling back to localStorage:",s),k.warning("Using offline conversations. Some data may not be synced."),t=L.get(G.CONVERSATIONS,{})}else console.log("üîç [ConversationService] No user ID, loading from localStorage"),t=L.get(G.CONVERSATIONS,{});let o=!1;return Object.values(t).forEach(s=>{(s.title==="General Chat"||s.title==="Everything else")&&(s.title=x,s.id=R,s.isGameHub=!0,o=!0),s.id===R&&!s.isGameHub&&(s.isGameHub=!0,o=!0)}),o&&await this.setConversations(t),t}static async setConversations(e,a=0){const t=await this.getCurrentUserId();if(console.log("üîç [ConversationService] Saving",Object.keys(e).length,"conversations"),this.conversationsCache=null,L.set(G.CONVERSATIONS,e),console.log("üîç [ConversationService] Saved to localStorage"),t)try{console.log("üîç [ConversationService] Syncing to Supabase...");const o=Object.values(e).map(async s=>{try{(await D.getConversations(t)).some(p=>p.id===s.id)?await D.updateConversation(s.id,s):await D.createConversation(t,s)}catch(i){throw console.warn(`Failed to save conversation ${s.id} to Supabase:`,i),i}});await Promise.all(o),console.log("üîç [ConversationService] Synced to Supabase successfully")}catch(o){if(console.error("üîç [ConversationService] Failed to sync to Supabase:",o),a<3){const s=1e3*Math.pow(2,a);return console.warn(`üîÑ [ConversationService] Retrying in ${s}ms (attempt ${a+1}/3)...`),await new Promise(i=>setTimeout(i,s)),this.setConversations(e,a+1)}else console.error("‚ùå [ConversationService] Supabase sync failed after 3 attempts"),P(async()=>{const{toastService:s}=await import("./services-BOnxyvYK.js").then(i=>i.n);return{toastService:s}},__vite__mapDeps([6,1,2,3,4,5,0])).then(({toastService:s})=>{s.warning("Changes saved locally. Will sync when online.")}).catch(s=>console.error("Failed to show toast:",s))}}static createConversation(e,a){const t=Date.now(),o=e===x;return{id:a||(o?R:`conv_${t}`),title:e||x,messages:[],createdAt:t,updatedAt:t,isActive:!0,isGameHub:o}}static async addConversation(e){if(this.pendingCreations.has(e.id))return console.log("üîç [ConversationService] Deduplicating conversation creation for:",e.id),await this.pendingCreations.get(e.id);const a=this._addConversationInternal(e);this.pendingCreations.set(e.id,a);try{return await a}finally{this.pendingCreations.delete(e.id)}}static async _addConversationInternal(e){const a=await this.getCurrentUserId(),t=await this.getConversations();if((e.isGameHub||e.title===x)&&Object.values(t).find(s=>s.isGameHub||s.title===x||s.id===R))return{success:!1,reason:'A "Game Hub" conversation already exists. Please use the existing one or create a conversation with a different title.'};if(t[e.id]=e,console.log("üîç [ConversationService] Adding new conversation:",e.id,e.title),a)try{const o=await D.createConversation(a,e);o&&(o!==e.id&&(delete t[e.id],e.id=o,t[o]=e),console.log("üîç [ConversationService] Created in Supabase with ID:",o))}catch(o){console.error("üîç [ConversationService] Failed to create in Supabase:",o)}return await this.setConversations(t),console.log("üîç [ConversationService] New conversation persisted successfully"),{success:!0}}static async updateConversation(e,a){const t=await this.getCurrentUserId(),o=await this.getConversations();if(o[e]){if(o[e]={...o[e],...a,updatedAt:Date.now()},t)try{await D.updateConversation(e,o[e]),console.log("üîç [ConversationService] Updated conversation in Supabase:",e)}catch(s){console.error("üîç [ConversationService] Failed to update in Supabase:",s)}await this.setConversations(o)}}static async deleteConversation(e){const a=await this.getCurrentUserId(),t=await this.getConversations(),o=t[e];if(o!=null&&o.isGameHub||e===R)throw console.warn("üîç [ConversationService] Cannot delete Game Hub conversation"),k.warning("Cannot delete the Game Hub conversation. It's your main conversation space!"),new Error("Cannot delete the Game Hub conversation");if(delete t[e],a)try{await D.deleteConversation(e),console.log("üîç [ConversationService] Deleted conversation from Supabase:",e)}catch(s){console.error("üîç [ConversationService] Failed to delete from Supabase:",s)}await this.setConversations(t)}static async addMessage(e,a){const t=await this.getConversations();if(t[e]){const o=t[e];return o.messages.some(i=>i.id===a.id)?(console.warn(`‚ö†Ô∏è [ConversationService] Message ${a.id} already exists in conversation ${e}, skipping`),{success:!0,reason:"Message already exists"}):(o.messages.push(a),o.updatedAt=Date.now(),await this.setConversations(t),B.saveConversation(o).catch(i=>console.warn("Failed to save conversation to cache:",i)),P(async()=>{const{authService:i}=await import("./core-services-CiRMA0K5.js").then(n=>n.e);return{authService:i}},__vite__mapDeps([0,1,2,3,4,5,6])).then(({authService:i})=>{const n=i.getCurrentUser();n!=null&&n.authUserId&&B.saveChatContext(n.authUserId,{recentMessages:o.messages.slice(-10),userPreferences:{},gameContext:{},conversationSummary:o.title}).catch(p=>console.warn("Failed to save chat context:",p))}).catch(i=>console.warn("Failed to import authService:",i)),{success:!0})}return{success:!1,reason:"Conversation not found"}}static async getActiveConversation(){const e=await this.getConversations();return Object.values(e).find(t=>t.isActive)||null}static async getUsageStats(){const{authService:e}=await P(async()=>{const{authService:s}=await import("./core-services-CiRMA0K5.js").then(i=>i.e);return{authService:s}},__vite__mapDeps([0,1,2,3,4,5,6])),a=e.getCurrentUser(),t=await this.getConversations(),o=await this.getUserTier();return a?{textQueries:{current:a.textCount||0,limit:a.textLimit||55,tier:o},imageQueries:{current:a.imageCount||0,limit:a.imageLimit||25,tier:o},conversations:{current:Object.keys(t).length,tier:o}}:{textQueries:{current:0,limit:55,tier:o},imageQueries:{current:0,limit:25,tier:o},conversations:{current:0,tier:o}}}static async setActiveConversation(e){const a=await this.getConversations();Object.values(a).forEach(t=>{t.isActive=!1}),a[e]&&(a[e].isActive=!0),await this.setConversations(a)}static async clearAllConversations(){await this.setConversations({});try{await A.clear()}catch(e){console.warn("Failed to clear conversation cache:",e)}}static async clearConversation(e){const a=await this.getConversations();a[e]&&(a[e]={...a[e],messages:[],updatedAt:Date.now()},await this.setConversations(a),await B.saveConversation(a[e]))}static async updateSubTabContent(e,a,t){const s=(await this.getConversations())[e];if(!s||!s.subtabs)throw new Error("Conversation or sub-tabs not found");const i=s.subtabs.map(n=>n.id===a?{...n,content:t,isNew:!1,status:"loaded"}:n);await this.updateConversation(e,{subtabs:i,updatedAt:Date.now()})}static async getConversation(e,a=!0){const o=(await this.getConversations())[e]||null;return o}static async ensureGameHubExists(){const e=await this.getConversations(),a=Object.values(e).find(o=>o.isGameHub||o.id===R||o.title===x);if(a)return console.log("üîç [ConversationService] Game Hub already exists:",a.id),a;console.log("üîç [ConversationService] Creating Game Hub...");const t=this.createConversation(x,R);return await this.addConversation(t),console.log("üîç [ConversationService] Game Hub created successfully"),t}static async setSessionState(e,a){await this.updateConversation(e,{isActiveSession:a,updatedAt:Date.now()})}static async updateGameProgress(e,a,t){await this.updateConversation(e,{gameProgress:a,activeObjective:t,updatedAt:Date.now()})}}I(j,"pendingCreations",new Map),I(j,"conversationsCache",null),I(j,"CACHE_TTL",2e3);const ie=Object.freeze(Object.defineProperty({__proto__:null,ConversationService:j},Symbol.toStringTag,{value:"Module"})),$=!0;q.HARM_CATEGORY_HARASSMENT,F.BLOCK_MEDIUM_AND_ABOVE,q.HARM_CATEGORY_HATE_SPEECH,F.BLOCK_MEDIUM_AND_ABOVE,q.HARM_CATEGORY_SEXUALLY_EXPLICIT,F.BLOCK_MEDIUM_AND_ABOVE,q.HARM_CATEGORY_DANGEROUS_CONTENT,F.BLOCK_MEDIUM_AND_ABOVE;class ne{constructor(){I(this,"genAI");I(this,"flashModel");I(this,"proModel");I(this,"flashModelWithGrounding");I(this,"edgeFunctionUrl");I(this,"pendingRequests",new Map);const e="https://qajcxgkqloumogioomiz.supabase.co";this.edgeFunctionUrl=`${e}/functions/v1/ai-proxy`,this.genAI={},this.flashModel={},this.proModel={},this.flashModelWithGrounding={}}async callEdgeFunction(e){const{data:{session:a}}=await te.auth.getSession();if(!a)throw new Error("Not authenticated");const t=await fetch(this.edgeFunctionUrl,{method:"POST",headers:{Authorization:`Bearer ${a.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const o=await t.json();throw new Error(o.error||"AI service error")}return await t.json()}checkSafetyResponse(e){var t,o;if((t=e.response.promptFeedback)!=null&&t.blockReason)return{safe:!1,reason:`Content blocked: ${e.response.promptFeedback.blockReason}`};const a=(o=e.response.candidates)==null?void 0:o[0];return a?a.finishReason==="SAFETY"?{safe:!1,reason:"Response blocked by safety filters"}:{safe:!0}:{safe:!1,reason:"No response generated"}}async getChatResponseWithDeduplication(e,a,t,o,s=!1,i,n){const p=`${e.id}_${t}_${o}_${s}`,d=this.pendingRequests.get(p);if(d)return console.warn("‚ö†Ô∏è [AIService] Duplicate request detected, returning existing promise"),d;const v=this.getChatResponseInternal(e,a,t,o,s,i,n);this.pendingRequests.set(p,v);try{return await v}finally{this.pendingRequests.delete(p)}}async getChatResponse(e,a,t,o,s=!1,i,n){return this.getChatResponseWithDeduplication(e,a,t,o,s,i,n)}async getChatResponseInternal(e,a,t,o,s=!1,i,n){const{ConversationService:p}=await P(async()=>{const{ConversationService:h}=await Promise.resolve().then(()=>ie);return{ConversationService:h}},void 0),d=s?await p.canSendImageQuery():await p.canSendTextQuery();if(!d.allowed)throw new Error(d.reason||"Query limit reached. Please upgrade your tier.");console.log(`üìä [AIService] Query limit check passed. ${s?"Image":"Text"} queries: ${d.used}/${d.limit}`);const v=`ai_response_${e.id}_${t.substring(0,50)}_${o}`,S=await A.get(v,!0);if(S)return{...S,metadata:{...S.metadata,fromCache:!0}};let C="";const E=a.profileData,u=W(e,t,a,o,s,E);let w="";!e.isGameHub&&e.gameTitle&&e.genre&&(w=J.generateImmersionContext({gameTitle:e.gameTitle,genre:e.genre,currentLocation:e.activeObjective,playerProgress:e.gameProgress}));const m=u+C+`

`+w;if(console.log("ü§ñ [AIService] Processing request:",{hasImages:s,hasImageData:!!i,imageDataLength:i==null?void 0:i.length,conversationId:e.id}),n!=null&&n.aborted)throw new DOMException("Request was aborted","AbortError");try{const h=t.toLowerCase().includes("release")||t.toLowerCase().includes("new games")||t.toLowerCase().includes("coming out")||t.toLowerCase().includes("this week")||t.toLowerCase().includes("this month")||t.toLowerCase().includes("latest")||t.toLowerCase().includes("news")||t.toLowerCase().includes("announced")||t.toLowerCase().includes("update")||t.toLowerCase().includes("patch")||t.toLowerCase().includes("current")||t.toLowerCase().includes("recent")||e.gameTitle&&(e.gameTitle.toLowerCase().includes("2025")||e.gameTitle.toLowerCase().includes("2024"));let r;if($){let _;s&&i&&(_=i.split(",")[1]);const N="gemini-2.5-flash-preview-09-2025",Y=h&&!s?[{googleSearchRetrieval:{}}]:[],M=await this.callEdgeFunction({prompt:m,image:_,temperature:.7,maxTokens:2048,requestType:s?"image":"text",model:N,tools:Y.length>0?Y:void 0});if(!M.success)throw new Error(M.response||"AI request failed");r=M.response}if(n!=null&&n.aborted)throw new DOMException("Request was aborted","AbortError");const{cleanContent:y,tags:l}=z(r),g={content:y,suggestions:[],otakonTags:l,rawContent:r,metadata:{model:"gemini-flash",timestamp:Date.now(),cost:0,tokens:0}},{SupabaseService:c}=await P(async()=>{const{SupabaseService:_}=await import("./core-services-CiRMA0K5.js").then(N=>N.f);return{SupabaseService:_}},__vite__mapDeps([0,1,2,3,4,5,6]));c.getInstance().recordQuery(a.authUserId,s?"image":"text").catch(_=>console.warn("Failed to record query usage:",_));const{authService:O}=await P(async()=>{const{authService:_}=await import("./core-services-CiRMA0K5.js").then(N=>N.e);return{authService:_}},__vite__mapDeps([0,1,2,3,4,5,6]));return O.refreshUser().catch(_=>console.warn("Failed to refresh user after query:",_)),A.set(v,g,3600*1e3).catch(_=>console.warn("Failed to cache AI response:",_)),g}catch(h){console.error("AI Service Error:",h);const r=h.message||"";if(r.includes("blocked")||r.includes("SAFETY")||r.includes("content policy"))throw k.error("Your message contains inappropriate content"),new Error("Content blocked by safety filters");k.error("AI response failed. Please try again.");const y=await V.handleAIError(h,{operation:"getChatResponse",conversationId:e.id,userId:a.id,timestamp:Date.now(),retryCount:0});if(y.type==="retry")return this.getChatResponse(e,a,t,o,s,i,n);if(y.type==="user_notification")return{content:y.message||"I'm having trouble thinking right now. Please try again later.",suggestions:["Try again","Check your connection","Contact support"],otakonTags:new Map,rawContent:y.message||"Error occurred",metadata:{model:"error",timestamp:Date.now(),cost:0,tokens:0}};throw new Error("Failed to get response from AI service.")}}async getChatResponseWithStructure(e,a,t,o,s=!1,i,n){const p=`ai_structured_${e.id}_${t.substring(0,50)}_${o}`,d=await A.get(p,!0);if(d)return{...d,metadata:{...d.metadata,fromCache:!0}};const v=W(e,t,a,o,s);let S="";!e.isGameHub&&e.gameTitle&&e.genre&&(S=J.generateImmersionContext({gameTitle:e.gameTitle,genre:e.genre,currentLocation:e.activeObjective,playerProgress:e.gameProgress}));const C=`

**ENHANCED RESPONSE FORMAT:**
In addition to your regular response, provide structured data in the following optional fields:

1. **followUpPrompts** (array of 3-4 strings): Generate contextual follow-up questions directly related to your response content
   ${e.isGameHub?"":`
   - Session Mode: ${o?"PLAYING MODE - User is actively playing":"PLANNING MODE - User is preparing/strategizing"}
   - ${o?'Generate immediate, actionable prompts (e.g., "How do I beat this boss?", "What should I do next?")':'Generate strategic, planning prompts (e.g., "What should I prepare?", "What builds are recommended?")'}`}
2. **progressiveInsightUpdates** (array): If conversation provides new info, update existing subtabs (e.g., story_so_far, characters)
3. **stateUpdateTags** (array): Detect game events (e.g., "OBJECTIVE_COMPLETE: true", "TRIUMPH: Boss Name")
4. **gamePillData** (object): ${e.isGameHub?"Set shouldCreate: true if user asks about a specific game, and include game details with pre-filled wikiContent":"Set shouldCreate: false (already in game tab)"}

Note: These are optional enhancements. If not applicable, omit or return empty arrays.
`,E=v+S+C;if(console.log("ü§ñ [AIService] Processing structured request:",{hasImages:s,conversationId:e.id,useStructuredMode:!s}),n!=null&&n.aborted)throw new DOMException("Request was aborted","AbortError");try{const u=t.toLowerCase().includes("release")||t.toLowerCase().includes("new games")||t.toLowerCase().includes("latest")||t.toLowerCase().includes("news")||t.toLowerCase().includes("announced")||t.toLowerCase().includes("update")||t.toLowerCase().includes("patch")||t.toLowerCase().includes("current")||t.toLowerCase().includes("recent")||e.gameTitle&&(e.gameTitle.toLowerCase().includes("2025")||e.gameTitle.toLowerCase().includes("2024"));if($){let h;s&&i&&(h=i.split(",")[1]);const r="gemini-2.5-flash-preview-09-2025",y=u&&!s?[{googleSearchRetrieval:{}}]:[],l=await this.callEdgeFunction({prompt:E,image:h,temperature:.7,maxTokens:2048,requestType:s?"image":"text",model:r,tools:y.length>0?y:void 0});if(!l.success)throw new Error(l.response||"AI request failed");const g=l.response,{cleanContent:c,tags:T}=z(g),O={content:c,suggestions:T.get("SUGGESTIONS")||[],otakonTags:T,rawContent:g,metadata:{model:r,timestamp:Date.now(),cost:0,tokens:0}};return A.set(p,O,3600*1e3).catch(_=>console.warn(_)),O}const w=u&&!s?this.flashModelWithGrounding:this.flashModel;u&&!s&&console.log("üåê [AIService] Using Google Search grounding for structured response:",{gameTitle:e.gameTitle,query:t.substring(0,50)+"..."});let m;if(s&&i){const h=i.split(";")[0].split(":")[1]||"image/jpeg",r=i.split(",")[1];m=[{text:E},{inlineData:{mimeType:h,data:r}}];const l=await(await w.generateContent(m)).response.text(),{cleanContent:g,tags:c}=z(l),T={content:g,suggestions:c.get("SUGGESTIONS")||[],otakonTags:c,rawContent:l,metadata:{model:"gemini-2.5-flash-preview-09-2025",timestamp:Date.now(),cost:0,tokens:0}};return A.set(p,T,3600*1e3).catch(O=>console.warn(O)),T}try{const h=await w.generateContent({contents:[{role:"user",parts:[{text:E}]}],generationConfig:{responseMimeType:"application/json",responseSchema:{type:b.OBJECT,properties:{content:{type:b.STRING,description:"The main chat response for the user"},followUpPrompts:{type:b.ARRAY,items:{type:b.STRING},description:"3-4 contextual follow-up questions"},progressiveInsightUpdates:{type:b.ARRAY,items:{type:b.OBJECT,properties:{tabId:{type:b.STRING},title:{type:b.STRING},content:{type:b.STRING}}}},stateUpdateTags:{type:b.ARRAY,items:{type:b.STRING}},gamePillData:{type:b.OBJECT,properties:{shouldCreate:{type:b.BOOLEAN},gameName:{type:b.STRING},genre:{type:b.STRING},wikiContent:{type:b.STRING,description:"JSON string containing pre-filled subtab content"}}}},required:["content"]}}}),r=this.checkSafetyResponse(h);if(!r.safe)throw k.error("Unable to generate response due to content policy"),new Error(r.reason);const y=await h.response.text(),l=JSON.parse(y);let g=l.content||"";g=g.replace(/^[\s\]}\[{),]+/g,"").replace(/(Hint:)(\s*)([A-Z])/g,`$1

$3`).replace(/\s*[\]}\s]*(?=\s*(?:Enhanced Response Data|followUpPrompts|progressiveInsightUpdates|stateUpdateTags|gamePillData|$))/gi,"").replace(/Enhanced Response Data\s*/gi,"").replace(/followUpPrompts:\s*\[[\s\S]*?\](?=\s*(?:progressiveInsightUpdates|stateUpdateTags|gamePillData|$))/gi,"").replace(/progressiveInsightUpdates:\s*\[[\s\S]*?\](?=\s*(?:followUpPrompts|stateUpdateTags|gamePillData|$))/gi,"").replace(/stateUpdateTags:\s*\[[\s\S]*?\](?=\s*(?:followUpPrompts|progressiveInsightUpdates|gamePillData|$))/gi,"").replace(/gamePillData:\s*\{[\s\S]*?\}(?=\s*$)/gi,"").replace(/^\s*[\]}]\s*$/gm,"").replace(/\{[\s\S]*?"OTAKON_[A-Z_]+":[\s\S]*?\}/g,"").replace(/([.!?])([A-Z])/g,`$1

$2`).replace(/\n{4,}/g,`

`).trim();let c=l.gamePillData;if(c&&typeof c.wikiContent=="string")try{c={...c,wikiContent:JSON.parse(c.wikiContent)}}catch{console.warn("Failed to parse wikiContent as JSON")}const T={content:g,suggestions:l.followUpPrompts||[],otakonTags:new Map,rawContent:y,metadata:{model:"gemini-2.5-flash-preview-09-2025",timestamp:Date.now(),cost:0,tokens:0},followUpPrompts:l.followUpPrompts,progressiveInsightUpdates:l.progressiveInsightUpdates,stateUpdateTags:l.stateUpdateTags,gamePillData:c};return A.set(p,T,3600*1e3).catch(O=>console.warn(O)),T}catch(h){console.warn("JSON mode failed, falling back to OTAKON_TAG parsing:",h);let r;if($){const c=await this.callEdgeFunction({prompt:E,temperature:.7,maxTokens:2048,requestType:"text",model:"gemini-2.5-flash-preview-09-2025"});if(!c.success)throw new Error(c.response||"AI request failed");r=c.response}const{cleanContent:y,tags:l}=z(r),g={content:y,suggestions:l.get("SUGGESTIONS")||[],otakonTags:l,rawContent:r,metadata:{model:"gemini-2.5-flash-preview-09-2025",timestamp:Date.now(),cost:0,tokens:0}};return A.set(p,g,3600*1e3).catch(c=>console.warn(c)),g}}catch(u){console.error("Structured AI Service Error:",u);const w=u.message||"";if(w.includes("blocked")||w.includes("SAFETY")||w.includes("content policy"))throw k.error("Your message contains inappropriate content"),new Error("Content blocked by safety filters");k.error("AI response failed. Please try again.");const m=await V.handleAIError(u,{operation:"getChatResponseWithStructure",conversationId:e.id,userId:a.id,timestamp:Date.now(),retryCount:0});if(m.type==="retry")return this.getChatResponseWithStructure(e,a,t,o,s,i,n);if(m.type==="user_notification")return{content:m.message||"I'm having trouble thinking right now. Please try again later.",suggestions:["Try again","Check your connection","Contact support"],otakonTags:new Map,rawContent:m.message||"Error occurred",metadata:{model:"error",timestamp:Date.now(),cost:0,tokens:0}};throw new Error("Failed to get structured response from AI service.")}}async generateInitialInsights(e,a,t,o){const s=o?o.substring(0,50).replace(/[^a-z0-9]/gi,""):"default",i=`insights_${e.toLowerCase().replace(/\s+/g,"-")}_${s}`,n=await A.get(i);if(n)return n;const p=U[a]||U.Default,d=p.map(u=>`- ${u.title} (${u.id}): ${u.instruction}`).join(`
`),v=t||K.getDefaultProfile(),S=K.buildProfileContext(v),C=o?`
Conversation Context:
${o}

‚úÖ USE THIS CONTEXT to generate relevant subtab content based on what was discussed!
`:"",E=`
You are a gaming assistant generating initial content for ${e} (${a} game).

Player Profile:
${S}
${C}
Instructions for each tab:
${d}

CRITICAL FORMATTING RULES:
1. Return ONLY valid JSON, nothing else (no markdown fences, no explanations)
2. Use this exact format: {"tab_id": "content", "tab_id": "content"}
3. Each content value should be 2-4 detailed paragraphs (150-250 words per tab for comprehensive insights)
4. Keep content STRUCTURED and informative:
   - Use **bold** for key terms and important points
   - Use *italic* for emphasis
   - Use \\n\\n for paragraph breaks (double newline)
   - Escape ALL quotes with \\"
   - NO line breaks inside strings (use \\n instead)
   - Use bullet points with ‚Ä¢ for lists when appropriate
5. Content should be detailed, spoiler-free, and helpful for players at this stage
6. Adapt content style based on the Player Profile above
7. YOU MUST generate comprehensive content for ALL ${p.length} tab IDs listed below
8. Provide actionable advice, specific details, and contextual information

Example valid JSON (TARGET THIS LEVEL OF DETAIL):
{
  "story_so_far": "Following the disastrous **Konpeki Plaza heist**, you barely escaped with your life. The Relic, an advanced biochip containing the digital ghost of legendary rockerboy **Johnny Silverhand**, is now killing you from the inside. You have mere weeks to find a solution.\\n\\nYou've been working with **Takemura**, a disgraced Arasaka bodyguard seeking to clear his name and expose the conspiracy behind the assassination of his former boss. The investigation has led you through Night City's criminal underworld, uncovering corporate secrets and dangerous truths.\\n\\nYour current location in **Jig-Jig Street** suggests you're deep in the heart of Westbrook, a district known for high-end entertainment and corporate intrigue. Every decision matters as you race against time.",
  "quest_log": "**Main Quest: The Space in Between**\\nTakemura has information crucial to your survival. His message indicated urgency and possible security concerns. Meeting him could provide vital leads on removing the Relic or expose you to Arasaka operatives still hunting you both.\\n\\n**Recommended Side Activities:**\\n‚Ä¢ Explore Jig-Jig Street for vendors offering rare cyberware upgrades\\n‚Ä¢ Check nearby ripperdocs for health monitoring and neural optimization\\n‚Ä¢ Investigate gig opportunities from local fixers to build street cred",
  "build_optimization": "Based on your current progress, consider these optimization strategies:\\n\\n**Cyberware Focus:** Invest in neural processors and reflex boosters to improve combat responsiveness. The **Sandevistan** operating system offers time dilation for tactical advantages during firefights.\\n\\n**Skill Synergies:** Balance Technical Ability for crafting legendary gear with Intelligence for quickhacking capabilities. This combination allows both direct combat and stealthy netrunning approaches.\\n\\n**Weapon Loadout:** Maintain variety - keep a silenced pistol for stealth, a tech weapon for cover penetration, and a power weapon for raw damage.",
  "boss_strategy": "Upcoming encounters in this arc will test your combat adaptability. **Tactical Recommendations:**\\n\\nYour opponents likely use advanced corporate-grade cyberware and coordinated tactics. Prioritize cover-based gameplay and use the environment to your advantage. Explosive barrels and electrical panels can turn the battlefield in your favor.\\n\\n**Key Strategies:**\\n‚Ä¢ Maintain distance and use tech weapons to attack through walls\\n‚Ä¢ Neutralize enemy netrunners first to prevent quickhacks\\n‚Ä¢ Stock up on MaxDoc inhalers and bounce-back injectors\\n‚Ä¢ Save frequently before major confrontations",
  "hidden_paths": "**Jig-Jig Street Secrets:**\\nLook for the **Clouds** entertainment establishment - there's a hidden databank terminal behind the reception desk containing valuable corporate intel. Access requires moderate Technical Ability or convincing dialogue options.\\n\\n**Exploration Tip:**\\nThe alleyways near the main street have vertical access points leading to rooftop areas. These elevated positions offer tactical advantages and often contain loot crates with rare crafting components. Watch for glowing yellow ledges indicating climbable surfaces."
}

NOW generate COMPREHENSIVE valid JSON for ALL these tab IDs (MUST include every single one): ${p.map(u=>u.id).join(", ")}
`;try{let u;if($){const h=await this.callEdgeFunction({prompt:E,temperature:.7,maxTokens:5e3,requestType:"text",model:"gemini-2.5-flash-preview-09-2025"});if(!h.success)throw new Error(h.response||"AI request failed");u=h.response}const w=u.replace(/```json\n?|\n?```/g,"").trim();let m;try{m=JSON.parse(w)}catch(h){console.error("JSON parse failed, attempting to fix malformed JSON:",h),console.error("Raw response (first 500 chars):",u.substring(0,500));let r=w;const y=r.lastIndexOf('",');if(y>0&&!r.endsWith("}"))r=r.substring(0,y+1)+`
}`,console.error("‚ö†Ô∏è Detected truncated response, using last complete property");else if(r=r.replace(/("(?:[^"\\]|\\.)*?)(?=\n\s*"[^"]+"\s*:|$)/gm,l=>l.endsWith('"')?l:l+'"'),r=r.replace(/"\s*\n\s*"/g,`",
"`),!r.endsWith("}")){const l=(r.match(/{/g)||[]).length,g=(r.match(/}/g)||[]).length;for(let c=0;c<l-g;c++)r+=`
}`}try{m=JSON.parse(r),console.error("‚úÖ Successfully fixed malformed JSON"),console.error("‚úÖ Recovered",Object.keys(m).length,"insights");const l=U[a]||U.Default,g=l.filter(c=>!m[c.id]);g.length>0&&(console.error(`‚ö†Ô∏è AI only generated ${Object.keys(m).length}/${l.length} insights, filling ${g.length} missing tabs with fallback`),g.forEach(c=>{m[c.id]=`Welcome to **${c.title}** for ${e}!

This section will be populated as you explore and chat about the game.`}))}catch{console.error("‚ùå Could not fix JSON, using fallback content for all tabs"),console.error("‚ùå Raw response that failed (first 1000 chars):",u.substring(0,1e3)),console.error("‚ùå This may be an AI generation issue - consider retrying or checking prompt"),m=(U[a]||U.Default).reduce((c,T)=>(c[T.id]=`Welcome to **${T.title}** for ${e}!

This section will be populated as you explore and chat about the game.`,c),{})}}return await A.set(i,m,1440*60*1e3),m}catch(u){console.error("Failed to generate initial insights:",u);const w=u.message||"";return w.includes("blocked")||w.includes("SAFETY")||w.includes("content policy")?(k.warning("Unable to generate insights due to content policy"),{}):(k.warning("Failed to generate game insights. You can still continue chatting!"),{})}}}const ge=new ne;export{se as C,R as G,G as S,he as T,H as U,P as _,j as a,ge as b,U as i,pe as n};
//# sourceMappingURL=chat-services-Br033muk.js.map
