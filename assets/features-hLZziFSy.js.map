{"version":3,"file":"features-hLZziFSy.js","sources":["../../src/components/ui/ManualUploadToggle.tsx","../../src/components/ui/ScreenshotButton.tsx","../../src/components/ui/DownloadIcon.tsx","../../src/components/ui/UserAvatar.tsx","../../src/components/ui/AIAvatar.tsx","../../src/components/ui/TypingIndicator.tsx","../../src/components/ui/SendIcon.tsx","../../src/components/ui/TTSControls.tsx","../../src/components/features/SuggestedPrompts.tsx","../../src/components/ui/ActiveSessionToggle.tsx","../../src/components/features/SubTabs.tsx","../../src/components/features/ChatInterface.tsx","../../src/components/features/GameProgressBar.tsx"],"sourcesContent":["import React from 'react';\n\ninterface ManualUploadToggleProps {\n  isManualMode: boolean;\n  onToggle: () => void;\n  isConnected?: boolean;\n}\n\nconst ManualUploadToggle: React.FC<ManualUploadToggleProps> = ({ isManualMode, onToggle, isConnected = false }) => {\n  const title = isManualMode\n    ? 'Manual review is ON (paused). Click to resume auto-sending screenshots.'\n    : 'Auto-sending is ON. Click to pause and review screenshots manually.';\n\n  // Only show when connected to PC\n  if (!isConnected) {\n    return null;\n  }\n\n  return (\n    <button\n      type=\"button\"\n      onClick={onToggle}\n      className={`w-12 h-12 sm:w-14 sm:h-14 rounded-xl bg-gradient-to-r from-[#2E2E2E]/90 to-[#1C1C1C]/90 flex items-center justify-center transition-all duration-300 hover:scale-105 ${\n        isManualMode ? 'text-yellow-400' : 'text-emerald-400'\n      }`}\n      aria-pressed={isManualMode}\n      aria-label={isManualMode ? 'Resume auto-sending screenshots' : 'Pause and review screenshots'}\n      title={title}\n    >\n      {isManualMode ? (\n        // Pause icon - Manual mode ON (paused/reviewing)\n        <svg className=\"w-5 h-5 sm:w-6 sm:h-6\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path d=\"M6 4h4v16H6V4zm8 0h4v16h-4V4z\"/>\n        </svg>\n      ) : (\n        // Play icon - Auto mode ON (playing/sending)\n        <svg className=\"w-5 h-5 sm:w-6 sm:h-6\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path d=\"M8 5v14l11-7z\"/>\n        </svg>\n      )}\n    </button>\n  );\n};\n\nexport default React.memo(ManualUploadToggle);","import React, { useEffect, useRef, useState } from 'react';\nimport { UserTier } from '../../types';\nimport { send } from '../../services/websocketService';\n\ninterface ScreenshotButtonProps {\n  isConnected: boolean;\n  isProcessing: boolean;\n  isManualUploadMode: boolean;\n  onRequestConnect?: () => void;\n  usage?: { tier: UserTier };\n}\n\ntype Mode = 'single' | 'multi';\n\nconst ScreenshotButton: React.FC<ScreenshotButtonProps> = ({ \n  isConnected, \n  isProcessing, \n  isManualUploadMode, \n  onRequestConnect,\n  usage \n}) => {\n  const [mode, setMode] = useState<Mode>('single');\n  const [menuOpen, setMenuOpen] = useState(false);\n  const rootRef = useRef<HTMLDivElement>(null);\n  const btnRef = useRef<HTMLButtonElement>(null);\n  const longPressRef = useRef<number | null>(null);\n  const [showHint, setShowHint] = useState(false);\n\n  // Check if user can access multishot\n  const canUseMultishot = usage?.tier === 'pro' || usage?.tier === 'vanguard_pro';\n  const isFreeUser = usage?.tier === 'free';\n\n  // Persist mode - ensure free users can't have multishot saved\n  useEffect(() => {\n    const saved = localStorage.getItem('otakon_screenshot_mode');\n    if (saved === 'single' || (saved === 'multi' && canUseMultishot)) {\n      setMode(saved);\n    } else if (saved === 'multi' && !canUseMultishot) {\n      // Reset to single if free user had multishot saved\n      setMode('single');\n      localStorage.setItem('otakon_screenshot_mode', 'single');\n    }\n    // Don't show hint by default - only show on first interaction\n    setShowHint(false);\n  }, [canUseMultishot]);\n\n  const setModeAndPersist = (m: Mode) => {\n    // Prevent free users from setting multishot mode\n    if (m === 'multi' && !canUseMultishot) {\n      return;\n    }\n    setMode(m);\n    localStorage.setItem('otakon_screenshot_mode', m);\n    setMenuOpen(false);\n  };\n\n  // Close on outside click\n  useEffect(() => {\n    const handler = (e: MouseEvent) => {\n      if (!rootRef.current) {\n        return;\n      }\n      if (!rootRef.current.contains(e.target as Node)) {\n        setMenuOpen(false);\n      }\n    };\n    if (menuOpen) {\n      document.addEventListener('mousedown', handler, { passive: true } as any);\n    }\n    return () => document.removeEventListener('mousedown', handler as any);\n  }, [menuOpen]);\n\n  const openMenu = (e?: { preventDefault?: () => void; stopPropagation?: () => void }) => {\n    e?.preventDefault?.();\n    e?.stopPropagation?.();\n    setMenuOpen(true);\n  };\n\n\n  const handleContextMenu = (e: React.MouseEvent) => {\n    // Explicitly handle right-click\n    e.preventDefault();\n    e.stopPropagation();\n    if (!isConnected) {\n      onRequestConnect?.();\n      return;\n    }\n    openMenu();\n  };\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    // Right-button fallback\n    if (e.button === 2) {\n      e.preventDefault();\n      e.stopPropagation();\n      if (!isConnected) {\n        onRequestConnect?.();\n        return;\n      }\n      openMenu();\n    }\n  };\n\n  const handleTouchStart = () => {\n    // Long-press 1.75s\n    if (longPressRef.current) {\n      window.clearTimeout(longPressRef.current);\n    }\n    longPressRef.current = window.setTimeout(() => {\n      if (!isConnected) {\n        onRequestConnect?.();\n        return;\n      }\n      openMenu();\n    }, 1750);\n  };\n\n  const clearLongPress = () => {\n    if (longPressRef.current) {\n      window.clearTimeout(longPressRef.current);\n      longPressRef.current = null;\n    }\n  };\n\n  const handleClick = async () => {\n    if (!isConnected) { onRequestConnect?.(); return; }\n    if (isProcessing) {\n      return;\n    }\n    \n    // Prevent multishot for free users\n    if (mode === 'multi' && !canUseMultishot) {\n      return;\n    }\n    \n    const processImmediate = isManualUploadMode ? false : mode === 'single';\n    const msg: any = {\n      type: 'screenshot_request',\n      mode,\n      processImmediate,\n    };\n    if (mode === 'multi') {\n      msg.count = 5;\n    }\n    \n    // Send screenshot request via websocket\n    if (typeof send === 'function') {\n      send(msg);\n      console.log('üì∏ Screenshot request sent:', msg);\n    } else {\n      console.warn('WebSocket send function not available');\n    }\n  };\n\n  const handleMultishotClick = () => {\n    if (!canUseMultishot) {\n      // Show upgrade prompt for free users\n      setMenuOpen(false);\n      // You can add an upgrade modal trigger here if needed\n      return;\n    }\n    setModeAndPersist('multi');\n  };\n\n  return (\n    <div ref={rootRef} className=\"relative\">\n      <button\n        ref={btnRef}\n        type=\"button\"\n        onClick={handleClick}\n        onContextMenu={handleContextMenu}\n        onMouseDown={handleMouseDown}\n        onTouchStart={handleTouchStart}\n        onTouchEnd={clearLongPress}\n        onTouchCancel={clearLongPress}\n        aria-disabled={!isConnected || isProcessing}\n        className={`${isConnected ? 'text-emerald-400' : 'text-[#8A8A8A]'} w-12 h-12 sm:w-14 sm:h-14 rounded-xl bg-gradient-to-r from-[#2E2E2E]/90 to-[#1C1C1C]/90 flex items-center justify-center transition-all duration-300 ${isConnected ? 'hover:scale-105' : 'opacity-70 cursor-pointer hover:opacity-90'} ${isProcessing ? 'animate-pulse' : ''}`}\n        title={isConnected ? 'Screenshot (right-click/long-press to change mode)' : 'Connect your PC to enable screenshots'}\n      >\n        {mode === 'single' ? (\n          // Monitor with capture corner (single)\n          <svg className=\"w-5 h-5 sm:w-6 sm:h-6\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" aria-hidden=\"true\">\n            <rect x=\"3\" y=\"4\" width=\"18\" height=\"12\" rx=\"2\" />\n            <path d=\"M8 20h8\" />\n            <path d=\"M7 7h3M7 10h3M14 7h3\" />\n            <path d=\"M4 3v4M4 3h4\" />\n          </svg>\n        ) : (\n          // Stacked monitors (multi)\n          <svg className=\"w-5 h-5 sm:w-6 sm:h-6\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" aria-hidden=\"true\">\n            <rect x=\"4\" y=\"5\" width=\"14\" height=\"9\" rx=\"2\" />\n            <rect x=\"6\" y=\"10\" width=\"14\" height=\"9\" rx=\"2\" />\n            <path d=\"M10 22h6\" />\n          </svg>\n        )}\n      </button>\n\n      {showHint && isConnected && (\n        <div className=\"absolute left-1/2 -translate-x-1/2 mt-3 top-full text-xs text-[#CFCFCF] bg-[#101010]/95 border border-[#424242]/60 rounded-lg px-3 py-2 shadow-lg whitespace-nowrap z-50\">\n          <button\n            type=\"button\"\n            onClick={() => { setShowHint(false); localStorage.setItem('otakon_screenshot_hint_seen', '1'); }}\n            className=\"w-full h-full\"\n          >\n            Press & hold (1.75s) or right-click to change mode\n          </button>\n        </div>\n      )}\n\n      {menuOpen && isConnected && (\n        <div className=\"absolute bottom-full right-0 mb-3 bg-[#101010]/98 border border-[#424242]/60 rounded-xl shadow-2xl min-w-[200px] overflow-hidden z-[9999] backdrop-blur-md\">\n          <button \n            onClick={() => setModeAndPersist('single')} \n            className={`w-full text-left px-4 py-3 hover:bg-[#2E2E2E]/60 transition-colors ${mode === 'single' ? 'text-emerald-400' : 'text-[#CFCFCF]'}`}\n          >\n            üì∏ Single Shot {mode === 'single' ? '‚úì' : ''}\n          </button>\n          \n          <button \n            onClick={handleMultishotClick} \n            className={`w-full text-left px-4 py-3 transition-all duration-200 ${\n              canUseMultishot \n                ? `hover:bg-[#2E2E2E]/60 ${mode === 'multi' ? 'text-emerald-400' : 'text-[#CFCFCF]'}` \n                : 'text-[#666666] cursor-not-allowed opacity-60'\n            }`}\n            disabled={!canUseMultishot}\n          >\n            {canUseMultishot ? (\n              <>üì∏ Multi Shot (5) {mode === 'multi' ? '‚úì' : ''}</>\n            ) : (\n              <div className=\"flex items-center justify-between\">\n                <span>üîí Multi Shot (5)</span>\n                <span className=\"text-xs bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] text-white px-2 py-1 rounded-full\">\n                  PRO\n                </span>\n              </div>\n            )}\n          </button>\n          \n          {isFreeUser && (\n            <div className=\"px-4 py-2 text-xs text-[#999999] border-t border-[#424242]/40\">\n              Upgrade to Pro for batch screenshots\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ScreenshotButton;\n\n","import React from 'react';\n\ninterface DownloadIconProps {\n  className?: string;\n}\n\nconst DownloadIcon: React.FC<DownloadIconProps> = ({ className }) => (\n  <svg\n    className={className}\n    fill=\"none\"\n    stroke=\"currentColor\"\n    viewBox=\"0 0 24 24\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    aria-hidden=\"true\"\n  >\n    <path\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      strokeWidth={2}\n      d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"\n    />\n  </svg>\n);\n\nexport default DownloadIcon;\n","import React from 'react';\n\ninterface UserAvatarProps {\n  className?: string;\n}\n\nconst UserAvatar: React.FC<UserAvatarProps> = ({ className }) => (\n  <svg\n    className={className}\n    viewBox=\"0 0 24 24\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    aria-label=\"User Avatar\"\n  >\n    <defs>\n      <linearGradient id=\"avatar-gradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n        <stop offset=\"0%\" stopColor=\"#FF4D4D\" />\n        <stop offset=\"100%\" stopColor=\"#FFAB40\" />\n      </linearGradient>\n    </defs>\n    <circle cx=\"12\" cy=\"12\" r=\"12\" fill=\"url(#avatar-gradient)\" />\n  </svg>\n);\n\nexport default UserAvatar;\n","import React from 'react';\n\ninterface AIAvatarProps {\n  className?: string;\n}\n\nconst AIAvatar: React.FC<AIAvatarProps> = ({ className }) => (\n  <img\n    src=\"/images/AvatarAI.png\"\n    alt=\"AI Avatar\"\n    className={`${className} rounded-full object-cover`}\n    aria-label=\"AI Avatar\"\n  />\n);\n\nexport default AIAvatar;\n","import React from 'react';\n\ninterface TypingIndicatorProps {\n  variant?: 'dots' | 'skeleton' | 'wave' | 'circular';\n  showText?: boolean;\n  className?: string;\n}\n\nconst TypingIndicator: React.FC<TypingIndicatorProps> = ({ \n  variant = 'dots', \n  showText = true, \n  className = '' \n}) => {\n  // Dots animation (default)\n  if (variant === 'dots') {\n    return (\n      <div className={`flex items-center gap-2 py-2 px-3 ${className}`}>\n        <div className=\"flex items-center space-x-1\">\n          <div className=\"w-2 h-2 bg-[#FF4D4D] rounded-full animate-bounce\" style={{ animationDelay: '0ms' }}></div>\n          <div className=\"w-2 h-2 bg-[#FFAB40] rounded-full animate-bounce\" style={{ animationDelay: '150ms' }}></div>\n          <div className=\"w-2 h-2 bg-[#5CBB7B] rounded-full animate-bounce\" style={{ animationDelay: '300ms' }}></div>\n        </div>\n        {showText && <span className=\"text-sm text-[#A3A3A3] font-medium\">AI is thinking...</span>}\n      </div>\n    );\n  }\n\n  // Skeleton animation\n  if (variant === 'skeleton') {\n    return (\n      <div className={`flex flex-col gap-3 py-3 px-4 ${className}`}>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] rounded-full animate-pulse\"></div>\n          <div className=\"flex-1 space-y-2\">\n            <div className=\"h-3 bg-gradient-to-r from-[#FF4D4D]/20 to-[#FFAB40]/20 rounded animate-pulse\" style={{ width: '60%' }}></div>\n            <div className=\"h-3 bg-gradient-to-r from-[#FFAB40]/20 to-[#5CBB7B]/20 rounded animate-pulse\" style={{ width: '80%' }}></div>\n          </div>\n        </div>\n        <div className=\"space-y-2\">\n          <div className=\"h-4 bg-gradient-to-r from-[#5CBB7B]/20 to-[#FF4D4D]/20 rounded animate-pulse\"></div>\n          <div className=\"h-4 bg-gradient-to-r from-[#FF4D4D]/20 to-[#FFAB40]/20 rounded animate-pulse\" style={{ width: '70%' }}></div>\n          <div className=\"h-4 bg-gradient-to-r from-[#FFAB40]/20 to-[#5CBB7B]/20 rounded animate-pulse\" style={{ width: '90%' }}></div>\n        </div>\n        {showText && <span className=\"text-sm text-[#A3A3A3] font-medium\">AI is thinking...</span>}\n      </div>\n    );\n  }\n\n  // Wave animation\n  if (variant === 'wave') {\n    return (\n      <div className={`flex items-center gap-3 py-3 px-4 ${className}`}>\n        <div className=\"flex items-center space-x-1\">\n          <div className=\"w-1 h-4 bg-[#FF4D4D] rounded-full animate-pulse\" style={{ animationDelay: '0ms' }}></div>\n          <div className=\"w-1 h-4 bg-[#FFAB40] rounded-full animate-pulse\" style={{ animationDelay: '150ms' }}></div>\n          <div className=\"w-1 h-4 bg-[#5CBB7B] rounded-full animate-pulse\" style={{ animationDelay: '300ms' }}></div>\n          <div className=\"w-1 h-4 bg-[#FF4D4D] rounded-full animate-pulse\" style={{ animationDelay: '450ms' }}></div>\n        </div>\n        {showText && <span className=\"text-sm text-[#A3A3A3] font-medium\">AI is thinking...</span>}\n      </div>\n    );\n  }\n\n  // Circular progress\n  if (variant === 'circular') {\n    return (\n      <div className={`flex items-center gap-3 py-3 px-4 ${className}`}>\n        <div className=\"relative w-8 h-8\">\n          {/* Outer ring */}\n          <div className=\"absolute inset-0 w-8 h-8 border-2 border-[#424242]/30 rounded-full\"></div>\n          {/* Animated ring */}\n          <div className=\"absolute inset-0 w-8 h-8 border-2 border-transparent border-t-[#E53A3A] border-r-[#D98C1F] border-b-transparent rounded-full animate-spin\"></div>\n          {/* Center dot */}\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <div className=\"w-2 h-2 bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] rounded-full animate-pulse\"></div>\n          </div>\n        </div>\n        {showText && <span className=\"text-sm text-[#A3A3A3] font-medium\">AI is thinking...</span>}\n      </div>\n    );\n  }\n\n  return null;\n};\n\nexport default TypingIndicator;\n","import React from 'react';\n\ninterface SendIconProps {\n  className?: string;\n}\n\nconst SendIcon: React.FC<SendIconProps> = ({ className }) => (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    viewBox=\"0 0 24 24\"\n    fill=\"currentColor\"\n    className={className}\n    aria-hidden=\"true\"\n  >\n    <path d=\"M12 4L4 12h5v8h6v-8h5L12 4z\" />\n  </svg>\n);\n\nexport default SendIcon;\n","import React, { useState, useEffect } from 'react';\r\nimport { ttsService } from '../../services/ttsService';\r\n\r\nconst TTSControls: React.FC = () => {\r\n  const [isSpeaking, setIsSpeaking] = useState(false);\r\n  const [isPaused, setIsPaused] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const handleTTSStarted = () => setIsSpeaking(true);\r\n    const handleTTSStopped = () => {\r\n      setIsSpeaking(false);\r\n      setIsPaused(false);\r\n    };\r\n    const handleTTSPaused = () => setIsPaused(true);\r\n    const handleTTSResumed = () => setIsPaused(false);\r\n\r\n    window.addEventListener('otakon:ttsStarted', handleTTSStarted);\r\n    window.addEventListener('otakon:ttsStopped', handleTTSStopped);\r\n    window.addEventListener('otakon:ttsPaused', handleTTSPaused);\r\n    window.addEventListener('otakon:ttsResumed', handleTTSResumed);\r\n\r\n    return () => {\r\n      window.removeEventListener('otakon:ttsStarted', handleTTSStarted);\r\n      window.removeEventListener('otakon:ttsStopped', handleTTSStopped);\r\n      window.removeEventListener('otakon:ttsPaused', handleTTSPaused);\r\n      window.removeEventListener('otakon:ttsResumed', handleTTSResumed);\r\n    };\r\n  }, []);\r\n\r\n  const handlePauseResume = () => {\r\n    if (isPaused) {\r\n      ttsService.resume();\r\n    } else {\r\n      ttsService.pause();\r\n    }\r\n  };\r\n\r\n  const handleRestart = async () => {\r\n    await ttsService.restart();\r\n  };\r\n\r\n  if (!isSpeaking) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-2 mt-3 pt-3 border-t border-[#424242]/30\">\r\n      <button\r\n        onClick={handlePauseResume}\r\n        className=\"flex items-center justify-center gap-1.5 px-3 py-1.5 bg-[#2E2E2E] hover:bg-[#3E3E3E] border border-[#424242] text-[#FFAB40] text-xs font-medium rounded-lg transition-all duration-200\"\r\n        title={isPaused ? 'Resume' : 'Pause'}\r\n      >\r\n        {isPaused ? (\r\n          <>\r\n            <svg className=\"w-3.5 h-3.5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path d=\"M8 5v14l11-7z\" />\r\n            </svg>\r\n            <span>Resume</span>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <svg className=\"w-3.5 h-3.5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path d=\"M6 4h4v16H6V4zm8 0h4v16h-4V4z\" />\r\n            </svg>\r\n            <span>Pause</span>\r\n          </>\r\n        )}\r\n      </button>\r\n\r\n      <button\r\n        onClick={handleRestart}\r\n        className=\"flex items-center justify-center gap-1.5 px-3 py-1.5 bg-[#2E2E2E] hover:bg-[#3E3E3E] border border-[#424242] text-[#FFAB40] text-xs font-medium rounded-lg transition-all duration-200\"\r\n        title=\"Restart from beginning\"\r\n      >\r\n        <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" strokeWidth=\"2\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n        </svg>\r\n        <span>Restart</span>\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TTSControls;\r\n","import React, { useState, useEffect } from 'react';\nimport { suggestedPromptsService } from '../../services/suggestedPromptsService';\nimport { newsPrompts } from '../../types';\n\ninterface SuggestedPromptsProps {\n  prompts: string[];\n  onPromptClick: (prompt: string) => void;\n  isLoading: boolean;\n  conversationId?: string; // To detect \"Game Hub\" tab\n}\n\nconst SuggestedPrompts: React.FC<SuggestedPromptsProps> = ({ \n  prompts, \n  onPromptClick, \n  isLoading,\n  conversationId = ''\n}) => {\n  const [isMobile, setIsMobile] = useState(false);\n  const [accordionOpen, setAccordionOpen] = useState(true);\n  const [usedPrompts, setUsedPrompts] = useState<Set<string>>(new Set());\n\n  const isGameHub = conversationId === 'game-hub' || conversationId === 'everything-else';\n  \n  // For Game Hub tab:\n  // - If prompts match newsPrompts (initial state), show newsPrompts with usage tracking\n  // - If prompts are different (AI-generated), show those instead (contextual suggestions after AI response)\n  const isShowingNewsPrompts = isGameHub && \n    (prompts.length === newsPrompts.length && prompts.every((p, i) => p === newsPrompts[i]));\n  \n  const displayPrompts = isShowingNewsPrompts ? newsPrompts : prompts;\n\n  // Check screen size for mobile accordion\n  useEffect(() => {\n    const mq = window.matchMedia('(max-width: 640px)');\n    const apply = () => {\n      setIsMobile(mq.matches);\n      // Always open on mobile for better UX - users can see suggestions immediately\n      setAccordionOpen(true);\n    };\n    apply();\n    mq.addEventListener('change', apply);\n    return () => mq.removeEventListener('change', apply);\n  }, []);\n\n  // Load used prompts status (only for news prompts)\n  useEffect(() => {\n    if (isShowingNewsPrompts) {\n      const used = new Set(newsPrompts.filter(p => suggestedPromptsService.isPromptUsed(p)));\n      setUsedPrompts(used);\n    }\n  }, [isShowingNewsPrompts, displayPrompts]);\n\n  // Handle prompt click\n  const handlePromptClick = (prompt: string) => {\n    if (isShowingNewsPrompts) {\n      // Mark as used for news prompts\n      suggestedPromptsService.markPromptAsUsed(prompt);\n      setUsedPrompts(prev => new Set([...prev, prompt]));\n    }\n    onPromptClick(prompt);\n  };\n\n  // Don't show if loading or no prompts\n  if (isLoading || displayPrompts.length === 0) {\n    return null;\n  }\n\n  // Hide if all news prompts are used (only for news prompts view)\n  if (isShowingNewsPrompts && suggestedPromptsService.areAllPromptsUsed(newsPrompts)) {\n    return null;\n  }\n\n  return (\n    <div className=\"pt-3 animate-fade-in\">\n      {/* Mobile accordion header - only for news prompts */}\n      {isMobile && isShowingNewsPrompts && (\n        <button\n          type=\"button\"\n          aria-expanded={accordionOpen}\n          onClick={() => setAccordionOpen(v => !v)}\n          className=\"w-full flex items-center justify-between px-3 py-2 rounded-lg border border-[#424242]/40 bg-[#1C1C1C]/60 text-[#E5E5E5] text-sm font-medium mb-2\"\n        >\n          <span>Gaming News Suggestions</span>\n          <svg \n            className={`w-4 h-4 transition-transform ${accordionOpen ? 'rotate-180' : ''}`} \n            viewBox=\"0 0 20 20\" \n            fill=\"currentColor\"\n          >\n            <path \n              fillRule=\"evenodd\" \n              d=\"M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.29a.75.75 0 01-.02-1.08z\" \n              clipRule=\"evenodd\"\n            />\n          </svg>\n        </button>\n      )}\n\n      {/* Prompts grid - show if not mobile or accordion is open */}\n      {(!isMobile || accordionOpen) && (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3\">\n          {displayPrompts.map((prompt, index) => {\n            const isUsed = isShowingNewsPrompts && usedPrompts.has(prompt);\n            \n            return (\n              <button\n                key={index}\n                onClick={() => !isUsed && handlePromptClick(prompt)}\n                disabled={isUsed}\n                className={`text-left p-3 sm:p-4 border rounded-lg sm:rounded-xl transition-all duration-200 backdrop-blur-sm ${\n                  isUsed \n                    ? 'bg-[#2A2A2A]/60 border-[#555555]/30 text-[#888888] cursor-not-allowed opacity-70' \n                    : 'bg-[#1C1C1C]/60 border-[#424242]/40 text-[#CFCFCF] hover:bg-[#E53A3A]/20 hover:border-[#E53A3A]/60 hover:scale-[1.02] active:scale-95'\n                }`}\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <p className={`font-medium text-xs sm:text-sm leading-relaxed flex-1 ${\n                    isUsed ? 'text-[#888888]' : 'text-[#CFCFCF]'\n                  }`}>\n                    {prompt}\n                  </p>\n                  {isUsed && (\n                    <span className=\"text-[#5CBB7B] text-sm flex-shrink-0\" aria-label=\"Used\">\n                      ‚úì\n                    </span>\n                  )}\n                </div>\n              </button>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SuggestedPrompts;\n","import React from 'react';\n\ninterface ActiveSessionToggleProps {\n  isActive: boolean;\n  onClick: () => void;\n  disabled?: boolean;\n}\n\nexport const ActiveSessionToggle: React.FC<ActiveSessionToggleProps> = ({ \n  isActive, \n  onClick, \n  disabled = false \n}) => {\n  return (\n    <>\n      {/* Mobile: Segmented Control Style */}\n      <div className=\"sm:hidden inline-flex items-center bg-[#2E2E2E]/80 rounded-lg p-0.5 backdrop-blur-sm border border-[#424242]/30\">\n        <button\n          onClick={!isActive ? onClick : undefined}\n          disabled={disabled}\n          className={`\n            px-3 py-1.5 text-[10px] font-semibold rounded-md transition-all duration-200 whitespace-nowrap\n            ${!isActive \n              ? 'bg-gradient-to-r from-[#FF4D4D] to-[#FF6B6B] text-white shadow-md' \n              : 'text-[#A3A3A3] hover:text-[#F5F5F5]'\n            }\n            ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\n          `}\n        >\n          Planning\n        </button>\n        <button\n          onClick={isActive ? onClick : undefined}\n          disabled={disabled}\n          className={`\n            px-3 py-1.5 text-[10px] font-semibold rounded-md transition-all duration-200 whitespace-nowrap\n            ${isActive \n              ? 'bg-gradient-to-r from-[#FF4D4D] to-[#FF6B6B] text-white shadow-md' \n              : 'text-[#A3A3A3] hover:text-[#F5F5F5]'\n            }\n            ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\n          `}\n        >\n          Playing\n        </button>\n      </div>\n\n      {/* Desktop: Classic Toggle Style */}\n      <div className=\"hidden sm:inline-flex items-center gap-3\">\n        <span className={`text-sm font-medium transition-colors duration-200 whitespace-nowrap ${isActive ? 'text-[#A3A3A3]' : 'text-[#FF4D4D]'}`}>\n          Planning\n        </span>\n        \n        <button\n          onClick={onClick}\n          disabled={disabled}\n          className={`\n            relative inline-flex h-6 w-11 flex-shrink-0 items-center rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-[#FF4D4D] focus:ring-offset-2 focus:ring-offset-[#1C1C1C]\n            ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\n            ${isActive ? 'bg-[#FF4D4D]' : 'bg-[#424242]'}\n          `}\n          role=\"switch\"\n          aria-checked={isActive}\n          aria-label={isActive ? 'Switch to Planning mode' : 'Switch to Playing mode'}\n        >\n          <span\n            className={`\n              inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200\n              ${isActive ? 'translate-x-6' : 'translate-x-1'}\n            `}\n          />\n        </button>\n        \n        <span className={`text-sm font-medium transition-colors duration-200 whitespace-nowrap ${isActive ? 'text-[#FF4D4D]' : 'text-[#A3A3A3]'}`}>\n          Playing\n        </span>\n      </div>\n    </>\n  );\n};","import React, { useState, useEffect } from 'react';\nimport { SubTab } from '../../types';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\n\ninterface SubTabsProps {\n  subtabs: SubTab[];\n  activeTabId?: string;\n  onTabClick?: (tabId: string) => void;\n  isLoading?: boolean;\n}\n\nconst SubTabs: React.FC<SubTabsProps> = ({ \n  subtabs = [], \n  activeTabId, \n  onTabClick, \n  isLoading = false \n}) => {\n  const [localActiveTab, setLocalActiveTab] = useState<string>(activeTabId || subtabs[0]?.id || '');\n  const [isExpanded, setIsExpanded] = useState<boolean>(false);\n  const [hasUserInteracted, setHasUserInteracted] = useState<boolean>(false);\n\n  const currentActiveTab = activeTabId || localActiveTab;\n  const activeTab = subtabs.find(tab => tab.id === currentActiveTab);\n\n  // üîç DEBUG: Log subtabs state on every render\n  console.error('üé® [SubTabs] Rendering:', {\n    subtabCount: subtabs.length,\n    statuses: subtabs.map(s => ({ title: s.title, status: s.status, hasContent: !!s.content })),\n    isExpanded,\n    hasUserInteracted,\n    activeTabTitle: activeTab?.title,\n    activeTabStatus: activeTab?.status,\n    activeTabHasContent: !!activeTab?.content\n  });\n\n  // Auto-expand when subtabs finish loading (ONLY if user hasn't manually controlled it)\n  useEffect(() => {\n    // Only auto-expand if user hasn't manually interacted with the accordion\n    if (hasUserInteracted) {\n      return;\n    }\n\n    // ‚úÖ FIX: More robust status checks\n    const allLoading = subtabs.every(tab => tab.status === 'loading');\n    const anyLoaded = subtabs.some(tab => tab.status === 'loaded');\n    const allLoaded = subtabs.every(tab => tab.status === 'loaded');\n    \n    // Check if we have subtabs that are loaded with actual content\n    const hasLoadedContent = subtabs.some(tab => \n      tab.status === 'loaded' && \n      tab.content && \n      tab.content.trim().length > 0 && \n      tab.content.trim() !== 'Loading...'\n    );\n    \n    console.error('üìÇ [SubTabs] useEffect triggered:', {\n      allLoading,\n      anyLoaded,\n      allLoaded,\n      hasLoadedContent,\n      isExpanded,\n      hasUserInteracted,\n      subtabStatuses: subtabs.map(s => ({ title: s.title, status: s.status })),\n      subtabContentLengths: subtabs.map(s => ({ title: s.title, length: s.content?.length || 0 }))\n    });\n    \n    // ‚úÖ FIX: Collapse if all loading\n    if (allLoading && isExpanded) {\n      console.error('üìÇ [SubTabs] Collapsing subtabs - all loading');\n      setIsExpanded(false);\n    }\n    \n    // ‚úÖ FIX: Expand when ANY content loads (more responsive)\n    // Changed from hasLoadedContent to anyLoaded for immediate feedback\n    if (anyLoaded && !isExpanded) {\n      console.error('üìÇ [SubTabs] ‚úÖ AUTO-EXPANDING - detected loaded subtabs');\n      setIsExpanded(true);\n    }\n    \n    // ‚úÖ NEW: Additional check for all loaded (belt and suspenders)\n    if (allLoaded && !isExpanded && subtabs.length > 0) {\n      console.error('üìÇ [SubTabs] ‚úÖ AUTO-EXPANDING - all subtabs loaded');\n      setIsExpanded(true);\n    }\n  }, [subtabs, isExpanded, hasUserInteracted]);\n\n  const handleTabClick = (tabId: string) => {\n    setLocalActiveTab(tabId);\n    onTabClick?.(tabId);\n  };\n\n  const toggleExpanded = () => {\n    setIsExpanded(!isExpanded);\n    setHasUserInteracted(true); // Mark that user has manually controlled the accordion\n  };\n\n  // Return null if no subtabs (after hooks)\n  if (!subtabs || subtabs.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"mb-4\">\n      {/* Collapsible Header - Matching Latest Gaming News style */}\n      <button\n        onClick={toggleExpanded}\n        className=\"w-full flex items-center justify-between mb-2 py-2 px-3 rounded-lg bg-[#1C1C1C]/50 hover:bg-[#1C1C1C] border border-[#424242]/30 hover:border-[#424242]/60 transition-all duration-200\"\n      >\n        <div className=\"text-xs font-semibold text-[#A3A3A3] uppercase tracking-wider\">\n          Lore & Insights\n        </div>\n        <svg\n          className={`w-4 h-4 text-[#A3A3A3] transition-transform duration-200 ${\n            isExpanded ? 'rotate-180' : ''\n          }`}\n          fill=\"none\"\n          stroke=\"currentColor\"\n          viewBox=\"0 0 24 24\"\n        >\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n        </svg>\n      </button>\n\n      {/* Collapsible Content */}\n      <div\n        className={`transition-all duration-300 ease-in-out overflow-hidden ${\n          isExpanded \n            ? 'max-h-[500px] opacity-100' \n            : 'max-h-0 opacity-0'\n        }`}\n      >\n        <div className=\"bg-[#1C1C1C]/60 border border-[#424242]/40 rounded-xl backdrop-blur-sm\">\n          {/* Tab Headers */}\n          <div className=\"flex items-center gap-2 p-2 sm:p-3 border-b border-[#424242]/40\">\n            <div className=\"flex flex-wrap gap-1 sm:gap-2 flex-1\">\n              {subtabs.map((tab) => (\n                <button\n                  key={tab.id}\n                  onClick={() => handleTabClick(tab.id)}\n                  className={`\n                    px-3 py-2 text-xs font-medium rounded-lg transition-all duration-200 whitespace-nowrap\n                    ${currentActiveTab === tab.id\n                      ? 'bg-[#FF4D4D] text-white shadow-lg'\n                      : 'bg-[#2E2E2E]/60 text-[#A3A3A3] hover:bg-[#424242]/60 hover:text-[#F5F5F5]'\n                    }\n                    ${tab.isNew ? 'ring-2 ring-[#FF4D4D]/50' : ''}\n                  `}\n                  disabled={isLoading}\n                >\n                  <div className=\"flex items-center gap-2\">\n                    {tab.isNew && (\n                      <div className=\"w-2 h-2 bg-[#FF4D4D] rounded-full animate-pulse\" />\n                    )}\n                    <span>{tab.title}</span>\n                    {tab.status === 'loading' && (\n                      <div className=\"w-3 h-3 border border-current border-t-transparent rounded-full animate-spin\" />\n                    )}\n                    {tab.status === 'error' && (\n                      <div className=\"w-3 h-3 text-red-400\">‚ö†</div>\n                    )}\n                  </div>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Tab Content */}\n          {activeTab && (\n            <div className=\"p-4 max-h-64 overflow-y-auto transition-all duration-300\">\n              {activeTab.status === 'loading' || (!activeTab.content && isLoading) ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"flex items-center gap-3 text-[#A3A3A3]\">\n                    <div className=\"w-5 h-5 border-2 border-[#FF4D4D] border-t-transparent rounded-full animate-spin\" />\n                    <span>Loading {activeTab.title}...</span>\n                  </div>\n                </div>\n              ) : activeTab.status === 'error' ? (\n                <div className=\"text-center py-8 text-[#A3A3A3]\">\n                  <div className=\"text-4xl mb-2\">‚ö†Ô∏è</div>\n                  <p>Failed to load {activeTab.title} content</p>\n                  <p className=\"text-sm mt-1\">Please try again later</p>\n                </div>\n              ) : activeTab.content ? (\n                <div className=\"prose prose-invert prose-sm max-w-none\">\n                  <ReactMarkdown\n                    remarkPlugins={[remarkGfm]}\n                    components={{\n                      h1: ({ children }) => (\n                        <h1 className=\"text-lg font-bold text-[#F5F5F5] mb-3\">{children}</h1>\n                      ),\n                      h2: ({ children }) => (\n                        <h2 className=\"text-base font-semibold text-[#F5F5F5] mb-2\">{children}</h2>\n                      ),\n                      h3: ({ children }) => (\n                        <h3 className=\"text-sm font-semibold text-[#F5F5F5] mb-2\">{children}</h3>\n                      ),\n                      p: ({ children }) => (\n                        <p className=\"text-[#CFCFCF] leading-relaxed mb-2\">{children}</p>\n                      ),\n                      ul: ({ children }) => (\n                        <ul className=\"list-disc list-inside text-[#CFCFCF] mb-2 space-y-1\">{children}</ul>\n                      ),\n                      ol: ({ children }) => (\n                        <ol className=\"list-decimal list-inside text-[#CFCFCF] mb-2 space-y-1\">{children}</ol>\n                      ),\n                      li: ({ children }) => (\n                        <li className=\"text-[#CFCFCF]\">{children}</li>\n                      ),\n                      strong: ({ children }) => (\n                        <strong className=\"font-semibold text-[#F5F5F5]\">{children}</strong>\n                      ),\n                      em: ({ children }) => (\n                        <em className=\"italic text-[#E0E0E0]\">{children}</em>\n                      ),\n                      code: ({ children }) => (\n                        <code className=\"bg-[#2E2E2E] text-[#FF4D4D] px-1 py-0.5 rounded text-xs font-mono\">\n                          {children}\n                        </code>\n                      ),\n                      pre: ({ children }) => (\n                        <pre className=\"bg-[#1C1C1C] border border-[#424442] rounded-lg p-3 overflow-x-auto\">\n                          {children}\n                        </pre>\n                      ),\n                      blockquote: ({ children }) => (\n                        <blockquote className=\"border-l-4 border-[#FF4D4D] pl-4 italic text-[#B0B0B0] my-2\">\n                          {children}\n                        </blockquote>\n                      ),\n                    }}\n                  >\n                    {activeTab.content}\n                  </ReactMarkdown>\n                </div>\n              ) : (\n                <div className=\"text-center py-8 text-[#A3A3A3]\">\n                  <p>No content available for {activeTab.title}</p>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default SubTabs;\n","import React, { useState, useRef, useEffect, memo } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport { Conversation, ActiveSessionState, ChatMessage } from '../../types';\nimport ManualUploadToggle from '../ui/ManualUploadToggle';\nimport ScreenshotButton from '../ui/ScreenshotButton';\nimport DownloadIcon from '../ui/DownloadIcon';\nimport UserAvatar from '../ui/UserAvatar';\nimport AIAvatar from '../ui/AIAvatar';\nimport TypingIndicator from '../ui/TypingIndicator';\nimport SendIcon from '../ui/SendIcon';\nimport TTSControls from '../ui/TTSControls';\nimport SuggestedPrompts from './SuggestedPrompts';\nimport { ActiveSessionToggle } from '../ui/ActiveSessionToggle';\nimport SubTabs from './SubTabs';\nimport { gameTabService } from '../../services/gameTabService';\nimport { tabManagementService } from '../../services/tabManagementService';\n\n// ============================================================================\n// MEMOIZED CHAT MESSAGE COMPONENT (Performance Optimization)\n// ============================================================================\n// Prevents unnecessary re-renders when other parts of the UI update\n// (e.g., when subtabs update, old messages won't re-render)\ninterface ChatMessageComponentProps {\n  message: ChatMessage;\n  suggestedPrompts: string[];\n  onSuggestedPromptClick?: (prompt: string) => void;\n  isLoading: boolean;\n  conversationId?: string;\n  onDownloadImage: (url: string, index: number) => void;\n}\n\nconst ChatMessageComponent: React.FC<ChatMessageComponentProps> = ({\n  message,\n  suggestedPrompts,\n  onSuggestedPromptClick,\n  isLoading,\n  conversationId,\n  onDownloadImage\n}) => {\n  return (\n    <div className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}>\n      <div\n        className={`max-w-[80%] ${\n          message.role === 'user'\n            ? 'chat-message-user'\n            : 'chat-message-ai'\n        }`}\n      >\n        <div className=\"flex items-start gap-3\">\n          {/* Avatar */}\n          <div className=\"flex-shrink-0\">\n            {message.role === 'user' ? (\n              <UserAvatar className=\"w-6 h-6 sm:w-8 sm:h-8 flex-shrink-0 text-[#D98C1F]\" />\n            ) : (\n              <AIAvatar className=\"w-6 h-6 sm:w-8 sm:h-8 flex-shrink-0\" />\n            )}\n          </div>\n          \n          {/* Message content */}\n          <div className=\"flex-1 min-w-0\">\n            {message.imageUrl && (\n              <div className=\"chat-image-container mb-3\">\n                <img\n                  src={message.imageUrl}\n                  alt=\"Uploaded\"\n                  className=\"w-full max-w-sm rounded-lg\"\n                />\n                {/* Download button for single image */}\n                <div className=\"flex flex-wrap gap-2 mt-3 pt-3 border-t border-[#424242]/30\">\n                  <button\n                    onClick={() => onDownloadImage(message.imageUrl || '', 0)}\n                    className=\"flex items-center justify-center gap-2 px-2 sm:px-3 py-1.5 sm:py-2 border border-[#FF4D4D] text-[#FF4D4D] text-xs sm:text-sm font-medium rounded-lg hover:bg-[#FF4D4D] hover:text-white transition-all duration-300 hover:scale-105\"\n                    title=\"Download this screenshot\"\n                  >\n                    <DownloadIcon className=\"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0\" />\n                    <span className=\"hidden sm:inline\">Download</span>\n                  </button>\n                </div>\n              </div>\n            )}\n            <div className=\"text-[#F5F5F5] leading-relaxed\">\n              <ReactMarkdown\n                remarkPlugins={[remarkGfm]}\n                components={{\n                  h1: ({ children }) => (\n                    <h1 className=\"text-lg font-bold text-[#F5F5F5] mb-3 mt-2\">{children}</h1>\n                  ),\n                  h2: ({ children }) => (\n                    <h2 className=\"text-base font-semibold text-[#F5F5F5] mb-2 mt-2\">{children}</h2>\n                  ),\n                  h3: ({ children }) => (\n                    <h3 className=\"text-sm font-semibold text-[#F5F5F5] mb-2 mt-2\">{children}</h3>\n                  ),\n                  p: ({ children }) => (\n                    <p className=\"text-[#CFCFCF] leading-relaxed mb-3\">{children}</p>\n                  ),\n                  ul: ({ children }) => (\n                    <ul className=\"list-disc list-outside ml-5 text-[#CFCFCF] mb-3 space-y-1.5\">{children}</ul>\n                  ),\n                  ol: ({ children }) => (\n                    <ol className=\"list-decimal list-outside ml-5 text-[#CFCFCF] mb-3 space-y-1.5\">{children}</ol>\n                  ),\n                  li: ({ children }) => (\n                    <li className=\"text-[#CFCFCF] leading-relaxed\">{children}</li>\n                  ),\n                  strong: ({ children }) => (\n                    <strong className=\"font-semibold text-[#F5F5F5]\">{children}</strong>\n                  ),\n                  em: ({ children }) => (\n                    <em className=\"italic text-[#E0E0E0]\">{children}</em>\n                  ),\n                  code: ({ children }) => (\n                    <code className=\"bg-[#2E2E2E] text-[#FF4D4D] px-1.5 py-0.5 rounded text-xs font-mono\">\n                      {children}\n                    </code>\n                  ),\n                  pre: ({ children }) => (\n                    <pre className=\"bg-[#1C1C1C] border border-[#424242] rounded-lg p-3 overflow-x-auto mb-3\">\n                      {children}\n                    </pre>\n                  ),\n                  blockquote: ({ children }) => (\n                    <blockquote className=\"border-l-4 border-[#FF4D4D] pl-4 italic text-[#B0B0B0] my-3\">\n                      {children}\n                    </blockquote>\n                  ),\n                  br: () => <br className=\"my-1\" />\n                }}\n              >\n                {message.content}\n              </ReactMarkdown>\n            </div>\n            \n            {/* TTS Controls for AI messages */}\n            {message.role === 'assistant' && <TTSControls />}\n            \n            {/* Show suggested prompts after AI response */}\n            {message.role === 'assistant' && suggestedPrompts.length > 0 && onSuggestedPromptClick && !isLoading && (\n              <div className=\"mt-4\">\n                <SuggestedPrompts\n                  prompts={suggestedPrompts}\n                  onPromptClick={onSuggestedPromptClick}\n                  isLoading={isLoading}\n                  conversationId={conversationId}\n                />\n              </div>\n            )}\n            \n            <p className=\"text-xs text-[#A3A3A3] mt-3\">\n              {new Date(message.timestamp).toLocaleTimeString()}\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// Memoize the component to prevent unnecessary re-renders\n// Only re-renders if message props actually change\nconst MemoizedChatMessage = memo(ChatMessageComponent, (prevProps, nextProps) => {\n  // Custom comparison: only re-render if message content, suggested prompts, or loading state changes\n  return (\n    prevProps.message.id === nextProps.message.id &&\n    prevProps.message.content === nextProps.message.content &&\n    prevProps.message.timestamp === nextProps.message.timestamp &&\n    prevProps.isLoading === nextProps.isLoading &&\n    prevProps.suggestedPrompts.length === nextProps.suggestedPrompts.length\n  );\n});\n\nMemoizedChatMessage.displayName = 'MemoizedChatMessage';\n\n// ============================================================================\n// MAIN CHAT INTERFACE COMPONENT\n// ============================================================================\n\ninterface ChatInterfaceProps {\n  conversation: Conversation | null;\n  onSendMessage: (message: string, imageUrl?: string) => void;\n  isLoading: boolean;\n  isPCConnected?: boolean;\n  onRequestConnect?: () => void;\n  userTier?: string;\n  onStop?: () => void;\n  isManualUploadMode?: boolean;\n  onToggleManualUploadMode?: () => void;\n  suggestedPrompts?: string[];\n  onSuggestedPromptClick?: (prompt: string) => void;\n  activeSession?: ActiveSessionState;\n  onToggleActiveSession?: () => void;\n  initialMessage?: string;\n  onMessageChange?: (message: string) => void;\n  queuedImage?: string | null; // ‚úÖ NEW: For WebSocket screenshot in manual mode\n  onImageQueued?: () => void; // ‚úÖ NEW: Callback when image is accepted\n}\n\nconst ChatInterface: React.FC<ChatInterfaceProps> = ({\n  conversation,\n  onSendMessage,\n  isLoading,\n  isPCConnected = false,\n  onRequestConnect,\n  userTier = 'free',\n  onStop,\n  isManualUploadMode = false,\n  onToggleManualUploadMode,\n  suggestedPrompts = [],\n  onSuggestedPromptClick,\n  activeSession,\n  onToggleActiveSession,\n  initialMessage = '',\n  onMessageChange,\n  queuedImage = null, // ‚úÖ NEW: Receive queued image from WebSocket\n  onImageQueued, // ‚úÖ NEW: Callback when image is set\n}) => {\n  const [message, setMessage] = useState(initialMessage);\n  const [imageFile, setImageFile] = useState<File | null>(null);\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\n  const [isFocused, setIsFocused] = useState(false);\n  const [showAutocomplete, setShowAutocomplete] = useState(false);\n  const [autocompleteSuggestions, setAutocompleteSuggestions] = useState<string[]>([]);\n  const [selectedSuggestionIndex, setSelectedSuggestionIndex] = useState(0);\n  const [isQuickActionsExpanded, setIsQuickActionsExpanded] = useState(true);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const autocompleteRef = useRef<HTMLDivElement>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  // Auto-resize textarea functionality\n  const adjustTextareaHeight = () => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      const MAX_HEIGHT = 120; // Max 5 lines\n      const MIN_HEIGHT = 44; // Single line height\n      \n      textarea.style.height = 'auto';\n      const scrollHeight = textarea.scrollHeight;\n      const newHeight = Math.min(Math.max(scrollHeight, MIN_HEIGHT), MAX_HEIGHT);\n      textarea.style.height = `${newHeight}px`;\n    }\n  };\n\n  // Handle textarea value change\n  const handleValueChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    const newValue = e.target.value;\n    setMessage(newValue);\n    adjustTextareaHeight();\n    // Notify parent of message change\n    onMessageChange?.(newValue);\n\n    // Check for @ command to show autocomplete\n    if (conversation && newValue.startsWith('@')) {\n      const availableTabs = tabManagementService.getAvailableTabNames(conversation);\n      if (availableTabs.length > 0) {\n        setAutocompleteSuggestions(availableTabs);\n        setShowAutocomplete(true);\n        setSelectedSuggestionIndex(0);\n      } else {\n        setShowAutocomplete(false);\n      }\n    } else {\n      setShowAutocomplete(false);\n    }\n  };\n\n  // Handle suggestion selection\n  const handleSelectSuggestion = (tabId: string) => {\n    setMessage(`@${tabId} `);\n    setShowAutocomplete(false);\n    textareaRef.current?.focus();\n  };\n\n  // Handle key down events\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    // Handle autocomplete navigation\n    if (showAutocomplete && autocompleteSuggestions.length > 0) {\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        setSelectedSuggestionIndex(prev => \n          prev < autocompleteSuggestions.length - 1 ? prev + 1 : 0\n        );\n        return;\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        setSelectedSuggestionIndex(prev => \n          prev > 0 ? prev - 1 : autocompleteSuggestions.length - 1\n        );\n        return;\n      } else if (e.key === 'Tab' || (e.key === 'Enter' && showAutocomplete)) {\n        e.preventDefault();\n        handleSelectSuggestion(autocompleteSuggestions[selectedSuggestionIndex]);\n        return;\n      } else if (e.key === 'Escape') {\n        e.preventDefault();\n        setShowAutocomplete(false);\n        return;\n      }\n    }\n\n    // Handle normal Enter key\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit(e as any);\n    }\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [conversation?.messages]);\n\n  // Adjust textarea height when message changes\n  useEffect(() => {\n    adjustTextareaHeight();\n  }, [message]);\n\n  // Update message when initialMessage prop changes (e.g., after tab switch)\n  useEffect(() => {\n    if (initialMessage !== undefined && initialMessage !== message) {\n      setMessage(initialMessage);\n    }\n  }, [initialMessage, message]);\n\n  // ‚úÖ NEW: Handle queued image from WebSocket (manual mode)\n  useEffect(() => {\n    if (queuedImage && isManualUploadMode) {\n      console.log('üì∏ [ChatInterface] Queued image received from WebSocket:', {\n        queuedImageLength: queuedImage.length,\n        queuedImagePreview: queuedImage.substring(0, 50),\n        currentImagePreview: imagePreview?.substring(0, 50),\n        isManualUploadMode\n      });\n      setImagePreview(queuedImage);\n      // Notify parent that image was accepted\n      onImageQueued?.();\n    }\n  }, [queuedImage, isManualUploadMode, imagePreview, onImageQueued]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    console.log('üì§ [ChatInterface] Submit attempt:', { \n      message: message.trim(), \n      hasMessage: !!message.trim(), \n      hasImageFile: !!imageFile, \n      hasImagePreview: !!imagePreview,\n      shouldSubmit: !(!message.trim() && !imageFile)\n    });\n    \n    // Allow submission if there's either a message OR an image\n    if (!message.trim() && !imageFile) {\n      console.log('üì§ [ChatInterface] Submission blocked: no message and no image');\n      return;\n    }\n\n    // Collapse quick actions when sending a message\n    if (conversation?.isGameHub) {\n      setIsQuickActionsExpanded(false);\n    }\n\n    const imageUrl = imagePreview || undefined;\n    console.log('üì§ [ChatInterface] Submitting:', { message, hasImage: !!imageUrl, imageUrl: imageUrl?.substring(0, 50) + '...' });\n    onSendMessage(message, imageUrl);\n    setMessage('');\n    setImageFile(null);\n    setImagePreview(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    console.log('üì∏ [ChatInterface] Image upload:', { file, fileName: file?.name, fileSize: file?.size });\n    if (file) {\n      setImageFile(file);\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const result = e.target?.result as string;\n        console.log('üì∏ [ChatInterface] Image preview created:', { \n          hasResult: !!result, \n          resultLength: result?.length,\n          resultStart: result?.substring(0, 50) + '...'\n        });\n        setImagePreview(result);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const removeImage = () => {\n    setImageFile(null);\n    setImagePreview(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const toggleManualUploadMode = () => {\n    onToggleManualUploadMode?.();\n  };\n\n  // Function to download image in high quality\n  const downloadImage = (imageSrc: string, index: number) => {\n    try {\n      // Create a temporary link element\n      const link = document.createElement('a');\n      link.href = imageSrc;\n      \n      // Generate filename with timestamp\n      const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');\n      const filename = `otakon-screenshot-${index + 1}-${timestamp}.png`;\n      link.download = filename;\n      \n      // Append to body, click, and remove\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    } catch (error) {\n      console.error('Failed to download image:', error);\n      // Fallback: open image in new tab\n      window.open(imageSrc, '_blank');\n    }\n  };\n\n\n  // Show loading state if no conversation yet\n  if (!conversation) {\n    return (\n      <div className=\"h-full bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-[#FF4D4D] mx-auto mb-4\"></div>\n          <p className=\"text-text-muted\">Loading chat...</p>\n          <p className=\"text-text-muted text-sm mt-2\">This may take a moment after completing onboarding</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Safety check for conversation\n  if (!conversation) {\n    return (\n      <div className=\"h-full bg-background flex flex-col overflow-hidden\">\n        <div className=\"flex-1 p-6 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <p className=\"text-text-muted text-lg\">Loading conversation...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full bg-gradient-to-r from-surface/30 to-background/30 flex flex-col overflow-hidden\">\n      {/* Messages Area - Only this should scroll */}\n      <div className={`flex-1 p-6 space-y-6 min-h-0 ${conversation.messages.length > 0 ? 'overflow-y-auto custom-scrollbar' : 'overflow-y-hidden'}`}>\n        {conversation.messages.length === 0 ? (\n          <div className=\"flex items-center justify-center h-full\">\n            <div className=\"text-center\">\n              <p className=\"text-text-muted text-lg\">\n                Start a conversation with <span className=\"bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] bg-clip-text text-transparent font-semibold\">Otagon</span>\n              </p>\n              <p className=\"text-text-muted text-sm mt-2\">Ask me anything about gaming, strategies, or tips.</p>\n            </div>\n          </div>\n        ) : (\n          conversation.messages.map((msg) => (\n            <MemoizedChatMessage\n              key={msg.id}\n              message={msg}\n              suggestedPrompts={msg.role === 'assistant' ? suggestedPrompts : []}\n              onSuggestedPromptClick={onSuggestedPromptClick}\n              isLoading={isLoading}\n              conversationId={conversation?.id}\n              onDownloadImage={downloadImage}\n            />\n          ))\n        )}\n        \n        {isLoading && (\n          <div className=\"flex justify-start\">\n            <div className=\"flex items-start gap-3\">\n              {/* AI Avatar */}\n              <div className=\"flex-shrink-0\">\n                <AIAvatar className=\"w-6 h-6 sm:w-8 sm:h-8 flex-shrink-0\" />\n              </div>\n              \n              {/* Loading content */}\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center gap-3 sm:gap-4 py-2 sm:py-3\">\n                  <TypingIndicator variant=\"dots\" showText={false} />\n                  {onStop && (\n                    <button\n                      onClick={onStop}\n                      className=\"text-xs font-semibold px-2 sm:px-3 py-1 sm:py-1.5 rounded-full transition-all duration-200 bg-[#424242]/60 text-[#CFCFCF] hover:bg-[#424242] hover:text-[#F5F5F5] hover:scale-105\"\n                      aria-label=\"Stop generating response\"\n                    >\n                      Stop\n                    </button>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n        \n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Image Preview - Show inside the chat input area */}\n      {/* Removed - will show preview inside the input form instead */}\n\n\n      {/* Sub-tabs Section - Show for released game conversations only (not Game Hub, not unreleased) */}\n      {conversation && !conversation.isGameHub && !conversation.isUnreleased && conversation.subtabs && conversation.subtabs.length > 0 && (\n        <div className=\"flex-shrink-0 px-3 pb-2\">\n          <SubTabs\n            key={`subtabs-${conversation.id}-${conversation.subtabs.filter(s => s.status === 'loaded').length}`}\n            subtabs={conversation.subtabs}\n            isLoading={isLoading}\n          />\n        </div>\n      )}\n\n      {/* Game Hub Quick Prompts - Only show in Game Hub tab */}\n      {conversation?.isGameHub && (\n        <div className=\"flex-shrink-0 px-3 pb-3\">\n          {/* Collapsible Header */}\n          <button\n            onClick={() => setIsQuickActionsExpanded(!isQuickActionsExpanded)}\n            className=\"w-full flex items-center justify-between mb-2 py-2 px-3 rounded-lg bg-[#1C1C1C]/50 hover:bg-[#1C1C1C] border border-[#424242]/30 hover:border-[#424242]/60 transition-all duration-200\"\n          >\n            <div className=\"text-xs font-semibold text-[#A3A3A3] uppercase tracking-wider\">\n              Latest Gaming News\n            </div>\n            <svg\n              className={`w-4 h-4 text-[#A3A3A3] transition-transform duration-200 ${\n                isQuickActionsExpanded ? 'rotate-180' : ''\n              }`}\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n            </svg>\n          </button>\n\n          {/* Collapsible Content */}\n          <div\n            className={`grid grid-cols-2 gap-2 transition-all duration-300 ease-in-out overflow-hidden ${\n              isQuickActionsExpanded \n                ? 'max-h-96 opacity-100' \n                : 'max-h-0 opacity-0'\n            }`}\n          >\n            {[\n              { text: \"What's the latest gaming news?\", shape: \"‚úï\" },\n              { text: \"Which games are releasing soon?\", shape: \"‚ñ†\" },\n              { text: \"What are the latest game reviews?\", shape: \"‚ñ≤\" },\n              { text: \"Show me the hottest new game trailers.\", shape: \"‚óØ\" }\n            ].map((prompt) => (\n              <button\n                key={prompt.text}\n                onClick={() => {\n                  setIsQuickActionsExpanded(false);\n                  onSuggestedPromptClick?.(prompt.text);\n                }}\n                disabled={isLoading}\n                className=\"group relative px-3 py-3 rounded-xl bg-gradient-to-br from-[#1C1C1C] to-[#0F0F0F] hover:from-[#252525] hover:to-[#1A1A1A] border border-[#424242]/30 hover:border-[#E53A3A]/50 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-left overflow-hidden\"\n              >\n                <div className=\"absolute inset-0 bg-gradient-to-r from-[#E53A3A]/10 to-[#FF6B35]/10 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"></div>\n                <div className=\"relative flex flex-col sm:flex-row items-start sm:items-center gap-2\">\n                  <span className=\"text-lg flex-shrink-0 text-[#E53A3A] font-bold leading-none\">{prompt.shape}</span>\n                  <span className=\"text-xs sm:text-sm text-[#E5E5E5] font-medium group-hover:text-white transition-colors leading-tight\">\n                    {prompt.text}\n                  </span>\n                </div>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Floating Chat Input Section with Gradient Border */}\n      <div className=\"flex-shrink-0 bg-background/95 backdrop-blur-sm\">\n        <div className=\"mx-3 my-3 rounded-2xl p-px transition-all duration-300\" style={{\n          background: isFocused \n            ? 'linear-gradient(135deg, #FF4D4D, #FFAB40)'\n            : 'transparent'\n        }}>\n          <form onSubmit={handleSubmit} className=\"relative p-3 rounded-2xl bg-gradient-to-r from-[#1A1A1A] to-[#0F0F0F] animate-pulse-glow\" style={{\n            background: 'linear-gradient(135deg, #1A1A1A 0%, #0F0F0F 100%)',\n            boxShadow: '0 0 20px rgba(255, 77, 77, 0.3), 0 0 40px rgba(255, 171, 64, 0.2), 0 0 60px rgba(0, 0, 0, 0.1)'\n          }}>\n          \n          {/* Autocomplete Dropdown */}\n          {showAutocomplete && autocompleteSuggestions.length > 0 && (\n            <div \n              ref={autocompleteRef}\n              className=\"absolute bottom-full mb-2 left-3 right-3 bg-[#1C1C1C] border border-[#424242] rounded-lg shadow-lg z-50 max-h-48 overflow-y-auto\"\n            >\n              <div className=\"p-2\">\n                <div className=\"text-xs text-[#A3A3A3] mb-2 px-2\">\n                  Select a subtab to update:\n                </div>\n                {autocompleteSuggestions.map((tabId, index) => {\n                  const tab = conversation?.subtabs?.find(t => t.id === tabId);\n                  return (\n                    <button\n                      key={tabId}\n                      type=\"button\"\n                      onClick={() => handleSelectSuggestion(tabId)}\n                      className={`w-full text-left px-3 py-2 rounded transition-colors ${\n                        index === selectedSuggestionIndex\n                          ? 'bg-[#E53A3A]/20 border border-[#E53A3A]/60'\n                          : 'hover:bg-[#2A2A2A] border border-transparent'\n                      }`}\n                    >\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-[#E53A3A] font-mono text-sm\">@{tabId}</span>\n                        {tab && (\n                          <span className=\"text-[#888888] text-xs\">- {tab.title}</span>\n                        )}\n                      </div>\n                    </button>\n                  );\n                })}\n              </div>\n              <div className=\"px-3 py-2 border-t border-[#424242]/30 bg-[#1A1A1A]/50\">\n                <div className=\"text-xs text-[#888888]\">\n                  Use ‚Üë‚Üì to navigate, Tab/Enter to select, Esc to cancel\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Textarea Container - Grows upward */}\n          <div className=\"relative mb-2\">\n            {/* Image Preview - Inside the form so it doesn't push input off screen */}\n            {imagePreview && (\n              <div className=\"mb-2 flex items-center gap-2\">\n                <div className=\"relative\">\n                  <img\n                    src={imagePreview}\n                    alt=\"Preview\"\n                    className=\"w-24 h-24 object-cover rounded-lg border border-[#424242]/40\"\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={removeImage}\n                    className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-600 transition-colors flex-shrink-0\"\n                  >\n                    √ó\n                  </button>\n                </div>\n                <div className=\"text-xs text-[#A3A3A3]\">\n                  <p className=\"font-semibold\">Image Ready</p>\n                  <p>Add a message or send</p>\n                </div>\n              </div>\n            )}\n            \n            <textarea\n              ref={textareaRef}\n              value={message}\n              onChange={handleValueChange}\n              onKeyDown={handleKeyDown}\n              onFocus={() => setIsFocused(true)}\n              onBlur={() => setIsFocused(false)}\n              placeholder=\"Type your message...\"\n              className=\"w-full px-4 sm:px-6 text-base text-[#F5F5F5] placeholder-[#A3A3A3] resize-none overflow-y-auto focus:outline-none disabled:opacity-60 bg-transparent border-0 rounded-xl\"\n              style={{\n                minHeight: '44px',\n                maxHeight: '120px',\n                lineHeight: '44px',\n                height: '44px',\n                paddingTop: '10px',\n                paddingBottom: '10px'\n              }}\n              disabled={isLoading}\n              rows={1}\n            />\n            </div>\n          \n          {/* Fixed Button Row - Always at bottom */}\n          <div className=\"flex items-center space-x-2 sm:space-x-3\">\n            <div className=\"flex-1 flex items-center space-x-2 sm:space-x-3\">\n              <input\n                type=\"file\"\n                ref={fileInputRef}\n                onChange={handleImageUpload}\n                accept=\"image/*\"\n                className=\"hidden\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => fileInputRef.current?.click()}\n                className=\"w-12 h-12 sm:w-14 sm:h-14 rounded-xl bg-gradient-to-r from-[#2E2E2E]/90 to-[#1C1C1C]/90 flex items-center justify-center transition-all duration-300 hover:scale-105 text-text-muted hover:text-text-primary\"\n              >\n                <svg className=\"w-5 h-5 sm:w-6 sm:h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                </svg>\n              </button>\n\n              {/* Only show ScreenshotButton and ManualUploadToggle when connected to PC */}\n              {isPCConnected && (\n                <>\n                  <ManualUploadToggle\n                    isManualMode={isManualUploadMode}\n                    onToggle={toggleManualUploadMode}\n                    isConnected={isPCConnected}\n                  />\n                  <ScreenshotButton\n                    isConnected={isPCConnected}\n                    isProcessing={isLoading}\n                    isManualUploadMode={isManualUploadMode}\n                    onRequestConnect={onRequestConnect}\n                    usage={{ tier: userTier as any }}\n                  />\n                </>\n              )}\n\n            </div>\n            \n            {/* Active Session Toggle - Show only for released game tabs */}\n            {/* For unreleased games, show \"Discuss\" mode label with disabled toggle */}\n            {conversation && gameTabService.isGameTab(conversation) && activeSession && (\n              conversation.isUnreleased ? (\n                <div className=\"flex items-center gap-2 px-4 py-2 bg-surface/50 rounded-lg border border-surface-light/20\">\n                  <span className=\"text-sm font-medium text-text-muted\">Discuss Mode</span>\n                  <div className=\"text-xs text-text-muted/60\">(No Playing mode until release)</div>\n                </div>\n              ) : onToggleActiveSession && (\n                <div className=\"flex-shrink-0\">\n                  <ActiveSessionToggle\n                    isActive={activeSession.isActive && activeSession.currentGameId === conversation.id}\n                    onClick={onToggleActiveSession}\n                  />\n                </div>\n              )\n            )}\n            \n            <button\n              type=\"submit\"\n              disabled={!message.trim() && !imageFile}\n              aria-label=\"Send message\"\n              className={`flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 rounded-xl transition-all duration-300 disabled:cursor-not-allowed ${\n                (!message.trim() && !imageFile) || isLoading\n                  ? 'bg-[#2E2E2E]/15 text-[#A3A3A3]/25 scale-100'\n                  : 'bg-gradient-to-r from-[#FFAB40] to-[#FF8C00] text-[#181818] scale-100 hover:scale-105 hover:shadow-lg hover:shadow-[#FFAB40]/25 active:scale-95 font-semibold'\n              }`}\n            >\n              {isLoading ? (\n                <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-current\"></div>\n              ) : (\n                <SendIcon className=\"w-5 h-5 sm:w-6 sm:h-6\" />\n              )}\n            </button>\n          </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ChatInterface;\n","import React from 'react';\r\n\r\ninterface GameProgressBarProps {\r\n  progress: number; // 0-100\r\n  gameTitle?: string;\r\n  className?: string;\r\n}\r\n\r\nconst GameProgressBar: React.FC<GameProgressBarProps> = ({ \r\n  progress,\r\n  className = '' \r\n}) => {\r\n  const clampedProgress = Math.min(Math.max(progress, 0), 100);\r\n  \r\n  return (\r\n    <div className={`relative ${className}`}>\r\n      {/* Progress Track */}\r\n      <div className=\"relative h-2 bg-surface-light/20 rounded-full overflow-hidden\">\r\n        {/* Progress Fill */}\r\n        <div\r\n          className=\"absolute left-0 top-0 h-full bg-gradient-to-r from-primary to-primary-dark transition-all duration-500 ease-out\"\r\n          style={{ width: `${clampedProgress}%` }}\r\n        />\r\n        \r\n        {/* Progress Dot */}\r\n        <div\r\n          className=\"absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full shadow-lg border-2 border-primary transition-all duration-500 ease-out\"\r\n          style={{ \r\n            left: `${clampedProgress}%`,\r\n            transform: `translateX(-50%) translateY(-50%)`\r\n          }}\r\n        >\r\n          {/* Pulse animation for recent updates */}\r\n          <div className=\"absolute inset-0 bg-primary/30 rounded-full animate-ping\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GameProgressBar;\r\n"],"names":["ManualUploadToggle","isManualMode","onToggle","isConnected","title","jsx","ManualUploadToggle$1","React","ScreenshotButton","isProcessing","isManualUploadMode","onRequestConnect","usage","mode","setMode","useState","menuOpen","setMenuOpen","rootRef","useRef","btnRef","longPressRef","showHint","setShowHint","canUseMultishot","isFreeUser","useEffect","saved","setModeAndPersist","m","handler","e","openMenu","handleContextMenu","handleMouseDown","handleTouchStart","clearLongPress","handleClick","msg","send","handleMultishotClick","jsxs","Fragment","DownloadIcon","className","UserAvatar","AIAvatar","TypingIndicator","variant","showText","SendIcon","TTSControls","isSpeaking","setIsSpeaking","isPaused","setIsPaused","handleTTSStarted","handleTTSStopped","handleTTSPaused","handleTTSResumed","handlePauseResume","ttsService","handleRestart","SuggestedPrompts","prompts","onPromptClick","isLoading","conversationId","isMobile","setIsMobile","accordionOpen","setAccordionOpen","usedPrompts","setUsedPrompts","isShowingNewsPrompts","newsPrompts","p","i","displayPrompts","mq","apply","used","suggestedPromptsService","handlePromptClick","prompt","prev","v","index","isUsed","ActiveSessionToggle","isActive","onClick","disabled","SubTabs","subtabs","activeTabId","onTabClick","localActiveTab","setLocalActiveTab","_a","isExpanded","setIsExpanded","hasUserInteracted","setHasUserInteracted","currentActiveTab","activeTab","tab","allLoading","anyLoaded","allLoaded","hasLoadedContent","s","handleTabClick","tabId","toggleExpanded","ReactMarkdown","remarkGfm","children","ChatMessageComponent","message","suggestedPrompts","onSuggestedPromptClick","onDownloadImage","MemoizedChatMessage","memo","prevProps","nextProps","ChatInterface","conversation","onSendMessage","isPCConnected","userTier","onStop","onToggleManualUploadMode","activeSession","onToggleActiveSession","initialMessage","onMessageChange","queuedImage","onImageQueued","setMessage","imageFile","setImageFile","imagePreview","setImagePreview","isFocused","setIsFocused","showAutocomplete","setShowAutocomplete","autocompleteSuggestions","setAutocompleteSuggestions","selectedSuggestionIndex","setSelectedSuggestionIndex","isQuickActionsExpanded","setIsQuickActionsExpanded","messagesEndRef","fileInputRef","textareaRef","autocompleteRef","scrollToBottom","adjustTextareaHeight","textarea","scrollHeight","newHeight","handleValueChange","newValue","availableTabs","tabManagementService","handleSelectSuggestion","handleKeyDown","handleSubmit","imageUrl","handleImageUpload","file","reader","result","removeImage","toggleManualUploadMode","downloadImage","imageSrc","link","timestamp","filename","error","t","gameTabService","GameProgressBar","progress","clampedProgress"],"mappings":"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"}