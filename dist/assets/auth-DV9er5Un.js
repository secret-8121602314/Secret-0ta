import{r as b,j as s}from"./react-vendor-Caqaq3dM.js";import{c as D}from"./supabase-vendor-wc801gge.js";import{a as v}from"./core-services-B5uw7mAT.js";const T="https://qajcxgkqloumogioomiz.supabase.co",O="sb_publishable_GoW6G_umt1lFF-KPbbm-Ow_D2PYxPLw",u=D(T,O,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});if(typeof window<"u"){u.auth.onAuthStateChange((t,o)=>{if(t==="SIGNED_IN"){if(o!=null&&o.access_token){document.body.style.cssText="",document.documentElement.style.cssText="";const a=document.getElementById("root");a&&(a.style.cssText=""),document.body.offsetHeight,console.log("ðŸ” [Supabase] DOM styles cleaned on SIGNED_IN"),localStorage.setItem("otakon_session_refreshed",Date.now().toString()),localStorage.setItem("otakon_last_session_check",Date.now().toString()),window.dispatchEvent(new CustomEvent("otakon:session-refreshed",{detail:{event:t,session:o}}))}}else if(t==="TOKEN_REFRESHED")o!=null&&o.access_token?(localStorage.setItem("otakon_session_refreshed",Date.now().toString()),localStorage.setItem("otakon_last_session_check",Date.now().toString()),window.dispatchEvent(new CustomEvent("otakon:session-refreshed",{detail:{event:t,session:o}}))):(console.error("ðŸ” [Supabase] Token refresh failed - session expired"),localStorage.removeItem("otakon_session_refreshed"),localStorage.removeItem("otakon_last_session_check"),window.dispatchEvent(new CustomEvent("otakon:session-expired",{detail:{reason:"token_refresh_failed",timestamp:Date.now()}})));else if(t==="SIGNED_OUT"){document.body.style.cssText="",document.documentElement.style.cssText="";const a=document.getElementById("root");a&&(a.style.cssText=""),document.body.offsetHeight,console.log("ðŸ” [Supabase] DOM styles cleaned on SIGNED_OUT"),localStorage.removeItem("otakon_session_refreshed"),localStorage.removeItem("otakon_last_session_check"),window.dispatchEvent(new CustomEvent("otakon:signed-out"))}else t==="USER_UPDATED"&&window.dispatchEvent(new CustomEvent("otakon:user-updated",{detail:{session:o}}))});const c=300*1e3;setInterval(async()=>{try{const{data:{session:t},error:o}=await u.auth.getSession();if(o||!t){const a=localStorage.getItem("otakon_last_session_check");a&&Date.now()-parseInt(a)<c*2&&(console.warn("ðŸ” [Supabase] Session expired during health check"),window.dispatchEvent(new CustomEvent("otakon:session-expired",{detail:{reason:"health_check_failed",timestamp:Date.now()}})))}else localStorage.setItem("otakon_last_session_check",Date.now().toString())}catch(t){console.error("ðŸ” [Supabase] Session health check error:",t)}},c)}const G=Object.freeze(Object.defineProperty({__proto__:null,supabase:u},Symbol.toStringTag,{value:"Module"})),L=({onAuthSuccess:c,onAuthError:t})=>{const[o,a]=b.useState("loading"),[p,h]=b.useState(null),E=b.useRef(!1),x=b.useRef(null);return b.useEffect(()=>E.current?void 0:(E.current=!0,(async()=>{var C,y;try{if(!(window.location.search.includes("code")||window.location.hash.includes("access_token"))&&(await u.auth.getSession()).data.session){const n=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,n),a("success"),c();return}const l=new URLSearchParams(window.location.search),w=new URLSearchParams(window.location.hash.substring(1)),r=l.get("error")||w.get("error"),i=l.get("error_description")||w.get("error_description"),S=l.get("error_code")||w.get("error_code");if(console.log("ðŸ” [AuthCallback] OAuth parameters:",{oauthError:r,errorDescription:i,errorCode:S,urlParams:Object.fromEntries(l.entries()),hashParams:Object.fromEntries(w.entries())}),r){console.error("ðŸ” [AuthCallback] OAuth error detected:",{oauthError:r,errorDescription:i,errorCode:S});let e="Authentication failed";r==="access_denied"&&S==="otp_expired"?e="Email confirmation link has expired. Please request a new confirmation email.":r==="access_denied"&&(i!=null&&i.includes("Email link is invalid"))?e="Email confirmation link is invalid. Please request a new confirmation email.":r==="access_denied"&&(i!=null&&i.includes("expired"))?e="Email confirmation link has expired. Please request a new confirmation email.":r==="server_error"?e="Authentication server error. This may be due to Supabase configuration. Please try again.":r==="access_denied"?e="Authentication was cancelled. Please try again.":r==="invalid_request"?e="Invalid authentication request. Please check configuration.":r==="unauthorized_client"?e="Authentication client is not authorized. Please check Supabase configuration.":r==="unsupported_response_type"?e="Authentication response type not supported. Please check Supabase configuration.":r==="invalid_scope"?e="Authentication scope is invalid. Please check Supabase configuration.":i&&(e=decodeURIComponent(i)),h(e),a("error"),t(e);return}const{data:{subscription:d}}=u.auth.onAuthStateChange(async(e,n)=>{var f,m,N,I,j;if(e==="SIGNED_IN"&&(n!=null&&n.user)){const F=((f=n.user.app_metadata)==null?void 0:f.provider)||((N=(m=n.user.app_metadata)==null?void 0:m.providers)==null?void 0:N[0])||((j=(I=n.user.identities)==null?void 0:I[0])==null?void 0:j.provider)||"unknown";await new Promise(k=>setTimeout(k,1500));try{await v.loadUserFromSupabase(n.user.id),a("success"),c()}catch(k){console.error("ðŸ” [AuthCallback] Error loading user data:",k),h("Failed to load user data. Please try again."),a("error"),t("Failed to load user data")}d.unsubscribe()}else e==="SIGNED_OUT"&&(h("Authentication failed"),a("error"),t("Authentication failed"),d.unsubscribe())});x.current=d;const{data:P,error:g}=await u.auth.getSession();if(g){console.error("ðŸ” [AuthCallback] Auth callback error:",g),h(g.message),a("error"),t(g.message),d.unsubscribe();return}if((C=P.session)!=null&&C.user)await new Promise(e=>setTimeout(e,1e3)),await v.loadUserFromSupabase(P.session.user.id),a("success"),c(),d.unsubscribe();else{const e=new URLSearchParams(window.location.search),n=new URLSearchParams(window.location.hash.substring(1));if(e.has("code")||e.has("error")||n.has("access_token")){await new Promise(m=>setTimeout(m,1e3));const f=await u.auth.getSession();if((y=f.data.session)!=null&&y.user){await new Promise(m=>setTimeout(m,500)),await v.loadUserFromSupabase(f.data.session.user.id),a("success"),c(),d.unsubscribe();return}}setTimeout(()=>{o==="loading"&&(h("Authentication timeout"),a("error"),t("Authentication timeout"),d.unsubscribe())},1e4)}}catch(A){console.error("ðŸ” [AuthCallback] Auth callback error:",A);const l="An unexpected error occurred";h(l),a("error"),t(l)}})(),()=>{x.current&&x.current.unsubscribe()}),[]),o==="loading"?s.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#FF4D4D] mx-auto mb-4"}),s.jsx("p",{className:"text-[#CFCFCF] text-lg",children:"Completing authentication..."})]})}):o==="error"?s.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âš ï¸"}),s.jsx("h2",{className:"text-2xl font-bold text-[#F5F5F5] mb-2",children:"Authentication Error"}),s.jsx("p",{className:"text-[#CFCFCF] mb-6",children:p}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>{const _=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,_),t("User cancelled authentication")},className:"bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] md:hover:from-[#D42A2A] md:hover:to-[#C87A1A] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 md:hover:scale-105 active:scale-95",children:"Return to Login"}),p&&p.includes("Email confirmation link")&&s.jsx("button",{onClick:()=>{window.history.replaceState({},document.title,"/"),t("Email confirmation expired - show resend option")},className:"bg-gradient-to-r from-[#4F46E5] to-[#7C3AED] md:hover:from-[#4338CA] md:hover:to-[#6D28D9] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 md:hover:scale-105 active:scale-95",children:"Request New Confirmation Email"})]})]})}):s.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-green-500 text-6xl mb-4",children:"âœ…"}),s.jsx("h2",{className:"text-2xl font-bold text-[#F5F5F5] mb-2",children:"Authentication Successful"}),s.jsx("p",{className:"text-[#CFCFCF]",children:"Redirecting to the app..."})]})})};export{L as A,G as a,u as s};
