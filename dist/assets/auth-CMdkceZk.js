import{r as m,j as a}from"./react-vendor-GN48U5Y-.js";import{c as O}from"./supabase-vendor-Q7d2eXAy.js";import{a as y}from"./core-services-BVV9fFrG.js";const E="https://qajcxgkqloumogioomiz.supabase.co",L="sb_publishable_GoW6G_umt1lFF-KPbbm-Ow_D2PYxPLw",w=O(E,L,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),I=({onAuthSuccess:b,onAuthError:n})=>{const[x,s]=m.useState("loading"),[C,u]=m.useState(null),_=m.useRef(!1),k=m.useRef(null);return m.useEffect(()=>{if(_.current){console.log("ðŸ” [AuthCallback] Already processed, skipping...");return}return _.current=!0,(async()=>{var F,S;try{console.log("ðŸ” [AuthCallback] Handling OAuth callback..."),console.log("ðŸ” [AuthCallback] Current URL:",window.location.href),console.log("ðŸ” [AuthCallback] URL search params:",window.location.search),console.log("ðŸ” [AuthCallback] URL hash:",window.location.hash);const f=window.location.search.includes("code")||window.location.hash.includes("access_token");if(console.log("ðŸ” [AuthCallback] Has OAuth code/token:",f),!f){console.log("ðŸ” [AuthCallback] No OAuth parameters found, checking existing session...");const e=await w.auth.getSession();if(e.data.session){console.log("ðŸ” [AuthCallback] Already logged in, no OAuth to process:",e.data.session.user.email);const t=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,t),s("success"),b();return}}console.log("ðŸ” [AuthCallback] Processing OAuth callback...");const i=new URLSearchParams(window.location.search),p=new URLSearchParams(window.location.hash.substring(1)),o=i.get("error")||p.get("error"),r=i.get("error_description")||p.get("error_description"),P=i.get("error_code")||p.get("error_code");if(console.log("ðŸ” [AuthCallback] OAuth parameters:",{oauthError:o,errorDescription:r,errorCode:P,urlParams:Object.fromEntries(i.entries()),hashParams:Object.fromEntries(p.entries())}),o){console.error("ðŸ” [AuthCallback] OAuth error detected:",{oauthError:o,errorDescription:r,errorCode:P});let e="Authentication failed";o==="access_denied"&&P==="otp_expired"?e="Email confirmation link has expired. Please request a new confirmation email.":o==="access_denied"&&(r!=null&&r.includes("Email link is invalid"))?e="Email confirmation link is invalid. Please request a new confirmation email.":o==="access_denied"&&(r!=null&&r.includes("expired"))?e="Email confirmation link has expired. Please request a new confirmation email.":o==="server_error"?e="Authentication server error. This may be due to Supabase configuration. Please try again.":o==="access_denied"?e="Authentication was cancelled. Please try again.":o==="invalid_request"?e="Invalid authentication request. Please check configuration.":o==="unauthorized_client"?e="Authentication client is not authorized. Please check Supabase configuration.":o==="unsupported_response_type"?e="Authentication response type not supported. Please check Supabase configuration.":o==="invalid_scope"?e="Authentication scope is invalid. Please check Supabase configuration.":r&&(e=decodeURIComponent(r)),u(e),s("error"),n(e);return}const{data:{subscription:l}}=w.auth.onAuthStateChange(async(e,t)=>{var c,d,j,N,U;if(console.log("ðŸ” [AuthCallback] Auth state change:",{event:e,session:t}),e==="SIGNED_IN"&&(t!=null&&t.user)){console.log("ðŸ” [AuthCallback] User signed in:",t.user.email),console.log("ðŸ” [AuthCallback] User metadata:",t.user.user_metadata),console.log("ðŸ” [AuthCallback] App metadata:",t.user.app_metadata),console.log("ðŸ” [AuthCallback] User identities:",t.user.identities);const R=((c=t.user.app_metadata)==null?void 0:c.provider)||((j=(d=t.user.app_metadata)==null?void 0:d.providers)==null?void 0:j[0])||((U=(N=t.user.identities)==null?void 0:N[0])==null?void 0:U.provider)||"unknown";console.log("ðŸ” [AuthCallback] Detected provider:",R),console.log("ðŸ” [AuthCallback] Waiting for database trigger to create user record..."),await new Promise(v=>setTimeout(v,1500));try{await y.loadUserFromSupabase(t.user.id),console.log("ðŸ” [AuthCallback] User data loaded successfully"),s("success"),b()}catch(v){console.error("ðŸ” [AuthCallback] Error loading user data:",v),u("Failed to load user data. Please try again."),s("error"),n("Failed to load user data")}l.unsubscribe()}else e==="SIGNED_OUT"&&(console.log("ðŸ” [AuthCallback] User signed out"),u("Authentication failed"),s("error"),n("Authentication failed"),l.unsubscribe())});k.current=l;const{data:A,error:h}=await w.auth.getSession();if(console.log("ðŸ” [AuthCallback] Current session:",{data:A,error:h}),h){console.error("ðŸ” [AuthCallback] Auth callback error:",h),u(h.message),s("error"),n(h.message),l.unsubscribe();return}if((F=A.session)!=null&&F.user)console.log("ðŸ” [AuthCallback] User already authenticated:",A.session.user.email),console.log("ðŸ” [AuthCallback] Waiting for database trigger to create user record..."),await new Promise(e=>setTimeout(e,1e3)),await y.loadUserFromSupabase(A.session.user.id),s("success"),b(),l.unsubscribe();else{console.log("ðŸ” [AuthCallback] No session found, waiting for auth state change..."),console.log("ðŸ” [AuthCallback] URL search params:",window.location.search);const e=new URLSearchParams(window.location.search),t=new URLSearchParams(window.location.hash.substring(1));if(e.has("code")||e.has("error")||t.has("access_token")){console.log("ðŸ” [AuthCallback] OAuth parameters found, trying manual handling..."),await new Promise(d=>setTimeout(d,1e3));const c=await w.auth.getSession();if(console.log("ðŸ” [AuthCallback] Retry session after manual handling:",c),(S=c.data.session)!=null&&S.user){console.log("ðŸ” [AuthCallback] User authenticated after retry:",c.data.session.user.email),console.log("ðŸ” [AuthCallback] Waiting for database trigger to create user record..."),await new Promise(d=>setTimeout(d,500)),await y.loadUserFromSupabase(c.data.session.user.id),s("success"),b(),l.unsubscribe();return}}setTimeout(()=>{x==="loading"&&(console.log("ðŸ” [AuthCallback] Timeout waiting for auth state change"),u("Authentication timeout"),s("error"),n("Authentication timeout"),l.unsubscribe())},1e4)}}catch(f){console.error("ðŸ” [AuthCallback] Auth callback error:",f);const i="An unexpected error occurred";u(i),s("error"),n(i)}})(),()=>{k.current&&k.current.unsubscribe()}},[]),x==="loading"?a.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#FF4D4D] mx-auto mb-4"}),a.jsx("p",{className:"text-[#CFCFCF] text-lg",children:"Completing authentication..."})]})}):x==="error"?a.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âš ï¸"}),a.jsx("h2",{className:"text-2xl font-bold text-[#F5F5F5] mb-2",children:"Authentication Error"}),a.jsx("p",{className:"text-[#CFCFCF] mb-6",children:C}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:()=>{const g=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,g),n("User cancelled authentication")},className:"bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] hover:from-[#D42A2A] hover:to-[#C87A1A] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:scale-105 active:scale-95",children:"Return to Login"}),C&&C.includes("Email confirmation link")&&a.jsx("button",{onClick:()=>{const g=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,g),n("Email confirmation expired - show resend option")},className:"bg-gradient-to-r from-[#4F46E5] to-[#7C3AED] hover:from-[#4338CA] hover:to-[#6D28D9] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:scale-105 active:scale-95",children:"Request New Confirmation Email"})]})]})}):a.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-green-500 text-6xl mb-4",children:"âœ…"}),a.jsx("h2",{className:"text-2xl font-bold text-[#F5F5F5] mb-2",children:"Authentication Successful"}),a.jsx("p",{className:"text-[#CFCFCF]",children:"Redirecting to the app..."})]})})};export{I as A,w as s};
//# sourceMappingURL=auth-CMdkceZk.js.map
