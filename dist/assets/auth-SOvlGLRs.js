import{r as b,j as a}from"./react-vendor-65gUsYuq.js";import{c as N}from"./supabase-vendor-B_JX6VhK.js";import{a as k}from"./core-services-z2li2Njd.js";const R="https://qajcxgkqloumogioomiz.supabase.co",E="sb_publishable_GoW6G_umt1lFF-KPbbm-Ow_D2PYxPLw",v=N(R,E,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),O=({onAuthSuccess:f,onAuthError:i})=>{const[p,o]=b.useState("loading"),[A,u]=b.useState(null),P=b.useRef(!1),x=b.useRef(null);return b.useEffect(()=>{if(P.current){console.log("ðŸ” [AuthCallback] Already processed, skipping...");return}return P.current=!0,(async()=>{var y,F;try{console.log("ðŸ” [AuthCallback] Handling OAuth callback..."),console.log("ðŸ” [AuthCallback] Current URL:",window.location.href),console.log("ðŸ” [AuthCallback] URL search params:",window.location.search),console.log("ðŸ” [AuthCallback] URL hash:",window.location.hash);const d=new URLSearchParams(window.location.search),n=new URLSearchParams(window.location.hash.substring(1)),r=d.get("error")||n.get("error"),s=d.get("error_description")||n.get("error_description"),w=d.get("error_code")||n.get("error_code");if(console.log("ðŸ” [AuthCallback] OAuth parameters:",{oauthError:r,errorDescription:s,errorCode:w,urlParams:Object.fromEntries(d.entries()),hashParams:Object.fromEntries(n.entries())}),r){console.error("ðŸ” [AuthCallback] OAuth error detected:",{oauthError:r,errorDescription:s,errorCode:w});let e="Authentication failed";r==="access_denied"&&w==="otp_expired"?e="Email confirmation link has expired. Please request a new confirmation email.":r==="access_denied"&&(s!=null&&s.includes("Email link is invalid"))?e="Email confirmation link is invalid. Please request a new confirmation email.":r==="access_denied"&&(s!=null&&s.includes("expired"))?e="Email confirmation link has expired. Please request a new confirmation email.":r==="server_error"?e="Authentication server error. This may be due to Supabase configuration. Please try again.":r==="access_denied"?e="Authentication was cancelled. Please try again.":r==="invalid_request"?e="Invalid authentication request. Please check configuration.":r==="unauthorized_client"?e="Authentication client is not authorized. Please check Supabase configuration.":r==="unsupported_response_type"?e="Authentication response type not supported. Please check Supabase configuration.":r==="invalid_scope"?e="Authentication scope is invalid. Please check Supabase configuration.":s&&(e=decodeURIComponent(s)),u(e),o("error"),i(e);return}const{data:{subscription:l}}=v.auth.onAuthStateChange(async(e,t)=>{var c,h,_,j,S;if(console.log("ðŸ” [AuthCallback] Auth state change:",{event:e,session:t}),e==="SIGNED_IN"&&(t!=null&&t.user)){console.log("ðŸ” [AuthCallback] User signed in:",t.user.email),console.log("ðŸ” [AuthCallback] User metadata:",t.user.user_metadata),console.log("ðŸ” [AuthCallback] App metadata:",t.user.app_metadata),console.log("ðŸ” [AuthCallback] User identities:",t.user.identities);const U=((c=t.user.app_metadata)==null?void 0:c.provider)||((_=(h=t.user.app_metadata)==null?void 0:h.providers)==null?void 0:_[0])||((S=(j=t.user.identities)==null?void 0:j[0])==null?void 0:S.provider)||"unknown";console.log("ðŸ” [AuthCallback] Detected provider:",U),console.log("ðŸ” [AuthCallback] Waiting for database trigger to create user record..."),await new Promise(C=>setTimeout(C,1500));try{await k.loadUserFromSupabase(t.user.id),console.log("ðŸ” [AuthCallback] User data loaded successfully"),o("success"),f()}catch(C){console.error("ðŸ” [AuthCallback] Error loading user data:",C),u("Failed to load user data. Please try again."),o("error"),i("Failed to load user data")}l.unsubscribe()}else e==="SIGNED_OUT"&&(console.log("ðŸ” [AuthCallback] User signed out"),u("Authentication failed"),o("error"),i("Authentication failed"),l.unsubscribe())});x.current=l;const{data:g,error:m}=await v.auth.getSession();if(console.log("ðŸ” [AuthCallback] Current session:",{data:g,error:m}),m){console.error("ðŸ” [AuthCallback] Auth callback error:",m),u(m.message),o("error"),i(m.message),l.unsubscribe();return}if((y=g.session)!=null&&y.user)console.log("ðŸ” [AuthCallback] User already authenticated:",g.session.user.email),console.log("ðŸ” [AuthCallback] Waiting for database trigger to create user record..."),await new Promise(e=>setTimeout(e,1e3)),await k.loadUserFromSupabase(g.session.user.id),o("success"),f(),l.unsubscribe();else{console.log("ðŸ” [AuthCallback] No session found, waiting for auth state change..."),console.log("ðŸ” [AuthCallback] URL search params:",window.location.search);const e=new URLSearchParams(window.location.search),t=new URLSearchParams(window.location.hash.substring(1));if(e.has("code")||e.has("error")||t.has("access_token")){console.log("ðŸ” [AuthCallback] OAuth parameters found, trying manual handling..."),await new Promise(h=>setTimeout(h,1e3));const c=await v.auth.getSession();if(console.log("ðŸ” [AuthCallback] Retry session after manual handling:",c),(F=c.data.session)!=null&&F.user){console.log("ðŸ” [AuthCallback] User authenticated after retry:",c.data.session.user.email),console.log("ðŸ” [AuthCallback] Waiting for database trigger to create user record..."),await new Promise(h=>setTimeout(h,500)),await k.loadUserFromSupabase(c.data.session.user.id),o("success"),f(),l.unsubscribe();return}}setTimeout(()=>{p==="loading"&&(console.log("ðŸ” [AuthCallback] Timeout waiting for auth state change"),u("Authentication timeout"),o("error"),i("Authentication timeout"),l.unsubscribe())},1e4)}}catch(d){console.error("ðŸ” [AuthCallback] Auth callback error:",d);const n="An unexpected error occurred";u(n),o("error"),i(n)}})(),()=>{x.current&&x.current.unsubscribe()}},[]),p==="loading"?a.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#FF4D4D] mx-auto mb-4"}),a.jsx("p",{className:"text-[#CFCFCF] text-lg",children:"Completing authentication..."})]})}):p==="error"?a.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âš ï¸"}),a.jsx("h2",{className:"text-2xl font-bold text-[#F5F5F5] mb-2",children:"Authentication Error"}),a.jsx("p",{className:"text-[#CFCFCF] mb-6",children:A}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:()=>{window.history.replaceState({},document.title,window.location.pathname),i("User cancelled authentication")},className:"bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] hover:from-[#D42A2A] hover:to-[#C87A1A] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:scale-105 active:scale-95",children:"Return to Login"}),A&&A.includes("Email confirmation link")&&a.jsx("button",{onClick:()=>{window.history.replaceState({},document.title,window.location.pathname),i("Email confirmation expired - show resend option")},className:"bg-gradient-to-r from-[#4F46E5] to-[#7C3AED] hover:from-[#4338CA] hover:to-[#6D28D9] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:scale-105 active:scale-95",children:"Request New Confirmation Email"})]})]})}):a.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-green-500 text-6xl mb-4",children:"âœ…"}),a.jsx("h2",{className:"text-2xl font-bold text-[#F5F5F5] mb-2",children:"Authentication Successful"}),a.jsx("p",{className:"text-[#CFCFCF]",children:"Redirecting to the app..."})]})})};export{O as A,v as s};
//# sourceMappingURL=auth-SOvlGLRs.js.map
