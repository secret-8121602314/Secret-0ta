import{j as s,z as F,r as w}from"./react-vendor-DAAJn5wd.js";import{c as O}from"./supabase-vendor-DhYXkmtO.js";import{a as E}from"./core-services-B2ixXSMI.js";import{t as U,c as z}from"./vendor-B9Aw4EYg.js";const q="https://qajcxgkqloumogioomiz.supabase.co",G="sb_publishable_GoW6G_umt1lFF-KPbbm-Ow_D2PYxPLw",f=O(q,G,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});if(typeof window<"u"){f.auth.onAuthStateChange((e,o)=>{if(e==="SIGNED_IN"){if(o!=null&&o.access_token){document.body.style.cssText="",document.documentElement.style.cssText="";const t=document.getElementById("root");t&&(t.style.cssText=""),document.body.offsetHeight,console.log("ðŸ” [Supabase] DOM styles cleaned on SIGNED_IN"),localStorage.setItem("otakon_session_refreshed",Date.now().toString()),localStorage.setItem("otakon_last_session_check",Date.now().toString()),window.dispatchEvent(new CustomEvent("otakon:session-refreshed",{detail:{event:e,session:o}}))}}else if(e==="TOKEN_REFRESHED")o!=null&&o.access_token?(localStorage.setItem("otakon_session_refreshed",Date.now().toString()),localStorage.setItem("otakon_last_session_check",Date.now().toString()),window.dispatchEvent(new CustomEvent("otakon:session-refreshed",{detail:{event:e,session:o}}))):(console.error("ðŸ” [Supabase] Token refresh failed - session expired"),localStorage.removeItem("otakon_session_refreshed"),localStorage.removeItem("otakon_last_session_check"),window.dispatchEvent(new CustomEvent("otakon:session-expired",{detail:{reason:"token_refresh_failed",timestamp:Date.now()}})));else if(e==="SIGNED_OUT"){document.body.style.cssText="",document.documentElement.style.cssText="";const t=document.getElementById("root");t&&(t.style.cssText=""),document.body.offsetHeight,console.log("ðŸ” [Supabase] DOM styles cleaned on SIGNED_OUT"),localStorage.removeItem("otakon_session_refreshed"),localStorage.removeItem("otakon_last_session_check"),window.dispatchEvent(new CustomEvent("otakon:signed-out"))}else e==="USER_UPDATED"&&window.dispatchEvent(new CustomEvent("otakon:user-updated",{detail:{session:o}}))});const n=300*1e3;setInterval(async()=>{try{const{data:{session:e},error:o}=await f.auth.getSession();if(o||!e){const t=localStorage.getItem("otakon_last_session_check");t&&Date.now()-parseInt(t)<n*2&&(console.warn("ðŸ” [Supabase] Session expired during health check"),window.dispatchEvent(new CustomEvent("otakon:session-expired",{detail:{reason:"health_check_failed",timestamp:Date.now()}})))}else localStorage.setItem("otakon_last_session_check",Date.now().toString())}catch(e){console.error("ðŸ” [Supabase] Session health check error:",e)}},n)}function j(...n){return U(z(n))}const T=({size:n="md",className:e="",fullScreen:o=!0})=>{const t={sm:"small",md:"medium",lg:"large"},l=s.jsx(F,{color:"#ff4d00",size:t[n],text:"",textColor:""});return o?s.jsx("div",{className:j("h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",e),children:l}):s.jsx("div",{className:j("h-full bg-background flex items-center justify-center",e),children:l})},B=({onAuthSuccess:n,onAuthError:e})=>{const[o,t]=w.useState("loading"),[l,m]=w.useState(null),v=w.useRef(!1),_=w.useRef(null);return w.useEffect(()=>v.current?void 0:(v.current=!0,(async()=>{var y,A;try{if(!(window.location.search.includes("code")||window.location.hash.includes("access_token"))&&(await f.auth.getSession()).data.session){const i=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,i),t("success"),n();return}const d=new URLSearchParams(window.location.search),b=new URLSearchParams(window.location.hash.substring(1)),r=d.get("error")||b.get("error"),c=d.get("error_description")||b.get("error_description"),k=d.get("error_code")||b.get("error_code");if(console.log("ðŸ” [AuthCallback] OAuth parameters:",{oauthError:r,errorDescription:c,errorCode:k,urlParams:Object.fromEntries(d.entries()),hashParams:Object.fromEntries(b.entries())}),r){console.error("ðŸ” [AuthCallback] OAuth error detected:",{oauthError:r,errorDescription:c,errorCode:k});let a="Authentication failed";r==="access_denied"&&k==="otp_expired"?a="Email confirmation link has expired. Please request a new confirmation email.":r==="access_denied"&&(c!=null&&c.includes("Email link is invalid"))?a="Email confirmation link is invalid. Please request a new confirmation email.":r==="access_denied"&&(c!=null&&c.includes("expired"))?a="Email confirmation link has expired. Please request a new confirmation email.":r==="server_error"?a="Authentication server error. This may be due to Supabase configuration. Please try again.":r==="access_denied"?a="Authentication was cancelled. Please try again.":r==="invalid_request"?a="Invalid authentication request. Please check configuration.":r==="unauthorized_client"?a="Authentication client is not authorized. Please check Supabase configuration.":r==="unsupported_response_type"?a="Authentication response type not supported. Please check Supabase configuration.":r==="invalid_scope"?a="Authentication scope is invalid. Please check Supabase configuration.":c&&(a=decodeURIComponent(c)),m(a),t("error"),e(a);return}const{data:{subscription:u}}=f.auth.onAuthStateChange(async(a,i)=>{var p,h,I,D,N;if(a==="SIGNED_IN"&&(i!=null&&i.user)){const R=((p=i.user.app_metadata)==null?void 0:p.provider)||((I=(h=i.user.app_metadata)==null?void 0:h.providers)==null?void 0:I[0])||((N=(D=i.user.identities)==null?void 0:D[0])==null?void 0:N.provider)||"unknown";await new Promise(x=>setTimeout(x,1500));try{await E.loadUserFromSupabase(i.user.id),t("success"),n()}catch(x){console.error("ðŸ” [AuthCallback] Error loading user data:",x),m("Failed to load user data. Please try again."),t("error"),e("Failed to load user data")}u.unsubscribe()}else a==="SIGNED_OUT"&&(m("Authentication failed"),t("error"),e("Authentication failed"),u.unsubscribe())});_.current=u;const{data:P,error:g}=await f.auth.getSession();if(g){console.error("ðŸ” [AuthCallback] Auth callback error:",g),m(g.message),t("error"),e(g.message),u.unsubscribe();return}if((y=P.session)!=null&&y.user)await new Promise(a=>setTimeout(a,1e3)),await E.loadUserFromSupabase(P.session.user.id),t("success"),n(),u.unsubscribe();else{const a=new URLSearchParams(window.location.search),i=new URLSearchParams(window.location.hash.substring(1));if(a.has("code")||a.has("error")||i.has("access_token")){await new Promise(h=>setTimeout(h,1e3));const p=await f.auth.getSession();if((A=p.data.session)!=null&&A.user){await new Promise(h=>setTimeout(h,500)),await E.loadUserFromSupabase(p.data.session.user.id),t("success"),n(),u.unsubscribe();return}}setTimeout(()=>{o==="loading"&&(m("Authentication timeout"),t("error"),e("Authentication timeout"),u.unsubscribe())},1e4)}}catch(C){console.error("ðŸ” [AuthCallback] Auth callback error:",C);const d="An unexpected error occurred";m(d),t("error"),e(d)}})(),()=>{_.current&&_.current.unsubscribe()}),[]),o==="loading"?s.jsx(T,{size:"md"}):o==="error"?s.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âš ï¸"}),s.jsx("h2",{className:"text-2xl font-bold text-[#F5F5F5] mb-2",children:"Authentication Error"}),s.jsx("p",{className:"text-[#CFCFCF] mb-6",children:l}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>{const S=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,S),e("User cancelled authentication")},className:"bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] md:hover:from-[#D42A2A] md:hover:to-[#C87A1A] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 md:hover:scale-105 active:scale-95",children:"Return to Login"}),l&&l.includes("Email confirmation link")&&s.jsx("button",{onClick:()=>{window.history.replaceState({},document.title,"/"),e("Email confirmation expired - show resend option")},className:"bg-gradient-to-r from-[#4F46E5] to-[#7C3AED] md:hover:from-[#4338CA] md:hover:to-[#6D28D9] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 md:hover:scale-105 active:scale-95",children:"Request New Confirmation Email"})]})]})}):s.jsx(T,{size:"md"})};export{T as A,B as a,j as c,f as s};
