import{r as g,j as o}from"./react-vendor-Caqaq3dM.js";import{c as D}from"./supabase-vendor-wc801gge.js";import{a as v}from"./core-services-C4OQcroU.js";const T="https://qajcxgkqloumogioomiz.supabase.co",O="sb_publishable_GoW6G_umt1lFF-KPbbm-Ow_D2PYxPLw",h=D(T,O,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});if(typeof window<"u"){h.auth.onAuthStateChange((t,s)=>{if(t==="SIGNED_IN"){if(s!=null&&s.access_token){document.body.style.cssText="",document.documentElement.style.cssText="";const a=document.getElementById("root");if(a){const r=window.innerHeight;a.style.cssText=`height: ${r}px !important; min-height: ${r}px !important; max-height: ${r}px !important;`,document.documentElement.style.setProperty("--app-height",`${r}px`)}document.body.offsetHeight,console.log("ðŸ” [Supabase] DOM styles cleaned on SIGNED_IN, viewport height preserved"),localStorage.setItem("otakon_session_refreshed",Date.now().toString()),localStorage.setItem("otakon_last_session_check",Date.now().toString()),window.dispatchEvent(new CustomEvent("otakon:session-refreshed",{detail:{event:t,session:s}}))}}else if(t==="TOKEN_REFRESHED")s!=null&&s.access_token?(localStorage.setItem("otakon_session_refreshed",Date.now().toString()),localStorage.setItem("otakon_last_session_check",Date.now().toString()),window.dispatchEvent(new CustomEvent("otakon:session-refreshed",{detail:{event:t,session:s}}))):(console.error("ðŸ” [Supabase] Token refresh failed - session expired"),localStorage.removeItem("otakon_session_refreshed"),localStorage.removeItem("otakon_last_session_check"),window.dispatchEvent(new CustomEvent("otakon:session-expired",{detail:{reason:"token_refresh_failed",timestamp:Date.now()}})));else if(t==="SIGNED_OUT"){document.body.style.cssText="",document.documentElement.style.cssText="";const a=document.getElementById("root");if(a){const r=window.innerHeight;a.style.cssText=`height: ${r}px !important; min-height: ${r}px !important; max-height: ${r}px !important;`,document.documentElement.style.setProperty("--app-height",`${r}px`)}document.body.offsetHeight,console.log("ðŸ” [Supabase] DOM styles cleaned on SIGNED_OUT, viewport height preserved"),localStorage.removeItem("otakon_session_refreshed"),localStorage.removeItem("otakon_last_session_check"),window.dispatchEvent(new CustomEvent("otakon:signed-out"))}else t==="USER_UPDATED"&&window.dispatchEvent(new CustomEvent("otakon:user-updated",{detail:{session:s}}))});const l=300*1e3;setInterval(async()=>{try{const{data:{session:t},error:s}=await h.auth.getSession();if(s||!t){const a=localStorage.getItem("otakon_last_session_check");a&&Date.now()-parseInt(a)<l*2&&(console.warn("ðŸ” [Supabase] Session expired during health check"),window.dispatchEvent(new CustomEvent("otakon:session-expired",{detail:{reason:"health_check_failed",timestamp:Date.now()}})))}else localStorage.setItem("otakon_last_session_check",Date.now().toString())}catch(t){console.error("ðŸ” [Supabase] Session health check error:",t)}},l)}const q=Object.freeze(Object.defineProperty({__proto__:null,supabase:h},Symbol.toStringTag,{value:"Module"})),G=({onAuthSuccess:l,onAuthError:t})=>{const[s,a]=g.useState("loading"),[r,m]=g.useState(null),E=g.useRef(!1),x=g.useRef(null);return g.useEffect(()=>E.current?void 0:(E.current=!0,(async()=>{var y,C;try{if(!(window.location.search.includes("code")||window.location.hash.includes("access_token"))&&(await h.auth.getSession()).data.session){const i=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,i),a("success"),l();return}const d=new URLSearchParams(window.location.search),w=new URLSearchParams(window.location.hash.substring(1)),n=d.get("error")||w.get("error"),c=d.get("error_description")||w.get("error_description"),S=d.get("error_code")||w.get("error_code");if(console.log("ðŸ” [AuthCallback] OAuth parameters:",{oauthError:n,errorDescription:c,errorCode:S,urlParams:Object.fromEntries(d.entries()),hashParams:Object.fromEntries(w.entries())}),n){console.error("ðŸ” [AuthCallback] OAuth error detected:",{oauthError:n,errorDescription:c,errorCode:S});let e="Authentication failed";n==="access_denied"&&S==="otp_expired"?e="Email confirmation link has expired. Please request a new confirmation email.":n==="access_denied"&&(c!=null&&c.includes("Email link is invalid"))?e="Email confirmation link is invalid. Please request a new confirmation email.":n==="access_denied"&&(c!=null&&c.includes("expired"))?e="Email confirmation link has expired. Please request a new confirmation email.":n==="server_error"?e="Authentication server error. This may be due to Supabase configuration. Please try again.":n==="access_denied"?e="Authentication was cancelled. Please try again.":n==="invalid_request"?e="Invalid authentication request. Please check configuration.":n==="unauthorized_client"?e="Authentication client is not authorized. Please check Supabase configuration.":n==="unsupported_response_type"?e="Authentication response type not supported. Please check Supabase configuration.":n==="invalid_scope"?e="Authentication scope is invalid. Please check Supabase configuration.":c&&(e=decodeURIComponent(c)),m(e),a("error"),t(e);return}const{data:{subscription:u}}=h.auth.onAuthStateChange(async(e,i)=>{var f,p,N,I,j;if(e==="SIGNED_IN"&&(i!=null&&i.user)){const F=((f=i.user.app_metadata)==null?void 0:f.provider)||((N=(p=i.user.app_metadata)==null?void 0:p.providers)==null?void 0:N[0])||((j=(I=i.user.identities)==null?void 0:I[0])==null?void 0:j.provider)||"unknown";await new Promise(k=>setTimeout(k,1500));try{await v.loadUserFromSupabase(i.user.id),a("success"),l()}catch(k){console.error("ðŸ” [AuthCallback] Error loading user data:",k),m("Failed to load user data. Please try again."),a("error"),t("Failed to load user data")}u.unsubscribe()}else e==="SIGNED_OUT"&&(m("Authentication failed"),a("error"),t("Authentication failed"),u.unsubscribe())});x.current=u;const{data:P,error:b}=await h.auth.getSession();if(b){console.error("ðŸ” [AuthCallback] Auth callback error:",b),m(b.message),a("error"),t(b.message),u.unsubscribe();return}if((y=P.session)!=null&&y.user)await new Promise(e=>setTimeout(e,1e3)),await v.loadUserFromSupabase(P.session.user.id),a("success"),l(),u.unsubscribe();else{const e=new URLSearchParams(window.location.search),i=new URLSearchParams(window.location.hash.substring(1));if(e.has("code")||e.has("error")||i.has("access_token")){await new Promise(p=>setTimeout(p,1e3));const f=await h.auth.getSession();if((C=f.data.session)!=null&&C.user){await new Promise(p=>setTimeout(p,500)),await v.loadUserFromSupabase(f.data.session.user.id),a("success"),l(),u.unsubscribe();return}}setTimeout(()=>{s==="loading"&&(m("Authentication timeout"),a("error"),t("Authentication timeout"),u.unsubscribe())},1e4)}}catch(A){console.error("ðŸ” [AuthCallback] Auth callback error:",A);const d="An unexpected error occurred";m(d),a("error"),t(d)}})(),()=>{x.current&&x.current.unsubscribe()}),[]),s==="loading"?o.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#FF4D4D] mx-auto mb-4"}),o.jsx("p",{className:"text-[#CFCFCF] text-lg",children:"Completing authentication..."})]})}):s==="error"?o.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âš ï¸"}),o.jsx("h2",{className:"text-2xl font-bold text-[#F5F5F5] mb-2",children:"Authentication Error"}),o.jsx("p",{className:"text-[#CFCFCF] mb-6",children:r}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("button",{onClick:()=>{const _=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,_),t("User cancelled authentication")},className:"bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] md:hover:from-[#D42A2A] md:hover:to-[#C87A1A] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 md:hover:scale-105 active:scale-95",children:"Return to Login"}),r&&r.includes("Email confirmation link")&&o.jsx("button",{onClick:()=>{window.history.replaceState({},document.title,"/"),t("Email confirmation expired - show resend option")},className:"bg-gradient-to-r from-[#4F46E5] to-[#7C3AED] md:hover:from-[#4338CA] md:hover:to-[#6D28D9] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 md:hover:scale-105 active:scale-95",children:"Request New Confirmation Email"})]})]})}):o.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-green-500 text-6xl mb-4",children:"âœ…"}),o.jsx("h2",{className:"text-2xl font-bold text-[#F5F5F5] mb-2",children:"Authentication Successful"}),o.jsx("p",{className:"text-[#CFCFCF]",children:"Redirecting to the app..."})]})})};export{G as A,q as a,h as s};
