{"version":3,"mappings":"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","names":["Logo","className","size","spin","spinOnce","bounce","sizeClasses","getAnimation","animations","jsx","getPublicPath","CheckIcon","FounderImage","showBorder","showShadow","showBadge","showStatus","borderClasses","shadowClasses","jsxs","e","target","fallback","_a","feature1","feature2","feature3","feature4","feature5","feature6","GamepadIcon","FeatureIcon","icon","icons","Fragment","Feature","React","title","description","image","FeaturesCarousel","features","autoplayOptions","emblaRef","emblaApi","useEmblaCarousel","Autoplay","selectedIndex","setSelectedIndex","useState","scrollSnaps","setScrollSnaps","isMobile","setIsMobile","useEffect","checkMobile","scrollPrev","useCallback","scrollNext","scrollTo","index","onSelect","slidesToShow","grouped","i","feature","group","slideIndex","idx","_","FeatureListItem","children","VanguardFeatureListItem","comingSoon","StarIcon","QuoteIcon","Testimonial","quote","author","LandingPage","onGetStarted","onOpenAbout","onOpenPrivacy","onOpenRefund","onOpenTerms","onDirectNavigation","email","setEmail","isSubmitting","setIsSubmitting","submitMessage","setSubmitMessage","showContactModal","setShowContactModal","scrollY","setScrollY","backgroundRef","useRef","path","handleScroll","handleWaitlistSubmit","result","WaitlistService","error","toastService","handleScrollTo","id","ContactUsModal","BANNER_DISMISS_KEY","GLOBAL_PROMPT_KEY","PWAInstallBanner","deferredPrompt","setDeferredPrompt","hasPrompt","setHasPrompt","showBanner","setShowBanner","isInstalled","setIsInstalled","globalPrompt","handleBeforeInstallPrompt","handleAppInstalled","handleInstallClick","outcome","handleDismiss","LoginSplashScreen","onComplete","onBackToLanding","onSetAppState","isLoading","setIsLoading","password","setPassword","emailMode","setEmailMode","errorMessage","setErrorMessage","successMessage","setSuccessMessage","isAnimating","setIsAnimating","rememberMe","setRememberMe","emailError","setEmailError","passwordError","setPasswordError","showTermsModal","setShowTermsModal","showPrivacyModal","setShowPrivacyModal","showSignupSuccess","setShowSignupSuccess","showPassword","setShowPassword","showSignupModal","setShowSignupModal","signupModalType","setSignupModalType","signupModalMessage","setSignupModalMessage","validatePassword","errors","validateEmail","togglePasswordVisibility","handleSignupModalClose","handleKeyDown","handleAuth","method","authService","handleEmailAuth","providerCheck","passwordValidation","errorMsg","prev","handleForgotPassword","Button","TermsModal","PrivacyModal","InitialSplashScreen","user","isProcessing","setIsProcessing","handleDownloadPCClient","handleStartAdventure","supabase","InitialSplashScreen$1","KeyboardIcon","ScreenshotIcon","HandsFreeIcon","isActive","PauseIcon","PlayIcon","InsightsIcon","ProBadge","FeatureItem","HowToUseSplashScreen","HowToUseSplashScreen$1","ProFeature","proFeatures","vanguardFeatures","ProFeaturesSplashScreen","onUpgrade","onUpgradeToVanguard","activeTab","setActiveTab","f","ProFeaturesSplashScreen$1","HintIcon","DesktopIcon","BookmarkIcon","allSlides","slides","SplashScreen","onSkipConnection","onConnect","status","connectionCode","onConnectionSuccess","step","setStep","code","setCode","syncInitiated","setSyncInitiated","connectionSuccessCalled","setConnectionSuccessCalled","touchStartX","setTouchStartX","touchEndX","setTouchEndX","ConnectionStatus","currentSlide","isLastStep","isConnecting","isConnected","handleNext","s","handlePrev","handleConnectClick","handleTouchStart","touch","handleTouchMove","handleTouchEnd","distance","minSwipeDistance","isLeftSwipe","isRightSwipe","isCodeValid","SplashScreen$1","useActiveSession","initialState","session","setSession","toggleSession","conversationId","prevSession","setActiveSession","ContextMenu","isOpen","position","onClose","onDelete","onPin","onUnpin","onClearConversation","canDelete","canPin","isPinned","isEverythingElse","menuRef","handleClickOutside","event","handleEscape","Sidebar","conversations","activeConversation","onConversationSelect","onDeleteConversation","onPinConversation","onUnpinConversation","onAddGame","contextMenu","setContextMenu","longPressTimer","longPressDelay","conversationList","a","b","aIsGameHub","bIsGameHub","handleContextMenu","handleLongPressStart","handleLongPressEnd","closeContextMenu","handleDelete","handlePin","handleUnpin","handleClearConversation","conversation","isGameHub","isUnreleased","isRegularGame","borderClass","titleClass","_b","_c","_d","CreditIndicator","onClick","textCount","textLimit","imageCount","imageLimit","textPercentRemaining","imagePercentRemaining","radiusOuter","circumferenceOuter","offsetOuter","radiusInner","circumferenceInner","offsetInner","strokeWidth","HandsFreeToggle","isHandsFree","onToggle","LoadingSpinner","SettingsContextMenu","onOpenSettings","onOpenGuide","onLogout","userTier","onTrialStart","isTrialEligible","setIsTrialEligible","isStartingTrial","setIsStartingTrial","currentUser","supabaseService","handleStartTrial","ProfileSetupBanner","onDismiss","isExpanded","setIsExpanded","profile","setProfile","currentStep","setCurrentStep","query","handleChange","steps","handleBack","handleOptionSelect","field","value","currentStepData","progressPercent","shouldUseOverlay","originalOverflow","collapsedBanner","expandedCard","option","handleOverlayClick","MainApp","_onOpenSettings","_onOpenAbout","_onOpenPrivacy","_onOpenRefund","_onOpenContact","_onOpenTerms","propConnectionStatus","propConnectionError","propOnConnect","propOnDisconnect","propOnClearConnectionError","propOnWebSocketMessage","showProfileSetupBanner","onProfileSetupComplete","onProfileSetupDismiss","setUser","setConversations","setActiveConversation","isInitializing","setIsInitializing","suggestedPrompts","setSuggestedPrompts","abortController","setAbortController","isManualUploadMode","setIsManualUploadMode","saved","sidebarOpen","setSidebarOpen","settingsOpen","setSettingsOpen","creditModalOpen","setCreditModalOpen","connectionModalOpen","setConnectionModalOpen","setConnectionCode","lastSuccessfulConnection","setLastSuccessfulConnection","isHandsFreeMode","setIsHandsFreeMode","handsFreeModalOpen","setHandsFreeModalOpen","currentInputMessage","setCurrentInputMessage","queuedScreenshot","setQueuedScreenshot","isLoadingConversationsRef","hasLoadedConversationsRef","handleSendMessageRef","useMemo","addGameModalOpen","setAddGameModalOpen","deepCloneConversations","cloned","key","tab","msg","settingsContextMenu","setSettingsContextMenu","connectionStatus","connectionError","savedConnectionCode","lastConnection","ttsService","err","handleWebSocketMessage","data","handleScreenshotQueued","loadData","retryCount","UserService","userConversations","ConversationService","active","currentGameHub","conv","gameHub","updatedConversations","finalActive","GAME_HUB_ID","newsPrompts","fallbackPrompts","suggestedPromptsService","gameHubConv","delay","timeout","refreshUserData","handleWebSocketError","handleWebSocketOpen","handleWebSocketClose","storedCode","connect","handleConversationSelect","targetConversation","mergedConversations","handleDeleteConversation","wasActive","freshConversations","gameHubTab","firstConversation","handlePinConversation","handleUnpinConversation","handleCreditModalOpen","handleCreditModalClose","handleUpgrade","handleOpenGuide","handleAddGame","handleCreateGame","gameName","formattedMessage","handleSendMessage","handleConnectionModalOpen","handleConnectionModalClose","handleClearConnectionError","handleHandsFreeToggle","handleHandsFreeModalClose","handleToggleHandsFreeFromModal","newMode","handleSettingsContextMenu","closeSettingsContextMenu","handleOpenSettings","handleLogout","handleConnect","handleDisconnect","disconnect","handleSuggestedPromptClick","prompt","handleInputMessageChange","message","handleToggleActiveSession","wasPlaying","willBePlaying","playingSummary","sessionSummaryService","summaryMessage","updated","planningSummary","handleStopAI","pollForSubtabUpdates","attempts","maxAttempts","resolve","targetConv","loadingSubtabs","loadedSubtabs","stillLoading","updatedActiveConv","st","handleCreateGameTab","gameInfo","existingConversation","newGameTab","gameTabService","imageUrl","newMessage","tabManagementService","command","queryType","SupabaseService","controller","conversationWithOptimizedContext","contextSummarizationService","__vitePreload","n","summarizedConversation","response","aiService","aiMessage","hintMatch","textToSpeak","cleanText","ttsError","showAINotification","isScreenLockedOrHidden","notificationText","notificationError","suggestionsToUse","processedSuggestions","tag","progress","updatedConv","objective","refreshedConversation","updateData","parsed","modifyData","deleteData","updatedSubtabs","gameTitle","confidence","genre","isFullscreen","shouldCreateTab","targetConvId","existingGameTab","targetConversationId","refreshedConversations","shouldMigrateMessages","MessageRoutingService","gameTab","fallbackSuggestions","hasLoadingSubtabs","_e","_f","recoveryAction","errorRecoveryService","GameProgressBar","ChatInterface","SettingsModal","CreditModal","ConnectionModal","HandsFreeModal","AddGameModal","refreshedUser","AppRouter","appState","authState","activeModal","showLogoutConfirm","hasEverLoggedIn","handleGetStarted","handleLoginComplete","handleBackToLanding","handleOAuthSuccess","handleOAuthError","confirmLogout","openModal","closeModal","handleOnboardingComplete","handleConnectionSuccess","handleSkipConnection","handleProfileSetupComplete","handleProfileSetupSkip","setShowLogoutConfirm","mainAppMessageHandlerRef","isManualNavigationRef","AuthCallback","shouldShowLoading","AboutModal","RefundPolicyModal","onboardingService","handler","ToastIcon","type","CheckCircleIcon","XCircleIcon","ExclamationTriangleIcon","InformationCircleIcon","ToastItem","toast","getBackgroundColor","getTextColor","XMarkIcon","ToastContainer","toasts","setToasts","App","setAuthState","setHasEverLoggedIn","setAppState","setActiveModal","setConnectionStatus","setConnectionError","authSubscriptionRef","isProcessingAuthRef","lastHotkeyRequestTimestamp","hasReceivedPCMessage","connectionTimeoutRef","isMounted","processAuthState","newAuthState","savedAppState","nextStep","isPWA","unsubscribe","newState","welcomeShown","modal","batchData","imgSrc","properDataUrl","dataUrl","_h","_g","now","send","profileData","ErrorBoundary","Component","props","__publicField","errorInfo","ReactDOM"],"ignoreList":[],"sources":["../../src/components/ui/Logo.tsx","../../src/components/ui/CheckIcon.tsx","../../src/components/FounderImage.tsx","../../src/assets/images/feature-images/feature1.png","../../src/assets/images/feature-images/feature2.png","../../src/assets/images/feature-images/feature3.png","../../src/assets/images/feature-images/feature4.png","../../src/assets/images/feature-images/feature5.png","../../src/assets/images/feature-images/feature6.png","../../src/components/LandingPageFresh.tsx","../../src/components/splash/PWAInstallBanner.tsx","../../src/components/splash/LoginSplashScreen.tsx","../../src/components/splash/InitialSplashScreen.tsx","../../src/components/ui/KeyboardIcon.tsx","../../src/components/ui/ScreenshotIcon.tsx","../../src/components/ui/HandsFreeIcon.tsx","../../src/components/ui/PauseIcon.tsx","../../src/components/ui/PlayIcon.tsx","../../src/components/splash/HowToUseSplashScreen.tsx","../../src/components/splash/ProFeaturesSplashScreen.tsx","../../src/components/ui/HintIcon.tsx","../../src/components/ui/DesktopIcon.tsx","../../src/components/ui/BookmarkIcon.tsx","../../src/components/splash/SplashScreen.tsx","../../src/hooks/useActiveSession.ts","../../src/components/ui/ContextMenu.tsx","../../src/components/layout/Sidebar.tsx","../../src/components/ui/CreditIndicator.tsx","../../src/components/ui/HandsFreeToggle.tsx","../../src/components/ui/LoadingSpinner.tsx","../../src/components/ui/SettingsContextMenu.tsx","../../src/components/ui/ProfileSetupBanner.tsx","../../src/components/MainApp.tsx","../../src/components/AppRouter.tsx","../../src/components/ui/ToastContainer.tsx","../../src/App.tsx","../../src/components/ErrorBoundary.tsx","../../src/main.tsx?v=20241114014200"],"sourcesContent":["import React from 'react';\r\nimport { getPublicPath } from '../../utils/publicPath';\r\n\r\ninterface LogoProps {\r\n  className?: string;\r\n  size?: 'sm' | 'md' | 'lg' | 'xl';\r\n  spin?: boolean;\r\n  spinOnce?: boolean; // New: rotates once and stops\r\n  bounce?: boolean;\r\n}\r\n\r\nconst Logo: React.FC<LogoProps> = ({ className = '', size = 'md', spin = false, spinOnce = false, bounce = false }) => {\r\n  const sizeClasses = {\r\n    sm: 'w-8 h-8',\r\n    md: 'w-12 h-12',\r\n    lg: 'w-16 h-16',\r\n    xl: 'w-24 h-24',\r\n  };\r\n\r\n  const getAnimation = () => {\r\n    const animations = [];\r\n    if (bounce) {\r\n      animations.push('bounce 2s infinite');\r\n    }\r\n    if (spinOnce) {\r\n      animations.push('spin-once 2s ease-in-out forwards');\r\n    } else if (spin) {\r\n      animations.push('spin 6s linear infinite');\r\n    }\r\n    return animations.length > 0 ? animations.join(', ') : 'none';\r\n  };\r\n\r\n  return (\r\n    <img\r\n      src={getPublicPath('/images/otagon-logo.png')}\r\n      alt=\"Otagon Logo\"\r\n      className={`${sizeClasses[size]} ${className}`}\r\n      style={{ \r\n        filter: 'drop-shadow(0 0 24px rgba(255, 140, 0, 0.3))',\r\n        objectFit: 'contain',\r\n        animation: getAnimation()\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nexport default Logo;\r\n","import React from 'react';\r\n\r\nconst CheckIcon: React.FC<{ className?: string }> = ({ className }) => (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    viewBox=\"0 0 24 24\"\r\n    fill=\"none\"\r\n    stroke=\"currentColor\"\r\n    strokeWidth=\"3\"\r\n    strokeLinecap=\"round\"\r\n    strokeLinejoin=\"round\"\r\n    className={className}\r\n  >\r\n    <polyline points=\"20 6 9 17 4 12\" />\r\n  </svg>\r\n);\r\n\r\nexport default CheckIcon;\r\n","import React from 'react';\r\nimport { getPublicPath } from '../utils/publicPath';\r\n\r\ninterface FounderImageProps {\r\n  className?: string;\r\n  size?: 'sm' | 'md' | 'lg' | 'xl';\r\n  showBorder?: boolean;\r\n  showShadow?: boolean;\r\n  showBadge?: boolean;\r\n  showStatus?: boolean;\r\n}\r\n\r\nconst FounderImage: React.FC<FounderImageProps> = ({ \r\n  className = \"\", \r\n  size = 'md',\r\n  showBorder = true,\r\n  showShadow = true,\r\n  showBadge = true,\r\n  showStatus = true\r\n}) => {\r\n  const sizeClasses = {\r\n    sm: 'w-16 h-16',\r\n    md: 'w-24 h-24',\r\n    lg: 'w-32 h-32',\r\n    xl: 'w-40 h-40'\r\n  };\r\n\r\n  const borderClasses = showBorder \r\n    ? 'border-2 border-[#E53A3A]/30 ring-2 ring-[#D98C1F]/20' \r\n    : '';\r\n\r\n  const shadowClasses = showShadow \r\n    ? 'shadow-lg shadow-[#E53A3A]/20' \r\n    : '';\r\n\r\n  return (\r\n    <div className={`relative ${className}`}>\r\n      {/* Founder Portrait */}\r\n      <div className={`relative overflow-hidden rounded-full ${sizeClasses[size]} ${borderClasses} ${shadowClasses}`}>\r\n        <img\r\n          src={getPublicPath('/images/founder-image.jpg')}\r\n          alt=\"Otagon Founder - AI Gaming Visionary\"\r\n          className=\"w-full h-full object-cover object-center\"\r\n          style={{\r\n            objectPosition: 'center 30%' // Position to show face clearly\r\n          }}\r\n          onError={(e) => {\r\n            // Fallback if image doesn't load\r\n            const target = e.target as HTMLImageElement;\r\n            target.style.display = 'none';\r\n            const fallback = target.parentElement?.querySelector('.fallback') as HTMLElement;\r\n            if (fallback) {\r\n              fallback.style.display = 'flex';\r\n            }\r\n          }}\r\n        />\r\n        \r\n        {/* Fallback Avatar */}\r\n        <div className=\"fallback hidden absolute inset-0 bg-gradient-to-br from-[#E53A3A] to-[#D98C1F] rounded-full items-center justify-center\">\r\n          <div className=\"text-white font-bold text-center\">\r\n            <div className=\"text-2xl\"></div>\r\n            <div className=\"text-xs mt-1\">Founder</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Status Indicator */}\r\n      {showStatus && (\r\n        <div className=\"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full\">\r\n          <div className=\"w-full h-full bg-green-400 rounded-full animate-pulse\"></div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Founder Badge */}\r\n      {showBadge && (\r\n        <div className=\"absolute -top-2 -right-2 bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] text-white text-xs px-2 py-1 rounded-full font-bold shadow-lg\">\r\n          FOUNDER\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FounderImage;\r\n","export default \"__VITE_ASSET__D0iwSPkS__\"","export default \"__VITE_ASSET__6sgaB6pw__\"","export default \"__VITE_ASSET__DmQfp9Up__\"","export default \"__VITE_ASSET__DVNKN4bq__\"","export default \"__VITE_ASSET__C5lxMogJ__\"","export default \"__VITE_ASSET__Wnr2IDcG__\"","import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport Logo from './ui/Logo';\r\nimport CheckIcon from './ui/CheckIcon';\r\nimport StarIcon from './ui/StarIcon';\r\nimport FounderImage from './FounderImage';\r\nimport ContactUsModal from './modals/ContactUsModal';\r\nimport { WaitlistService } from '../services/waitlistService';\r\nimport { toastService } from '../services/toastService';\r\nimport useEmblaCarousel from 'embla-carousel-react';\r\nimport Autoplay from 'embla-carousel-autoplay';\r\n\r\n// Import feature images\r\nimport feature1 from '../assets/images/feature-images/feature1.png';\r\nimport feature2 from '../assets/images/feature-images/feature2.png';\r\nimport feature3 from '../assets/images/feature-images/feature3.png';\r\nimport feature4 from '../assets/images/feature-images/feature4.png';\r\nimport feature5 from '../assets/images/feature-images/feature5.png';\r\nimport feature6 from '../assets/images/feature-images/feature6.png';\r\n\r\nconsole.log(' LandingPageFresh - Feature images imported:', { feature1, feature2, feature3, feature4, feature5, feature6 });\r\n\r\nconst GamepadIcon = ({ className }: { className?: string }) => (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" className={className} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n        <rect x=\"2\" y=\"6\" width=\"20\" height=\"12\" rx=\"2\"></rect>\r\n        <path d=\"M6 12h4\"></path>\r\n        <path d=\"M14 10v4\"></path>\r\n        <path d=\"M18 10v4\"></path>\r\n        <path d=\"M10 10v4\"></path>\r\n    </svg>\r\n);\r\n\r\n\r\nconst ProBadge = () => (\r\n    <span className=\"text-sm font-bold bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] text-white px-2.5 py-1 rounded-full uppercase tracking-wider ml-3\">\r\n        PRO\r\n    </span>\r\n);\r\n\r\nconst FeatureIcon = ({ icon }: { icon: 'eye' | 'bookmark' | 'network' | 'mic' | 'insights' | 'cpu' }) => {\r\n    const icons = {\r\n        eye: (\r\n            <>\r\n                <path d=\"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z\" />\r\n                <circle cx=\"12\" cy=\"12\" r=\"3\" />\r\n            </>\r\n        ),\r\n        bookmark: (\r\n            <>\r\n                <path d=\"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z\" />\r\n            </>\r\n        ),\r\n        network: (\r\n            <>\r\n                <rect x=\"16\" y=\"16\" width=\"6\" height=\"6\" rx=\"1\" />\r\n                <rect x=\"2\" y=\"16\" width=\"6\" height=\"6\" rx=\"1\" />\r\n                <rect x=\"9\" y=\"2\" width=\"6\" height=\"6\" rx=\"1\" />\r\n                <path d=\"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3\" />\r\n                <path d=\"M12 12V8\" />\r\n            </>\r\n        ),\r\n        mic: (\r\n            <>\r\n                <path d=\"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z\" />\r\n                <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\" />\r\n                <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"22\" />\r\n            </>\r\n        ),\r\n        insights: (\r\n            <>\r\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" />\r\n                <path d=\"M3 9h18M9 21V9\" />\r\n            </>\r\n        ),\r\n        cpu: (\r\n            <>\r\n                <rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\" ry=\"2\"></rect>\r\n                <rect x=\"9\" y=\"9\" width=\"6\" height=\"6\"></rect>\r\n                <line x1=\"9\" y1=\"1\" x2=\"9\" y2=\"4\"></line>\r\n                <line x1=\"15\" y1=\"1\" x2=\"15\" y2=\"4\"></line>\r\n                <line x1=\"9\" y1=\"20\" x2=\"9\" y2=\"23\"></line>\r\n                <line x1=\"15\" y1=\"20\" x2=\"15\" y2=\"23\"></line>\r\n                <line x1=\"20\" y1=\"9\" x2=\"23\" y2=\"9\"></line>\r\n                <line x1=\"20\" y1=\"14\" x2=\"23\" y2=\"14\"></line>\r\n                <line x1=\"1\" y1=\"9\" x2=\"4\" y2=\"9\"></line>\r\n                <line x1=\"1\" y1=\"14\" x2=\"4\" y2=\"14\"></line>\r\n            </>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div className=\"relative flex h-full w-full items-center justify-center rounded-2xl p-4 group hover:scale-105 transition-all duration-500\" style={{ pointerEvents: 'auto' }}>\r\n            <div className=\"absolute inset-0 bg-gradient-to-r from-[#E53A3A]/20 to-[#D98C1F]/20 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500\" style={{ pointerEvents: 'none' }}></div>\r\n            <svg\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                width=\"60\"\r\n                height=\"60\"\r\n                viewBox=\"0 0 24 24\"\r\n                fill=\"none\"\r\n                stroke=\"url(#feature-gradient)\"\r\n                strokeWidth=\"1.5\"\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                className=\"opacity-60 group-hover:opacity-100 transition-opacity duration-500\"\r\n            >\r\n                <defs>\r\n                    <linearGradient id=\"feature-gradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n                        <stop offset=\"0%\" stopColor=\"#E53A3A\" />\r\n                        <stop offset=\"100%\" stopColor=\"#D98C1F\" />\r\n                    </linearGradient>\r\n                </defs>\r\n                {icons[icon]}\r\n            </svg>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst Feature = React.memo(({ title, description, icon, image }: { title: React.ReactNode, description: string, icon?: 'eye' | 'bookmark' | 'network' | 'mic' | 'insights' | 'cpu', image?: string }) => {\r\n    console.log(' Feature rendering:', { title, image, hasImage: !!image });\r\n    return (\r\n        <div className=\"flex flex-col items-center text-center group p-6 rounded-2xl hover:bg-gradient-to-br hover:from-neutral-800/20 hover:to-neutral-900/20 transition-all duration-500\">\r\n            <div className=\"w-full max-w-4xl aspect-video mb-6 animate-fade-slide-up group-hover:scale-105 transition-transform duration-500\">\r\n                {image ? (\r\n                    <img \r\n                        src={image} \r\n                        alt={typeof title === 'string' ? title : ''} \r\n                        className=\"w-full h-full object-contain\"\r\n                        loading=\"lazy\"\r\n                        decoding=\"async\"\r\n                        onError={(e) => {\r\n                            console.error(' Image failed to load:', image, e);\r\n                            console.error(' Image element:', e.target);\r\n                        }}\r\n                        onLoad={() => console.log(' Image loaded successfully:', image)}\r\n                        style={{ \r\n                            display: 'block',\r\n                            imageRendering: 'crisp-edges',\r\n                            WebkitFontSmoothing: 'antialiased',\r\n                            backfaceVisibility: 'hidden',\r\n                            transform: 'translateZ(0)'\r\n                        }}\r\n                    />\r\n                ) : icon ? (\r\n                    <FeatureIcon icon={icon} />\r\n                ) : null}\r\n            </div>\r\n            <div className=\"animate-fade-slide-up group-hover:translate-y-1 transition-transform duration-500\">\r\n                <h3 className=\"text-2xl lg:text-3xl font-bold tracking-tight text-white mb-4 leading-tight group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-[#E53A3A] group-hover:to-[#D98C1F] transition-all duration-500\">{title}</h3>\r\n                <p className=\"text-lg text-neutral-300 leading-relaxed group-hover:text-neutral-200 transition-colors duration-500\">{description}</p>\r\n            </div>\r\n        </div>\r\n    );\r\n});\r\n\r\nconst FeaturesCarousel = ({ features }: { features: Array<{ title: string; description: string; image: string }> }) => {\r\n    const autoplayOptions = {\r\n        delay: 5000,\r\n        stopOnInteraction: true,\r\n        stopOnMouseEnter: true,\r\n        playOnInit: true\r\n    };\r\n\r\n    const [emblaRef, emblaApi] = useEmblaCarousel(\r\n        { \r\n            loop: true,\r\n            align: 'start',\r\n            slidesToScroll: 1,\r\n            skipSnaps: false,\r\n            dragFree: false,\r\n            containScroll: 'trimSnaps',\r\n            breakpoints: {\r\n                '(min-width: 768px)': { \r\n                    align: 'start'\r\n                }\r\n            }\r\n        },\r\n        [Autoplay(autoplayOptions)]\r\n    );\r\n    \r\n    const [selectedIndex, setSelectedIndex] = useState(0);\r\n    const [scrollSnaps, setScrollSnaps] = useState<number[]>([]);\r\n    const [isMobile, setIsMobile] = useState(false);\r\n\r\n    // Detect mobile screen size\r\n    useEffect(() => {\r\n        const checkMobile = () => {\r\n            setIsMobile(window.innerWidth < 768);\r\n        };\r\n        checkMobile();\r\n        window.addEventListener('resize', checkMobile);\r\n        return () => window.removeEventListener('resize', checkMobile);\r\n    }, []);\r\n\r\n    const scrollPrev = useCallback(() => {\r\n        if (emblaApi) emblaApi.scrollPrev();\r\n    }, [emblaApi]);\r\n    \r\n    const scrollNext = useCallback(() => {\r\n        if (emblaApi) emblaApi.scrollNext();\r\n    }, [emblaApi]);\r\n    \r\n    const scrollTo = useCallback((index: number) => {\r\n        if (emblaApi) emblaApi.scrollTo(index);\r\n    }, [emblaApi]);\r\n\r\n    const onSelect = useCallback(() => {\r\n        if (!emblaApi) return;\r\n        setSelectedIndex(emblaApi.selectedScrollSnap());\r\n    }, [emblaApi]);\r\n\r\n    useEffect(() => {\r\n        if (!emblaApi) return;\r\n        onSelect();\r\n        setScrollSnaps(emblaApi.scrollSnapList());\r\n        emblaApi.on('select', onSelect);\r\n        emblaApi.on('reInit', onSelect);\r\n        \r\n        return () => {\r\n            emblaApi.off('select', onSelect);\r\n            emblaApi.off('reInit', onSelect);\r\n        };\r\n    }, [emblaApi, onSelect]);\r\n\r\n    // On mobile: show 1 item per slide, on desktop: show 2 items per slide\r\n    const slidesToShow = isMobile ? features : (() => {\r\n        const grouped = [];\r\n        for (let i = 0; i < features.length; i += 2) {\r\n            grouped.push(features.slice(i, i + 2));\r\n        }\r\n        return grouped;\r\n    })();\r\n\r\n    return (\r\n        <div className=\"relative px-4 md:px-0\">\r\n            {/* Embla Container */}\r\n            <div className=\"overflow-hidden\" ref={emblaRef}>\r\n                <div className=\"flex touch-pan-y touch-pinch-zoom -ml-4\">\r\n                    {isMobile ? (\r\n                        // Mobile: 1 item per slide\r\n                        features.map((feature, index) => (\r\n                            <div \r\n                                key={index} \r\n                                className=\"flex-[0_0_100%] min-w-0 pl-4\"\r\n                            >\r\n                                <Feature\r\n                                    title={feature.title}\r\n                                    description={feature.description}\r\n                                    image={feature.image}\r\n                                />\r\n                            </div>\r\n                        ))\r\n                    ) : (\r\n                        // Desktop: 2 items per slide\r\n                        slidesToShow.map((group, slideIndex) => (\r\n                            <div \r\n                                key={slideIndex} \r\n                                className=\"flex-[0_0_100%] min-w-0 pl-4\"\r\n                            >\r\n                                <div className=\"grid grid-cols-2 gap-8\">\r\n                                    {Array.isArray(group) && group.map((feature, idx) => (\r\n                                        <Feature\r\n                                            key={slideIndex * 2 + idx}\r\n                                            title={feature.title}\r\n                                            description={feature.description}\r\n                                            image={feature.image}\r\n                                        />\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Navigation Arrows */}\r\n            <button\r\n                onClick={scrollPrev}\r\n                className=\"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-3 md:-translate-x-16 lg:-translate-x-20 border-2 border-[#E53A3A] text-[#E53A3A] p-2 md:p-3 rounded-lg hover:bg-gradient-to-r hover:from-[#E53A3A] hover:to-[#D98C1F] hover:text-white hover:border-transparent hover:shadow-2xl hover:shadow-[#E53A3A]/50 hover:scale-110 active:scale-95 transition-all duration-300 z-10 disabled:opacity-30 disabled:cursor-not-allowed backdrop-blur-sm opacity-40 hover:opacity-100\"\r\n                aria-label=\"Previous slide\"\r\n            >\r\n                <svg className=\"w-5 h-5 md:w-8 md:h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" strokeWidth=\"3\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 19l-7-7 7-7\" />\r\n                </svg>\r\n            </button>\r\n            <button\r\n                onClick={scrollNext}\r\n                className=\"absolute right-0 top-1/2 -translate-y-1/2 translate-x-3 md:translate-x-16 lg:translate-x-20 border-2 border-[#E53A3A] text-[#E53A3A] p-2 md:p-3 rounded-lg hover:bg-gradient-to-r hover:from-[#E53A3A] hover:to-[#D98C1F] hover:text-white hover:border-transparent hover:shadow-2xl hover:shadow-[#E53A3A]/50 hover:scale-110 active:scale-95 transition-all duration-300 z-10 disabled:opacity-30 disabled:cursor-not-allowed backdrop-blur-sm opacity-40 hover:opacity-100\"\r\n                aria-label=\"Next slide\"\r\n            >\r\n                <svg className=\"w-5 h-5 md:w-8 md:h-8\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" strokeWidth=\"3\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 5l7 7-7 7\" />\r\n                </svg>\r\n            </button>\r\n\r\n            {/* Pagination Dots */}\r\n            <div className=\"hidden md:flex justify-center gap-3 mt-8\">\r\n                {scrollSnaps.map((_, idx) => (\r\n                    <button\r\n                        key={idx}\r\n                        onClick={() => scrollTo(idx)}\r\n                        className={`transition-all duration-300 rounded-full ${\r\n                            idx === selectedIndex\r\n                                ? 'w-12 h-3 bg-gradient-to-r from-[#E53A3A] to-[#D98C1F]'\r\n                                : 'w-3 h-3 bg-neutral-600 hover:bg-neutral-500'\r\n                        }`}\r\n                        aria-label={`Go to slide ${idx + 1}`}\r\n                        aria-current={idx === selectedIndex ? 'true' : 'false'}\r\n                    />\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst FeatureListItem = ({ children }: { children: React.ReactNode }) => (\r\n    <li className=\"flex items-start gap-4\">\r\n        <CheckIcon className=\"w-6 h-6 mt-1 text-green-500 flex-shrink-0\" />\r\n        <span className=\"text-neutral-200 text-base leading-relaxed\">{children}</span>\r\n    </li>\r\n);\r\n\r\nconst VanguardFeatureListItem = ({ children, comingSoon = false }: { children: React.ReactNode, comingSoon?: boolean }) => (\r\n    <li className=\"flex items-start gap-4\">\r\n        <StarIcon className=\"w-6 h-6 mt-1 text-[#FFAB40] flex-shrink-0\" />\r\n        <div className=\"flex-1\">\r\n            <span className=\"text-neutral-200 font-medium text-base leading-relaxed block\">\r\n                {children}\r\n            </span>\r\n            {comingSoon && (\r\n                <span className=\"inline-block mt-2 text-xs font-semibold bg-gradient-to-r from-sky-500/20 to-blue-500/20 text-sky-300 border-2 border-sky-500/40 px-3 py-1 rounded-full uppercase\">Coming Soon</span>\r\n            )}\r\n        </div>\r\n    </li>\r\n);\r\n\r\nconst QuoteIcon = () => (\r\n    <svg className=\"w-12 h-12 text-neutral-600 mb-6\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n        <path d=\"M6.5,10c0,2.21-1.79,4-4,4v-2c1.1,0,2-0.9,2-2h-2V4h6V10z M18.5,10c0,2.21-1.79,4-4,4v-2c1.1,0,2-0.9,2-2h-2V4h6V10z\"></path>\r\n    </svg>\r\n);\r\n\r\nconst Testimonial = React.memo(({ quote, author, title }: { quote: string, author: string, title: string }) => (\r\n    <div className=\"bg-gradient-to-r from-[#1C1C1C]/60 to-[#0A0A0A]/60 backdrop-blur-xl border-2 border-neutral-800/60 rounded-3xl p-10 flex flex-col justify-between h-full animate-fade-slide-up transition-all duration-500 hover:bg-gradient-to-r hover:from-[#1C1C1C]/80 hover:to-[#0A0A0A]/80 hover:border-neutral-700/80 hover:scale-105 hover:shadow-2xl hover:shadow-[#E53A3A]/10\">\r\n        <div className=\"mb-8\">\r\n            <QuoteIcon />\r\n            <p className=\"text-xl text-neutral-200 leading-relaxed\">\"{quote}\"</p>\r\n        </div>\r\n        <div>\r\n            <p className=\"font-bold text-white text-lg\">{author}</p>\r\n            <p className=\"text-base text-neutral-400\">{title}</p>\r\n        </div>\r\n    </div>\r\n));\r\n\r\ninterface LandingPageProps {\r\n  onGetStarted: () => void;\r\n  onOpenAbout: () => void;\r\n  onOpenPrivacy: () => void;\r\n  onOpenRefund: () => void;\r\n  onOpenTerms: () => void;\r\n  onDirectNavigation: (_path: string) => void;\r\n}\r\n\r\nconst LandingPage: React.FC<LandingPageProps> = ({ onGetStarted, onOpenAbout, onOpenPrivacy, onOpenRefund, onOpenTerms, onDirectNavigation }) => {\r\n  const [email, setEmail] = useState('');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [submitMessage, setSubmitMessage] = useState('');\r\n  const [showContactModal, setShowContactModal] = useState(false);\r\n  const [scrollY, setScrollY] = useState(0);\r\n  const backgroundRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Handle direct URL navigation on component mount\r\n    useEffect(() => {\r\n        const path = window.location.pathname;\r\n        if (path !== '/' && path !== '') {\r\n            onDirectNavigation(path);\r\n        }\r\n    }, [onDirectNavigation]);\r\n\r\n    // Parallax scroll effect\r\n    useEffect(() => {\r\n        const handleScroll = () => {\r\n            setScrollY(window.scrollY);\r\n        };\r\n\r\n        window.addEventListener('scroll', handleScroll);\r\n        return () => window.removeEventListener('scroll', handleScroll);\r\n    }, []);\r\n\r\n  const handleWaitlistSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!email) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    setSubmitMessage('');\r\n\r\n    try {\r\n      const result = await WaitlistService.addToWaitlist(email, 'landing_page');\r\n      \r\n      if (result.success) {\r\n        if (result.alreadyExists) {\r\n          setSubmitMessage('You\\'re already on our waitlist! We\\'ll email you when access is ready.');\r\n        } else {\r\n          setSubmitMessage('Thanks for joining! We\\'ll email you when access is ready.');\r\n        }\r\n        setEmail('');\r\n      } else {\r\n        setSubmitMessage(result.error || 'Failed to join waitlist. Please try again.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Waitlist submission error:', error);\r\n      toastService.error('Failed to join waitlist. Please try again.');\r\n      setSubmitMessage('An unexpected error occurred. Please try again.');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n\r\n    const handleScrollTo = (id: string) => (e: React.MouseEvent) => {\r\n        e.preventDefault();\r\n        document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });\r\n    };\r\n\r\n\r\n  return (\r\n        <div \r\n            ref={backgroundRef}\r\n            className=\"text-white font-inter relative custom-scrollbar animate-fade-in\"\r\n            style={{\r\n                backgroundColor: '#111111',\r\n                minHeight: '100vh',\r\n                height: 'auto',\r\n                overflowX: 'hidden',\r\n                overflowY: 'auto',\r\n                WebkitOverflowScrolling: 'touch'\r\n            }}\r\n        >\r\n            {/* Enhanced Background Glows */}\r\n            <div className=\"absolute top-0 left-0 w-full h-full -z-15 pointer-events-none hero-glow-texture-top\"></div>\r\n            <div className=\"absolute bottom-0 left-0 w-full h-full -z-15 pointer-events-none hero-glow-texture-bottom\"></div>\r\n            \r\n            {/* Animated Floating Particles with Parallax */}\r\n            <div className=\"absolute inset-0 -z-12 pointer-events-none\">\r\n                {[...Array(40)].map((_, i) => (\r\n                    <div\r\n                        key={i}\r\n                        className=\"absolute w-1 h-1 bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] rounded-full opacity-40 animate-float\"\r\n                        style={{\r\n                            left: `${Math.random() * 100}%`,\r\n                            top: `${Math.random() * 100}%`,\r\n                            transform: `translateY(${scrollY * (0.2 + Math.random() * 0.4)}px)`,\r\n                            animationDelay: `${Math.random() * 3}s`,\r\n                            animationDuration: `${4 + Math.random() * 4}s`\r\n                        }}\r\n                    />\r\n                ))}\r\n          </div>\r\n          \r\n            {/* Floating Geometric Shapes with Parallax */}\r\n            <div className=\"absolute inset-0 -z-12 pointer-events-none\">\r\n                {[...Array(16)].map((_, i) => (\r\n                    <div\r\n                        key={`shape-${i}`}\r\n                        className=\"absolute opacity-15 animate-drift\"\r\n                        style={{\r\n                            left: `${Math.random() * 100}%`,\r\n                            top: `${Math.random() * 100}%`,\r\n                            transform: `translateY(${scrollY * (0.1 + Math.random() * 0.3)}px)`,\r\n                            animationDelay: `${Math.random() * 4}s`,\r\n                            animationDuration: `${6 + Math.random() * 4}s`\r\n                        }}\r\n                    >\r\n                        <div className=\"w-4 h-4 bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] transform rotate-45\"></div>\r\n          </div>\r\n                ))}\r\n        </div>\r\n\r\n            {/* Full Page Grid Pattern */}\r\n            <div \r\n                className=\"absolute inset-0 -z-10 opacity-10 pointer-events-none\"\r\n                style={{\r\n                    background: 'linear-gradient(90deg, #FF4D4D10 1px, transparent 1px), linear-gradient(0deg, #FF4D4D10 1px, transparent 1px)',\r\n                    backgroundSize: '30px 30px',\r\n                }}\r\n            ></div>\r\n\r\n            {/* Fade out gradients for background pattern */}\r\n            <div className=\"absolute top-0 left-0 w-full h-64 bg-gradient-to-b from-[#111111] via-[#111111]/80 to-transparent -z-5 pointer-events-none\"></div>\r\n            <div className=\"absolute bottom-0 left-0 w-full h-64 bg-gradient-to-t from-[#111111] via-[#111111]/80 to-transparent -z-5 pointer-events-none\"></div>\r\n\r\n            {/* Main Content */}\r\n            <main>\r\n      {/* Hero Section */}\r\n                <section className=\"relative pt-20 pb-6 md:pb-8 text-center\">\r\n                    \r\n                    <div className=\"container mx-auto px-6 relative overflow-visible\">\r\n                        <div className=\"flex flex-col items-center justify-center gap-4 mb-10 overflow-visible\">\r\n                            <Logo className=\"h-32 w-32\" spinOnce={true} />\r\n                            <h1 \r\n                                className=\"text-6xl md:text-7xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] leading-none py-2\"\r\n                                style={{\r\n                                    lineHeight: '1.3',\r\n                                    paddingTop: '1rem',\r\n                                    paddingBottom: '1rem',\r\n                                    display: 'block',\r\n                                    overflow: 'visible',\r\n                                    minHeight: '1.3em',\r\n                                    height: 'auto'\r\n                                }}\r\n                            >\r\n              Otagon\r\n            </h1>\r\n          </div>\r\n          \r\n                        <h2 className=\"text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold tracking-tight mb-6 text-white leading-tight\">\r\n                            Never Get Stuck Again\r\n                        </h2>\r\n                        \r\n                        <p className=\"text-lg sm:text-xl md:text-2xl lg:text-3xl text-neutral-300 mb-8 font-medium px-4\">\r\n                            Get instant, spoiler-free hints without leaving your game\r\n                        </p>\r\n                        \r\n                        {/* Social Proof */}\r\n                        <div className=\"flex flex-col sm:flex-row items-center justify-center gap-6 mb-8\">\r\n                            <div className=\"flex items-center gap-2 text-lg text-neutral-300\">\r\n                                <div className=\"flex -space-x-2\">\r\n                                    {[...Array(5)].map((_, i) => (\r\n                                        <div key={i} className=\"w-8 h-8 rounded-full overflow-hidden\">\r\n                                            <img \r\n                                                src={`/images/landing/${i + 1}.png`}\r\n                                                alt={`Gamer ${i + 1}`}\r\n                                                className=\"w-full h-full rounded-full object-cover\"\r\n                                            />\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                                <span className=\"ml-2\">\r\n                                    <span className=\"font-bold text-white\">1000+</span> gamers waiting\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"hidden sm:block w-px h-6 bg-neutral-600\"></div>\r\n                            <div className=\"flex items-center gap-2 text-lg text-neutral-300\">\r\n                                <svg className=\"w-5 h-5 text-[#FFAB40]\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path d=\"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z\"/>\r\n                                </svg>\r\n                                <span>Trusted by <span className=\"font-bold text-white\">50+</span> beta testers</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"relative mx-auto my-16 w-full max-w-2xl h-auto rounded-3xl bg-black/60 backdrop-blur-xl p-2 shadow-2xl border-2 border-[#424242]/40 group hover:border-[#E53A3A]/60 transition-all duration-500 hover:shadow-2xl hover:shadow-[#E53A3A]/25 hover:scale-105\" style={{\r\n                            animation: 'glow 2s ease-in-out infinite alternate',\r\n                            boxShadow: '0 0 20px rgba(229, 58, 58, 0.3), 0 0 40px rgba(229, 58, 58, 0.1), 0 0 60px rgba(229, 58, 58, 0.1)'\r\n                        }}>\r\n                            <div className=\"bg-transparent rounded-2xl p-6 space-y-6\">\r\n                                {/* User Prompt */}\r\n                                <div className=\"flex justify-end\">\r\n                                    <p className=\"text-base text-[#F5F5F5] bg-gradient-to-r from-rose-900/15 to-rose-800/15 py-3 px-6 rounded-2xl rounded-br-none border-2 border-rose-500/40 backdrop-blur-sm shadow-lg\">\r\n                                        What should I do here?\r\n                                    </p>\r\n                                </div>\r\n                                {/* Model Response */}\r\n                                <div className=\"flex justify-start\">\r\n                                    <div className=\"border-2 border-neutral-700/60 bg-gradient-to-r from-neutral-800/15 to-neutral-700/15 p-6 rounded-2xl rounded-bl-none max-w-[80%] text-left backdrop-blur-sm shadow-lg\">\r\n                                        <p className=\"text-base font-bold text-white mb-2\">Hint:</p>\r\n                                        <p className=\"text-base text-[#F5F5F5] leading-relaxed\">\r\n                                        The contraption on the far wall seems to be missing a gear. Perhaps there's one nearby?\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n          </div>\r\n        </div>\r\n                        \r\n                        <p className=\"text-xl md:text-2xl text-neutral-300 max-w-4xl mx-auto mb-8 leading-relaxed\">\r\n              Otagon sees your screen and gives you the perfect nudge to keep you playingwithout ruining the surprise. Stop searching, start playing.\r\n            </p>\r\n\r\n                        {/* Enhanced Waitlist Form */}\r\n                        <div className=\"max-w-2xl mx-auto px-4\">\r\n                            <form id=\"waitlist-form\" onSubmit={handleWaitlistSubmit} className=\"flex flex-col sm:flex-row gap-4 mb-4\">\r\n                                <div className=\"flex-grow relative group\">\r\n            <input\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              placeholder=\"Enter your email address\"\r\n              required\r\n              disabled={isSubmitting}\r\n                                        className=\"w-full bg-gradient-to-r from-[#1C1C1C] to-[#0A0A0A] border-2 border-neutral-800/60 rounded-xl py-4 sm:py-5 px-4 sm:px-6 text-white placeholder-neutral-400 focus:outline-none focus:ring-4 focus:ring-[#FFAB40]/30 focus:border-[#FFAB40] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-base sm:text-lg backdrop-blur-sm hover:border-neutral-700/80\"\r\n              aria-label=\"Email for waitlist\"\r\n            />\r\n                                </div>\r\n                                <button\r\n              type=\"submit\"\r\n              disabled={isSubmitting}\r\n                                    className=\"bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] text-white font-bold py-4 sm:py-5 px-8 sm:px-12 rounded-xl transition-all duration-300 transform hover:scale-105 hover:shadow-2xl hover:shadow-[#E53A3A]/30 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:active:scale-100 text-base sm:text-lg relative overflow-hidden group min-h-[56px]\"\r\n                                >\r\n                                    <div className=\"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\"></div>\r\n                                    <span className=\"relative z-10\">\r\n                                        {isSubmitting ? (\r\n                                            <div className=\"flex items-center justify-center\">\r\n                                                <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3\"></div>\r\n                                                Joining...\r\n                                            </div>\r\n                                        ) : (\r\n                                            'Join the Waitlist'\r\n                                        )}\r\n                                    </span>\r\n                                </button>\r\n          </form>\r\n\r\n                            {/* Trust Indicators */}\r\n                            <div className=\"flex flex-col sm:flex-row items-center justify-center gap-6 text-sm text-neutral-400\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <CheckIcon className=\"w-4 h-4 text-green-400\" />\r\n                                    <span>No spam, ever</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <CheckIcon className=\"w-4 h-4 text-green-400\" />\r\n                                    <span>Free to join</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <CheckIcon className=\"w-4 h-4 text-green-400\" />\r\n                                    <span>Early access</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n          {submitMessage && (\r\n                            <div className={`mt-6 text-center text-lg ${submitMessage.includes('Thanks') ? 'text-green-400' : 'text-red-400'}`}>\r\n              {submitMessage}\r\n            </div>\r\n          )}\r\n\r\n                        <p className=\"text-sm text-neutral-400 mt-4\">\r\n                            Join thousands of gamers on the waitlist!\r\n                        </p>\r\n                    </div>\r\n                </section>\r\n\r\n\r\n                {/* How It Works Section */}\r\n                <section className=\"py-10 md:py-14 bg-transparent relative\">\r\n                    <div className=\"container mx-auto px-8 max-w-6xl relative\">\r\n                        <div className=\"text-center mb-8 md:mb-10 animate-fade-slide-up\">\r\n                            <h2 className=\"text-5xl md:text-6xl font-bold tracking-tight text-white mb-6\">How It Works</h2>\r\n                            <p className=\"text-xl text-neutral-300 mt-6 leading-relaxed\">Get unstuck, get smart, get back to gamingall without leaving your game.</p>\r\n                        </div>\r\n                        \r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-12\">\r\n                            {/* Step 1 */}\r\n                            <div className=\"text-center animate-fade-slide-up\">\r\n                                <div className=\"flex items-center justify-center mx-auto mb-6\">\r\n                                    <svg className=\"w-16 h-16\" fill=\"url(#keyboard-gradient)\" viewBox=\"0 0 16 16\">\r\n                                        <defs>\r\n                                            <linearGradient id=\"keyboard-gradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n                                                <stop offset=\"0%\" stopColor=\"#E53A3A\" />\r\n                                                <stop offset=\"100%\" stopColor=\"#D98C1F\" />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                        <path d=\"M0 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6zm13 .25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5a.25.25 0 0 0-.25.25zM2.25 8a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 3 8.75v-.5A.25.25 0 0 0 2.75 8h-.5zM4 8.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 5 8.75v-.5A.25.25 0 0 0 4.75 8h-.5a.25.25 0 0 0-.25.25zM6.25 8a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 7 8.75v-.5A.25.25 0 0 0 6.75 8h-.5zM8 8.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 9 8.75v-.5A.25.25 0 0 0 8.75 8h-.5a.25.25 0 0 0-.25.25zM13.25 8a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5zm0 2a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5zm-3-2a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h1.5a.25.25 0 0 0 .25-.25v-.5A.25.25 0 0 0 10.75 8h-1.5zm.75 2.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5a.25.25 0 0 0-.25.25zM11.25 6a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5zM9 6.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5A.25.25 0 0 0 9.75 6h-.5a.25.25 0 0 0-.25.25zM7.25 6a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 8 6.75v-.5A.25.25 0 0 0 7.75 6h-.5zM5 6.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 6 6.75v-.5A.25.25 0 0 0 5.75 6h-.5a.25.25 0 0 0-.25.25zM2.25 6a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h1.5A.25.25 0 0 0 4 6.75v-.5A.25.25 0 0 0 3.75 6h-1.5zM2 10.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5a.25.25 0 0 0-.25.25zM4.25 10a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h5.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-5.5z\"/>\r\n                                    </svg>\r\n                                </div>\r\n                                <h3 className=\"text-2xl font-bold text-white mb-4\">Press a Hotkey on Your PC</h3>\r\n                                <p className=\"text-lg text-neutral-300 leading-relaxed\">\r\n                                    Instantly capture and analyze PC screenshots\r\n                                </p>\r\n                            </div>\r\n                            \r\n                            {/* Step 2 */}\r\n                            <div className=\"text-center animate-fade-slide-up\">\r\n                                <div className=\"flex items-center justify-center mx-auto mb-6\">\r\n                                    <svg className=\"w-16 h-16\" fill=\"url(#message-gradient)\" viewBox=\"0 0 24 24\">\r\n                                        <defs>\r\n                                            <linearGradient id=\"message-gradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n                                                <stop offset=\"0%\" stopColor=\"#E53A3A\" />\r\n                                                <stop offset=\"100%\" stopColor=\"#D98C1F\" />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                        <path d=\"M2 8.994A5.99 5.99 0 0 1 8 3h8c3.313 0 6 2.695 6 5.994V21H8c-3.313 0-6-2.695-6-5.994V8.994zM14 11v2h2v-2h-2zm-6 0v2h2v-2H8z\"/>\r\n                                    </svg>\r\n                                </div>\r\n                                <h3 className=\"text-2xl font-bold text-white mb-4\">Get an Instant Hint on Your Phone</h3>\r\n                                <p className=\"text-lg text-neutral-300 leading-relaxed\">\r\n                                    AI analyzes your situation and delivers spoiler-free hints to your mobile or second monitor\r\n                                </p>\r\n                            </div>\r\n                            \r\n                            {/* Step 3 */}\r\n                            <div className=\"text-center animate-fade-slide-up\">\r\n                                <div className=\"flex items-center justify-center mx-auto mb-6\">\r\n                                    <svg className=\"w-16 h-16\" fill=\"url(#joystick-gradient)\" viewBox=\"0 0 24 24\">\r\n                                        <defs>\r\n                                            <linearGradient id=\"joystick-gradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n                                                <stop offset=\"0%\" stopColor=\"#E53A3A\" />\r\n                                                <stop offset=\"100%\" stopColor=\"#D98C1F\" />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                        <path d=\"M16 6H8a6 6 0 0 0 0 12h8a6 6 0 0 0 0-12zm-5 7H9v2H7v-2H5v-2h2V9h2v2h2v2zm3.5 2a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3-3a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z\"/>\r\n                                    </svg>\r\n                                </div>\r\n                                <h3 className=\"text-2xl font-bold text-white mb-4\">Keep Playing</h3>\r\n                                <p className=\"text-lg text-neutral-300 leading-relaxed\">\r\n                                    Get the nudge you need and dive back into action without alt-tabbing or overlays\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Features Section */}\r\n                <section id=\"features\" className=\"py-10 md:py-14 bg-transparent relative\">\r\n                    <div className=\"container mx-auto px-8 max-w-6xl relative\">\r\n                        <div className=\"text-center mb-8 md:mb-10 animate-fade-slide-up\">\r\n                            <h2 className=\"text-5xl md:text-6xl font-bold tracking-tight text-white mb-6 leading-tight\" style={{ lineHeight: '1.3', minHeight: '1.3em', height: 'auto', paddingTop: '0.5rem', paddingBottom: '0.5rem' }}>Your Journey From First Moment to Victory</h2>\r\n                            <p className=\"text-xl text-neutral-300 mt-6 leading-relaxed\">Features built to match your gaming style, not slow you down</p>\r\n                        </div>\r\n                        <FeaturesCarousel \r\n                            features={[\r\n                                {\r\n                                    title: \"From First Screenshot to Victory\",\r\n                                    description: \"Upload a screenshot. Otakon identifies your game and becomes your personal guideno spoilers, full context.\",\r\n                                    image: feature1\r\n                                },\r\n                                {\r\n                                    title: \"Play Your Way\",\r\n                                    description: \"Story-driven explorer? Completionist? Speedrunner? Tell us once, and every hint, strategy, and insight matches your playstyle.\",\r\n                                    image: feature2\r\n                                },\r\n                                {\r\n                                    title: \"Never Pause for Help Again\",\r\n                                    description: \"Hands-Free mode reads AI insights aloud. Get strategy tips, lore context, or build advice without leaving the game.\",\r\n                                    image: feature3\r\n                                },\r\n                                {\r\n                                    title: \"Your Gaming Dashboard\",\r\n                                    description: \"Track multiple games at once. Each has its own conversation, progress bar, and AI-generated insight tabs tailored to that game's genre.\",\r\n                                    image: feature4\r\n                                },\r\n                                {\r\n                                    title: \"Play From Anywhere\",\r\n                                    description: \"Gaming on console? Manually upload screenshots from your phone. Help arrives instantly in the same conversation.\",\r\n                                    image: feature5\r\n                                },\r\n                                {\r\n                                    title: \"Stay Focused, Stay Ahead\",\r\n                                    description: \"Skip the wiki-hunting. Otakon provides quest tips, secret locations, build optimizationall without spoiling your discovery.\",\r\n                                    image: feature6\r\n                                }\r\n                            ]}\r\n                        />\r\n                    </div>\r\n                </section>\r\n\r\n                {/* For Every Gamer, For Every Genre Section */}\r\n                <section className=\"py-10 md:py-14 bg-transparent relative\">\r\n                    <div className=\"container mx-auto px-8 max-w-6xl relative\">\r\n                        <div className=\"text-center mb-8 md:mb-10 animate-fade-slide-up\">\r\n                            <h2 className=\"text-5xl md:text-6xl font-bold tracking-tight text-white mb-6\">For Every Challenge, In Every World</h2>\r\n                        </div>\r\n                        \r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n                            {/* Souls-likes & Action RPGs */}\r\n                            <div className=\"text-center animate-fade-slide-up\">\r\n                                <div className=\"flex items-center justify-center mx-auto mb-4\">\r\n                                    <svg className=\"w-16 h-16\" fill=\"url(#souls-gradient)\" viewBox=\"0 0 800 800\">\r\n                                        <defs>\r\n                                            <linearGradient id=\"souls-gradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n                                                <stop offset=\"0%\" stopColor=\"#E53A3A\" />\r\n                                                <stop offset=\"100%\" stopColor=\"#D98C1F\" />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                        <path d=\"M750.5,225H576v-75h40c6.6,0,12-5.4,12-12V12c0-6.6-5.4-12-12-12h-89.5h-253H184c-6.6,0-12,5.4-12,12v126c0,6.6,5.4,12,12,12h40v75H49.5C22.2,225,0,247.2,0,274.5v476C0,777.8,22.2,800,49.5,800h701c27.3,0,49.5-22.2,49.5-49.5v-476C800,247.2,777.8,225,750.5,225z M299,150h202v106H299V150z M725,725H75V300h152.6c7.3,18.2,25.1,31,45.9,31h253c20.8,0,38.6-12.8,45.9-31H725V725z\"/>\r\n                                        <path d=\"M383.6,428h-13.5c-0.7,0-1.3,0.1-2,0.2c-2.5,0.3-4.9,1.5-6.8,3.4l-29.9,29.9l-29.9-29.9c-1.9-1.9-4.3-3-6.8-3.4c-0.7-0.1-1.3-0.2-2-0.2h-13.5c-6.6,0-12,5.4-12,12v155c0,6.6,5.4,12,12,12h13.5c6.6,0,12-5.4,12-12V487.8l17.7,17.7c2.5,2.5,5.8,3.6,9.1,3.5c3.3,0.2,6.6-1,9.1-3.5l17.7-17.7V595c0,6.6,5.4,12,12,12h13.5c6.6,0,12-5.4,12-12V440C395.6,433.4,390.2,428,383.6,428z\"/>\r\n                                        <path d=\"M520.9,427h-67c-0.4,0-0.8,0-1.1,0.1c-0.4,0-0.7-0.1-1.1-0.1h-13.5c-6.6,0-12,5.4-12,12v155c0,6.6,5.4,12,12,12h13.5c6.6,0,12-5.4,12-12v-59h57.3c6.6,0,12-5.4,12-12v-6v-7v-58v-2v-11C532.9,432.4,527.5,427,520.9,427z M495.9,498h-32.3v-34h32.3V498z\"/>\r\n                                    </svg>\r\n                                </div>\r\n                                <h3 className=\"text-xl font-bold text-white mb-3\">Souls-likes & Action RPGs</h3>\r\n                                <p className=\"text-neutral-300 leading-relaxed\">\r\n                                    Master tough bosses and find hidden paths without rage-quitting. We'll give you a hint, not the easy way out.\r\n              </p>\r\n            </div>\r\n\r\n                            {/* RPGs */}\r\n                            <div className=\"text-center animate-fade-slide-up\">\r\n                                <div className=\"flex items-center justify-center mx-auto mb-4\">\r\n                                    <svg className=\"w-16 h-16\" viewBox=\"0 0 64 64\">\r\n                                        <path fill=\"#ea8039\" d=\"M53.5,13.81l2.83-6.13-6.1,2.81a24.35,24.35,0,0,1-6.93,2.2A7.16,7.16,0,0,0,38.18,16a7.13,7.13,0,1,0,13,5.22A34.82,34.82,0,0,1,53.5,13.81Z\"/>\r\n                                        <path fill=\"#ea8039\" d=\"M50.3,23.49a9.21,9.21,0,0,1-4.13-2.4,9.44,9.44,0,0,1-.8-12.41,9.42,9.42,0,0,0-6.18,16.07l.07.06c.1.1.2.18.3.27a7.12,7.12,0,0,0,9.74-.3A7.31,7.31,0,0,0,50.3,23.49Z\"/>\r\n                                        <path fill=\"#ea8039\" d=\"M40.51,13.71a9.43,9.43,0,0,0,14.82,4.92,9.42,9.42,0,0,1-16.07,6.18l-.07-.07-.27-.3a7,7,0,0,1,1.59-10.73Z\"/>\r\n                                        <path fill=\"#e8a63a\" d=\"M37.76,15.2l-.12-6.75-4.27,5.18a24.26,24.26,0,0,1-5.28,5,7.12,7.12,0,1,0,10.65,8.29,7,7,0,0,0,.19-4A34.56,34.56,0,0,1,37.76,15.2Z\"/>\r\n                                        <path fill=\"#ea8039\" d=\"M39.08,25.31a9.36,9.36,0,0,1-10.76-6.86,9.48,9.48,0,0,1-.11-4.34,9.42,9.42,0,0,0,1.42,17.16l.09,0,.39.11a7.12,7.12,0,0,0,8.63-4.5A6.44,6.44,0,0,0,39.08,25.31Z\"/>\r\n                                        <path fill=\"#e8a63a\" d=\"M23.37,25.17l-3.61-4,.17,5.35a19.15,19.15,0,0,1-.55,5.75,5.73,5.73,0,0,0,.84,4.79,5.67,5.67,0,1,0,7.88-7.93A27.66,27.66,0,0,1,23.37,25.17Z\"/>\r\n                                        <path fill=\"#ea8039\" d=\"M29.47,30.52a7.41,7.41,0,0,1-3,2.28,7.5,7.5,0,0,1-7-.74,7.42,7.42,0,0,1-2.34-2.54,7.49,7.49,0,0,0,9.84,9.53L27,39l.3-.13a5.67,5.67,0,0,0,2.8-7.23A5.19,5.19,0,0,0,29.47,30.52Z\"/>\r\n                                        <path fill=\"#e85b23\" d=\"M48.8,26.25l6.76.12-5.19,4.27a24.27,24.27,0,0,0-5,5.28,7.13,7.13,0,0,1-5.22,3.16,7,7,0,0,1-6.77-3.33A7.13,7.13,0,0,1,37.1,25.26a7,7,0,0,1,4-.19A35,35,0,0,0,48.8,26.25Z\"/>\r\n                                        <path fill=\"#ea8039\" d=\"M38.69,24.92a9.26,9.26,0,0,0,.37,4.76A9.45,9.45,0,0,0,49.89,35.8a9.41,9.41,0,0,1-17.15-1.42.29.29,0,0,1,0-.1c-.05-.12-.08-.26-.12-.38a7.13,7.13,0,0,1,4.51-8.64A7.53,7.53,0,0,1,38.69,24.92Z\"/>\r\n                                        <path fill=\"#e85b23\" d=\"M38.84,40.63l4,3.61-5.34-.16a19.54,19.54,0,0,0-5.76.54,5.67,5.67,0,1,1,3.14-8.72A27.79,27.79,0,0,0,38.84,40.63Z\"/>\r\n                                        <path fill=\"#ea8039\" d=\"M33.48,34.53a7.52,7.52,0,0,0,1,12.39A7.49,7.49,0,0,1,25,37.07L25,37c0-.1.09-.19.14-.29a5.66,5.66,0,0,1,7.22-2.81A6.19,6.19,0,0,1,33.48,34.53Z\"/>\r\n                                        <path fill=\"#e5cfb3\" d=\"M46.6,17.16,36.77,20.3a1.51,1.51,0,0,0-.53.32L22,34.91a5.05,5.05,0,0,0,0,7.14h0a5,5,0,0,0,7.14,0L43.38,27.77a1.26,1.26,0,0,0,.32-.53l3.15-9.84A.19.19,0,0,0,46.6,17.16Z\"/>\r\n                                        <path fill=\"#d1baa1\" d=\"M29.09,42.05,43.38,27.77a1.26,1.26,0,0,0,.32-.53l3.15-9.84a.21.21,0,0,0-.05-.2L22,42.05A5,5,0,0,0,29.09,42.05Z\"/>\r\n                                        <path fill=\"#f4e4d3\" d=\"M46.85,17.4a.19.19,0,0,0-.25-.24l-9.45,3-3,9.45a.19.19,0,0,0,.24.25l9.45-3Z\"/>\r\n                                        <path fill=\"#f9f3ed\" d=\"M22,37.48,36.32,23.19a1.26,1.26,0,0,1,.53-.32L46,19.93l.81-2.53a.19.19,0,0,0-.25-.24L36.77,20.3a1.51,1.51,0,0,0-.53.32L22,34.91a5.06,5.06,0,0,0-1.27,5A5,5,0,0,1,22,37.48Z\"/>\r\n                                        <path fill=\"#5df9e6\" d=\"M43.3,27.07l3.14-9.83a.18.18,0,0,0,0-.2L45,18.44l-2.51,7.83a1.26,1.26,0,0,1-.32.53L27.88,41.09a5,5,0,0,1-2.44,1.33,5,5,0,0,1-2.56.42,5,5,0,0,0,5.81-1L43,27.6A1.32,1.32,0,0,0,43.3,27.07Z\"/>\r\n                                        <path fill=\"#041256\" d=\"M25.52,44.53a6,6,0,0,1-4.28-10.32L35.53,19.92a2.3,2.3,0,0,1,.93-.57L46.3,16.2h0a1.21,1.21,0,0,1,1.21.3,1.18,1.18,0,0,1,.29,1.21l-3.15,9.83a2.22,2.22,0,0,1-.56.93L29.8,42.76A6,6,0,0,1,25.52,44.53Zm19.9-25.95-8.35,2.67a.57.57,0,0,0-.13.08L22.66,35.62a4,4,0,0,0,0,5.73,4.07,4.07,0,0,0,5.73,0L42.67,27.06a.35.35,0,0,0,.08-.13Z\"/>\r\n                                        <rect fill=\"#d0e0ef\" height=\"2.61\" rx=\"0.89\" transform=\"translate(36.31 -2.85) rotate(45)\" width=\"15.43\" x=\"13.88\" y=\"41.11\"/>\r\n                                        <path fill=\"#fff\" d=\"M16.5,38.58a.89.89,0,0,1,1.26,0l9.29,9.29.29-.29a.9.9,0,0,0,0-1.27l-9.65-9.65a.91.91,0,0,0-1.26,0l-.58.58a.9.9,0,0,0,0,1.27l.36.36Z\"/>\r\n                                        <path fill=\"#5df9e6\" d=\"M26.9,46.31l-9.65-9.65a.83.83,0,0,0-.51-.23l9.05,9a.9.9,0,0,1,0,1.27l-.58.58a.93.93,0,0,1-.75.24l.6.6a.89.89,0,0,0,1.26,0l.58-.58A.9.9,0,0,0,26.9,46.31Z\"/>\r\n                                        <path fill=\"#385272\" d=\"M18.42,50.73l4.82-4.83L18.1,40.76l-4.87,4.87a2.55,2.55,0,0,1-1.39.69,5,5,0,1,0,5.83,5.9A2.86,2.86,0,0,1,18.42,50.73Z\"/>\r\n                                        <rect fill=\"#577491\" height=\"0.54\" transform=\"translate(37.3 -0.51) rotate(45)\" width=\"5.5\" x=\"16.51\" y=\"44.5\"/>\r\n                                        <rect fill=\"#577491\" height=\"0.54\" transform=\"translate(37.82 0.75) rotate(45)\" width=\"5.5\" x=\"15.26\" y=\"45.75\"/>\r\n                                        <rect fill=\"#577491\" height=\"0.54\" transform=\"translate(38.33 2) rotate(45)\" width=\"5.5\" x=\"14\" y=\"47\"/>\r\n                                        <rect fill=\"#577491\" height=\"0.54\" transform=\"translate(38.85 3.25) rotate(45)\" width=\"5.5\" x=\"12.75\" y=\"48.26\"/>\r\n                                        <path fill=\"#5df9e6\" d=\"M17.41,51.72a2.72,2.72,0,0,1,.75-1.49L23,45.4l-5.15-5.14-.33.33,4.34,4.34L17,49.75a2.79,2.79,0,0,0-.75,1.5,5,5,0,0,1-1.39,2.62A5,5,0,0,1,10,55.15a5,5,0,0,0,7.46-3.43Z\"/>\r\n                                        <path fill=\"#577491\" d=\"M8.91,50a5,5,0,0,1,3.33-2.2,2.55,2.55,0,0,0,1.4-.69l5.42-5.42-1-1-4.87,4.87a2.55,2.55,0,0,1-1.39.69,5,5,0,0,0-3.72,7A4.94,4.94,0,0,1,8.91,50Z\"/>\r\n                                        <path fill=\"#041256\" d=\"M26.13,49.42a1.88,1.88,0,0,1-1.34-.56l-9.65-9.65a1.87,1.87,0,0,1,0-2.67l.58-.58a1.9,1.9,0,0,1,2.68,0l9.65,9.65a1.91,1.91,0,0,1,0,2.68l-.58.57A1.89,1.89,0,0,1,26.13,49.42Zm.07-2h0Zm-9.57-9.57,9.52,9.52.41-.45-9.5-9.5Zm10,9h0Z\"/>\r\n                                        <path fill=\"#041256\" d=\"M12.73,57.33a5.83,5.83,0,0,1-.59,0,6.1,6.1,0,0,1-4.45-2.67,6,6,0,0,1,4-9.29,1.61,1.61,0,0,0,.86-.42l4.87-4.87a1,1,0,1,1,1.42,1.42l-4.87,4.87a3.63,3.63,0,0,1-1.93,1,4.08,4.08,0,0,0-2.68,1.76,4,4,0,0,0,6.25,5.07A4,4,0,0,0,16.69,52a3.82,3.82,0,0,1,1-2l4.83-4.82A1,1,0,0,1,24,46.61l-4.82,4.82a2,2,0,0,0-.48,1A5.91,5.91,0,0,1,17,55.55,6,6,0,0,1,12.73,57.33Z\"/>\r\n                                        <path fill=\"#041256\" d=\"M13.16,52A.83.83,0,0,1,12,52a.85.85,0,0,1,0-1.18A.83.83,0,0,1,13.16,52Z\"/>\r\n                                    </svg>\r\n                                </div>\r\n                                <h3 className=\"text-xl font-bold text-white mb-3\">RPGs</h3>\r\n                                <p className=\"text-neutral-300 leading-relaxed\">\r\n                                    Uncover deep lore and track complex quests without accidentally reading major story spoilers.\r\n              </p>\r\n            </div>\r\n\r\n                            {/* Puzzle Games */}\r\n                            <div className=\"text-center animate-fade-slide-up\">\r\n                                <div className=\"flex items-center justify-center mx-auto mb-4\">\r\n                                    <svg className=\"w-16 h-16\" viewBox=\"0 0 500 500\">\r\n                                        <path fill=\"#E53A3A\" d=\"M202.78,371.74a34.27,34.27,0,0,1,36.11-13.5,34,34,0,0,1-8.18,67.09,34.17,34.17,0,0,1-27.93-14.46v76.51h171.7A20.55,20.55,0,0,0,395,466.83V295.23h-76.9a34,34,0,1,0-38.35,0h-77Z\"/>\r\n                                        <path fill=\"#D98C1F\" d=\"M362.63,295.23v171.6a20.55,20.55,0,0,1-20.55,20.55h32.4A20.55,20.55,0,0,0,395,466.83V295.23Z\"/>\r\n                                        <path fill=\"#E53A3A\" d=\"M126.17,295.23a34,34,0,1,1-39.13,0H10.53v171.6a20.55,20.55,0,0,0,20.55,20.55h171.7V410.47a33.83,33.83,0,0,0,32,14.63,34,34,0,0,0-4-67.82,33.82,33.82,0,0,0-28,14.85v-76.9Z\"/>\r\n                                        <path fill=\"#D98C1F\" d=\"M374.46,203.72a33.84,33.84,0,1,1,38.92,0h76.09V34a21.33,21.33,0,0,0-21.33-21.33H298.27V89.1a33.64,33.64,0,0,0-31.84-14.54,33.84,33.84,0,0,0,4,67.45,33.63,33.63,0,0,0,27.85-14.77v76.48Z\"/>\r\n                                        <path fill=\"#E53A3A\" d=\"M468.14,12.62h-32.4A21.33,21.33,0,0,1,457.07,34V203.72h32.4V34A21.33,21.33,0,0,0,468.14,12.62Z\"/>\r\n                                        <path fill=\"#D98C1F\" d=\"M202.78,218.72a34.27,34.27,0,0,1-36.11,13.5,34,34,0,0,1,8.18-67.09,34.17,34.17,0,0,1,27.93,14.46V103.08H31.08a20.55,20.55,0,0,0-20.55,20.54V295.23H87.44a34,34,0,1,0,38.34,0h77Z\"/>\r\n                                    </svg>\r\n                                </div>\r\n                                <h3 className=\"text-xl font-bold text-white mb-3\">Puzzle Games</h3>\r\n                                <p className=\"text-neutral-300 leading-relaxed\">\r\n                                    Get a clue for that brain-bending puzzle, not the entire solution. Preserve your \"aha!\" moment.\r\n              </p>\r\n            </div>\r\n\r\n                            {/* Open-World Adventures */}\r\n                            <div className=\"text-center animate-fade-slide-up\">\r\n                                <div className=\"flex items-center justify-center mx-auto mb-4\">\r\n                                    <img src=\"/icons/openworld.svg\" alt=\"Open World Adventures\" className=\"w-16 h-16\" />\r\n                                </div>\r\n                                <h3 className=\"text-xl font-bold text-white mb-3\">Open-World Adventures</h3>\r\n                                <p className=\"text-neutral-300 leading-relaxed\">\r\n                                    Hunt down every last collectible and conquer secret challenges with a gentle nudge in the right direction.\r\n              </p>\r\n            </div>\r\n\r\n                            {/* Metroidvanias */}\r\n                            <div className=\"text-center animate-fade-slide-up\">\r\n                                <div className=\"flex items-center justify-center mx-auto mb-4\">\r\n                                    <svg className=\"w-16 h-16\" viewBox=\"0 0 1367 1562\">\r\n                                        <rect fill=\"#E62129\" height=\"97.6415\" width=\"780.786\" x=\"293\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.5262\" width=\"976.069\" x=\"195\" y=\"98\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.6415\" width=\"195.283\" x=\"195\" y=\"195\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.6415\" width=\"195.168\" x=\"976\" y=\"195\"/>\r\n                                        <rect fill=\"#E62129\" height=\"195.168\" width=\"97.6415\" x=\"293\" y=\"293\"/>\r\n                                        <rect fill=\"#E62129\" height=\"195.168\" width=\"97.5262\" x=\"390\" y=\"390\"/>\r\n                                        <rect fill=\"#E62129\" height=\"195.168\" width=\"97.6415\" x=\"976\" y=\"293\"/>\r\n                                        <rect fill=\"#E62129\" height=\"195.168\" width=\"97.5262\" x=\"879\" y=\"390\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.6415\" width=\"780.786\" x=\"293\" y=\"586\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.5262\" width=\"585.503\" x=\"391\" y=\"683\"/>\r\n                                        <rect fill=\"#E62129\" height=\"390.451\" width=\"97.5262\" x=\"98\" y=\"488\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.1804\" width=\"97.6415\" x=\"195\" y=\"781\"/>\r\n                                        <rect fill=\"#E62129\" height=\"390.335\" width=\"97.6415\" y=\"683\"/>\r\n                                        <rect fill=\"#E62129\" height=\"390.451\" width=\"97.5262\" x=\"1171\" y=\"488\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.1804\" width=\"97.6415\" x=\"1074\" y=\"781\"/>\r\n                                        <rect fill=\"#E62129\" height=\"390.335\" width=\"97.6415\" x=\"1269\" y=\"683\"/>\r\n                                        <rect fill=\"#F98812\" height=\"292.809\" width=\"97.6415\" x=\"195\" y=\"293\"/>\r\n                                        <rect fill=\"#F98812\" height=\"97.6415\" width=\"97.6415\" x=\"293\" y=\"488\"/>\r\n                                        <rect fill=\"#F98812\" height=\"292.809\" width=\"97.6415\" x=\"1074\" y=\"293\"/>\r\n                                        <rect fill=\"#F98812\" height=\"97.6415\" width=\"97.6415\" x=\"976\" y=\"488\"/>\r\n                                        <rect fill=\"#F98812\" height=\"195.283\" width=\"97.5262\" x=\"390\" y=\"195\"/>\r\n                                        <rect fill=\"#F98812\" height=\"195\" width=\"198\" x=\"583\" y=\"195\"/>\r\n                                        <rect fill=\"#F98812\" height=\"195.283\" width=\"99.1401\" x=\"877\" y=\"195\"/>\r\n                                        <rect fill=\"#F98812\" height=\"195\" width=\"391\" x=\"488\" y=\"390\"/>\r\n                                        <rect fill=\"#1D1819\" height=\"195.283\" width=\"94.9901\" x=\"488\" y=\"195\"/>\r\n                                        <rect fill=\"#1D1819\" height=\"195.283\" width=\"96.1429\" x=\"781\" y=\"195\"/>\r\n                                        <rect fill=\"#990000\" height=\"195.629\" width=\"97.6415\" x=\"195\" y=\"586\"/>\r\n                                        <rect fill=\"#990000\" height=\"292.348\" width=\"97.6415\" x=\"293\" y=\"684\"/>\r\n                                        <rect fill=\"#990000\" height=\"293\" width=\"195\" x=\"390\" y=\"781\"/>\r\n                                        <rect fill=\"#990000\" height=\"195.629\" width=\"97.7568\" x=\"1074\" y=\"586\"/>\r\n                                        <rect fill=\"#990000\" height=\"292.809\" width=\"97.5262\" x=\"976\" y=\"684\"/>\r\n                                        <rect fill=\"#990000\" height=\"293\" width=\"195\" x=\"781\" y=\"781\"/>\r\n                                        <rect fill=\"#990000\" height=\"195\" width=\"195\" x=\"586\" y=\"781\"/>\r\n                                        <rect fill=\"#F98812\" height=\"97.5262\" width=\"195.168\" y=\"1171\"/>\r\n                                        <rect fill=\"#F98812\" height=\"97.6415\" width=\"292.809\" y=\"1074\"/>\r\n                                        <rect fill=\"#F98812\" height=\"97.6415\" width=\"292.809\" x=\"1074\" y=\"1074\"/>\r\n                                        <rect fill=\"#F98812\" height=\"97.5262\" width=\"195.744\" x=\"1171\" y=\"1171\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.5262\" width=\"195.168\" x=\"586\" y=\"976\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.6415\" width=\"780.786\" x=\"293\" y=\"1074\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.5262\" width=\"196.897\" x=\"584\" y=\"1171\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.6415\" width=\"195.283\" x=\"195\" y=\"1269\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.6415\" width=\"390.451\" x=\"195\" y=\"1366\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.5262\" width=\"195.052\" x=\"293\" y=\"1464\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.5262\" width=\"195.168\" x=\"878\" y=\"1464\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.6415\" width=\"390.451\" x=\"781\" y=\"1366\"/>\r\n                                        <rect fill=\"#E62129\" height=\"97.6415\" width=\"195.168\" x=\"976\" y=\"1269\"/>\r\n                                        <rect fill=\"#F98812\" height=\"293\" width=\"195\" x=\"98\" y=\"878\"/>\r\n                                        <rect fill=\"#F98812\" height=\"293\" width=\"195\" x=\"1074\" y=\"878\"/>\r\n                                        <rect fill=\"#990000\" height=\"97.5262\" width=\"390.451\" x=\"195\" y=\"1171\"/>\r\n                                        <rect fill=\"#990000\" height=\"97.6415\" width=\"390.451\" x=\"781\" y=\"1171\"/>\r\n                                        <rect fill=\"#990000\" height=\"97.6415\" width=\"585.618\" x=\"390\" y=\"1269\"/>\r\n                                        <rect fill=\"#F98812\" height=\"97.6415\" width=\"97.6415\" x=\"293\" y=\"976\"/>\r\n                                        <rect fill=\"#F98812\" height=\"97.1804\" width=\"97.5262\" x=\"976\" y=\"976\"/>\r\n                                    </svg>\r\n                                </div>\r\n                                <h3 className=\"text-xl font-bold text-white mb-3\">Metroidvanias</h3>\r\n                                <p className=\"text-neutral-300 leading-relaxed\">\r\n                                    Lost after finding a new power? Discover which hidden path just opened up without checking a full map.\r\n              </p>\r\n            </div>\r\n\r\n                            {/* Survival & Crafting */}\r\n                            <div className=\"text-center animate-fade-slide-up\">\r\n                                <div className=\"flex items-center justify-center mx-auto mb-4\">\r\n                                    <svg className=\"w-16 h-16\" viewBox=\"0 0 500 500\">\r\n                                        <path fill=\"#faae3b\" d=\"M360.62,93.33c1.11,18.72-33.87,73.85-33.87,73.85C305.59,76.87,192.91,10.68,192.91,10.68s26.67,31.6-30.1,124-31.29,150.15-31.29,150.15h0c12.3,44.84,62.05,78.42,121.64,78.42s104-36.12,121.64-78.42h.05C411.52,203.21,360.62,93.33,360.62,93.33Z\"/>\r\n                                        <path fill=\"#ee3734\" d=\"M201.59,311.38c0-29,51.16-88.94,51.16-88.94s51.15,60,51.15,88.94-22.9,52.48-51.15,52.48S201.59,340.37,201.59,311.38Z\"/>\r\n                                        <path fill=\"rgba(0,0,0,0.15)\" d=\"M168.71,336.69c22.2,16.49,51.85,26.61,84.49,26.61,59.6,0,104-36.12,121.64-78.42h.05c36.63-81.67-14.27-191.55-14.27-191.55,1.11,18.72-33.87,73.85-33.87,73.85C305.59,76.87,192.91,10.68,192.91,10.68S438.82,258.17,168.71,336.69Z\"/>\r\n                                        <ellipse fill=\"#513b2c\" cx=\"55.48\" cy=\"453.93\" rx=\"22.06\" ry=\"36.04\" transform=\"translate(-107.9 26.8) rotate(-13.96)\"/>\r\n                                        <path fill=\"#fff\" d=\"M46,419.29c.27-.08.5-.26.78-.33l-.82.2Z\"/>\r\n                                        <path fill=\"#fff\" d=\"M63.36,489.11l.82-.2c-.28.07-.57,0-.85.07Z\"/>\r\n                                        <path fill=\"#b3814b\" d=\"M466.56,351.71a36,36,0,0,0-43.67-26.28L46.78,419c11.83-2.94,25.31,10.33,30.11,29.65S76,486,64.18,488.91l376.1-93.52A36,36,0,0,0,466.56,351.71Z\"/>\r\n                                        <polygon fill=\"rgba(0,0,0,0.15)\" points=\"64.18 488.91 440.28 395.39 466.56 351.71 76.89 448.61 64.18 488.91\"/>\r\n                                        <ellipse fill=\"#513b2c\" cx=\"444.52\" cy=\"453.93\" rx=\"36.04\" ry=\"22.06\" transform=\"translate(-103.27 775.77) rotate(-76.04)\"/>\r\n                                        <path fill=\"#fff\" d=\"M454,419.29c-.27-.08-.5-.26-.78-.33l.82.2Z\"/>\r\n                                        <path fill=\"#fff\" d=\"M436.64,489.11l-.82-.2c.28.07.57,0,.85.07Z\"/>\r\n                                        <path fill=\"#b3814b\" d=\"M33.44,351.71a36,36,0,0,1,43.67-26.28L453.22,419c-11.83-2.94-25.31,10.33-30.11,29.65s.89,37.36,12.71,40.3L59.72,395.39A36,36,0,0,1,33.44,351.71Z\"/>\r\n                                        <polygon fill=\"rgba(0,0,0,0.15)\" points=\"435.82 488.91 59.72 395.39 33.44 351.71 423.11 448.61 435.82 488.91\"/>\r\n                                    </svg>\r\n                                </div>\r\n                                <h3 className=\"text-xl font-bold text-white mb-3\">Survival & Crafting</h3>\r\n                                <p className=\"text-neutral-300 leading-relaxed\">\r\n                                    Need a specific resource? Learn where to find it or what recipe you're missing to build your ultimate base.\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n\r\n                {/* Pricing Section */}\r\n                <section id=\"pricing\" className=\"py-8 md:py-10 bg-transparent\">\r\n                    <div className=\"container mx-auto px-8\">\r\n                        <div className=\"text-center mb-8 md:mb-10 animate-fade-slide-up\">\r\n                            <h2 className=\"text-4xl md:text-5xl font-bold tracking-tight text-white mb-4\">Choose Your Plan</h2>\r\n                            <p className=\"text-lg text-neutral-300 leading-relaxed\">Start for free. Upgrade when you're ready.</p>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 items-stretch\">\r\n                            \r\n                        {/* Free Plan */}\r\n                        <div className=\"bg-gradient-to-r from-[#1C1C1C]/60 to-[#0A0A0A]/60 backdrop-blur-xl border-2 border-neutral-800/60 rounded-2xl p-6 flex flex-col animate-fade-slide-up hover:border-neutral-700/80 hover:scale-105 hover:shadow-[0_0_30px_rgba(229,58,58,0.3)] hover:shadow-[#E53A3A]/20 transition-all duration-500 group cursor-pointer\">\r\n                                <h3 className=\"text-2xl font-bold text-white mb-2\">Free</h3>\r\n                                <p className=\"text-neutral-300 mb-6 text-sm\">For the Casual Player</p>\r\n                                <div className=\"mb-6\">\r\n                                    <span className=\"text-4xl font-bold text-white\">$0</span>\r\n                                    <span className=\"text-lg text-neutral-300\">/month</span>\r\n                                </div>\r\n                                <ul className=\"space-y-3 mb-8\">\r\n                                    <FeatureListItem>55 Text | 25 Image Queries/month</FeatureListItem>\r\n                                    <FeatureListItem>Knowledge till January 2025</FeatureListItem>\r\n                                    <FeatureListItem>Standard AI Model</FeatureListItem>\r\n                                    <FeatureListItem>PC-to-Mobile Sync</FeatureListItem>\r\n                                    <FeatureListItem>Progress Tracking</FeatureListItem>\r\n                                    <FeatureListItem>14 day free trial for Pro</FeatureListItem>\r\n                                </ul>\r\n                                <div className=\"mt-auto\">\r\n                                    <button\r\n                                        onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}\r\n                                        className=\"w-full bg-gradient-to-r from-neutral-600 to-neutral-500 text-neutral-300 font-bold py-3 px-6 rounded-lg cursor-not-allowed opacity-50\"\r\n                                        disabled\r\n                                        title=\"Coming Soon - Join the waitlist to be notified when pricing goes live!\"\r\n                                    >\r\n                                        Coming Soon\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                        {/* Vanguard Plan (center and highlighted) */}\r\n                        <div className=\"relative border-2 border-[#FFAB40] rounded-2xl p-6 bg-gradient-to-r from-[#111] to-[#0A0A0A] shadow-2xl shadow-[#D98C1F]/30 transform lg:scale-105 flex flex-col animate-fade-slide-up hover:shadow-[#D98C1F]/50 hover:scale-110 hover:z-50 transition-all duration-500 group cursor-pointer animate-glow-pulse\">\r\n                                <div className=\"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] text-white text-xs font-bold px-4 py-1 rounded-full uppercase tracking-wider shadow-2xl\">\r\n                                    Limited Offer\r\n                                </div>\r\n                                <h3 className=\"text-3xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] mb-2\">Pro Vanguard</h3>\r\n                                <p className=\"text-neutral-300 mb-6 text-sm\">Become a Founding Member</p>\r\n                                <div className=\"mb-6\">\r\n                                    <span className=\"text-4xl font-bold text-white\">$20</span>\r\n                                    <span className=\"text-lg text-neutral-300\">/year</span>\r\n                                    <p className=\"text-green-400 font-medium text-sm mt-1\">Lifetime Price Guarantee!</p>\r\n                                </div>\r\n                                <ul className=\"space-y-3 mb-6\">\r\n                                    <FeatureListItem>Everything in Pro, plus:</FeatureListItem>\r\n                                </ul>\r\n                                <ul className=\"space-y-3 mb-8 border-l-2 border-[#FFAB40]/40 pl-4 ml-2\">\r\n                                    <VanguardFeatureListItem>Permanent Price Lock-in</VanguardFeatureListItem>\r\n                                    <VanguardFeatureListItem>Exclusive 'Vanguard' Badge</VanguardFeatureListItem>\r\n                                    <VanguardFeatureListItem>Founder's Council Access</VanguardFeatureListItem>\r\n                                    <VanguardFeatureListItem>Beta Access to Features</VanguardFeatureListItem>\r\n                                    <VanguardFeatureListItem comingSoon={true}>Revenue Sharing</VanguardFeatureListItem>\r\n                                </ul>\r\n                                <div className=\"mt-auto\">\r\n                                    <button \r\n                                        onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}\r\n                                        className=\"w-full bg-gradient-to-r from-neutral-600 to-neutral-500 text-neutral-300 font-bold py-3 px-6 rounded-lg cursor-not-allowed opacity-50\"\r\n                                        disabled\r\n                                        title=\"Coming Soon - Join the waitlist to be notified when pricing goes live!\"\r\n                                    >\r\n                                        Coming Soon\r\n                                    </button>\r\n            </div>\r\n          </div>\r\n\r\n                        {/* Pro (Monthly) Plan */}\r\n                        <div className=\"bg-gradient-to-r from-[#1C1C1C]/60 to-[#0A0A0A]/60 backdrop-blur-xl border-2 border-neutral-800/60 rounded-2xl p-6 flex flex-col animate-fade-slide-up hover:border-neutral-700/80 hover:scale-105 hover:shadow-[0_0_30px_rgba(229,58,58,0.3)] hover:shadow-[#E53A3A]/20 transition-all duration-500 group cursor-pointer\">\r\n                                <h3 className=\"text-2xl font-bold text-white mb-2\">Pro</h3>\r\n                                <p className=\"text-neutral-300 mb-6 text-sm\">For the Serious Gamer</p>\r\n                                <div className=\"mb-6\">\r\n                                    <span className=\"text-4xl font-bold text-white\">$3.99</span>\r\n                                    <span className=\"text-lg text-neutral-300\">/month</span>\r\n                                </div>\r\n                                <ul className=\"space-y-3 mb-8\">\r\n                                    <FeatureListItem>Everything in Free, plus:</FeatureListItem>\r\n                                    <FeatureListItem>1,583 Text | 328 Image Queries/month</FeatureListItem>\r\n                                    <FeatureListItem>Up-to-date knowledge using web search</FeatureListItem>\r\n                                    <FeatureListItem>Advanced AI Model</FeatureListItem>\r\n                                    <FeatureListItem>In-Depth Insight Tabs</FeatureListItem>\r\n                                    <FeatureListItem>Hands-Free Voice Response</FeatureListItem>\r\n                                    <FeatureListItem>Batch Screenshot Capture</FeatureListItem>\r\n                                    <FeatureListItem>Priority Support & No Ads</FeatureListItem>\r\n                                </ul>\r\n                                <div className=\"mt-auto\">\r\n                                    <button \r\n                                        onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}\r\n                                        className=\"w-full bg-gradient-to-r from-neutral-600 to-neutral-500 text-neutral-300 font-bold py-3 px-6 rounded-lg cursor-not-allowed opacity-50\"\r\n                                        disabled\r\n                                        title=\"Coming Soon - Join the waitlist to be notified when pricing goes live!\"\r\n                                    >\r\n                                        Coming Soon\r\n                                    </button>\r\n                                </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n                </section>\r\n\r\n                {/* Testimonials Section */}\r\n                <section className=\"py-10 md:py-14 bg-transparent relative\">\r\n                    <div className=\"container mx-auto px-8 max-w-6xl relative\">\r\n                        <div className=\"text-center mb-8 md:mb-10 animate-fade-slide-up\">\r\n                            <h2 className=\"text-5xl md:text-6xl font-bold tracking-tight text-white mb-6 leading-tight\" style={{ lineHeight: '1.3', minHeight: '1.3em', height: 'auto', paddingTop: '0.5rem', paddingBottom: '0.5rem' }}>What Gamers Are Saying</h2>\r\n                        </div>\r\n                        \r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n                            <Testimonial\r\n                                quote=\"Finally, a gaming assistant that doesn't spoil the story! I was stuck on a puzzle in Elden Ring for hours, and Otagon gave me just the right hint to figure it out myself.\"\r\n                                author=\"Sarah Chen\"\r\n                                title=\"Souls-like Enthusiast\"\r\n                            />\r\n                            <Testimonial\r\n                                quote=\"The PC-to-mobile sync is a game-changer. I can get help without alt-tabbing and losing my immersion. It's like having a gaming buddy who knows exactly when to chime in.\"\r\n                                author=\"Marcus Rodriguez\"\r\n                                title=\"RPG Completionist\"\r\n                            />\r\n                            <Testimonial\r\n                                quote=\"Just press F1 during intense boss fights and get spoken hints without pausing the game. The hands-free mode is a lifesaver - it's like having an expert coach right beside me.\"\r\n                                author=\"Safi Rahman\"\r\n                                title=\"Souls-like Speedrunner\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n\r\n                {/* Earn by Playing Section */}\r\n                <section id=\"earn-by-playing\" className=\"hidden py-10 md:py-14 bg-transparent\">\r\n                    <div className=\"container mx-auto px-6 max-w-4xl\">\r\n                        {/* Gradient border wrapper */}\r\n                        <div className=\"p-[1px] bg-gradient-to-br from-[#E53A3A]/50 to-[#D98C1F]/50 rounded-xl\">\r\n                            <div className=\"bg-[#111111] rounded-[11px] p-8 md:p-12 text-left flex flex-col\">\r\n                                <div>\r\n                                    <div className=\"flex justify-start mb-4\">\r\n                                        <div className=\"flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-[#E53A3A]/10 to-[#FFAB40]/10 border border-neutral-700/50\">\r\n                                            <GamepadIcon className=\"w-12 h-12 text-[#FFAB40]\" />\r\n                                        </div>\r\n                                    </div>\r\n                                    <h2 className=\"text-4xl md:text-5xl font-bold tracking-tight text-white mb-6\">\r\n                                        Earn by Playing\r\n                                    </h2>\r\n                                    <div className=\"mb-6\">\r\n                                        <span className=\"text-base font-bold bg-sky-500/20 text-sky-300 border border-sky-500/30 px-3 py-1 rounded-full uppercase tracking-wider\">Coming when we reach 10,000 pro subs</span>\r\n                                    </div>\r\n                                    <p className=\"text-lg text-[#FFAB40] font-semibold mb-4\">Exclusive to Vanguard Users</p>\r\n                                </div>\r\n\r\n                                <div className=\"flex-grow\">\r\n                                    <ul className=\"space-y-4 text-lg max-w-2xl mb-6 leading-relaxed\">\r\n                                        <VanguardFeatureListItem>Earn instant rewards for completing in-game challenges.</VanguardFeatureListItem>\r\n                                        <VanguardFeatureListItem>Discover secrets, defeat bosses, find rare loot, or uncover lore.</VanguardFeatureListItem>\r\n                                        <VanguardFeatureListItem>Each achievement helps train our AI and puts money in your pocket, rewarded based on the challenge.</VanguardFeatureListItem>\r\n                                    </ul>\r\n                                </div>\r\n\r\n                                <div className=\"mt-auto\">\r\n                                    <button\r\n                                        onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}\r\n                                        className=\"w-full bg-neutral-600 text-neutral-400 font-bold py-3 px-6 rounded-lg cursor-not-allowed opacity-50\"\r\n                                        disabled\r\n                                        title=\"Coming when we reach 10,000 pro subs - Join the waitlist to be notified when this feature goes live!\"\r\n                                    >\r\n                                        Coming when we reach 10,000 pro subs\r\n                                    </button>\r\n                                    <p className=\"text-xs text-neutral-500 mt-3 text-center\">Join the waitlist to be notified when this feature goes live!</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Founder Section */}\r\n                <section id=\"founder\" className=\"py-10 md:py-14 bg-transparent\">\r\n                    <div className=\"container mx-auto px-8 md:px-10 max-w-5xl\">\r\n                        {/* Section Header */}\r\n                        <div className=\"text-center mb-8 md:mb-10 animate-fade-slide-up\">\r\n                            <h2 className=\"text-4xl md:text-6xl font-bold tracking-tight text-white mb-6\">\r\n                                Meet the Founder\r\n                            </h2>\r\n                            <p className=\"text-lg md:text-xl text-neutral-300 max-w-3xl mx-auto leading-relaxed\">\r\n                                Hey, I'm Amaana passionate gamer from Hyderabad who spent my early days printing cheat codes at internet cafes.\r\n                                After years of thinking about how people interact with technology, I'm building the future of gaming assistance.\r\n              </p>\r\n            </div>\r\n\r\n                        {/* Hero-Style Layout */}\r\n                        <div className=\"text-center animate-fade-slide-up\">\r\n                            {/* Founder Image - Centered */}\r\n                            <div className=\"flex justify-center mb-8\">\r\n                                <FounderImage size=\"xl\" showBadge={false} showStatus={false} />\r\n                            </div>\r\n\r\n                            {/* Decorative Gradient Line */}\r\n                            <div className=\"w-24 h-1 bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] mx-auto mb-8 rounded-full\"></div>\r\n\r\n                            {/* Name and Title - Centered */}\r\n                            <div className=\"space-y-3 mb-8\">\r\n                                <h3 className=\"text-4xl md:text-5xl font-bold text-white\">\r\n                                    Amaan\r\n                                </h3>\r\n                                <p className=\"text-xl md:text-2xl text-neutral-300 font-medium\">\r\n                                    Service Designer\r\n                                </p>\r\n                            </div>                            {/* Personal Quote - Centered */}\r\n                            <div className=\"max-w-4xl mx-auto mb-12\">\r\n                                <div className=\"bg-gradient-to-r from-[#0F0F0F]/60 to-[#1A1A1A]/60 border-2 border-neutral-700/60 rounded-2xl p-8 md:p-10 backdrop-blur-sm\">\r\n                                    <p className=\"text-[#CFCFCF] leading-relaxed text-lg md:text-xl italic\">\r\n                                        \"Like you, I've spent my life passionate about games. From getting lost in the deep lore of modern RPGs\r\n                                        to the frustration of needing a small hint and getting a massive spoiler in return. That's why I built Otagon\r\n                                        - to preserve the magic of discovery while giving you just the nudge you need.\"\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n                            {/* Contact Buttons - Centered */}\r\n                            <div className=\"flex flex-col sm:flex-row items-center justify-center gap-6 md:gap-8\">\r\n                                <a\r\n                                    href=\"https://www.linkedin.com/in/readmetxt/\"\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className=\"inline-flex items-center justify-center gap-3 bg-gradient-to-r from-[#0077B5] to-[#005885] hover:from-[#005885] hover:to-[#004066] text-white font-semibold py-4 px-8 rounded-xl transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl hover:shadow-[#0077B5]/25\"\r\n                                >\r\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                                        <path d=\"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z\"></path>\r\n                                        <rect x=\"2\" y=\"9\" width=\"4\" height=\"12\"></rect>\r\n                                        <circle cx=\"4\" cy=\"4\" r=\"2\"></circle>\r\n                                    </svg>\r\n                                    <span className=\"hidden sm:inline\">Connect on LinkedIn</span>\r\n                                    <span className=\"sm:hidden\">LinkedIn</span>\r\n                                </a>\r\n\r\n                                <a\r\n                                    href=\"mailto:support@otagon.app\"\r\n                                    className=\"inline-flex items-center justify-center gap-3 bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] hover:from-[#D42A2A] hover:to-[#C87A1A] text-white font-semibold py-4 px-8 rounded-xl transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl hover:shadow-[#E53A3A]/25\"\r\n                                >\r\n                                    <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n                                    </svg>\r\n                                    <span className=\"hidden sm:inline\">Email Amaan</span>\r\n                                    <span className=\"sm:hidden\">Email</span>\r\n                                </a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n                </section>\r\n      </main>\r\n\r\n      {/* Footer */}\r\n            <footer className=\"bg-transparent border-t border-neutral-800/50\">\r\n                <div className=\"container mx-auto px-6 py-8\">\r\n                    <div className=\"flex flex-col md:flex-row justify-between items-center gap-6\">\r\n                        {/* Footer Links - Two rows on mobile, single row on desktop */}\r\n                        <div className=\"flex flex-col md:flex-row items-center gap-3 md:gap-6 text-sm font-medium text-neutral-400 order-1 md:order-2\">\r\n                           <div className=\"flex items-center gap-4 md:gap-6\">\r\n                               <a href=\"#pricing\" onClick={handleScrollTo('pricing')} className=\"hover:text-white transition-colors\">Pricing</a>\r\n                               <button type=\"button\" onClick={onOpenAbout} className=\"hover:text-white transition-colors active:scale-95\">About</button>\r\n                               <button type=\"button\" onClick={onOpenTerms} className=\"hover:text-white transition-colors active:scale-95\">Terms</button>\r\n                           </div>\r\n                           <div className=\"flex items-center gap-4 md:gap-6\">\r\n                               <button type=\"button\" onClick={onOpenPrivacy} className=\"hover:text-white transition-colors active:scale-95\">Privacy</button>\r\n                               <button type=\"button\" onClick={onOpenRefund} className=\"hover:text-white transition-colors active:scale-95\">Refund Policy</button>\r\n                               <button type=\"button\" onClick={() => setShowContactModal(true)} className=\"hover:text-white transition-colors active:scale-95\">Contact Us</button>\r\n                           </div>\r\n            </div>\r\n            \r\n                        {/* Logo and Branding - Centered on mobile, left side on desktop */}\r\n                        <div className=\"flex flex-col items-center md:items-start text-center md:text-left order-2 md:order-1\">\r\n                            <button \r\n                                onClick={onGetStarted}\r\n                                className=\"flex items-center gap-2 cursor-pointer hover:scale-105 transition-transform duration-300\"\r\n                            >\r\n                                <Logo className=\"h-8 w-8\" bounce={false} />\r\n                                <span className=\"text-xl font-bold\">Otagon</span>\r\n              </button>\r\n                             <p className=\"text-neutral-400 mt-2 text-sm\">&copy; {new Date().getFullYear()} Otagon. All rights reserved.</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </footer>\r\n            \r\n            {/* Contact Us Modal */}\r\n            <ContactUsModal \r\n                isOpen={showContactModal} \r\n                onClose={() => setShowContactModal(false)} \r\n            />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LandingPage;\r\n\r\n","import React, { useState, useEffect } from 'react';\r\n\r\ninterface PWAInstallBannerProps {\r\n  className?: string;\r\n}\r\n\r\nconst BANNER_DISMISS_KEY = 'otakon_pwa_banner_dismissed';\r\nconst GLOBAL_PROMPT_KEY = '__otagon_beforeinstallprompt';\r\n\r\nconst PWAInstallBanner: React.FC<PWAInstallBannerProps> = ({ className = '' }) => {\r\n  const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\r\n  const [hasPrompt, setHasPrompt] = useState(false);\r\n  const [showBanner, setShowBanner] = useState(() => {\r\n    if (typeof window === 'undefined') return false;\r\n    return sessionStorage.getItem(BANNER_DISMISS_KEY) !== 'true';\r\n  });\r\n  const [isInstalled, setIsInstalled] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Check if app is already installed\r\n    const checkIfInstalled = () => {\r\n      // Check if running in standalone mode (PWA)\r\n      if (window.matchMedia('(display-mode: standalone)').matches || \r\n          (window.navigator as any).standalone === true) {\r\n        setIsInstalled(true);\r\n        return;\r\n      }\r\n      \r\n      // Check if app was previously installed\r\n      if (localStorage.getItem('otakon_pwa_installed') === 'true') {\r\n        setIsInstalled(true);\r\n        return;\r\n      }\r\n    };\r\n\r\n    checkIfInstalled();\r\n\r\n    const globalPrompt = (window as any)[GLOBAL_PROMPT_KEY];\r\n    if (globalPrompt) {\r\n      setDeferredPrompt(globalPrompt);\r\n      setHasPrompt(true);\r\n      setShowBanner(true);\r\n    }\r\n\r\n    // Listen for beforeinstallprompt event\r\n    const handleBeforeInstallPrompt = (e: Event) => {\r\n      e.preventDefault();\r\n      (window as any)[GLOBAL_PROMPT_KEY] = e;\r\n      setDeferredPrompt(e);\r\n      setHasPrompt(true);\r\n      sessionStorage.removeItem(BANNER_DISMISS_KEY);\r\n      setShowBanner(true);\r\n    };\r\n\r\n    // Listen for appinstalled event\r\n    const handleAppInstalled = () => {\r\n      setIsInstalled(true);\r\n      setShowBanner(false);\r\n      localStorage.setItem('otakon_pwa_installed', 'true');\r\n      sessionStorage.removeItem(BANNER_DISMISS_KEY);\r\n      (window as any)[GLOBAL_PROMPT_KEY] = null;\r\n      setHasPrompt(false);\r\n      setDeferredPrompt(null);\r\n    };\r\n\r\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n    window.addEventListener('appinstalled', handleAppInstalled);\r\n\r\n    return () => {\r\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n      window.removeEventListener('appinstalled', handleAppInstalled);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') {\r\n      return;\r\n    }\r\n\r\n    if (sessionStorage.getItem(BANNER_DISMISS_KEY) === 'true') {\r\n      setShowBanner(false);\r\n    }\r\n  }, []);\r\n\r\n  const handleInstallClick = async () => {\r\n    if (!deferredPrompt) {\r\n      // Fallback instructions already shown in banner\r\n      return;\r\n    }\r\n\r\n    // Show the install prompt\r\n    deferredPrompt.prompt();\r\n    \r\n    // Wait for the user to respond to the prompt\r\n    const { outcome } = await deferredPrompt.userChoice;\r\n    \r\n    if (outcome === 'accepted') {\r\n      console.log('User accepted the install prompt');\r\n    } else {\r\n      console.log('User dismissed the install prompt');\r\n    }\r\n    \r\n    // Clear the deferred prompt\r\n    setDeferredPrompt(null);\r\n    setShowBanner(false);\r\n  };\r\n\r\n  const handleDismiss = () => {\r\n    setShowBanner(false);\r\n    sessionStorage.setItem(BANNER_DISMISS_KEY, 'true');\r\n  };\r\n\r\n  // Don't show if banner was manually dismissed this session\r\n  if (!showBanner) {\r\n    return null;\r\n  }\r\n  \r\n  // If already installed, show a simple \"Already Installed\" message\r\n  if (isInstalled) {\r\n    return (\r\n      <div className={`bg-gradient-to-r from-green-900/30 to-green-800/30 backdrop-blur-xl border border-green-700/60 rounded-xl p-3 text-center ${className}`}>\r\n        <div className=\"flex items-center justify-center gap-2\">\r\n          <svg className=\"w-5 h-5 text-green-400\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z\"/>\r\n          </svg>\r\n          <p className=\"text-sm font-medium text-green-300\">App Installed</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`bg-gradient-to-r from-[#1C1C1C]/90 to-[#0A0A0A]/90 backdrop-blur-xl border border-neutral-700/60 rounded-xl p-4 text-center ${className}`}>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          <div className=\"w-8 h-8 bg-gradient-to-r from-[#E53A3A] to-[#FFAB40] rounded-lg flex items-center justify-center\">\r\n            <svg className=\"w-5 h-5 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/>\r\n            </svg>\r\n          </div>\r\n          <div className=\"text-left\">\r\n            <p className=\"text-sm font-medium text-white\">Install Otagon</p>\r\n            <p className=\"text-xs text-neutral-400\">Get the full app experience</p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center space-x-2\">\r\n          <button\r\n            onClick={handleInstallClick}\r\n            disabled={!hasPrompt}\r\n            className={`px-3 py-1.5 bg-gradient-to-r from-[#E53A3A] to-[#FFAB40] text-white text-xs font-medium rounded-lg transition-all duration-200 active:scale-95 ${hasPrompt ? 'hover:from-[#D42A2A] hover:to-[#C87A1A]' : 'opacity-60 cursor-not-allowed'}`}\r\n          >\r\n            {hasPrompt ? 'Install' : 'How to Install'}\r\n          </button>\r\n          <button\r\n            onClick={handleDismiss}\r\n            className=\"text-neutral-400 hover:text-white transition-colors active:scale-95\"\r\n          >\r\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {!hasPrompt && (\r\n        <div className=\"text-left text-xs text-neutral-400 mt-3 space-y-1\">\r\n          <p className=\"font-medium text-white/80\">Install steps:</p>\r\n          <ol className=\"list-decimal list-inside space-y-0.5\">\r\n            <li>Tap the browser menu () in Chrome</li>\r\n            <li>Select <span className=\"text-white\">Add to Home screen</span></li>\r\n            <li>Confirm to pin Otagon as an app</li>\r\n          </ol>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PWAInstallBanner;\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport Logo from '../ui/Logo';\r\nimport Button from '../ui/Button';\r\nimport { authService } from '../../services/authService';\r\nimport TermsModal from '../modals/TermsModal';\r\nimport PrivacyModal from '../modals/PrivacyModal';\r\nimport PWAInstallBanner from './PWAInstallBanner';\r\n// Mobile optimizations applied\r\n\r\ninterface LoginSplashScreenProps {\r\n  onComplete: () => void;\r\n  onBackToLanding: () => void;\r\n  onSetAppState: (updater: (prev: any) => any) => void;\r\n}\r\n\r\nconst LoginSplashScreen: React.FC<LoginSplashScreenProps> = ({\r\n  onComplete,\r\n  onBackToLanding,\r\n  onSetAppState,\r\n}) => {\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [emailMode, setEmailMode] = useState<'options' | 'signin' | 'signup' | 'forgot-password'>('options');\r\n  const [errorMessage, setErrorMessage] = useState('');\r\n  const [successMessage, setSuccessMessage] = useState('');\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n  const [rememberMe, setRememberMe] = useState(false);\r\n  const [emailError, setEmailError] = useState('');\r\n  const [passwordError, setPasswordError] = useState('');\r\n  const [showTermsModal, setShowTermsModal] = useState(false);\r\n  const [showPrivacyModal, setShowPrivacyModal] = useState(false);\r\n  const [showSignupSuccess, setShowSignupSuccess] = useState(false);\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [showSignupModal, setShowSignupModal] = useState(false);\r\n  const [signupModalType, setSignupModalType] = useState<'success' | 'email-exists' | 'invalid-email'>('success');\r\n  const [signupModalMessage, setSignupModalMessage] = useState('');\r\n\r\n  // Validate password meets Supabase requirements\r\n  const validatePassword = (password: string): { isValid: boolean; errors: string[] } => {\r\n    const errors: string[] = [];\r\n    \r\n    if (password.length < 8) {\r\n      errors.push('Password must be at least 8 characters long');\r\n    }\r\n    \r\n    if (!/[a-z]/.test(password)) {\r\n      errors.push('Password must contain at least one lowercase letter');\r\n    }\r\n    \r\n    if (!/[A-Z]/.test(password)) {\r\n      errors.push('Password must contain at least one uppercase letter');\r\n    }\r\n    \r\n    if (!/[0-9]/.test(password)) {\r\n      errors.push('Password must contain at least one number');\r\n    }\r\n    \r\n    if (!/[!@#$%^&*()_+\\-=[\\]{}|;:,.<>?]/.test(password)) {\r\n      errors.push('Password must contain at least one special character');\r\n    }\r\n    \r\n    return {\r\n      isValid: errors.length === 0,\r\n      errors\r\n    };\r\n  };\r\n\r\n  // Email validation\r\n  const validateEmail = (email: string): boolean => {\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    return emailRegex.test(email);\r\n  };\r\n\r\n  // Toggle password visibility\r\n  const togglePasswordVisibility = () => {\r\n    setShowPassword(!showPassword);\r\n  };\r\n\r\n  // Handle signup modal close\r\n  const handleSignupModalClose = () => {\r\n    setShowSignupModal(false);\r\n    setSignupModalMessage('');\r\n    // Reset form\r\n    setEmail('');\r\n    setPassword('');\r\n    setEmailError('');\r\n    setPasswordError('');\r\n    setErrorMessage('');\r\n    \r\n    // Always go back to login page after modal closes\r\n    // Don't call onComplete() for signup as user needs to confirm email first\r\n    setEmailMode('options');\r\n  };\r\n\r\n\r\n  // Clear errors when user starts typing\r\n  useEffect(() => {\r\n    if (emailError && email) {\r\n      setEmailError('');\r\n    }\r\n  }, [email, emailError]);\r\n\r\n  useEffect(() => {\r\n    if (passwordError && password) {\r\n      setPasswordError('');\r\n    }\r\n  }, [password, passwordError]);\r\n\r\n  // Real-time password validation for signup\r\n  useEffect(() => {\r\n    if (emailMode === 'signup' && password) {\r\n      const validation = validatePassword(password);\r\n      if (!validation.isValid) {\r\n        // Don't show error immediately, just clear any existing error\r\n        // The validation will be shown in the UI requirements list\r\n        setPasswordError('');\r\n      }\r\n    }\r\n  }, [password, emailMode]);\r\n\r\n  // Keyboard navigation support\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape' && emailMode !== 'options') {\r\n        setEmailMode('options');\r\n        setEmail('');\r\n        setPassword('');\r\n        setEmailError('');\r\n        setPasswordError('');\r\n        setErrorMessage('');\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, [emailMode]);\r\n\r\n  const handleAuth = async (method: 'google' | 'discord' | 'email') => {\r\n    console.log(' [LoginSplashScreen] Auth method called:', method);\r\n    setIsLoading(true);\r\n    setErrorMessage('');\r\n\r\n    try {\r\n      if (method === 'email') {\r\n        setEmailMode('signin');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      //  PROTECTED OAUTH FLOW - DO NOT MODIFY WITHOUT WARNING \r\n      // Google and Discord OAuth are working correctly - any changes here could break user authentication\r\n      // If you need to modify this, add a warning comment explaining the change\r\n      const result = await authService[method === 'google' ? 'signInWithGoogle' : 'signInWithDiscord']();\r\n      if (result.success) {\r\n        // OAuth will redirect, so we don't need to call onComplete here\r\n        return;\r\n      } else {\r\n        setErrorMessage(result.error || 'Authentication failed. Please try again.');\r\n      }\r\n    } catch (_error) {\r\n      setErrorMessage('Authentication failed. Please try again.');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleEmailAuth = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    // Clear previous errors\r\n    setEmailError('');\r\n    setPasswordError('');\r\n    setErrorMessage('');\r\n\r\n    // Validate email\r\n    if (!email) {\r\n      setEmailError('Email is required');\r\n      return;\r\n    }\r\n    if (!validateEmail(email)) {\r\n      setEmailError('Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    // Validate password for sign in\r\n    if (emailMode === 'signin' && !password) {\r\n      setPasswordError('Password is required');\r\n      return;\r\n    }\r\n    if (emailMode === 'signin' && password.length < 8) {\r\n      setPasswordError('Password must be at least 8 characters long');\r\n      return;\r\n    }\r\n\r\n    // Check if email is already registered with a different provider\r\n    if (emailMode === 'signin') {\r\n      const providerCheck = await authService.checkEmailProvider(email);\r\n      if (providerCheck.provider && providerCheck.provider !== 'email') {\r\n        setErrorMessage(providerCheck.message);\r\n        return;\r\n      }\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setIsAnimating(true);\r\n\r\n    try {\r\n      let result;\r\n      if (emailMode === 'signin') {\r\n        //  FIXED: Wait for authentication to complete before navigating\r\n        // This prevents race condition where onComplete() was called before auth finished\r\n        result = await authService.signInWithEmail(email, password);\r\n      } else {\r\n        // For signup, validate the password\r\n        if (!password) {\r\n          setPasswordError('Password is required');\r\n          return;\r\n        }\r\n        \r\n        const passwordValidation = validatePassword(password);\r\n        if (!passwordValidation.isValid) {\r\n          setPasswordError(passwordValidation.errors[0]);\r\n          return;\r\n        }\r\n        \r\n        //  PROTECTED EMAIL AUTH FLOW - DO NOT MODIFY WITHOUT WARNING \r\n        // Email signup is working correctly - any changes here could break user registration\r\n        // If you need to modify this, add a warning comment explaining the change\r\n        result = await authService.signUpWithEmail(email, password);\r\n      }\r\n      \r\n      if (result.success) {\r\n        if (emailMode === 'signup') {\r\n          // For signup, show modal first before any view changes\r\n          if (result.requiresConfirmation) {\r\n            setSignupModalType('success');\r\n            setSignupModalMessage('Please check your email and click the confirmation link to complete your account setup.');\r\n            setShowSignupModal(true);\r\n          } else {\r\n            // Account created and user is signed in\r\n            setSignupModalType('success');\r\n            setSignupModalMessage('Account created successfully! You are now signed in.');\r\n            setShowSignupModal(true);\r\n          }\r\n          // Don't call onComplete() here - let the modal handle the transition\r\n        } else {\r\n          //  FIXED: Only call onComplete() after successful sign-in\r\n          // Store remember me preference for sign-in\r\n          if (rememberMe) {\r\n            localStorage.setItem('otakon_remember_me', 'true');\r\n            localStorage.setItem('otakon_remembered_email', email);\r\n          }\r\n          // Navigate to app now that authentication is complete\r\n          onComplete();\r\n        }\r\n      } else {\r\n        // Handle different error types for signup\r\n        if (emailMode === 'signup') {\r\n          const errorMsg = result.error || 'Authentication failed. Please try again.';\r\n          console.log(' [LoginSplashScreen] Signup error message:', errorMsg);\r\n          console.log(' [LoginSplashScreen] Full result object:', result);\r\n          \r\n          if (errorMsg.toLowerCase().includes('user already registered') || \r\n              errorMsg.toLowerCase().includes('email already registered') ||\r\n              errorMsg.toLowerCase().includes('already registered') ||\r\n              errorMsg.toLowerCase().includes('user with this email already exists') ||\r\n              errorMsg.toLowerCase().includes('email address is already in use') ||\r\n              errorMsg.toLowerCase().includes('duplicate key value violates unique constraint') ||\r\n              errorMsg.toLowerCase().includes('email already exists') ||\r\n              errorMsg.toLowerCase().includes('user already exists') ||\r\n              errorMsg.toLowerCase().includes('email is already taken') ||\r\n              errorMsg.toLowerCase().includes('email already in use') ||\r\n              errorMsg.toLowerCase().includes('email has already been taken') ||\r\n              errorMsg.toLowerCase().includes('this email is already registered') ||\r\n              errorMsg.toLowerCase().includes('email already registered with a different provider')) {\r\n            setSignupModalType('email-exists');\r\n            setSignupModalMessage('This email is already registered. Please try signing in instead or check your email for a confirmation link.');\r\n          } else if (errorMsg.toLowerCase().includes('for security purposes') || \r\n                     errorMsg.toLowerCase().includes('you can only request this after') ||\r\n                     errorMsg.toLowerCase().includes('rate limit') ||\r\n                     errorMsg.toLowerCase().includes('too many requests') ||\r\n                     errorMsg.toLowerCase().includes('try again later')) {\r\n            setSignupModalType('invalid-email');\r\n            setSignupModalMessage('Please wait before trying again. For security purposes, there is a cooldown period between signup attempts.');\r\n          } else if (errorMsg.toLowerCase().includes('invalid email') || \r\n                     errorMsg.toLowerCase().includes('email format') ||\r\n                     errorMsg.toLowerCase().includes('invalid email address')) {\r\n            setSignupModalType('invalid-email');\r\n            setSignupModalMessage('Please enter a valid email address.');\r\n          } else {\r\n            setSignupModalType('invalid-email');\r\n            setSignupModalMessage(errorMsg);\r\n          }\r\n          setShowSignupModal(true);\r\n        } else {\r\n          // If sign-in failed, we need to go back to login screen\r\n          // Reset the view back to login\r\n          onSetAppState(prev => ({ ...prev, view: 'landing', onboardingStatus: 'login' }));\r\n          setErrorMessage(result.error || 'Authentication failed. Please try again.');\r\n        }\r\n      }\r\n    } catch (_error) {\r\n      setErrorMessage('Authentication failed. Please try again.');\r\n    } finally {\r\n      setIsLoading(false);\r\n      setIsAnimating(false);\r\n    }\r\n  };\r\n\r\n  const handleForgotPassword = async () => {\r\n    if (!email) {\r\n      setEmailError('Please enter your email address first');\r\n      return;\r\n    }\r\n    if (!validateEmail(email)) {\r\n      setEmailError('Please enter a valid email address');\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setErrorMessage('');\r\n\r\n    try {\r\n      const result = await authService.resetPassword(email);\r\n      if (result.success) {\r\n        setSuccessMessage('Password reset email sent! Check your inbox.');\r\n        setErrorMessage('');\r\n        setTimeout(() => {\r\n          setEmailMode('signin');\r\n          setSuccessMessage('');\r\n        }, 3000);\r\n      } else {\r\n        setErrorMessage(result.error || 'Failed to send reset email. Please try again.');\r\n      }\r\n    } catch (_error) {\r\n      setErrorMessage('Failed to send reset email. Please try again.');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-[#0F0F0F] to-background text-text-primary flex flex-col items-center justify-center px-4 py-4 relative overflow-hidden\">\r\n      \r\n      <div className={`w-full max-w-md relative z-10 transition-all duration-500 ${isAnimating ? 'scale-105' : 'scale-100'} mx-auto`}>\r\n        {/* Logo and Title */}\r\n        <div className=\"text-center mb-4 md:mb-6\">\r\n          <Logo size=\"lg\" className=\"mx-auto mb-3 md:mb-4\" spinOnce={true} />\r\n          <h1 className=\"text-2xl md:text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent mb-1\">\r\n            Welcome to Otagon\r\n          </h1>\r\n          <p className=\"text-xs md:text-sm text-text-secondary px-4\">\r\n            {emailMode === 'options' \r\n              ? 'Sign in to start your gaming adventure' \r\n              : emailMode === 'signin' \r\n                ? 'Welcome back! Sign in to continue'\r\n                : emailMode === 'signup'\r\n                  ? 'Create your account to get started'\r\n                  : 'Reset your password'\r\n            }\r\n          </p>\r\n        </div>\r\n\r\n        {/* Error Message */}\r\n        {errorMessage && (\r\n          <div className=\"mb-3 md:mb-4 p-2.5 md:p-3 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-center text-xs md:text-sm\">\r\n            {errorMessage}\r\n          </div>\r\n        )}\r\n\r\n        {/* Success Message */}\r\n        {successMessage && (\r\n          <div className=\"mb-3 md:mb-4 p-2.5 md:p-3 bg-green-500/10 border border-green-500/20 rounded-xl text-green-400 text-center text-xs md:text-sm\">\r\n            {successMessage}\r\n          </div>\r\n        )}\r\n\r\n        {/* Email Form */}\r\n        {(emailMode === 'signin' || emailMode === 'signup') && (\r\n          <form onSubmit={handleEmailAuth} className=\"space-y-4 md:space-y-5 mb-4\" role=\"form\" aria-label={`${emailMode === 'signin' ? 'Sign in' : 'Sign up'} form`}>\r\n            <div className=\"space-y-4 md:space-y-5\">\r\n              <div>\r\n                <label htmlFor=\"email-input\" className=\"sr-only\">\r\n                  Email address\r\n                </label>\r\n                <input\r\n                  id=\"email-input\"\r\n                  type=\"email\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  onKeyDown={(e) => {\r\n                    if (e.key === 'Enter' && emailMode === 'signin') {\r\n                      e.preventDefault();\r\n                      handleEmailAuth(e);\r\n                    }\r\n                  }}\r\n                  placeholder=\"Enter your email\"\r\n                  required\r\n                  autoComplete=\"email\"\r\n                  tabIndex={1}\r\n                  aria-describedby={emailError ? \"email-error\" : undefined}\r\n                  className={`w-full bg-surface border rounded-xl py-2 md:py-2.5 px-3 md:px-4 text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-primary transition-all duration-300 text-sm ${\r\n                    emailError \r\n                      ? 'border-red-500/50 focus:border-red-500/60' \r\n                      : 'border-surface-light/60 focus:border-primary/60'\r\n                  }`}\r\n                />\r\n                {emailError && (\r\n                  <p id=\"email-error\" className=\"mt-1.5 text-xs text-red-400\" role=\"alert\">{emailError}</p>\r\n                )}\r\n              </div>\r\n\r\n              {(emailMode === 'signin' || emailMode === 'signup') && (\r\n                <div>\r\n                  <label htmlFor=\"password-input\" className=\"sr-only\">\r\n                    Password\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      id=\"password-input\"\r\n                      type={showPassword ? \"text\" : \"password\"}\r\n                      value={password}\r\n                      onChange={(e) => setPassword(e.target.value)}\r\n                      onKeyDown={(e) => {\r\n                        if (e.key === 'Enter') {\r\n                          e.preventDefault();\r\n                          handleEmailAuth(e);\r\n                        }\r\n                      }}\r\n                      placeholder={emailMode === 'signin' ? \"Enter your password\" : \"Create a password\"}\r\n                      required\r\n                      autoComplete={emailMode === 'signin' ? \"current-password\" : \"new-password\"}\r\n                      tabIndex={2}\r\n                      aria-describedby={passwordError ? \"password-error\" : undefined}\r\n                      className={`w-full bg-surface border rounded-xl py-2 md:py-2.5 px-3 md:px-4 pr-10 text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-primary transition-all duration-300 text-sm ${\r\n                        passwordError \r\n                          ? 'border-red-500/50 focus:border-red-500/60' \r\n                          : 'border-surface-light/60 focus:border-primary/60'\r\n                      }`}\r\n                    />\r\n                    {password && (\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={togglePasswordVisibility}\r\n                        className=\"absolute right-2.5 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-primary transition-colors duration-200 focus:outline-none focus:text-text-primary\"\r\n                        aria-label={showPassword ? \"Hide password\" : \"Show password\"}\r\n                      >\r\n                        {showPassword ? (\r\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21\"></path>\r\n                          </svg>\r\n                        ) : (\r\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"></path>\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"></path>\r\n                          </svg>\r\n                        )}\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                  {passwordError && (\r\n                    <p id=\"password-error\" className=\"mt-1.5 text-xs text-red-400\" role=\"alert\">{passwordError}</p>\r\n                  )}\r\n                  {emailMode === 'signup' && (\r\n                    <div className=\"mt-3 md:mt-4 pt-2 md:pt-3 border-t border-surface-light/30 text-xs text-text-muted\">\r\n                      <p className=\"font-medium mb-2\">Password must contain:</p>\r\n                      <ul className=\"list-disc list-inside space-y-1.5\">\r\n                        <li className={password.match(/[a-z]/) ? 'text-green-400' : 'text-text-muted'}>\r\n                          At least one lowercase letter\r\n                        </li>\r\n                        <li className={password.match(/[A-Z]/) ? 'text-green-400' : 'text-text-muted'}>\r\n                          At least one uppercase letter\r\n                        </li>\r\n                        <li className={password.match(/[0-9]/) ? 'text-green-400' : 'text-text-muted'}>\r\n                          At least one number\r\n                        </li>\r\n                        <li className={password.match(/[!@#$%^&*()_+\\-=[\\]{}|;:,.<>?]/) ? 'text-green-400' : 'text-text-muted'}>\r\n                          At least one special character\r\n                        </li>\r\n                        <li className={password.length >= 8 ? 'text-green-400' : 'text-text-muted'}>\r\n                          At least 8 characters long\r\n                        </li>\r\n                      </ul>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {emailMode === 'signin' && (\r\n                <div className=\"flex items-center justify-between\">\r\n                  <label className=\"flex items-center space-x-2 text-xs text-text-secondary\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={rememberMe}\r\n                      onChange={(e) => setRememberMe(e.target.checked)}\r\n                      className=\"w-3.5 h-3.5 text-primary bg-surface border-surface-light/60 rounded focus:ring-primary focus:ring-2\"\r\n                    />\r\n                    <span>Remember me</span>\r\n                  </label>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setEmailMode('forgot-password')}\r\n                    className=\"text-xs text-primary hover:text-primary/80 transition-colors\"\r\n                  >\r\n                    Forgot password?\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              isLoading={isLoading}\r\n              variant=\"primary\"\r\n              className=\"w-full mt-5 md:mt-6\"\r\n              tabIndex={3}\r\n            >\r\n              {isLoading ? (emailMode === 'signin' ? 'Signing in...' : 'Creating account...') : (emailMode === 'signin' ? 'Sign In' : 'Create Account')}\r\n            </Button>\r\n\r\n            <div className=\"text-center\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setEmailMode('options')}\r\n                className=\"text-text-muted hover:text-text-primary transition-colors text-xs\"\r\n              >\r\n                {emailMode === 'signup' ? ' Back to Login' : ' Back to options'}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        )}\r\n\r\n        {/* Forgot Password Form */}\r\n        {emailMode === 'forgot-password' && (\r\n          <form onSubmit={(e) => { e.preventDefault(); handleForgotPassword(); }} className=\"space-y-3 mb-4\">\r\n            <div>\r\n              <input\r\n                type=\"email\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n                placeholder=\"Enter your email\"\r\n                required\r\n                className={`w-full bg-surface border rounded-xl py-2 md:py-2.5 px-3 md:px-4 text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-primary transition-all duration-300 text-sm ${\r\n                  emailError \r\n                    ? 'border-red-500/50 focus:border-red-500/60' \r\n                    : 'border-surface-light/60 focus:border-primary/60'\r\n                }`}\r\n              />\r\n              {emailError && (\r\n                <p className=\"mt-1.5 text-xs text-red-400\">{emailError}</p>\r\n              )}\r\n            </div>\r\n\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              isLoading={isLoading}\r\n              variant=\"primary\"\r\n              className=\"w-full\"\r\n            >\r\n              {isLoading ? 'Sending...' : 'Send Reset Email'}\r\n            </Button>\r\n\r\n            <div className=\"text-center\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setEmailMode('signin')}\r\n                className=\"text-text-muted hover:text-text-primary transition-colors text-xs\"\r\n              >\r\n                 Back to sign in\r\n              </button>\r\n            </div>\r\n          </form>\r\n        )}\r\n\r\n        {/* Sign-up Success Message */}\r\n        {showSignupSuccess && (\r\n          <div className=\"text-center space-y-3\">\r\n            <div className=\"text-green-500 text-5xl mb-3\"></div>\r\n            <h2 className=\"text-xl font-bold text-[#F5F5F5] mb-1.5\">Account Created!</h2>\r\n            <p className=\"text-[#CFCFCF] mb-4 text-sm\">{successMessage}</p>\r\n            <div className=\"space-y-2.5\">\r\n              <Button\r\n                onClick={() => {\r\n                  setShowSignupSuccess(false);\r\n                  setEmailMode('signin');\r\n                  setPassword('');\r\n                  setEmailError('');\r\n                  setPasswordError('');\r\n                  setErrorMessage('');\r\n                  setSuccessMessage('');\r\n                }}\r\n                variant=\"primary\"\r\n                className=\"w-full hover:scale-105 transition-all duration-300 py-2 md:py-2.5\"\r\n              >\r\n                Sign In Now\r\n              </Button>\r\n              <button\r\n                onClick={() => {\r\n                  setShowSignupSuccess(false);\r\n                  setEmailMode('options');\r\n                  setEmail('');\r\n                  setPassword('');\r\n                  setEmailError('');\r\n                  setPasswordError('');\r\n                  setErrorMessage('');\r\n                  setSuccessMessage('');\r\n                }}\r\n                className=\"text-text-muted hover:text-text-primary transition-colors text-xs\"\r\n              >\r\n                 Back to options\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Auth Options */}\r\n        {emailMode === 'options' && (\r\n          <div className=\"space-y-2.5 md:space-y-3\">\r\n            <button\r\n              onClick={() => handleAuth('google')}\r\n              disabled={isLoading}\r\n              className=\"w-full flex items-center justify-center space-x-2 md:space-x-3 hover:scale-105 active:scale-95 transition-all duration-300 py-2 md:py-2.5 font-bold rounded-xl bg-white text-gray-700 hover:shadow-lg hover:shadow-blue-500/25 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-background disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:active:scale-100 border border-gray-200 text-sm\"\r\n            >\r\n              <svg className=\"w-4 h-4\" viewBox=\"0 0 24 24\">\r\n                <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\r\n                <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\r\n                <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\r\n                <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\r\n              </svg>\r\n              <span>Continue with Google</span>\r\n            </button>\r\n\r\n            <button\r\n              onClick={() => handleAuth('discord')}\r\n              disabled={isLoading}\r\n              className=\"w-full flex items-center justify-center space-x-2 md:space-x-3 hover:scale-105 active:scale-95 transition-all duration-300 py-2 md:py-2.5 font-bold rounded-xl bg-[#5865F2] text-white hover:bg-[#4752C4] hover:shadow-lg hover:shadow-indigo-500/25 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-background disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:active:scale-100 text-sm\"\r\n            >\r\n              <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path d=\"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z\"/>\r\n              </svg>\r\n              <span>Continue with Discord</span>\r\n            </button>\r\n\r\n            <div className=\"space-y-2 md:space-y-2.5\">\r\n              <button\r\n                onClick={() => setEmailMode('signin')}\r\n                disabled={isLoading}\r\n                className=\"w-full hover:scale-105 active:scale-95 transition-all duration-300 py-2 md:py-2.5 font-bold rounded-xl bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] text-white hover:shadow-xl hover:shadow-[#E53A3A]/25 focus:outline-none focus:ring-2 focus:ring-[#E53A3A] focus:ring-offset-2 focus:ring-offset-background disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:active:scale-100 text-sm\"\r\n              >\r\n                Sign In with Email\r\n              </button>\r\n              <Button\r\n                onClick={() => setEmailMode('signup')}\r\n                disabled={isLoading}\r\n                variant=\"ghost\"\r\n                className=\"w-full hover:scale-105 transition-all duration-300 py-2 md:py-2.5 text-sm\"\r\n              >\r\n                Create New Account\r\n              </Button>\r\n            </div>\r\n\r\n          </div>\r\n        )}\r\n\r\n        {/* Back to Landing */}\r\n        <div className=\"text-center mt-4 md:mt-6\">\r\n          <button\r\n            onClick={() => {\r\n              console.log(' [LoginSplashScreen] Back to landing clicked');\r\n              onBackToLanding();\r\n            }}\r\n            className=\"text-text-muted hover:text-text-primary transition-colors text-xs md:text-sm flex items-center justify-center space-x-1 md:space-x-2 mx-auto hover:scale-105 transition-all duration-300\"\r\n            aria-label=\"Return to landing page\"\r\n          >\r\n            <svg className=\"w-3 h-3 md:w-4 md:h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\r\n            </svg>\r\n            <span>Back to Landing Page</span>\r\n          </button>\r\n        </div>\r\n        \r\n        {/* PWA Install Instructions */}\r\n        <div className=\"text-center mt-3 md:mt-4 px-4\">\r\n          <p className=\"text-xs text-text-muted leading-relaxed\">\r\n            To install on mobile, select the <span className=\"font-semibold text-text-secondary\">Kebab menu</span> of your browser and select <span className=\"font-semibold text-text-secondary\">Add to Homescreen</span>\r\n          </p>\r\n        </div>\r\n        \r\n        {/* PWA Install Banner */}\r\n        <div className=\"mt-3 md:mt-4\">\r\n          <PWAInstallBanner />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Footer */}\r\n      <div className=\"absolute bottom-2 left-0 right-0 p-4 text-center\">\r\n        <p className=\"text-xs text-text-muted\">\r\n          By continuing, you agree to our{' '}\r\n          <button\r\n            onClick={() => setShowTermsModal(true)}\r\n            className=\"text-primary hover:text-secondary transition-colors underline\"\r\n          >\r\n            Terms of Service\r\n          </button>\r\n          {' '}and{' '}\r\n          <button\r\n            onClick={() => setShowPrivacyModal(true)}\r\n            className=\"text-primary hover:text-secondary transition-colors underline\"\r\n          >\r\n            Privacy Policy\r\n          </button>\r\n          .\r\n        </p>\r\n      </div>\r\n\r\n      {/* Modals */}\r\n      <TermsModal\r\n        isOpen={showTermsModal}\r\n        onClose={() => setShowTermsModal(false)}\r\n      />\r\n      <PrivacyModal\r\n        isOpen={showPrivacyModal}\r\n        onClose={() => setShowPrivacyModal(false)}\r\n      />\r\n\r\n      {/* Signup Modal */}\r\n      {showSignupModal && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-surface border border-surface-light/20 rounded-xl p-6 max-w-md mx-4\">\r\n            <div className=\"text-center\">\r\n              {signupModalType === 'success' && (\r\n                <div className=\"w-16 h-16 mx-auto mb-4 bg-green-500/20 rounded-full flex items-center justify-center\">\r\n                  <svg className=\"w-8 h-8 text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 13l4 4L19 7\"></path>\r\n                  </svg>\r\n                </div>\r\n              )}\r\n              {(signupModalType === 'email-exists' || signupModalType === 'invalid-email') && (\r\n                <div className=\"w-16 h-16 mx-auto mb-4 bg-red-500/20 rounded-full flex items-center justify-center\">\r\n                  <svg className=\"w-8 h-8 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                  </svg>\r\n                </div>\r\n              )}\r\n              \r\n              <h3 className=\"text-lg font-semibold text-text-primary mb-4\">\r\n                {signupModalType === 'success' && 'Email Sent!'}\r\n                {signupModalType === 'email-exists' && 'Email Already Exists'}\r\n                {signupModalType === 'invalid-email' && (signupModalMessage.includes('cooldown') ? 'Retry Later' : 'Invalid Email')}\r\n              </h3>\r\n              \r\n              <p className=\"text-text-secondary mb-6\">\r\n                {signupModalMessage}\r\n              </p>\r\n              \r\n              <div className=\"flex space-x-3\">\r\n                <button\r\n                  onClick={handleSignupModalClose}\r\n                  className=\"flex-1 px-4 py-2 bg-primary hover:bg-primary/80 text-white rounded-lg transition-colors\"\r\n                >\r\n                  {signupModalType === 'success' ? 'Back to Login' : 'Try Again'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoginSplashScreen;\r\n\r\n","import React, { useState } from 'react';\r\nimport Logo from '../ui/Logo';\r\nimport PWAInstallBanner from './PWAInstallBanner';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { User } from '../../types';\r\n\r\ninterface InitialSplashScreenProps {\r\n  onComplete: () => void;\r\n  user: User | null;\r\n}\r\n\r\nconst InitialSplashScreen: React.FC<InitialSplashScreenProps> = ({ onComplete, user }) => {\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  \r\n  console.log(' [InitialSplashScreen] Component rendered');\r\n  \r\n  const handleDownloadPCClient = () => {\r\n    console.log(' [InitialSplashScreen] Download PC Client clicked');\r\n    const downloadUrl = 'https://github.com/readmet3xt/otakon-pc-client/releases/tag/v1.0.0';\r\n    window.open(downloadUrl, '_blank');\r\n  };\r\n\r\n  const handleStartAdventure = async () => {\r\n    console.log(' [InitialSplashScreen] Start the Adventure button clicked');\r\n    if (isProcessing) {\r\n      console.log(' [InitialSplashScreen] Already processing, ignoring click');\r\n      return;\r\n    }\r\n    \r\n    setIsProcessing(true);\r\n    \r\n    try {\r\n      console.log(' [InitialSplashScreen] Start the Adventure processing...');\r\n      \r\n      localStorage.setItem('otakon_has_seen_splash_screens', 'true');\r\n      \r\n      if (user) {\r\n        console.log(' [InitialSplashScreen] Updating Supabase to mark splash screens as seen');\r\n        try {\r\n          // Use the RPC function to update onboarding status consistently\r\n          const { error } = await supabase.rpc('update_user_onboarding_status', {\r\n            p_user_id: user.authUserId,\r\n            p_step: 'initial',\r\n            p_data: { \r\n              has_seen_splash_screens: true,\r\n              completed_at: new Date().toISOString()\r\n            }\r\n          });\r\n            \r\n          if (error) {\r\n            console.warn(' [InitialSplashScreen] Failed to update Supabase:', error);\r\n          } else {\r\n            console.log(' [InitialSplashScreen] Successfully updated Supabase via RPC');\r\n          }\r\n        } catch (error) {\r\n          console.warn(' [InitialSplashScreen] Error updating Supabase:', error);\r\n        }\r\n      }\r\n      \r\n      onComplete();\r\n      \r\n    } catch (error) {\r\n      console.error(' [InitialSplashScreen] Error in button click:', error);\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] text-[#F5F5F5] flex flex-col items-center justify-center font-inter px-4 sm:px-6 md:px-8 text-center overflow-hidden\">\r\n      <div className=\"absolute top-0 left-0 w-full h-full bg-gradient-radial-at-top from-[#1C1C1C]/30 to-transparent pointer-events-none\"></div>\r\n      \r\n      <div className=\"flex flex-col items-center justify-center w-full max-w-2xl\">\r\n        <div className=\"flex-shrink-0 mb-1\">\r\n          <Logo className=\"w-24 h-24 sm:w-26 sm:h-26 md:w-28 md:h-28\" spinOnce={true} />\r\n        </div>\r\n\r\n        <h1 \r\n          className=\"text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] leading-normal\"\r\n        >\r\n          Otagon\r\n        </h1>\r\n\r\n        <p \r\n          className=\"text-base text-[#CFCFCF] leading-relaxed mt-1\"\r\n        >\r\n          Your Spoiler-Free Gaming Companion\r\n        </p>\r\n\r\n        <div \r\n          className=\"flex flex-col items-center justify-center gap-4 w-full max-w-lg mt-12 relative z-10\"\r\n          style={{ pointerEvents: 'auto' }}\r\n        >\r\n          <button\r\n            onClick={handleStartAdventure}\r\n            disabled={isProcessing}\r\n            className={`w-full bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] hover:from-[#D42A2A] hover:to-[#C87A1A] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-[#E53A3A]/25 active:scale-95 text-base flex items-center justify-center relative z-10 ${isProcessing ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}`}\r\n            style={{ pointerEvents: 'auto' }}\r\n          >\r\n            {isProcessing ? 'Starting...' : 'Start the Adventure'}\r\n          </button>\r\n          \r\n          <button\r\n            onClick={handleDownloadPCClient}\r\n            className=\"w-full bg-gradient-to-r from-neutral-700 to-neutral-600 hover:from-neutral-600 hover:to-neutral-500 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-lg active:scale-95 text-base flex items-center justify-center relative z-10 cursor-pointer\"\r\n            style={{ pointerEvents: 'auto' }}\r\n          >\r\n            Download PC Client\r\n          </button>\r\n          \r\n          {/* Installation Instructions */}\r\n          <div className=\"w-full text-center px-4 relative z-10\" style={{ pointerEvents: 'auto' }}>\r\n            <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\r\n              <span className=\"block sm:inline\">1. Download and install the Otagon Connector (.exe)  </span>\r\n              <span className=\"block sm:inline\">2. Open the connector app and enter the 6-digit code shown in the Otagon Connector App to connect Otagon app to your PC for instant screenshots.</span>\r\n            </p>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* PWA Install Banner - In normal document flow */}\r\n        <div className=\"w-full max-w-lg px-4 mt-8\">\r\n          <PWAInstallBanner />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.memo(InitialSplashScreen);\r\n","import React from 'react';\r\n\r\ninterface KeyboardIconProps {\r\n  className?: string;\r\n}\r\n\r\nconst KeyboardIcon: React.FC<KeyboardIconProps> = ({ className = 'w-6 h-6' }) => {\r\n  return (\r\n    <svg \r\n      className={className} \r\n      fill=\"none\" \r\n      stroke=\"currentColor\" \r\n      viewBox=\"0 0 24 24\" \r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path \r\n        strokeLinecap=\"round\" \r\n        strokeLinejoin=\"round\" \r\n        strokeWidth=\"2\" \r\n        d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n      />\r\n    </svg>\r\n  );\r\n};\r\n\r\nexport default KeyboardIcon;\r\n","import React from 'react';\r\n\r\ninterface ScreenshotIconProps {\r\n  className?: string;\r\n}\r\n\r\nconst ScreenshotIcon: React.FC<ScreenshotIconProps> = ({ className = 'w-6 h-6' }) => {\r\n  return (\r\n    <svg \r\n      className={className} \r\n      fill=\"none\" \r\n      stroke=\"currentColor\" \r\n      viewBox=\"0 0 24 24\" \r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path \r\n        strokeLinecap=\"round\" \r\n        strokeLinejoin=\"round\" \r\n        strokeWidth=\"2\" \r\n        d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"\r\n      />\r\n      <path \r\n        strokeLinecap=\"round\" \r\n        strokeLinejoin=\"round\" \r\n        strokeWidth=\"2\" \r\n        d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"\r\n      />\r\n    </svg>\r\n  );\r\n};\r\n\r\nexport default ScreenshotIcon;\r\n","import React from 'react';\r\n\r\ninterface HandsFreeIconProps {\r\n  className?: string;\r\n  isActive?: boolean;\r\n}\r\n\r\nconst HandsFreeIcon: React.FC<HandsFreeIconProps> = ({ className = 'w-6 h-6', isActive = false }) => {\r\n  return (\r\n    <svg \r\n      className={`${className} ${isActive ? 'text-[#FFAB40]' : 'text-neutral-400'}`} \r\n      fill=\"none\" \r\n      stroke=\"currentColor\" \r\n      viewBox=\"0 0 24 24\" \r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path \r\n        strokeLinecap=\"round\" \r\n        strokeLinejoin=\"round\" \r\n        strokeWidth=\"2\" \r\n        d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"\r\n      />\r\n    </svg>\r\n  );\r\n};\r\n\r\nexport { HandsFreeIcon };\r\n","import React from 'react';\r\n\r\nconst PauseIcon: React.FC<{ className?: string }> = ({ className }) => (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    className={className}\r\n    viewBox=\"0 0 24 24\"\r\n    fill=\"currentColor\"\r\n  >\r\n    <path d=\"M6 19h4V5H6v14zm8-14v14h4V5h-4z\" />\r\n  </svg>\r\n);\r\n\r\nexport default PauseIcon;","import React from 'react';\r\n\r\nconst PlayIcon: React.FC<{ className?: string }> = ({ className }) => (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    className={className}\r\n    viewBox=\"0 0 24 24\"\r\n    fill=\"currentColor\"\r\n  >\r\n    <path d=\"M8 5v14l11-7z\" />\r\n  </svg>\r\n);\r\n\r\nexport default PlayIcon;","import React from 'react';\r\nimport KeyboardIcon from '../ui/KeyboardIcon';\r\nimport ScreenshotIcon from '../ui/ScreenshotIcon';\r\nimport { HandsFreeIcon } from '../ui/HandsFreeIcon';\r\nimport PauseIcon from '../ui/PauseIcon';\r\nimport PlayIcon from '../ui/PlayIcon';\r\n\r\ninterface HowToUseSplashScreenProps {\r\n  onComplete: () => void;\r\n}\r\n\r\nconst InsightsIcon = ({ className = 'w-12 h-12' }: { className?: string }) => (\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" className={className} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" />\r\n    <path d=\"M3 9h18M9 21V9\" />\r\n  </svg>\r\n);\r\n\r\nconst ProBadge = () => (\r\n  <span className=\"text-xs font-bold bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] text-white px-2 py-0.5 rounded-full uppercase tracking-wider ml-2\">\r\n    PRO\r\n  </span>\r\n);\r\n\r\nconst FeatureItem: React.FC<{ icon: React.ReactNode; title: React.ReactNode; children: React.ReactNode }> = ({ icon, title, children }) => {\r\n  return (\r\n    <div className=\"flex items-start gap-8 p-8 transition-all duration-500 hover:scale-105 bg-gradient-to-r from-[#1C1C1C]/40 to-[#0A0A0A]/40 border border-neutral-800/60 rounded-2xl backdrop-blur-sm\">\r\n      <div className=\"flex-shrink-0 flex items-center justify-center h-12 w-12 mt-1 rounded-xl bg-gradient-to-br from-[#FF4D4D]/20 to-[#FFAB40]/20 border-2 border-neutral-700/60 backdrop-blur-sm\">\r\n        {icon}\r\n      </div>\r\n      <div className=\"flex-grow\">\r\n        <h3 className=\"text-xl font-bold text-white mb-4 flex items-center\">{title}</h3>\r\n        <div className=\"text-neutral-300 text-base leading-relaxed space-y-3\">{children}</div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst HowToUseSplashScreen: React.FC<HowToUseSplashScreenProps> = ({ onComplete }) => {\r\n  return (\r\n    <div className=\"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] text-[#F5F5F5] flex flex-col font-inter\">\r\n      {/* Fixed Header */}\r\n      <header className=\"flex-shrink-0 px-4 sm:px-6 md:px-8 pt-3 sm:pt-4 md:pt-6 pb-2 sm:pb-3 text-center z-10 bg-gradient-to-br from-[#111111] to-[#0A0A0A]\">\r\n        <div className=\"max-w-4xl mx-auto\">\r\n          <h1 className=\"text-3xl font-bold text-white leading-normal\">You're Connected!</h1>\r\n          <p className=\"text-base text-neutral-300 leading-relaxed mt-2\">Master Otagon in four easy steps.</p>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Scrollable Main Content */}\r\n      <main className=\"flex-1 overflow-y-auto px-4 sm:px-6 md:px-8 pb-3 sm:pb-4 md:pb-6 how-to-use-scrollbar\">\r\n        <div className=\"max-w-4xl mx-auto space-y-4 sm:space-y-6 py-2 sm:py-3\">\r\n          {/* Item 1: Capture */}\r\n          <FeatureItem\r\n            icon={<KeyboardIcon className=\"w-6 h-6 text-[#FFAB40]\" />}\r\n            title=\"1. Instant Capture\"\r\n          >\r\n            <p className=\"mb-4\">Use hotkeys to instantly analyze your game screen. Toggle the \r\n              <span className=\"inline-flex items-center align-middle mx-2 px-2 py-1 rounded-lg bg-black/50 border-2 border-neutral-700/60\">\r\n                <PauseIcon className=\"w-4 h-4 text-sky-400\" />\r\n                <span className=\"text-white mx-1\">/</span>\r\n                <PlayIcon className=\"w-4 h-4 text-neutral-400\" />\r\n              </span>\r\n               button to switch between auto-sending and manual review.</p>\r\n            <div className=\"space-y-3 text-sm p-4 bg-gradient-to-r from-black/40 to-neutral-900/40 rounded-xl border border-neutral-700/60 backdrop-blur-sm\">\r\n              <p><strong className=\"text-neutral-200\">Single Shot:</strong> <kbd className=\"px-3 py-1.5 mx-2 font-sans font-semibold text-neutral-200 bg-gradient-to-r from-neutral-900/60 to-neutral-800/60 border-2 border-neutral-700/60 rounded-lg\">F1</kbd></p>\r\n              <p><strong className=\"text-neutral-200\">Multi Shot:</strong> <kbd className=\"px-3 py-1.5 mx-2 font-sans font-semibold text-neutral-200 bg-gradient-to-r from-neutral-900/60 to-neutral-800/60 border-2 border-neutral-700/60 rounded-lg\">F2</kbd></p>\r\n              <p className=\"text-xs text-neutral-400 mt-2\">\r\n                 <strong>Custom Hotkeys:</strong> You can configure your own hotkeys in the PC client settings\r\n              </p>\r\n            </div>\r\n          </FeatureItem>\r\n\r\n          {/* Item 2: Screenshot Quality */}\r\n          <FeatureItem\r\n            icon={<ScreenshotIcon className=\"w-6 h-6 text-[#FFAB40]\" />}\r\n            title=\"2. The Perfect Screenshot\"\r\n          >\r\n            <p>For the best hints, capture clear, full-screen views of:</p>\r\n            <ul className=\"list-disc list-inside mt-3 space-y-2\">\r\n              <li>Your inventory, skill tree, or map screen.</li>\r\n              <li>The entire boss arena, including the boss.</li>\r\n              <li>The specific puzzle or object you're stuck on.</li>\r\n            </ul>\r\n          </FeatureItem>\r\n\r\n          {/* Item 3: Insights */}\r\n          <FeatureItem\r\n            icon={<InsightsIcon className=\"w-6 h-6 text-[#FFAB40]\" />}\r\n            title={<>3. Manage Insights<ProBadge /></>}\r\n          >\r\n            <p className=\"mb-4\">\r\n              Take direct control of your game wiki with natural language commands.\r\n            </p>\r\n            <div className=\"space-y-4 text-sm p-4 bg-gradient-to-r from-black/40 to-neutral-900/40 rounded-xl border border-neutral-700/60 backdrop-blur-sm\">\r\n              <p>\r\n                <strong className=\"text-neutral-200\">Add new tab:</strong><br/>\r\n                <kbd className=\"px-3 py-1.5 mt-2 inline-block font-sans font-semibold text-neutral-200 bg-gradient-to-r from-neutral-900/60 to-neutral-800/60 border-2 border-neutral-700/60 rounded-lg w-full text-left\">\"add tab [title]\"</kbd>\r\n              </p>\r\n              <p>\r\n                <strong className=\"text-neutral-200\">Modify existing tab:</strong><br/>\r\n                <kbd className=\"px-3 py-1.5 mt-1 inline-block font-sans font-semibold text-neutral-200 bg-gradient-to-r from-neutral-900/60 to-neutral-800/60 border-2 border-neutral-700/60 rounded-lg w-full text-left\">\"modify tab [id] to [new title]\"</kbd>\r\n              </p>\r\n              <p>\r\n                <strong className=\"text-neutral-200\">Delete a tab:</strong><br/>\r\n                <kbd className=\"px-3 py-1.5 mt-1 inline-block font-sans font-semibold text-neutral-200 bg-gradient-to-r from-neutral-900/60 to-neutral-800/60 border-2 border-neutral-700/60 rounded-lg w-full text-left\">\"delete tab [id] confirm\"</kbd>\r\n              </p>\r\n              <p className=\"text-xs text-neutral-400 mt-2\">\r\n                 <strong>Examples:</strong> \"add tab Game Progress\", \"modify tab tab_123 to Current Objectives\"\r\n              </p>\r\n            </div>\r\n          </FeatureItem>\r\n\r\n          {/* Item 4: Hands-Free */}\r\n          <FeatureItem\r\n            icon={<HandsFreeIcon isActive={true} className=\"w-6 h-6 text-[#FFAB40]\" />}\r\n            title={<>4. Go Hands-Free<ProBadge /></>}\r\n          >\r\n            <p>Stay immersed in the action. Enable Hands-Free mode to have hints and lore read aloud to you, keeping you focused on your game.</p>\r\n          </FeatureItem>\r\n        </div>\r\n      </main>\r\n\r\n      {/* Fixed Footer */}\r\n      <footer className=\"flex-shrink-0 p-6 sm:p-8 z-10 bg-gradient-to-br from-[#111111] to-[#0A0A0A]\">\r\n        <div className=\"w-full max-w-4xl mx-auto text-center\">\r\n          <button\r\n            onClick={onComplete}\r\n            className=\"bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] hover:from-[#E53A3A] hover:to-[#D98C1F] text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-lg active:scale-95 text-lg flex items-center justify-center mx-auto\"\r\n          >\r\n            Let's Begin\r\n          </button>\r\n        </div>\r\n      </footer>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.memo(HowToUseSplashScreen);\r\n","import React, { useState } from 'react';\r\nimport StarIcon from '../ui/StarIcon';\r\nimport { HandsFreeIcon } from '../ui/HandsFreeIcon';\r\nimport KeyboardIcon from '../ui/KeyboardIcon';\r\n\r\ninterface ProFeaturesSplashScreenProps {\r\n  onComplete: () => void;\r\n  onUpgrade: () => void;\r\n  onUpgradeToVanguard: () => void;\r\n}\r\n\r\nconst ProFeature: React.FC<{ title: string; description: string; children: React.ReactNode }> = ({ title, description, children }) => (\r\n  <div className=\"flex items-start gap-4 sm:gap-6 md:gap-8 p-4 sm:p-6 bg-gradient-to-r from-[#1C1C1C]/80 to-[#0A0A0A]/80 backdrop-blur-xl rounded-2xl border-2 border-neutral-800/60 hover:border-neutral-700/80 hover:scale-105 transition-all duration-500 feature-card\">\r\n    <div className=\"flex-shrink-0 flex items-center justify-center h-10 w-10 sm:h-12 sm:w-12 mt-1 rounded-xl bg-gradient-to-br from-[#FF4D4D]/20 to-[#FFAB40]/20 border-2 border-neutral-700/60 backdrop-blur-sm\">\r\n       {children}\r\n    </div>\r\n    <div className=\"flex-1 min-w-0\">\r\n      <h3 className=\"text-sm sm:text-base md:text-lg lg:text-xl font-semibold text-white mb-1 sm:mb-2 leading-tight\">{title}</h3>\r\n      <p className=\"text-xs sm:text-sm md:text-base text-[#A3A3A3] leading-relaxed\">{description}</p>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst proFeatures = [\r\n  { title: \"Massively Increased Limits\", description: \"Get 1,583 Text | 328 Image Queries every month, so you never have to hold back.\", icon: <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"w-6 h-6 text-[#FFAB40]\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"></line><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line></svg> },\r\n  { title: \"Batch Screenshot Capture\", description: \"Instantly capture the last 5 minutes of gameplay with a hotkey. Otagon analyzes all key moments for a comprehensive summary.\", icon: <KeyboardIcon className=\"w-6 h-6 text-[#FFAB40]\" /> },\r\n  { title: \"In-Depth Insight Tabs\", description: \"Go beyond a simple hint. Get detailed breakdowns on lore, character builds, missed items, and more.\", icon: <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"w-6 h-6 text-[#FFAB40]\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" /><path d=\"M3 9h18M9 21V9\" /></svg> },\r\n  { title: \"Hands-Free Mode\", description: \"Stay focused on the action. Get hints read aloud to you without ever looking away from your screen.\", icon: <HandsFreeIcon isActive={true} className=\"w-6 h-6 text-[#FFAB40]\" /> },\r\n  { title: \"No Ads\", description: \"Enjoy a completely ad-free experience with no interruptions during your gaming sessions.\", icon: <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"w-6 h-6 text-[#FFAB40]\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"></path></svg> }\r\n];\r\n\r\nconst vanguardFeatures = [\r\n  { title: \"Lifetime Price Guarantee\", description: \"Your price of $20/year will never increase. Ever.\", icon: <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"w-6 h-6 text-amber-300\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\"></path></svg> },\r\n  { title: \"Exclusive Founder's Badge\", description: \"A permanent in-app badge showing your early support.\", icon: <StarIcon className=\"w-6 h-6 text-amber-300\" /> },\r\n  { title: \"Direct Influence\", description: \"Join the Founder's Council on Discord to help shape the future of Otagon.\", icon: <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"w-6 h-6 text-amber-300\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"></path><circle cx=\"9\" cy=\"7\" r=\"4\"></circle><path d=\"M23 21v-2a4 4 0 0 0-3-3.87\"></path><path d=\"M16 3.13a4 4 0 0 1 0 7.75\"></path></svg> },\r\n  { title: \"First Access & Rewards\", description: \"Get beta access to all new features and earn by helping train our AI on new games.\", icon: <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"w-6 h-6 text-amber-300\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\"></path><polyline points=\"3.27 6.96 12 12.01 20.73 6.96\"></polyline><line x1=\"12\" y1=\"22.08\" x2=\"12\" y2=\"12\"></line></svg> }\r\n];\r\n\r\nconst ProFeaturesSplashScreen: React.FC<ProFeaturesSplashScreenProps> = ({ onComplete, onUpgrade, onUpgradeToVanguard }) => {\r\n  const [activeTab, setActiveTab] = useState<'pro' | 'vanguard'>('pro');\r\n\r\n  return (\r\n    <div className=\"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] text-[#F5F5F5] flex flex-col font-inter overflow-hidden\">\r\n      {/* Header - Fixed */}\r\n      <header className=\"flex-shrink-0 px-4 sm:px-6 md:px-8 pt-4 sm:pt-6 pb-3 sm:pb-4 text-center bg-gradient-to-b from-[#111111]/95 to-transparent backdrop-blur-sm\">\r\n        <div className=\"max-w-2xl w-full mx-auto\">\r\n          <div className=\"flex justify-center mb-2\">\r\n            <StarIcon className=\"w-8 h-8 sm:w-10 sm:h-10 text-[#FFAB40]\" />\r\n          </div>\r\n          <h1 className=\"text-2xl sm:text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] leading-tight mb-2 pb-1\" style={{ lineHeight: '1.2', paddingBottom: '0.25rem' }}>Supercharge with Otagon Pro</h1>\r\n          <p className=\"text-sm sm:text-base md:text-lg text-neutral-300 leading-relaxed px-2\">Unlock exclusive features for the ultimate gaming companion.</p>\r\n\r\n          <div className=\"w-full max-w-sm mx-auto p-1 bg-gradient-to-r from-[#2E2E2E]/60 to-[#1A1A1A]/60 backdrop-blur-sm rounded-2xl flex items-center gap-1 mt-4 sm:mt-6\">\r\n            <button onClick={() => setActiveTab('pro')} className={`w-1/2 py-2 sm:py-3 text-xs sm:text-sm font-bold rounded-xl transition-all duration-300 active:scale-95 ${activeTab === 'pro' ? 'bg-gradient-to-r from-[#424242] to-[#2A2A2A] text-white shadow-lg' : 'text-neutral-300 hover:bg-neutral-700/50'}`}>Pro</button>\r\n            <button onClick={() => setActiveTab('vanguard')} className={`w-1/2 py-2 sm:py-3 text-xs sm:text-sm font-bold rounded-xl transition-all duration-300 active:scale-95 ${activeTab === 'vanguard' ? 'bg-gradient-to-r from-[#424242] to-[#2A2A2A] text-white shadow-lg' : 'text-neutral-300 hover:bg-neutral-700/50'}`}>Pro Vanguard</button>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Content - Scrollable */}\r\n      <main className=\"flex-1 overflow-y-auto px-4 sm:px-6 md:px-8 py-2 sm:py-4\">\r\n        <div className=\"max-w-2xl w-full mx-auto\">\r\n          <div className=\"space-y-3 sm:space-y-4 md:space-y-6\">\r\n             {activeTab === 'pro' && proFeatures.map(f => <ProFeature key={f.title} title={f.title} description={f.description}>{f.icon}</ProFeature>)}\r\n             {activeTab === 'vanguard' && (\r\n              <>\r\n                <div className=\"text-center p-3 sm:p-4 mb-4 sm:mb-6 bg-gradient-to-r from-amber-500/20 to-orange-500/20 border-2 border-amber-500/40 rounded-2xl backdrop-blur-sm\">\r\n                   <p className=\"font-bold text-amber-300 text-sm sm:text-base md:text-lg\">All Pro features are included!</p>\r\n               </div>\r\n               {vanguardFeatures.map(f => <ProFeature key={f.title} title={f.title} description={f.description}>{f.icon}</ProFeature>)}\r\n              </>\r\n             )}\r\n          </div>\r\n          {/* Extra padding to ensure content doesn't get hidden behind sticky footer */}\r\n          <div className=\"h-24 sm:h-32\"></div>\r\n        </div>\r\n      </main>\r\n\r\n      {/* Footer - Sticky */}\r\n      <footer className=\"flex-shrink-0 sticky bottom-0 bg-gradient-to-t from-[#0A0A0A]/95 via-[#0A0A0A]/90 to-transparent backdrop-blur-md border-t border-neutral-800/30 px-4 sm:px-6 md:px-8 pt-4 pb-4 sm:pb-6\">\r\n        <div className=\"w-full max-w-lg mx-auto space-y-2 sm:space-y-3\">\r\n          <button\r\n            onClick={activeTab === 'pro' ? onUpgrade : onUpgradeToVanguard}\r\n            disabled\r\n            className=\"w-full bg-gradient-to-r from-neutral-600 to-neutral-500 text-neutral-300 font-bold py-3 sm:py-4 px-6 rounded-xl transition-all duration-300 cursor-not-allowed opacity-50 text-sm sm:text-base flex items-center justify-center\"\r\n          >\r\n            Coming Soon\r\n          </button>\r\n          <button\r\n            onClick={onComplete}\r\n            className=\"w-full text-neutral-300 font-medium py-2 sm:py-3 px-4 rounded-xl hover:bg-neutral-800/50 transition-all duration-300 hover:scale-105 active:scale-95 text-xs sm:text-sm flex items-center justify-center\"\r\n          >\r\n            Maybe Later\r\n          </button>\r\n        </div>\r\n      </footer>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.memo(ProFeaturesSplashScreen);\r\n","import React from 'react';\r\n\r\ninterface HintIconProps {\r\n  className?: string;\r\n}\r\n\r\nconst HintIcon: React.FC<HintIconProps> = ({ className = 'w-6 h-6' }) => {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      className={className}\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      strokeLinecap=\"round\"\r\n      strokeLinejoin=\"round\"\r\n    >\r\n      <circle cx=\"12\" cy=\"12\" r=\"10\" />\r\n      <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\" />\r\n      <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\" />\r\n    </svg>\r\n  );\r\n};\r\n\r\nexport default HintIcon;\r\n","import React from 'react';\r\n\r\ninterface DesktopIconProps {\r\n  className?: string;\r\n}\r\n\r\nconst DesktopIcon: React.FC<DesktopIconProps> = ({ className = 'w-6 h-6' }) => {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      className={className}\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      strokeLinecap=\"round\"\r\n      strokeLinejoin=\"round\"\r\n    >\r\n      <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\" />\r\n      <line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\" />\r\n      <line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\" />\r\n    </svg>\r\n  );\r\n};\r\n\r\nexport default DesktopIcon;\r\n","import React from 'react';\r\n\r\ninterface BookmarkIconProps {\r\n  className?: string;\r\n}\r\n\r\nconst BookmarkIcon: React.FC<BookmarkIconProps> = ({ className = 'w-6 h-6' }) => {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      className={className}\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      strokeLinecap=\"round\"\r\n      strokeLinejoin=\"round\"\r\n    >\r\n      <path d=\"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z\" />\r\n    </svg>\r\n  );\r\n};\r\n\r\nexport default BookmarkIcon;\r\n","import React, { useState, useEffect } from 'react';\r\nimport ScreenshotIcon from '../ui/ScreenshotIcon';\r\nimport HintIcon from '../ui/HintIcon';\r\nimport DesktopIcon from '../ui/DesktopIcon';\r\nimport BookmarkIcon from '../ui/BookmarkIcon';\r\nimport { ConnectionStatus } from '../../types';\r\n\r\n// Feature flag: toggle to show or hide intro slides\r\nconst SHOW_INTRO_SLIDES = false;\r\n\r\nconst allSlides = [\r\n  {\r\n    icon: <ScreenshotIcon className=\"w-24 h-24 text-[#FF4D4D]\" />,\r\n    title: \"Instant Context from Any Screenshot\",\r\n    description: \"Upload a screenshot from any game. Otagon instantly identifies the game, your location, and what's happening. Get answers, not spoilers.\"\r\n  },\r\n  {\r\n    icon: <HintIcon className=\"w-24 h-24 text-[#FF4D4D]\" />,\r\n    title: \"Hints that Don't Spoil the Story\",\r\n    description: \"Stuck on a puzzle or boss? Get contextual, spoiler-free guidance. Discover rich lore about the world without ruining the surprise.\"\r\n  },\r\n  {\r\n    icon: <BookmarkIcon className=\"w-24 h-24 text-[#FF4D4D]\" />,\r\n    title: \"Automatic Progress Tracking\",\r\n    description: \"Otagon automatically organizes your chats by game and tracks your main story progress. Easily see how far you've come and pick up right where you left off.\"\r\n  },\r\n  {\r\n    icon: <DesktopIcon className=\"w-24 h-24 text-[#FF4D4D]\" />,\r\n    title: \"Connect Your PC for Instant Help\",\r\n    description: \"Link your desktop and mobile app to get help without leaving your game. Press a hotkey to instantly send a screenshot for analysis.\"\r\n  }\r\n];\r\n\r\nconst slides = SHOW_INTRO_SLIDES ? allSlides : allSlides.slice(-1);\r\n\r\ninterface SplashScreenProps {\r\n  onSkipConnection: () => void;\r\n  onConnect: (code: string) => void;\r\n  status: ConnectionStatus;\r\n  error: string | null;\r\n  connectionCode: string | null;\r\n  onConnectionSuccess: () => void;\r\n}\r\n\r\nconst SplashScreen: React.FC<SplashScreenProps> = ({ \r\n    onSkipConnection,\r\n    onConnect,\r\n    status,\r\n    error,\r\n    connectionCode,\r\n    onConnectionSuccess,\r\n }) => {\r\n  const [step, setStep] = useState(0);\r\n  const [code, setCode] = useState(connectionCode || '');\r\n  const [syncInitiated, setSyncInitiated] = useState(false);\r\n  const [connectionSuccessCalled, setConnectionSuccessCalled] = useState(false);\r\n  const [touchStartX, setTouchStartX] = useState<number | null>(null);\r\n  const [touchEndX, setTouchEndX] = useState<number | null>(null);\r\n  \r\n  useEffect(() => {\r\n    // This effect transitions to the next screen ONLY if the connection\r\n    // was successful AND it was initiated by the user clicking the button.\r\n    if (syncInitiated && status === ConnectionStatus.CONNECTED && !connectionSuccessCalled) {\r\n        console.log(' [SplashScreen] Connection successful, calling onConnectionSuccess');\r\n        setConnectionSuccessCalled(true);\r\n        onConnectionSuccess();\r\n    }\r\n  }, [status, onConnectionSuccess, syncInitiated, connectionSuccessCalled]);\r\n\r\n  const currentSlide = slides[step];\r\n  const isLastStep = step === slides.length - 1;\r\n\r\n  const isConnecting = status === ConnectionStatus.CONNECTING;\r\n  const isConnected = status === ConnectionStatus.CONNECTED;\r\n\r\n  const handleNext = () => {\r\n    if (!isLastStep) {\r\n      setStep(s => s + 1);\r\n    }\r\n  };\r\n  \r\n  const handlePrev = () => {\r\n    if (step > 0) {\r\n      setStep(s => s - 1);\r\n    }\r\n  };\r\n\r\n  const handleConnectClick = () => {\r\n    if (isConnecting || isConnected) {\r\n      return;\r\n    }\r\n    setSyncInitiated(true);\r\n    setConnectionSuccessCalled(false); // Reset the flag for new connection attempt\r\n    onConnect(code);\r\n  };\r\n  \r\n  \r\n  const handleTouchStart = (e: React.TouchEvent) => {\r\n    setTouchEndX(null); // Clear end on new touch\r\n    const touch = e.targetTouches[0];\r\n    if (touch) {\r\n      setTouchStartX(touch.clientX);\r\n    }\r\n  };\r\n\r\n  const handleTouchMove = (e: React.TouchEvent) => {\r\n    const touch = e.targetTouches[0];\r\n    if (touch) {\r\n      setTouchEndX(touch.clientX);\r\n    }\r\n  };\r\n\r\n  const handleTouchEnd = () => {\r\n    if (!touchStartX || !touchEndX) {\r\n      return;\r\n    }\r\n    const distance = touchStartX - touchEndX;\r\n    const minSwipeDistance = 50;\r\n    const isLeftSwipe = distance > minSwipeDistance;\r\n    const isRightSwipe = distance < -minSwipeDistance;\r\n\r\n    if (isLeftSwipe) {\r\n      handleNext();\r\n    } else if (isRightSwipe) {\r\n      handlePrev();\r\n    }\r\n    // Reset after swipe action\r\n    setTouchStartX(null);\r\n    setTouchEndX(null);\r\n  };\r\n\r\n  const isCodeValid = /^\\d{6}$/.test(code);\r\n\r\n  return (\r\n    <div \r\n        className=\"h-screen bg-[#111111] text-[#F5F5F5] flex flex-col font-inter\"\r\n        onTouchStart={handleTouchStart}\r\n        onTouchMove={handleTouchMove}\r\n        onTouchEnd={handleTouchEnd}\r\n    >\r\n\r\n      <main className=\"flex-1 flex flex-col items-center justify-center p-4 sm:p-6 md:p-8\">\r\n        <div className=\"text-center max-w-lg w-full\">\r\n          <div className=\"mb-2 sm:mb-4 flex justify-center\">\r\n            {currentSlide?.icon}\r\n          </div>\r\n          <h1 className=\"text-2xl sm:text-3xl md:text-4xl font-bold text-[#F5F5F5] mb-2 sm:mb-4 leading-normal\">{currentSlide?.title}</h1>\r\n          <p className=\"text-[#CFCFCF] text-base sm:text-lg md:text-xl mb-4 leading-relaxed\">{currentSlide?.description}</p>\r\n          \r\n          {isLastStep && (\r\n              <div className=\"space-y-3 sm:space-y-4 text-left\">\r\n                  <div className=\"text-center pb-2\">\r\n                      <button\r\n                        onClick={() => {\r\n                          const downloadUrl = 'https://github.com/readmet3xt/otakon-pc-client/releases/tag/v1.0.0';\r\n                          window.open(downloadUrl, '_blank');\r\n                        }}\r\n                        className=\"text-sm sm:text-base font-medium text-[#FF4D4D] hover:text-[#FF4D4D] hover:underline transition-all duration-300 hover:scale-105\"\r\n                      >\r\n                        Download PC Client (v1.0.0)\r\n                      </button>\r\n                  </div>\r\n                  <div>\r\n                      <label htmlFor=\"connection-code\" className=\"block text-sm sm:text-base font-medium text-[#CFCFCF] mb-2 text-center\">\r\n                        6-Digit Connection Code\r\n                      </label>\r\n                      <input\r\n                      id=\"connection-code\"\r\n                      type=\"text\"\r\n                      value={code}\r\n                      onChange={(e) => setCode(e.target.value)}\r\n                      placeholder=\"123456\"\r\n                      maxLength={6}\r\n                      pattern=\"\\d{6}\"\r\n                      title=\"Enter exactly 6 digits\"\r\n                      disabled={isConnecting || isConnected}\r\n                      required\r\n                      className=\"w-full bg-gradient-to-r from-[#2E2E2E] to-[#1A1A1A] border-2 border-[#424242]/60 rounded-xl py-2 sm:py-3 px-4 text-[#F5F5F5] placeholder-[#6E6E6E] focus:outline-none focus:ring-2 focus:ring-[#FFAB40] focus:border-[#FFAB40]/60 disabled:opacity-50 text-center text-lg sm:text-xl font-mono tracking-widest backdrop-blur-sm\"\r\n                      style={{ textAlign: 'center' }}\r\n                      />\r\n                  </div>\r\n                  <div className=\"h-6 text-center text-base\">\r\n                      {error && <p className=\"text-[#E53A3A]\">{error}</p>}\r\n                      {isConnected && <p className=\"text-[#5CBB7B]\">You're all set! Your PC is now connected.</p>}\r\n                      {isConnecting && <p className=\"text-[#A3A3A3]\">Attempting to connect...</p>}\r\n                  </div>\r\n              </div>\r\n          )}\r\n        </div>\r\n      </main>\r\n      \r\n      <footer className=\"flex-shrink-0 px-4 sm:px-6 md:px-8 pt-3 sm:pt-4 pb-6 sm:pb-8\">\r\n        <div className=\"w-full max-w-lg mx-auto\">\r\n            {isLastStep ? (\r\n                <div className=\"flex flex-col gap-4\">\r\n                    {!isConnected ? (\r\n                        <>\r\n                            <button\r\n                                onClick={handleConnectClick}\r\n                                disabled={isConnecting || !isCodeValid}\r\n                                className={`w-full font-bold py-3 sm:py-4 px-6 sm:px-8 rounded-xl transition-all duration-300 flex items-center justify-center text-sm sm:text-base active:scale-95 ${\r\n                                    isCodeValid && !isConnecting \r\n                                        ? 'bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] hover:from-[#D42A2A] hover:to-[#C87A1A] text-white hover:scale-105 hover:shadow-xl hover:shadow-[#E53A3A]/25' \r\n                                        : 'bg-gradient-to-r from-neutral-600 to-neutral-500 text-neutral-300 cursor-not-allowed opacity-25'\r\n                                }`}\r\n                            >\r\n                                {isConnecting ? \"Connecting...\" : \"Sync Now\"}\r\n                            </button>\r\n                            <button\r\n                                onClick={onSkipConnection}\r\n                                className=\"w-full bg-gradient-to-r from-neutral-700 to-neutral-600 hover:from-neutral-600 hover:to-neutral-500 text-white font-bold py-3 sm:py-4 px-6 sm:px-8 rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-lg active:scale-95 flex items-center justify-center text-sm sm:text-base\"\r\n                            >\r\n                                Skip for Now\r\n                            </button>\r\n                        </>\r\n                    ) : (\r\n                        <div className=\"text-center py-4\">\r\n                            <div className=\"text-green-400 text-lg font-semibold mb-2\">\r\n                                 You're all set! PC is connected\r\n                            </div>\r\n                            <div className=\"text-neutral-400 text-sm\">\r\n                                Taking you to the next step...\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n            </div>\r\n            ) : (\r\n                <button\r\n                    onClick={handleNext}\r\n                    className=\"w-full bg-gradient-to-r from-neutral-700 to-neutral-600 hover:from-neutral-600 hover:to-neutral-500 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-lg active:scale-95 flex items-center justify-center\"\r\n                >\r\n                    Next\r\n                </button>\r\n            )}\r\n        </div>\r\n      </footer>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.memo(SplashScreen);\r\n\r\n","import { useState, useCallback } from 'react';\r\n\r\nexport interface ActiveSessionState {\r\n  isActive: boolean;\r\n  currentGameId?: string; // Corresponds to conversation.id\r\n}\r\n\r\nexport const useActiveSession = (initialState: ActiveSessionState = { isActive: false }) => {\r\n  const [session, setSession] = useState<ActiveSessionState>(initialState);\r\n\r\n  const toggleSession = useCallback((conversationId: string) => {\r\n    setSession(prevSession => {\r\n      // If toggling off, or switching to a new game's session\r\n      if (prevSession.isActive && prevSession.currentGameId === conversationId) {\r\n        return { isActive: false };\r\n      } else {\r\n        return { isActive: true, currentGameId: conversationId };\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const setActiveSession = useCallback((conversationId: string, isActive: boolean) => {\r\n    setSession({\r\n      isActive,\r\n      currentGameId: isActive ? conversationId : undefined\r\n    });\r\n  }, []);\r\n\r\n  return { \r\n    session, \r\n    toggleSession, \r\n    setActiveSession \r\n  };\r\n};\r\n","import React, { useEffect, useRef } from 'react';\r\n\r\ninterface ContextMenuProps {\r\n  isOpen: boolean;\r\n  position: { x: number; y: number };\r\n  onClose: () => void;\r\n  onDelete?: () => void;\r\n  onPin?: () => void;\r\n  onUnpin?: () => void;\r\n  onClearConversation?: () => void;\r\n  canDelete?: boolean;\r\n  canPin?: boolean;\r\n  isPinned?: boolean;\r\n  isEverythingElse?: boolean;\r\n}\r\n\r\nconst ContextMenu: React.FC<ContextMenuProps> = ({\r\n  isOpen,\r\n  position,\r\n  onClose,\r\n  onDelete,\r\n  onPin,\r\n  onUnpin,\r\n  onClearConversation,\r\n  canDelete = true,\r\n  canPin = true,\r\n  isPinned = false,\r\n  isEverythingElse = false,\r\n}) => {\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    const handleEscape = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      document.addEventListener('mousedown', handleClickOutside);\r\n      document.addEventListener('keydown', handleEscape);\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n      document.removeEventListener('keydown', handleEscape);\r\n    };\r\n  }, [isOpen, onClose]);\r\n\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={menuRef}\r\n      className=\"fixed z-[100] bg-surface border border-surface-light/20 rounded-lg shadow-xl py-2 min-w-[160px]\"\r\n      style={{\r\n        left: position.x,\r\n        top: position.y,\r\n        transform: position.y < 200 ? 'translate(-50%, 10px)' : 'translate(-50%, -100%)',\r\n      }}\r\n    >\r\n      {/* Pin/Unpin Option */}\r\n      {canPin && !isEverythingElse && (\r\n        <button\r\n          onClick={() => {\r\n            if (isPinned) {\r\n              onUnpin?.();\r\n            } else {\r\n              onPin?.();\r\n            }\r\n            onClose();\r\n          }}\r\n          className=\"w-full px-4 py-2 text-left text-text-primary hover:bg-surface-light/50 transition-colors duration-200 flex items-center space-x-3\"\r\n        >\r\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            {isPinned ? (\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z\" />\r\n            ) : (\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z\" />\r\n            )}\r\n          </svg>\r\n          <span>{isPinned ? 'Unpin' : 'Pin to top'}</span>\r\n        </button>\r\n      )}\r\n\r\n      {/* Clear conversation option - available for all conversations */}\r\n      <button\r\n        onClick={() => {\r\n          onClearConversation?.();\r\n          onClose();\r\n        }}\r\n        className=\"w-full px-4 py-2 text-left text-orange-400 hover:bg-orange-500/10 transition-colors duration-200 flex items-center space-x-3\"\r\n      >\r\n        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n        </svg>\r\n        <span>Clear conversation</span>\r\n      </button>\r\n\r\n      {/* Delete Option */}\r\n      {canDelete && !isEverythingElse && (\r\n        <button\r\n          onClick={() => {\r\n            onDelete?.();\r\n            onClose();\r\n          }}\r\n          className=\"w-full px-4 py-2 text-left text-red-400 hover:bg-red-500/10 transition-colors duration-200 flex items-center space-x-3\"\r\n        >\r\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n          </svg>\r\n          <span>Delete</span>\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ContextMenu;\r\n","import React, { useState, useRef } from 'react';\r\nimport { Conversations, Conversation } from '../../types';\r\nimport ContextMenu from '../ui/ContextMenu';\r\n\r\ninterface SidebarProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  conversations: Conversations;\r\n  activeConversation: Conversation | null;\r\n  onConversationSelect: (id: string) => void;\r\n  onDeleteConversation: (id: string) => void;\r\n  onPinConversation?: (id: string) => void;\r\n  onUnpinConversation?: (id: string) => void;\r\n  onClearConversation?: (id: string) => void;\r\n  onAddGame?: () => void;\r\n}\r\n\r\nconst Sidebar: React.FC<SidebarProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  conversations,\r\n  activeConversation,\r\n  onConversationSelect,\r\n  onDeleteConversation,\r\n  onPinConversation,\r\n  onUnpinConversation,\r\n  onClearConversation,\r\n  onAddGame,\r\n}) => {\r\n  // Context menu state\r\n  const [contextMenu, setContextMenu] = useState<{\r\n    isOpen: boolean;\r\n    position: { x: number; y: number };\r\n    conversationId: string | null;\r\n  }>({\r\n    isOpen: false,\r\n    position: { x: 0, y: 0 },\r\n    conversationId: null,\r\n  });\r\n\r\n  // Long press detection\r\n  const longPressTimer = useRef<NodeJS.Timeout | null>(null);\r\n  const longPressDelay = 1500; // 1.5 seconds\r\n\r\n  // Sort conversations: Game Hub first, then pinned, then others (newest last)\r\n  const conversationList = Object.values(conversations).sort((a, b) => {\r\n    // \"Game Hub\" always at top\r\n    const aIsGameHub = a.isGameHub || a.id === 'game-hub' || a.title === 'Game Hub';\r\n    const bIsGameHub = b.isGameHub || b.id === 'game-hub' || b.title === 'Game Hub';\r\n    \r\n    if (aIsGameHub && !bIsGameHub) {\r\n      return -1;\r\n    }\r\n    if (!aIsGameHub && bIsGameHub) {\r\n      return 1;\r\n    }\r\n    \r\n    // Pinned conversations next (sorted by pinned date, oldest pinned first)\r\n    if (a.isPinned && !b.isPinned) {\r\n      return -1;\r\n    }\r\n    if (!a.isPinned && b.isPinned) {\r\n      return 1;\r\n    }\r\n    if (a.isPinned && b.isPinned) {\r\n      return (a.pinnedAt || 0) - (b.pinnedAt || 0);\r\n    }\r\n    \r\n    // Then by creation date (oldest first, newest last)\r\n    return a.createdAt - b.createdAt;\r\n  });\r\n\r\n  const handleContextMenu = (e: React.MouseEvent, conversationId: string) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    setContextMenu({\r\n      isOpen: true,\r\n      position: { x: e.clientX, y: e.clientY },\r\n      conversationId,\r\n    });\r\n  };\r\n\r\n  const handleLongPressStart = (conversationId: string) => {\r\n    longPressTimer.current = setTimeout(() => {\r\n      setContextMenu({\r\n        isOpen: true,\r\n        position: { x: window.innerWidth / 2, y: window.innerHeight / 2 },\r\n        conversationId,\r\n      });\r\n    }, longPressDelay);\r\n  };\r\n\r\n  const handleLongPressEnd = () => {\r\n    if (longPressTimer.current) {\r\n      clearTimeout(longPressTimer.current);\r\n      longPressTimer.current = null;\r\n    }\r\n  };\r\n\r\n  const closeContextMenu = () => {\r\n    setContextMenu({\r\n      isOpen: false,\r\n      position: { x: 0, y: 0 },\r\n      conversationId: null,\r\n    });\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (contextMenu.conversationId) {\r\n      onDeleteConversation(contextMenu.conversationId);\r\n      closeContextMenu();\r\n    }\r\n  };\r\n\r\n  const handlePin = () => {\r\n    if (contextMenu.conversationId && onPinConversation) {\r\n      onPinConversation(contextMenu.conversationId);\r\n      closeContextMenu();\r\n    }\r\n  };\r\n\r\n  const handleUnpin = () => {\r\n    if (contextMenu.conversationId && onUnpinConversation) {\r\n      onUnpinConversation(contextMenu.conversationId);\r\n      closeContextMenu();\r\n    }\r\n  };\r\n\r\n  const handleClearConversation = () => {\r\n    if (contextMenu.conversationId && onClearConversation) {\r\n      onClearConversation(contextMenu.conversationId);\r\n      closeContextMenu();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Overlay */}\r\n      {isOpen && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/60 backdrop-blur-md z-40 lg:hidden\"\r\n          onClick={onClose}\r\n        />\r\n      )}\r\n\r\n      {/* Sidebar */}\r\n      <div className={`fixed inset-y-0 left-0 z-50 w-72 sm:w-80 bg-gradient-to-b from-surface to-background border-r border-surface-light/20 transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 ${\r\n        isOpen ? 'translate-x-0' : '-translate-x-full'\r\n      }`} style={{ zIndex: 50 }}>\r\n        <div className=\"flex flex-col h-full\">\r\n          {/* Header */}\r\n          <div className=\"p-4 sm:p-6 border-b border-surface-light/20 flex-shrink-0 relative\" style={{ zIndex: 10 }}>\r\n            <div className=\"flex items-center justify-between\">\r\n              <h2 className=\"text-xl sm:text-2xl font-bold text-text-primary\">Conversations</h2>\r\n              <button\r\n                onClick={onClose}\r\n                className=\"lg:hidden btn-icon p-3 text-text-muted hover:text-text-primary active:scale-95 min-h-[44px] min-w-[44px] flex items-center justify-center\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n\r\n          {/* Add Game Button */}\r\n          {onAddGame && (\r\n            <div className=\"px-4 sm:px-6 pt-4 pb-2\">\r\n              <button\r\n                onClick={onAddGame}\r\n                className=\"w-full px-4 py-3 bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] hover:from-[#D42A2A] hover:to-[#C87A1A] text-white font-medium rounded-lg transition-all shadow-lg hover:shadow-xl active:scale-95 flex items-center justify-center gap-2\"\r\n              >\r\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                </svg>\r\n                <span>Add Game</span>\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* Conversation List */}\r\n          <div className=\"flex-1 overflow-y-auto px-4 sm:px-6 pb-4 sm:pb-6 custom-scrollbar\" style={{ minHeight: 0 }}>\r\n            <div className=\"space-y-2 sm:space-y-3 pt-2\">\r\n              {conversationList.map((conversation) => {\r\n                const isGameHub = conversation.isGameHub || conversation.id === 'game-hub' || conversation.title === 'Game Hub';\r\n                const isUnreleased = conversation.isUnreleased || false;\r\n                const isRegularGame = !isGameHub && !isUnreleased && conversation.gameTitle;\r\n                \r\n                // Determine border color based on tab type\r\n                let borderClass = '';\r\n                let titleClass = 'text-text-primary';\r\n                \r\n                if (isGameHub) {\r\n                  // Game Hub: Otagon brand gradient (red to orange)\r\n                  borderClass = 'border-l-2 border-gradient-to-b from-[#FF4D4D] to-[#FFAB40]';\r\n                  titleClass = 'bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] bg-clip-text text-transparent';\r\n                } else if (isUnreleased) {\r\n                  // Unreleased games: Yellow\r\n                  borderClass = 'border-l-2 border-yellow-500';\r\n                  titleClass = 'text-yellow-400';\r\n                } else if (isRegularGame) {\r\n                  // Regular games: Orange\r\n                  borderClass = 'border-l-2 border-orange-500';\r\n                  titleClass = 'text-orange-400';\r\n                }\r\n                // Non-game conversations: No border, default text color\r\n                \r\n                return (\r\n                  <div\r\n                    key={conversation.id}\r\n                    className={`conversation-tab cursor-pointer transition-all duration-300 relative ${\r\n                      activeConversation?.id === conversation.id\r\n                        ? 'conversation-tab-active'\r\n                        : ''\r\n                    } ${borderClass}`}\r\n                    onClick={() => onConversationSelect(conversation.id)}\r\n                    onContextMenu={(e) => handleContextMenu(e, conversation.id)}\r\n                    onMouseDown={() => handleLongPressStart(conversation.id)}\r\n                    onMouseUp={handleLongPressEnd}\r\n                    onMouseLeave={handleLongPressEnd}\r\n                    onTouchStart={() => handleLongPressStart(conversation.id)}\r\n                    onTouchEnd={handleLongPressEnd}\r\n                    style={{ zIndex: 1 }}\r\n                  >\r\n                    <div className=\"flex items-center justify-between p-4 min-h-[60px]\">\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center space-x-2\">\r\n                          <p className={`text-xs font-medium truncate ${titleClass}`}>\r\n                            {conversation.title}\r\n                          </p>\r\n                          {isUnreleased && (\r\n                            <span className=\"flex-shrink-0 px-1.5 py-0.5 bg-yellow-500/20 border border-yellow-500/40 rounded text-[10px] text-yellow-400 font-medium\">\r\n                              UPCOMING\r\n                            </span>\r\n                          )}\r\n                          {conversation.isPinned && (\r\n                            <svg className=\"w-3 h-3 text-primary-dark flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                              <path d=\"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z\" />\r\n                            </svg>\r\n                          )}\r\n                        </div>\r\n                        <p className=\"text-xs text-text-muted mt-2\">\r\n                          {conversation.messages.length} messages\r\n                        </p>\r\n                        <p className=\"text-xs text-text-muted mt-1\">\r\n                          {new Date(conversation.updatedAt).toLocaleDateString()}\r\n                        </p>\r\n                    </div>\r\n                    \r\n                    {/* Delete button - only show for non-Game Hub conversations */}\r\n                    {!isGameHub && (\r\n                      <button\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          onDeleteConversation(conversation.id);\r\n                        }}\r\n                        className=\"opacity-0 group-hover:opacity-100 p-3 text-text-muted hover:text-red-400 transition-all duration-200 rounded-lg hover:bg-red-500/10 active:scale-95 min-h-[44px] min-w-[44px] flex items-center justify-center\"\r\n                      >\r\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                        </svg>\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                );\r\n              })}\r\n              \r\n              {conversationList.length === 0 && (\r\n                <div className=\"text-center py-12\">\r\n                  <div className=\"w-16 h-16 bg-gradient-to-r from-primary/20 to-secondary/20 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                    <svg className=\"w-8 h-8 text-primary\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n                    </svg>\r\n                  </div>\r\n                  <p className=\"text-text-muted text-lg\">No conversations yet</p>\r\n                  <p className=\"text-sm text-text-muted mt-2\">Create your first conversation to get started</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Context Menu */}\r\n      <ContextMenu\r\n        isOpen={contextMenu.isOpen}\r\n        position={contextMenu.position}\r\n        onClose={closeContextMenu}\r\n        onDelete={handleDelete}\r\n        onPin={handlePin}\r\n        onUnpin={handleUnpin}\r\n        onClearConversation={handleClearConversation}\r\n        canDelete={contextMenu.conversationId ? !conversations[contextMenu.conversationId]?.isGameHub : true}\r\n        canPin={contextMenu.conversationId ? !conversations[contextMenu.conversationId]?.isGameHub : true}\r\n        isPinned={contextMenu.conversationId ? conversations[contextMenu.conversationId]?.isPinned : false}\r\n        isEverythingElse={contextMenu.conversationId ? conversations[contextMenu.conversationId]?.isGameHub === true : false}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Sidebar;\r\n","import React from 'react';\r\nimport { User } from '../../types';\r\n\r\ninterface CreditIndicatorProps {\r\n  user: User;\r\n  onClick: () => void;\r\n}\r\n\r\n\r\nconst CreditIndicator: React.FC<CreditIndicatorProps> = ({ user, onClick }) => {\r\n  const { textCount, textLimit, imageCount, imageLimit } = user.usage;\r\n  \r\n\r\n  const textPercentRemaining = textLimit > 0 ? Math.max(0, 100 - (textCount / textLimit) * 100) : 0;\r\n  const imagePercentRemaining = imageLimit > 0 ? Math.max(0, 100 - (imageCount / imageLimit) * 100) : 0;\r\n\r\n  const radiusOuter = 13;\r\n  const circumferenceOuter = 2 * Math.PI * radiusOuter;\r\n  const offsetOuter = circumferenceOuter - (textPercentRemaining / 100) * circumferenceOuter;\r\n\r\n  const radiusInner = 8;\r\n  const circumferenceInner = 2 * Math.PI * radiusInner;\r\n  const offsetInner = circumferenceInner - (imagePercentRemaining / 100) * circumferenceInner;\r\n\r\n  const strokeWidth = 3.5;\r\n\r\n  return (\r\n    <div \r\n      className=\"credit-indicator-wrapper\"\r\n      style={{\r\n        display: 'inline-block',\r\n        background: 'linear-gradient(135deg, #E53A3A, #D98C1F)',\r\n        padding: '1px',\r\n        borderRadius: '8px',\r\n        // Add soft brand gradient shadow (reduced glow)\r\n        boxShadow: '0 4px 16px rgba(229, 58, 58, 0.2), 0 2px 8px rgba(217, 140, 31, 0.15), 0 1px 4px rgba(0, 0, 0, 0.1)',\r\n        filter: 'drop-shadow(0 0 10px rgba(229, 58, 58, 0.15))'\r\n      }}\r\n    >\r\n      <button\r\n        type=\"button\"\r\n        onClick={onClick}\r\n        className=\"credit-indicator-button flex items-center justify-center h-11 w-11 sm:h-12 sm:w-12 lg:h-14 lg:w-14 rounded-lg transition-all duration-300 hover:scale-105 active:scale-95 min-h-[44px] min-w-[44px]\"\r\n        style={{\r\n          background: '#0F0F0F',\r\n          border: 'none',\r\n          outline: 'none',\r\n          boxShadow: '0 2px 8px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1)',\r\n          width: '100%',\r\n          height: '100%'\r\n        }}\r\n        aria-label=\"View query credits\"\r\n      >\r\n        {/* All Screen Sizes: Circular Bars */}\r\n        <div className=\"w-7 h-7 sm:w-8 sm:h-8 lg:w-9 lg:h-9 xl:w-10 xl:h-10 flex items-center justify-center rounded-full p-0.5\" style={{\r\n          background: 'rgba(0, 0, 0, 0.2)'\r\n        }}>\r\n          <svg className=\"w-full h-full\" viewBox=\"0 0 32 32\" fill=\"none\">\r\n            <defs>\r\n              <linearGradient id=\"sky-gradient\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"1\">\r\n                <stop offset=\"0%\" stopColor=\"#38bdf8\" />\r\n                <stop offset=\"100%\" stopColor=\"#0ea5e9\" />\r\n              </linearGradient>\r\n              <linearGradient id=\"emerald-gradient\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"1\">\r\n                <stop offset=\"0%\" stopColor=\"#34d399\" />\r\n                <stop offset=\"100%\" stopColor=\"#10b981\" />\r\n              </linearGradient>\r\n            </defs>\r\n            {/* Outer circle (text) - only the colored ring */}\r\n            <circle \r\n              cx=\"16\" cy=\"16\" r={radiusOuter} \r\n              stroke=\"url(#sky-gradient)\" \r\n              strokeWidth={strokeWidth} \r\n              strokeDasharray={circumferenceOuter}\r\n              strokeDashoffset={offsetOuter}\r\n              strokeLinecap=\"round\"\r\n              transform=\"rotate(-90 16 16)\"\r\n            />\r\n            {/* Inner circle (image) - only the colored ring */}\r\n            <circle \r\n              cx=\"16\" cy=\"16\" r={radiusInner} \r\n              stroke=\"url(#emerald-gradient)\" \r\n              strokeWidth={strokeWidth}\r\n              strokeDasharray={circumferenceInner}\r\n              strokeDashoffset={offsetInner}\r\n              strokeLinecap=\"round\"\r\n              transform=\"rotate(-90 16 16)\"\r\n            />\r\n          </svg>\r\n        </div>\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CreditIndicator;\r\n","import React from 'react';\r\n\r\nexport const HandsFreeIcon: React.FC<{ isActive: boolean; className?: string }> = ({ isActive, className }) => (\r\n    <svg \r\n        xmlns=\"http://www.w3.org/2000/svg\" \r\n        className={className}\r\n        viewBox=\"0 0 24 24\" \r\n        fill=\"none\" \r\n        stroke=\"currentColor\" \r\n        strokeWidth=\"2\" \r\n        strokeLinecap=\"round\" \r\n        strokeLinejoin=\"round\"\r\n        width=\"24\"\r\n        height=\"24\"\r\n    >\r\n        <path d=\"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z\" fill={isActive ? 'currentColor' : 'none'}/>\r\n        <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\" />\r\n    </svg>\r\n);\r\n\r\ninterface HandsFreeToggleProps {\r\n  isHandsFree: boolean;\r\n  onToggle: () => void;\r\n}\r\n\r\nconst HandsFreeToggle: React.FC<HandsFreeToggleProps> = ({ isHandsFree, onToggle }) => {\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      onClick={onToggle}\r\n      className={`btn-icon p-3 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center ${\r\n        isHandsFree\r\n          ? 'text-green-400 hover:text-green-300'\r\n          : 'text-text-muted hover:text-text-primary'\r\n      }`}\r\n      aria-pressed={isHandsFree}\r\n      aria-label=\"Hands-Free Settings\"\r\n      title={isHandsFree ? 'Hands-Free Mode Active' : 'Hands-Free Voice Response Settings'}\r\n    >\r\n      <HandsFreeIcon className=\"w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0\" isActive={isHandsFree} />\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default HandsFreeToggle;\r\n\r\n","import React from 'react';\r\n\r\ninterface LoadingSpinnerProps {\r\n  size?: 'sm' | 'md' | 'lg';\r\n  className?: string;\r\n}\r\n\r\nconst LoadingSpinner: React.FC<LoadingSpinnerProps> = ({ \r\n  size = 'md', \r\n  className = '' \r\n}) => {\r\n  const sizeClasses = {\r\n    sm: 'w-4 h-4',\r\n    md: 'w-6 h-6',\r\n    lg: 'w-8 h-8',\r\n  };\r\n\r\n  return (\r\n    <div className={`animate-spin rounded-full border-2 border-current border-t-transparent ${sizeClasses[size]} ${className}`} />\r\n  );\r\n};\r\n\r\nexport { LoadingSpinner };\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { UserTier } from '../../types';\r\nimport { authService } from '../../services/authService';\r\nimport { supabaseService } from '../../services/supabaseService';\r\nimport { toastService } from '../../services/toastService';\r\n\r\ninterface SettingsContextMenuProps {\r\n  isOpen: boolean;\r\n  position: { x: number; y: number };\r\n  onClose: () => void;\r\n  onOpenSettings: () => void;\r\n  onOpenGuide?: () => void;\r\n  onLogout: () => void;\r\n  userTier?: UserTier;\r\n  onTrialStart?: () => void;\r\n}\r\n\r\nconst SettingsContextMenu: React.FC<SettingsContextMenuProps> = ({\r\n  isOpen,\r\n  position,\r\n  onClose,\r\n  onOpenSettings,\r\n  onOpenGuide,\r\n  onLogout,\r\n  userTier,\r\n  onTrialStart,\r\n}) => {\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n  // Optimistic: Show trial button immediately for free users, hide if check fails\r\n  const [isTrialEligible, setIsTrialEligible] = useState(userTier === 'free');\r\n  const [isStartingTrial, setIsStartingTrial] = useState(false);\r\n\r\n  // Check trial eligibility when menu opens\r\n  useEffect(() => {\r\n    const checkTrialEligibility = async () => {\r\n      if (isOpen && userTier === 'free') {\r\n        try {\r\n          const currentUser = authService.getCurrentUser();\r\n          if (currentUser) {\r\n            const status = await supabaseService.getTrialStatus(currentUser.authUserId);\r\n            setIsTrialEligible(status?.isEligible && !status?.isActive || false);\r\n          }\r\n        } catch (error) {\r\n          console.error('Error checking trial eligibility:', error);\r\n          // Keep showing the button on error - user can try\r\n          setIsTrialEligible(true);\r\n        }\r\n      } else {\r\n        setIsTrialEligible(false);\r\n      }\r\n    };\r\n\r\n    checkTrialEligibility();\r\n  }, [isOpen, userTier]);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    const handleEscape = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      document.addEventListener('mousedown', handleClickOutside);\r\n      document.addEventListener('keydown', handleEscape);\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n      document.removeEventListener('keydown', handleEscape);\r\n    };\r\n  }, [isOpen, onClose]);\r\n\r\n  const handleStartTrial = async () => {\r\n    const currentUser = authService.getCurrentUser();\r\n    if (!currentUser || isStartingTrial) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsStartingTrial(true);\r\n      const success = await supabaseService.startTrial(currentUser.authUserId);\r\n      \r\n      if (success) {\r\n        console.log(' Trial started successfully');\r\n        toastService.success('Pro trial activated! Enjoy your 7-day trial.');\r\n        if (onTrialStart) {\r\n          onTrialStart();\r\n        }\r\n        onClose();\r\n      } else {\r\n        console.error(' Failed to start trial');\r\n        toastService.error('Failed to start trial. Please try again.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error starting trial:', error);\r\n      toastService.error('Failed to start trial. Please try again.');\r\n    } finally {\r\n      setIsStartingTrial(false);\r\n    }\r\n  };\r\n\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={menuRef}\r\n      className=\"fixed z-[100] bg-surface border border-surface-light/20 rounded-lg shadow-xl py-2 min-w-[200px]\"\r\n      style={{\r\n        left: position.x,\r\n        top: position.y,\r\n        transform: position.y < 200 ? 'translate(-50%, 10px)' : 'translate(-50%, -100%)',\r\n      }}\r\n    >\r\n      {/* Settings Option */}\r\n      <button\r\n        onClick={() => {\r\n          onOpenSettings();\r\n          onClose();\r\n        }}\r\n        className=\"w-full px-4 py-2 text-left text-text-primary hover:bg-surface-light/50 transition-colors duration-200 flex items-center space-x-3\"\r\n      >\r\n        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n        </svg>\r\n        <span>Settings</span>\r\n      </button>\r\n\r\n      {/* Guide Option */}\r\n      {onOpenGuide && (\r\n        <button\r\n          onClick={() => {\r\n            onOpenGuide();\r\n            onClose();\r\n          }}\r\n          className=\"w-full px-4 py-2 text-left text-text-primary hover:bg-gradient-to-r hover:from-[#FF4D4D]/10 hover:to-[#FFAB40]/10 transition-colors duration-200 flex items-center space-x-3\"\r\n        >\r\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253\" />\r\n          </svg>\r\n          <span>Guide</span>\r\n        </button>\r\n      )}\r\n\r\n      {/* Start Free Trial - Only show for free users who haven't used trial */}\r\n      {isTrialEligible && (\r\n        <button\r\n          onClick={handleStartTrial}\r\n          disabled={isStartingTrial}\r\n          className=\"w-full px-4 py-2 text-left text-blue-400 hover:bg-blue-500/10 transition-colors duration-200 flex items-center space-x-3 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n        >\r\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\r\n          </svg>\r\n          <span>{isStartingTrial ? 'Starting...' : 'Start 14-Day Pro Trial'}</span>\r\n        </button>\r\n      )}\r\n\r\n      {/* Divider before logout */}\r\n      <div className=\"border-t border-surface-light/20 my-1\" />\r\n\r\n      {/* Logout Option */}\r\n      <button\r\n        onClick={() => {\r\n          onLogout();\r\n          onClose();\r\n        }}\r\n        className=\"w-full px-4 py-2 text-left text-red-400 hover:bg-red-500/10 transition-colors duration-200 flex items-center space-x-3\"\r\n      >\r\n        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n        </svg>\r\n        <span>Logout</span>\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SettingsContextMenu;\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport { PlayerProfile } from '../../types';\r\n\r\ninterface ProfileSetupBannerProps {\r\n  onComplete: (profile: PlayerProfile) => void;\r\n  onDismiss: () => void;\r\n}\r\n\r\nexport const ProfileSetupBanner: React.FC<ProfileSetupBannerProps> = ({\r\n  onComplete,\r\n  onDismiss\r\n}) => {\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n  const [isMobile, setIsMobile] = useState(() => {\r\n    if (typeof window === 'undefined') {\r\n      return false;\r\n    }\r\n    return window.matchMedia('(max-width: 768px)').matches;\r\n  });\r\n  const [profile, setProfile] = useState<Partial<PlayerProfile>>({\r\n    hintStyle: 'Balanced',\r\n    playerFocus: 'Story-Driven',\r\n    preferredTone: 'Encouraging',\r\n    spoilerTolerance: 'Strict'\r\n  });\r\n  const [currentStep, setCurrentStep] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') {\r\n      return;\r\n    }\r\n\r\n    const query = window.matchMedia('(max-width: 768px)');\r\n    const handleChange = (event: MediaQueryListEvent) => setIsMobile(event.matches);\r\n\r\n    setIsMobile(query.matches);\r\n    query.addEventListener('change', handleChange);\r\n\r\n    return () => query.removeEventListener('change', handleChange);\r\n  }, []);\r\n\r\n  const steps = [\r\n    {\r\n      title: \"How do you like your hints?\",\r\n      field: 'hintStyle' as keyof PlayerProfile,\r\n      options: [\r\n        { value: 'Cryptic', label: ' Cryptic' },\r\n        { value: 'Balanced', label: ' Balanced' },\r\n        { value: 'Direct', label: ' Direct' }\r\n      ]\r\n    },\r\n    {\r\n      title: \"What's your gaming focus?\",\r\n      field: 'playerFocus' as keyof PlayerProfile,\r\n      options: [\r\n        { value: 'Story-Driven', label: ' Story-Driven' },\r\n        { value: 'Completionist', label: ' Completionist' },\r\n        { value: 'Strategist', label: ' Strategist' }\r\n      ]\r\n    },\r\n    {\r\n      title: \"Preferred tone?\",\r\n      field: 'preferredTone' as keyof PlayerProfile,\r\n      options: [\r\n        { value: 'Encouraging', label: ' Encouraging' },\r\n        { value: 'Professional', label: ' Professional' },\r\n        { value: 'Casual', label: ' Casual' }\r\n      ]\r\n    },\r\n    {\r\n      title: \"Spoiler protection?\",\r\n      field: 'spoilerTolerance' as keyof PlayerProfile,\r\n      options: [\r\n        { value: 'Strict', label: ' Strict' },\r\n        { value: 'Moderate', label: ' Moderate' },\r\n        { value: 'Relaxed', label: ' Relaxed' }\r\n      ]\r\n    }\r\n  ];\r\n\r\n  const handleNext = () => {\r\n    if (currentStep < steps.length - 1) {\r\n      setCurrentStep(currentStep + 1);\r\n    } else {\r\n      onComplete(profile as PlayerProfile);\r\n    }\r\n  };\r\n\r\n  const handleBack = () => {\r\n    if (currentStep > 0) {\r\n      setCurrentStep(currentStep - 1);\r\n    }\r\n  };\r\n\r\n  const handleOptionSelect = (field: keyof PlayerProfile, value: string) => {\r\n    setProfile(prev => ({ ...prev, [field]: value }));\r\n    // Auto-advance after selection\r\n    setTimeout(() => {\r\n      if (currentStep < steps.length - 1) {\r\n        setCurrentStep(currentStep + 1);\r\n      } else {\r\n        onComplete({ ...profile, [field]: value } as PlayerProfile);\r\n      }\r\n    }, 300);\r\n  };\r\n\r\n  const currentStepData = steps[currentStep];\r\n  const progressPercent = ((currentStep + 1) / steps.length) * 100;\r\n  const shouldUseOverlay = isExpanded && isMobile;\r\n\r\n  useEffect(() => {\r\n    if (!shouldUseOverlay) {\r\n      return;\r\n    }\r\n\r\n    const originalOverflow = document.body.style.overflow;\r\n    document.body.style.overflow = 'hidden';\r\n\r\n    return () => {\r\n      document.body.style.overflow = originalOverflow;\r\n    };\r\n  }, [shouldUseOverlay]);\r\n\r\n  const collapsedBanner = (\r\n    <div className=\"mx-3 sm:mx-4 lg:mx-6 mb-4 sm:mb-6\">\r\n      <div className=\"bg-gradient-to-r from-[#FF4D4D]/10 to-[#FFAB40]/10 border-2 border-[#FF4D4D]/30 rounded-xl p-4 shadow-lg animate-slide-down backdrop-blur-sm\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-3 flex-1\">\r\n            <div className=\"w-10 h-10 bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] rounded-full flex items-center justify-center flex-shrink-0 shadow-lg\">\r\n              <svg className=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"flex-1 min-w-0\">\r\n              <h3 className=\"text-base sm:text-lg font-semibold text-text-primary\">Personalize Your Experience</h3>\r\n              <p className=\"text-sm text-text-secondary hidden sm:block\">Set up your gaming preferences for better AI responses</p>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center space-x-2 ml-3\">\r\n            <button\r\n              onClick={() => setIsExpanded(true)}\r\n              className=\"px-4 py-2 bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] hover:from-[#D42A2A] hover:to-[#C87A1A] text-white text-sm font-bold rounded-lg transition-all hover:scale-105 active:scale-95 whitespace-nowrap shadow-lg\"\r\n            >\r\n              Set Up\r\n            </button>\r\n            <button\r\n              onClick={onDismiss}\r\n              className=\"p-2 text-text-muted hover:text-text-primary transition-colors\"\r\n              aria-label=\"Dismiss banner\"\r\n            >\r\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  if (!isExpanded) {\r\n    return collapsedBanner;\r\n  }\r\n\r\n  const expandedCard = (\r\n    <div\r\n      className=\"bg-gradient-to-br from-[#1C1C1C] to-[#0A0A0A] border-2 border-[#FF4D4D]/30 rounded-xl shadow-2xl overflow-hidden animate-scale-in backdrop-blur-xl\"\r\n      role=\"dialog\"\r\n      aria-modal={isMobile}\r\n      aria-label=\"Profile setup wizard\"\r\n    >\r\n      {/* Header */}\r\n      <div className=\"bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] p-4 sm:p-5 shadow-xl\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <div>\r\n            <h2 className=\"text-xl sm:text-2xl font-bold text-white\">Quick Setup</h2>\r\n            <p className=\"text-white/90 text-sm mt-1\">Step {currentStep + 1} of {steps.length}</p>\r\n          </div>\r\n          <button\r\n            onClick={() => setIsExpanded(false)}\r\n            className=\"p-2 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors\"\r\n            aria-label=\"Minimize\"\r\n          >\r\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Progress bar */}\r\n        <div className=\"bg-white/20 rounded-full h-2 shadow-inner\">\r\n          <div\r\n            className=\"bg-white rounded-full h-2 transition-all duration-300 shadow-lg\"\r\n            style={{ width: `${progressPercent}%` }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"p-4 sm:p-6\">\r\n        <h3 className=\"text-lg font-semibold text-text-primary mb-4\">{currentStepData.title}</h3>\r\n\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\r\n          {currentStepData.options.map((option) => (\r\n            <button\r\n              key={option.value}\r\n              onClick={() => handleOptionSelect(currentStepData.field, option.value)}\r\n              className={`p-4 text-center rounded-lg border-2 transition-all duration-200 hover:scale-105 active:scale-95 ${\r\n                profile[currentStepData.field] === option.value\r\n                  ? 'border-[#FF4D4D] bg-gradient-to-br from-[#FF4D4D]/20 to-[#FFAB40]/20 text-text-primary ring-2 ring-[#FF4D4D]/50 shadow-lg'\r\n                  : 'border-surface-light/30 bg-surface/50 text-text-secondary hover:border-[#FF4D4D]/50 hover:bg-surface-light/30'\r\n              }`}\r\n            >\r\n              <div className=\"text-2xl mb-2\">{option.label.split(' ')[0]}</div>\r\n              <div className=\"text-sm font-medium\">{option.label.split(' ').slice(1).join(' ')}</div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Navigation */}\r\n        <div className=\"flex justify-between mt-6 pt-4 border-t border-surface-light/20\">\r\n          <div className=\"flex space-x-2\">\r\n            {currentStep > 0 && (\r\n              <button\r\n                onClick={handleBack}\r\n                className=\"px-4 py-2 bg-surface hover:bg-surface-light text-text-primary rounded-lg transition-colors text-sm font-medium\"\r\n              >\r\n                 Back\r\n              </button>\r\n            )}\r\n            <button\r\n              onClick={onDismiss}\r\n              className=\"px-4 py-2 text-text-muted hover:text-text-primary transition-colors text-sm\"\r\n            >\r\n              Skip for now\r\n            </button>\r\n          </div>\r\n\r\n          <button\r\n            onClick={handleNext}\r\n            className=\"px-6 py-2 bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] hover:from-[#D42A2A] hover:to-[#C87A1A] text-white font-bold rounded-lg transition-all hover:scale-105 active:scale-95 text-sm shadow-lg\"\r\n          >\r\n            {currentStep === steps.length - 1 ? ' Complete' : 'Next '}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  if (shouldUseOverlay) {\r\n    const handleOverlayClick = (event: React.MouseEvent<HTMLDivElement>) => {\r\n      if (event.target === event.currentTarget) {\r\n        setIsExpanded(false);\r\n      }\r\n    };\r\n\r\n    return (\r\n      <div\r\n        className=\"fixed inset-0 z-[70] flex items-center justify-center px-4 py-6 bg-black/80 backdrop-blur-lg\"\r\n        onClick={handleOverlayClick}\r\n      >\r\n        <div className=\"w-full max-w-md max-h-[90vh] overflow-y-auto custom-scrollbar\">\r\n          {expandedCard}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"mx-3 sm:mx-4 lg:mx-6 mb-4 sm:mb-6\">\r\n      {expandedCard}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProfileSetupBanner;\r\n","import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\r\nimport { User, Conversation, Conversations, newsPrompts, ConnectionStatus } from '../types';\r\nimport { GAME_HUB_ID } from '../constants';\r\nimport { ConversationService } from '../services/conversationService';\r\nimport { authService } from '../services/authService';\r\nimport { aiService } from '../services/aiService';\r\nimport { useActiveSession } from '../hooks/useActiveSession';\r\nimport { suggestedPromptsService } from '../services/suggestedPromptsService';\r\nimport { sessionSummaryService } from '../services/sessionSummaryService';\r\nimport { gameTabService } from '../services/gameTabService';\r\nimport { errorRecoveryService } from '../services/errorRecoveryService';\r\nimport { UserService } from '../services/userService';\r\nimport { SupabaseService } from '../services/supabaseService';\r\nimport { tabManagementService } from '../services/tabManagementService';\r\nimport { ttsService } from '../services/ttsService';\r\nimport { toastService } from '../services/toastService';\r\nimport { MessageRoutingService } from '../services/messageRoutingService';\r\nimport Sidebar from './layout/Sidebar';\r\nimport ChatInterface from './features/ChatInterface';\r\nimport SettingsModal from './modals/SettingsModal';\r\nimport CreditModal from './modals/CreditModal';\r\nimport ConnectionModal from './modals/ConnectionModal';\r\nimport HandsFreeModal from './modals/HandsFreeModal';\r\nimport AddGameModal from './modals/AddGameModal';\r\nimport Logo from './ui/Logo';\r\nimport CreditIndicator from './ui/CreditIndicator';\r\nimport HandsFreeToggle from './ui/HandsFreeToggle';\r\nimport { LoadingSpinner } from './ui/LoadingSpinner';\r\nimport SettingsContextMenu from './ui/SettingsContextMenu';\r\nimport ProfileSetupBanner from './ui/ProfileSetupBanner';\r\nimport GameProgressBar from './features/GameProgressBar';\r\nimport { connect, disconnect } from '../services/websocketService';\r\n\r\ninterface MainAppProps {\r\n  onLogout: () => void;\r\n  onOpenSettings: () => void;\r\n  onOpenAbout?: () => void;\r\n  onOpenPrivacy?: () => void;\r\n  onOpenRefund?: () => void;\r\n  onOpenContact?: () => void;\r\n  onOpenTerms?: () => void;\r\n  connectionStatus?: ConnectionStatus;\r\n  connectionError?: string | null;\r\n  onConnect?: (_code: string) => void;\r\n  onDisconnect?: () => void;\r\n  onClearConnectionError?: () => void;\r\n  onWebSocketMessage?: (_data: any) => void;\r\n  showProfileSetupBanner?: boolean;\r\n  onProfileSetupComplete?: (_profileData: any) => void;\r\n  onProfileSetupDismiss?: () => void;\r\n}\r\n\r\nconst MainApp: React.FC<MainAppProps> = ({\r\n  onLogout,\r\n  onOpenSettings: _onOpenSettings,\r\n  onOpenAbout: _onOpenAbout,\r\n  onOpenPrivacy: _onOpenPrivacy,\r\n  onOpenRefund: _onOpenRefund,\r\n  onOpenContact: _onOpenContact,\r\n  onOpenTerms: _onOpenTerms,\r\n  connectionStatus: propConnectionStatus,\r\n  connectionError: propConnectionError,\r\n  onConnect: propOnConnect,\r\n  onDisconnect: propOnDisconnect,\r\n  onClearConnectionError: propOnClearConnectionError,\r\n  onWebSocketMessage: propOnWebSocketMessage,\r\n  showProfileSetupBanner = false,\r\n  onProfileSetupComplete,\r\n  onProfileSetupDismiss,\r\n}) => {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [conversations, setConversations] = useState<Conversations>({});\r\n  const [activeConversation, setActiveConversation] = useState<Conversation | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isInitializing, setIsInitializing] = useState(true);\r\n  const [suggestedPrompts, setSuggestedPrompts] = useState<string[]>([]);\r\n  const [abortController, setAbortController] = useState<AbortController | null>(null);\r\n  \r\n  // Active session management\r\n  const { session, toggleSession, setActiveSession } = useActiveSession();\r\n  const [isManualUploadMode, setIsManualUploadMode] = useState(() => {\r\n    // Restore from localStorage, default to true (auto-upload OFF)\r\n    const saved = localStorage.getItem('otakon_manual_upload_mode');\r\n    return saved !== null ? saved === 'true' : true;\r\n  });\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n  const [settingsOpen, setSettingsOpen] = useState(false);\r\n  const [creditModalOpen, setCreditModalOpen] = useState(false);\r\n  const [connectionModalOpen, setConnectionModalOpen] = useState(false);\r\n  const [connectionCode, setConnectionCode] = useState<string | null>(null);\r\n  const [lastSuccessfulConnection, setLastSuccessfulConnection] = useState<Date | null>(null);\r\n  \r\n  // Hands-free mode state (persisted to localStorage)\r\n  const [isHandsFreeMode, setIsHandsFreeMode] = useState(() => {\r\n    const saved = localStorage.getItem('otakonHandsFreeMode');\r\n    return saved === 'true';\r\n  });\r\n  const [handsFreeModalOpen, setHandsFreeModalOpen] = useState(false);\r\n  \r\n  // Input preservation for tab switching\r\n  const [currentInputMessage, setCurrentInputMessage] = useState<string>('');\r\n  \r\n  //  NEW: Queued screenshot from WebSocket (manual mode)\r\n  const [queuedScreenshot, setQueuedScreenshot] = useState<string | null>(null);\r\n  \r\n  //  PERFORMANCE: Loading guards to prevent concurrent conversation loading\r\n  const isLoadingConversationsRef = useRef(false);\r\n  const hasLoadedConversationsRef = useRef(false);\r\n  \r\n  //  Ref to store latest handleSendMessage function\r\n  const handleSendMessageRef = useRef<((message: string, imageUrl?: string) => Promise<void>) | null>(null);\r\n  \r\n  //  PERFORMANCE: Memoize currentUser to prevent re-creating object on every render\r\n  const currentUser = useMemo(() => user || { tier: 'free' } as User, [user]);\r\n  \r\n  // Add Game modal state\r\n  const [addGameModalOpen, setAddGameModalOpen] = useState(false);\r\n  \r\n  // Helper function to deep clone conversations to force React re-renders\r\n  const deepCloneConversations = (conversations: Conversations): Conversations => {\r\n    const cloned: Conversations = {};\r\n    Object.keys(conversations).forEach(key => {\r\n      cloned[key] = {\r\n        ...conversations[key],\r\n        //  DEEP CLONE: Clone array AND each subtab object (fixes React change detection)\r\n        subtabs: conversations[key].subtabs \r\n          ? conversations[key].subtabs?.map(tab => ({ ...tab }))\r\n          : undefined,\r\n        //  DEEP CLONE: Clone each message object\r\n        messages: conversations[key].messages.map(msg => ({ ...msg }))\r\n      };\r\n    });\r\n    return cloned;\r\n  };\r\n  \r\n  // Settings context menu state\r\n  const [settingsContextMenu, setSettingsContextMenu] = useState<{\r\n    isOpen: boolean;\r\n    position: { x: number; y: number };\r\n  }>({\r\n    isOpen: false,\r\n    position: { x: 0, y: 0 },\r\n  });\r\n  \r\n  // Use props for connection state, fallback to local state if not provided\r\n  const connectionStatus = propConnectionStatus ?? ConnectionStatus.DISCONNECTED;\r\n  const connectionError = propConnectionError ?? null;\r\n\r\n  // Restore connection state from localStorage on mount\r\n  useEffect(() => {\r\n    const savedConnectionCode = localStorage.getItem('otakon_connection_code');\r\n    if (savedConnectionCode) {\r\n      setConnectionCode(savedConnectionCode);\r\n      const lastConnection = localStorage.getItem('otakon_last_connection');\r\n      if (lastConnection) {\r\n        setLastSuccessfulConnection(new Date(lastConnection));\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Initialize TTS service on mount\r\n  useEffect(() => {\r\n    ttsService.init().catch((err: Error) => {\r\n      console.warn('Failed to initialize TTS service:', err);\r\n    });\r\n  }, []);\r\n\r\n  // Persist auto-upload mode setting to localStorage\r\n  useEffect(() => {\r\n    localStorage.setItem('otakon_manual_upload_mode', String(isManualUploadMode));\r\n  }, [isManualUploadMode]);\r\n\r\n  // Handle WebSocket messages for screenshot processing\r\n  const handleWebSocketMessage = useCallback((data: any) => {\r\n    console.log(' [MainApp] Received WebSocket message:', data);\r\n    \r\n    if (data.type === 'screenshot' && data.dataUrl) {\r\n      console.log(' [MainApp] Processing screenshot:', {\r\n        dataUrlLength: data.dataUrl.length,\r\n        dataUrlPreview: data.dataUrl.substring(0, 50),\r\n        isManualUploadMode,\r\n        hasActiveConversation: !!activeConversation\r\n      });\r\n      \r\n      if (isManualUploadMode) {\r\n        //  FIXED: In manual mode, queue the image for ChatInterface (not text input!)\r\n        console.log(' [MainApp] Manual mode: Setting queuedScreenshot state');\r\n        setQueuedScreenshot(data.dataUrl);\r\n        console.log(' [MainApp] queuedScreenshot state should now be set');\r\n        toastService.info('Screenshot queued. Review and send when ready.');\r\n        return; // Don't send automatically in manual mode\r\n      }\r\n      \r\n      // Auto mode: Send the screenshot to the active conversation immediately\r\n      if (activeConversation && handleSendMessageRef.current) {\r\n        console.log(' Auto mode: Sending screenshot immediately');\r\n        handleSendMessageRef.current(\"\", data.dataUrl);\r\n        // Clear the queued screenshot immediately after sending in auto mode\r\n        setQueuedScreenshot(null);\r\n      } else {\r\n        console.warn(' No active conversation to send screenshot to');\r\n        toastService.warning('No active conversation. Please select or create a conversation first.');\r\n      }\r\n    }\r\n  }, [isManualUploadMode, activeConversation]);\r\n\r\n  // Clear queued screenshot when it's been used\r\n  const handleScreenshotQueued = () => {\r\n    setQueuedScreenshot(null);\r\n  };\r\n\r\n  // Debug: Log when queuedScreenshot changes\r\n  useEffect(() => {\r\n    console.log(' [MainApp] queuedScreenshot state changed:', {\r\n      hasQueuedScreenshot: !!queuedScreenshot,\r\n      queuedScreenshotLength: queuedScreenshot?.length,\r\n      queuedScreenshotPreview: queuedScreenshot?.substring(0, 50)\r\n    });\r\n  }, [queuedScreenshot]);\r\n\r\n  // Expose the message handler to parent\r\n  useEffect(() => {\r\n    if (propOnWebSocketMessage) {\r\n      propOnWebSocketMessage(handleWebSocketMessage);\r\n    }\r\n  }, [propOnWebSocketMessage, handleWebSocketMessage]);\r\n\r\n  useEffect(() => {\r\n    const loadData = async (retryCount = 0) => {\r\n      //  PERFORMANCE: Guard against concurrent loads\r\n      if (isLoadingConversationsRef.current) {\r\n        console.log(' [MainApp] Already loading conversations, skipping...');\r\n        return;\r\n      }\r\n      \r\n      //  PERFORMANCE: Skip if already loaded (unless retry)\r\n      if (hasLoadedConversationsRef.current && retryCount === 0) {\r\n        console.log(' [MainApp] Conversations already loaded, skipping...');\r\n        return;\r\n      }\r\n      \r\n      isLoadingConversationsRef.current = true;\r\n      \r\n      try {\r\n        // Get user from AuthService instead of UserService\r\n        const currentUser = authService.getCurrentUser();\r\n        if (currentUser) {\r\n          setUser(currentUser);\r\n          // Also sync to UserService for compatibility\r\n          UserService.setCurrentUser(currentUser);\r\n        } else if (retryCount === 0) {\r\n          // If no user on first attempt, wait a bit for auth state to settle after onboarding\r\n          console.log(' [MainApp] No user found, retrying in 500ms...');\r\n          setTimeout(() => loadData(1), 500);\r\n          return;\r\n        }\r\n\r\n        console.log(' [MainApp] Loading conversations (attempt', retryCount + 1, ')');\r\n        const userConversations = await ConversationService.getConversations();\r\n        console.log(' [MainApp] Loaded conversations:', userConversations);\r\n        \r\n        // Migration: Fix old \"Everything else\" or ensure Game Hub exists\r\n        // Note: conversationService.getConversations() already handles the migration\r\n        \r\n        setConversations(userConversations);\r\n\r\n        let active = await ConversationService.getActiveConversation();\r\n        console.log(' [MainApp] Active conversation from service:', active);\r\n\r\n        // Handle all cases to ensure \"Game Hub\" is always available and active by default\r\n        const currentGameHub = Object.values(userConversations).find(\r\n          conv => conv.isGameHub || conv.title === 'Game Hub' || conv.id === 'game-hub'\r\n        );\r\n\r\n        // Case 1: No conversations at all - create \"Game Hub\" and set as active\r\n        if (Object.keys(userConversations).length === 0) {\r\n          console.log(' [MainApp] No conversations found, ensuring Game Hub exists...');\r\n          const gameHub = await ConversationService.ensureGameHubExists();\r\n          await ConversationService.setActiveConversation(gameHub.id);\r\n          \r\n          // Reload conversations to get the Game Hub\r\n          const updatedConversations = await ConversationService.getConversations();\r\n          setConversations(updatedConversations);\r\n          active = updatedConversations[gameHub.id];\r\n          setActiveConversation(active);\r\n          \r\n          // Mark as first-run complete since we just created and activated Game Hub\r\n          localStorage.setItem('otakon_has_used_app', 'true');\r\n          console.log(' [MainApp] Created and activated \"Game Hub\" conversation (first-run complete)');\r\n          console.log(' [MainApp] Active conversation details:', {\r\n            id: active?.id,\r\n            title: active?.title,\r\n            isActive: active?.isActive,\r\n            isGameHub: active?.isGameHub,\r\n            messageCount: active?.messages?.length || 0\r\n          });\r\n        }\r\n        // Case 2: Game Hub exists but nothing is active - set Game Hub as active\r\n        // This handles first-time users after onboarding, as well as returning users\r\n        else if (!active && currentGameHub) {\r\n          console.log(' [MainApp] No active conversation found, activating Game Hub');\r\n          await ConversationService.setActiveConversation(currentGameHub.id);\r\n          const updatedConversations = await ConversationService.getConversations();\r\n          setConversations(updatedConversations);\r\n          active = updatedConversations[currentGameHub.id];\r\n          setActiveConversation(active);\r\n          console.log(' [MainApp] Game Hub activated:', {\r\n            id: active?.id,\r\n            title: active?.title,\r\n            isActive: active?.isActive\r\n          });\r\n        }\r\n        // Case 4: No \"Game Hub\" conversation but other conversations exist - create and activate it\r\n        else if (!currentGameHub) {\r\n          console.log(' [MainApp] \"Game Hub\" missing, ensuring it exists...');\r\n          const gameHub = await ConversationService.ensureGameHubExists();\r\n          \r\n          // If no active conversation, make \"Game Hub\" active\r\n          if (!active) {\r\n            await ConversationService.setActiveConversation(gameHub.id);\r\n            const updatedConversations = await ConversationService.getConversations();\r\n            setConversations(updatedConversations);\r\n            active = updatedConversations[gameHub.id];\r\n            setActiveConversation(active);\r\n            console.log(' [MainApp] Ensured Game Hub exists and set as active');\r\n          } else {\r\n            // Otherwise, just add it but keep current active conversation\r\n            const updatedConversations = await ConversationService.getConversations();\r\n            setConversations(updatedConversations);\r\n            setActiveConversation(active);\r\n            console.log(' [MainApp] Ensured Game Hub exists but kept existing active conversation:', active.title);\r\n          }\r\n        }\r\n        // Case 5: Active conversation exists - restore it\r\n        else if (active) {\r\n          console.log(' [MainApp] Restoring active conversation:', active.title, 'with ID:', active.id);\r\n          setActiveConversation(active);\r\n        }\r\n        // Case 6: FALLBACK - No active conversation but Game Hub exists\r\n        else if (currentGameHub) {\r\n          console.log(' [MainApp] No active conversation, falling back to Game Hub');\r\n          await ConversationService.setActiveConversation(currentGameHub.id);\r\n          const updatedConversations = await ConversationService.getConversations();\r\n          setConversations(updatedConversations);\r\n          setActiveConversation(updatedConversations[currentGameHub.id]);\r\n        }\r\n\r\n        // Set initial suggested prompts for the active conversation\r\n        const finalActive = active || currentGameHub;\r\n        if (finalActive) {\r\n          if (finalActive.isGameHub || finalActive.id === GAME_HUB_ID) {\r\n            // For Game Hub tab, show news prompts if no messages\r\n            if (!finalActive.messages || finalActive.messages.length === 0) {\r\n              setSuggestedPrompts(newsPrompts);\r\n            } else {\r\n              const fallbackPrompts = suggestedPromptsService.getFallbackSuggestions(finalActive.id, finalActive.isGameHub);\r\n              setSuggestedPrompts(fallbackPrompts);\r\n            }\r\n          } else {\r\n            // For game tabs, show fallback prompts\r\n            const fallbackPrompts = suggestedPromptsService.getFallbackSuggestions(finalActive.id, finalActive.isGameHub);\r\n            setSuggestedPrompts(fallbackPrompts);\r\n          }\r\n        }\r\n        \r\n        //  CRITICAL: Only mark initialization as complete if we have an active conversation\r\n        // This prevents showing \"Loading chat...\" when there's no active conversation set\r\n        if (finalActive) {\r\n          console.log(' [MainApp] Initialization complete with active conversation:', finalActive.title);\r\n          setIsInitializing(false);\r\n        } else {\r\n          console.error(' [MainApp] ERROR: No active conversation after initialization!');\r\n          // Force Game Hub as active if we somehow got here without one\r\n          const gameHubConv = Object.values(userConversations).find(\r\n            conv => conv.isGameHub || conv.title === 'Game Hub' || conv.id === 'game-hub'\r\n          );\r\n          if (gameHubConv) {\r\n            await ConversationService.setActiveConversation(gameHubConv.id);\r\n            const updatedConversations = await ConversationService.getConversations();\r\n            setConversations(updatedConversations);\r\n            setActiveConversation(updatedConversations[gameHubConv.id]);\r\n          }\r\n          setIsInitializing(false);\r\n        }\r\n        \r\n        //  PERFORMANCE: Mark conversations as successfully loaded\r\n        hasLoadedConversationsRef.current = true;\r\n      } catch (error) {\r\n        console.error(' [MainApp] Error loading data:', error);\r\n        \r\n        // Retry up to 3 times with exponential backoff\r\n        if (retryCount < 3) {\r\n          const delay = Math.pow(2, retryCount) * 1000; // 1s, 2s, 4s\r\n          console.log(` [MainApp] Retrying in ${delay}ms...`);\r\n          setTimeout(() => loadData(retryCount + 1), delay);\r\n        } else {\r\n          console.error(' [MainApp] Failed to load data after 3 attempts');\r\n          toastService.error('Failed to load conversations. Please refresh the page.', {\r\n            action: {\r\n              label: 'Refresh',\r\n              onClick: () => window.location.reload()\r\n            }\r\n          });\r\n          // Set a fallback state to prevent infinite loading\r\n          setActiveConversation(null);\r\n          setIsInitializing(false);\r\n        }\r\n      } finally {\r\n        //  PERFORMANCE: Always clear the loading flag\r\n        isLoadingConversationsRef.current = false;\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, []);\r\n\r\n  // Safety timeout: Force initialization complete after 3 seconds to prevent infinite loading\r\n  useEffect(() => {\r\n    const timeout = setTimeout(() => {\r\n      if (isInitializing) {\r\n        // Only force complete if we have conversations, even without user\r\n        if (Object.keys(conversations).length > 0 || activeConversation) {\r\n          console.warn(' [MainApp] Initialization timeout - but we have conversations, forcing completion');\r\n          setIsInitializing(false);\r\n        } else {\r\n          // Try to get user and load conversations one more time\r\n          console.warn(' [MainApp] Initialization timeout - retrying to load user and conversations');\r\n          const currentUser = authService.getCurrentUser();\r\n          if (currentUser) {\r\n            setUser(currentUser);\r\n            UserService.setCurrentUser(currentUser);\r\n            setIsInitializing(false);\r\n          }\r\n        }\r\n      }\r\n    }, 3000); // Increased from 1s to 3s to allow Game Hub creation to complete\r\n    \r\n    return () => clearTimeout(timeout);\r\n  }, [isInitializing, conversations, activeConversation]);\r\n\r\n  //  DISABLED: This continuous polling conflicts with targeted pollForSubtabUpdates\r\n  // The targeted polling (triggered after game tab creation) is more efficient\r\n  // and prevents infinite loops. This effect was causing duplicate polling.\r\n  /*\r\n  // Poll for conversation updates when subtabs are loading\r\n  useEffect(() => {\r\n    const pollForSubtabUpdates = async () => {\r\n      // Check if any conversation has loading subtabs\r\n      const hasLoadingSubtabs = Object.values(conversations).some(conv => \r\n        conv.subtabs?.some(tab => tab.status === 'loading')\r\n      );\r\n\r\n      if (!hasLoadingSubtabs) {\r\n        // All subtabs loaded, no need to poll\r\n        return;\r\n      }\r\n\r\n      console.log(' [MainApp] Polling for subtab updates...');\r\n      \r\n      //  FIX 1: Skip cache to get fresh data\r\n      const updatedConversations = await ConversationService.getConversations(true);\r\n      \r\n      //  FIX 2: Only update if subtabs actually changed (prevents unnecessary re-renders)\r\n      setConversations(prevConversations => {\r\n        const freshConversations = deepCloneConversations(updatedConversations);\r\n        \r\n        // Check if subtabs have actually been updated\r\n        let hasChanges = false;\r\n        Object.keys(freshConversations).forEach(convId => {\r\n          const prev = prevConversations[convId];\r\n          const curr = freshConversations[convId];\r\n          \r\n          if (prev && curr && prev.subtabs && curr.subtabs) {\r\n            const prevLoadingCount = prev.subtabs.filter(t => t.status === 'loading').length;\r\n            const currLoadingCount = curr.subtabs.filter(t => t.status === 'loading').length;\r\n            \r\n            if (prevLoadingCount !== currLoadingCount) {\r\n              hasChanges = true;\r\n              console.log(` [MainApp] Subtab status changed in ${curr.gameTitle}: ${prevLoadingCount}  ${currLoadingCount} loading`);\r\n            }\r\n            \r\n            //  NEW: Check content, status, and isNew changes\r\n            if (!hasChanges) {\r\n              for (let i = 0; i < prev.subtabs.length; i++) {\r\n                const prevTab = prev.subtabs[i];\r\n                const currTab = curr.subtabs[i];\r\n                \r\n                if (currTab && prevTab && (\r\n                  prevTab.content !== currTab.content ||      //  Content changed\r\n                  prevTab.status !== currTab.status ||        //  Status changed\r\n                  prevTab.isNew !== currTab.isNew             //  New flag changed\r\n                )) {\r\n                  hasChanges = true;\r\n                  console.log(` [MainApp] Subtab updated: ${currTab.title} (status: ${prevTab.status}  ${currTab.status})`);\r\n                  break;\r\n                }\r\n              }\r\n            }\r\n          }\r\n        });\r\n        \r\n        // Only update if subtabs changed\r\n        if (hasChanges) {\r\n          console.log(' [MainApp] Subtabs updated, refreshing state');\r\n          \r\n          //  CRITICAL: Always update activeConversation when subtabs change\r\n          // This ensures the user sees newly loaded content immediately without switching tabs\r\n          if (activeConversation && freshConversations[activeConversation.id]) {\r\n            console.log(' [MainApp] Updating active conversation with fresh data (including subtab content)');\r\n            setActiveConversation(freshConversations[activeConversation.id]);\r\n          }\r\n          \r\n          return freshConversations;\r\n        }\r\n        \r\n        console.log(' [MainApp] No subtab changes, keeping current state');\r\n        return prevConversations; // Keep existing state (preserves messages)\r\n      });\r\n    };\r\n\r\n    //  FIX: Reduce polling frequency to 2 seconds AND stop when all loaded\r\n    const interval = setInterval(pollForSubtabUpdates, 2000);\r\n    \r\n    // Cleanup on unmount\r\n    return () => clearInterval(interval);\r\n  }, [conversations, activeConversation]);\r\n  */\r\n\r\n  // Function to refresh user data (for credit updates)\r\n  const refreshUserData = async () => {\r\n    try {\r\n      const currentUser = authService.getCurrentUser();\r\n      if (currentUser) {\r\n        setUser(currentUser);\r\n        UserService.setCurrentUser(currentUser);\r\n        console.log(' [MainApp] User data refreshed for credit update');\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to refresh user data:', error);\r\n      toastService.warning('Failed to refresh user data. Please refresh the page if you experience issues.');\r\n    }\r\n  };\r\n\r\n  // WebSocket message handling (only if using local websocket)\r\n  useEffect(() => {\r\n    if (propOnConnect) {\r\n      // Using App.tsx connection state, no local websocket needed\r\n      return;\r\n    }\r\n\r\n\r\n    const handleWebSocketError = (error: string) => {\r\n      console.error('WebSocket error:', error);\r\n    };\r\n\r\n    const handleWebSocketOpen = () => {\r\n      console.log(' WebSocket connected');\r\n      // Save connection time for status tracking\r\n      setLastSuccessfulConnection(new Date());\r\n    };\r\n\r\n    const handleWebSocketClose = () => {\r\n      console.log(' WebSocket disconnected');\r\n    };\r\n\r\n    // Check if we have a stored connection code and try to reconnect\r\n    const storedCode = localStorage.getItem('otakon_connection_code');\r\n    if (storedCode) {\r\n      setConnectionCode(storedCode);\r\n      connect(storedCode, handleWebSocketOpen, handleWebSocketMessage, handleWebSocketError, handleWebSocketClose);\r\n    }\r\n\r\n    // Note: Removed automatic disconnect on unmount to maintain persistent connection\r\n    // WebSocket should only disconnect when user explicitly disconnects or logs out\r\n  }, [activeConversation, propOnConnect, handleWebSocketMessage]);\r\n\r\n\r\n  const handleConversationSelect = async (id: string) => {\r\n    console.error(' [MainApp] Switching to conversation:', id);\r\n    \r\n    //  CRITICAL FIX: ALWAYS use local state as source of truth\r\n    // Reloading from service can cause race conditions where newly created tabs disappear\r\n    // because background sync hasn't completed yet\r\n    const targetConversation = conversations[id];\r\n    if (!targetConversation) {\r\n      console.error(' [MainApp]  Conversation not found in local state:', id);\r\n      console.error(' [MainApp] Available conversations:', Object.keys(conversations));\r\n      console.error(' [MainApp] This should NOT happen - conversation should exist in state');\r\n      \r\n      // Last resort: reload from service, but this indicates a bug\r\n      const updatedConversations = await ConversationService.getConversations();\r\n      const mergedConversations = {\r\n        ...conversations, // Keep existing local state\r\n        ...updatedConversations // Add anything from DB\r\n      };\r\n      setConversations(mergedConversations);\r\n      setActiveConversation(mergedConversations[id]);\r\n    } else {\r\n      //  PERFORMANCE FIX: Update UI immediately without waiting for database sync\r\n      console.error(' [MainApp]  Instant UI update for conversation:', id);\r\n      \r\n      // Update local state first (instant UI feedback)\r\n      setActiveConversation(targetConversation);\r\n      setSidebarOpen(false);\r\n      \r\n      //  CRITICAL FIX: Save current conversations state to DB BEFORE switching\r\n      // This ensures the new tab is persisted even if user switches quickly\r\n      ConversationService.setConversations(conversations).catch(error => {\r\n        console.error(' [MainApp] Failed to persist conversations:', error);\r\n      });\r\n      \r\n      // Update active conversation in service in background (don't await)\r\n      // This prevents blocking the UI while syncing to Supabase\r\n      ConversationService.setActiveConversation(id).catch(error => {\r\n        console.error(' [MainApp] Failed to sync active conversation:', error);\r\n      });\r\n    }\r\n    \r\n    // Close sidebar immediately after selecting\r\n    if (!targetConversation) {\r\n      setSidebarOpen(false);\r\n    }\r\n\r\n    // Set initial suggested prompts for Game Hub tab\r\n    const conversation = conversations[id];\r\n    if (conversation?.isGameHub || id === GAME_HUB_ID) {\r\n      // If no messages yet, show news prompts (they will be displayed by SuggestedPrompts component)\r\n      if (!conversation || !conversation.messages || conversation.messages.length === 0) {\r\n        // SuggestedPrompts component will handle showing newsPrompts for Game Hub\r\n        // We just need to ensure prompts array is not empty\r\n        setSuggestedPrompts(newsPrompts);\r\n      } else {\r\n        // If there are messages, show contextual fallback prompts\r\n        const fallbackPrompts = suggestedPromptsService.getFallbackSuggestions(id, conversation.isGameHub);\r\n        setSuggestedPrompts(fallbackPrompts);\r\n      }\r\n    } else {\r\n      // For game tabs, set appropriate fallback prompts\r\n      const fallbackPrompts = suggestedPromptsService.getFallbackSuggestions(id, conversation?.isGameHub);\r\n      setSuggestedPrompts(fallbackPrompts);\r\n    }\r\n  };\r\n\r\n  const handleDeleteConversation = async (id: string) => {\r\n    const wasActive = activeConversation?.id === id;\r\n    \r\n    // Delete the conversation\r\n    await ConversationService.deleteConversation(id);\r\n    \r\n    // Get fresh conversations from service\r\n    const updatedConversations = await ConversationService.getConversations();\r\n    \r\n    // Force a new object reference to ensure React detects the change\r\n    const freshConversations = { ...updatedConversations };\r\n    \r\n    // Update conversations state immediately\r\n    setConversations(freshConversations);\r\n    \r\n    if (wasActive) {\r\n      // If we're deleting the current active conversation, switch to \"Game Hub\" tab\r\n      const gameHubTab = freshConversations[GAME_HUB_ID] || freshConversations['game-hub'];\r\n      if (gameHubTab) {\r\n        // Persist the active conversation change\r\n        await ConversationService.setActiveConversation(gameHubTab.id);\r\n        setActiveConversation(gameHubTab);\r\n        // Also clear any active session since we're switching away from a game tab\r\n        setActiveSession('', false);\r\n      } else {\r\n        // Fallback to first available conversation\r\n        const firstConversation = Object.values(freshConversations)[0] || null;\r\n        if (firstConversation) {\r\n          await ConversationService.setActiveConversation(firstConversation.id);\r\n          setActiveConversation(firstConversation);\r\n        } else {\r\n          setActiveConversation(null);\r\n        }\r\n      }\r\n      // Close sidebar on mobile after switching\r\n      setSidebarOpen(false);\r\n    }\r\n  };\r\n\r\n  const handlePinConversation = async (id: string) => {\r\n    // Check if we can pin (max 3 pinned conversations)\r\n    const pinnedCount = Object.values(conversations).filter((conv: Conversation) => conv.isPinned).length;\r\n    if (pinnedCount >= 3) {\r\n      alert('You can only pin up to 3 conversations. Please unpin another conversation first.');\r\n      return;\r\n    }\r\n\r\n    await ConversationService.updateConversation(id, { \r\n      isPinned: true, \r\n      pinnedAt: Date.now() \r\n    });\r\n    const updatedConversations = await ConversationService.getConversations();\r\n    setConversations(updatedConversations);\r\n  };\r\n\r\n  const handleUnpinConversation = async (id: string) => {\r\n    await ConversationService.updateConversation(id, { \r\n      isPinned: false, \r\n      pinnedAt: undefined \r\n    });\r\n    const updatedConversations = await ConversationService.getConversations();\r\n    setConversations(updatedConversations);\r\n  };\r\n\r\n  const handleClearConversation = async (id: string) => {\r\n    await ConversationService.clearConversation(id);\r\n    const updatedConversations = await ConversationService.getConversations();\r\n    setConversations(updatedConversations);\r\n    \r\n    // If this was the active conversation, update it\r\n    if (activeConversation?.id === id) {\r\n      setActiveConversation(updatedConversations[id]);\r\n    }\r\n  };\r\n\r\n\r\n\r\n  const handleCreditModalOpen = () => {\r\n    setCreditModalOpen(true);\r\n  };\r\n\r\n  const handleCreditModalClose = () => {\r\n    setCreditModalOpen(false);\r\n  };\r\n\r\n  const handleUpgrade = () => {\r\n    // TODO: Implement upgrade functionality\r\n    console.log('Upgrade clicked');\r\n  };\r\n\r\n  const handleOpenGuide = () => {\r\n    // Guide functionality removed - no longer showing welcome screen\r\n  };\r\n\r\n  const handleAddGame = () => {\r\n    setAddGameModalOpen(true);\r\n  };\r\n\r\n  const handleCreateGame = async (gameName: string, query: string) => {\r\n    // Switch to Game Hub\r\n    const gameHub = Object.values(conversations).find(\r\n      (conv) => conv.isGameHub || conv.id === 'game-hub' || conv.title === 'Game Hub'\r\n    );\r\n    \r\n    if (!gameHub) {\r\n      toastService.error('Game Hub not found. Please refresh the page.');\r\n      return;\r\n    }\r\n\r\n    // Switch to Game Hub and close modal\r\n    await ConversationService.setActiveConversation(gameHub.id);\r\n    setActiveConversation(gameHub);\r\n    setAddGameModalOpen(false);\r\n    \r\n    // Send formatted query to Game Hub\r\n    // Format: \"I'm playing [GAME]. [USER_QUERY]\"\r\n    const formattedMessage = `I'm playing ${gameName}. ${query}`;\r\n    \r\n    // Show processing message\r\n    toastService.info(`Checking ${gameName}...`);\r\n    \r\n    // Send message immediately - UI is already switched to Game Hub\r\n    // The AI will respond and determine if it's a valid/released/unreleased game\r\n    // The handleSendMessage flow will handle tab creation based on AI response\r\n    handleSendMessage(formattedMessage);\r\n  };\r\n\r\n  const handleConnectionModalOpen = () => {\r\n    setConnectionModalOpen(true);\r\n  };\r\n\r\n  const handleConnectionModalClose = () => {\r\n    setConnectionModalOpen(false);\r\n  };\r\n\r\n  const handleClearConnectionError = () => {\r\n    if (propOnClearConnectionError) {\r\n      propOnClearConnectionError();\r\n    }\r\n  };\r\n\r\n  const handleHandsFreeToggle = () => {\r\n    // Just open the modal - don't toggle the state\r\n    setHandsFreeModalOpen(true);\r\n  };\r\n\r\n  const handleHandsFreeModalClose = () => {\r\n    setHandsFreeModalOpen(false);\r\n  };\r\n\r\n  const handleToggleHandsFreeFromModal = () => {\r\n    // This is the actual toggle that enables/disables hands-free mode\r\n    const newMode = !isHandsFreeMode;\r\n    setIsHandsFreeMode(newMode);\r\n    localStorage.setItem('otakonHandsFreeMode', String(newMode));\r\n    \r\n    // If disabling hands-free mode, stop any ongoing speech\r\n    if (!newMode) {\r\n      ttsService.cancel();\r\n    }\r\n  };\r\n\r\n  // Settings context menu handlers\r\n  const handleSettingsContextMenu = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    setSettingsContextMenu({\r\n      isOpen: true,\r\n      position: { x: e.clientX, y: e.clientY },\r\n    });\r\n  };\r\n\r\n  const closeSettingsContextMenu = () => {\r\n    setSettingsContextMenu({\r\n      isOpen: false,\r\n      position: { x: 0, y: 0 },\r\n    });\r\n  };\r\n\r\n  const handleOpenSettings = () => {\r\n    setSettingsOpen(true);\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    onLogout();\r\n  };\r\n\r\n  const handleConnect = (code: string) => {\r\n    setConnectionCode(code);\r\n    \r\n    // Store connection code for persistence\r\n    localStorage.setItem('otakon_connection_code', code);\r\n    localStorage.setItem('otakon_last_connection', new Date().toISOString());\r\n    \r\n    // Use prop handler if available, otherwise use local websocket\r\n    if (propOnConnect) {\r\n      propOnConnect(code);\r\n    } else {\r\n      // Fallback to local websocket connection\r\n      connect(\r\n        code,\r\n        () => {\r\n          setLastSuccessfulConnection(new Date());\r\n          localStorage.setItem('otakonHasConnectedBefore', 'true');\r\n        },\r\n        (data: any) => {\r\n          console.log('Connection message:', data);\r\n        },\r\n        (error: string) => {\r\n          console.error('Connection error:', error);\r\n        },\r\n        () => {\r\n          console.log('Connection closed');\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleDisconnect = () => {\r\n    if (propOnDisconnect) {\r\n      propOnDisconnect();\r\n    } else {\r\n      disconnect();\r\n    }\r\n    setConnectionCode(null);\r\n    setLastSuccessfulConnection(null);\r\n    localStorage.removeItem('otakon_connection_code');\r\n    localStorage.removeItem('otakon_last_connection');\r\n  };\r\n\r\n  // Handle suggested prompt clicks\r\n  const handleSuggestedPromptClick = (prompt: string) => {\r\n    handleSendMessage(prompt);\r\n  };\r\n\r\n  // Handle input message change\r\n  const handleInputMessageChange = (message: string) => {\r\n    setCurrentInputMessage(message);\r\n  };\r\n\r\n  // Handle active session toggle with session summaries\r\n  const handleToggleActiveSession = async () => {\r\n    if (!activeConversation) {\r\n      return;\r\n    }\r\n\r\n    const wasPlaying = session.isActive && session.currentGameId === activeConversation.id;\r\n    const willBePlaying = !wasPlaying;\r\n\r\n    // Create summary of current session before switching\r\n    if (wasPlaying) {\r\n      // Switching from Playing to Planning - create playing session summary\r\n      console.log(' [MainApp] Creating Playing session summary for Planning mode');\r\n      try {\r\n        const playingSummary = await sessionSummaryService.generatePlayingSessionSummary(activeConversation);\r\n        await sessionSummaryService.storeSessionSummary(activeConversation.id, playingSummary);\r\n        \r\n        // Add summary message to conversation\r\n        const summaryMessage = {\r\n          id: `msg_${Date.now()}`,\r\n          content: `**Session Summary - Switching to Planning Mode**\\n\\n${playingSummary.summary}`,\r\n          role: 'assistant' as const,\r\n          timestamp: Date.now(),\r\n        };\r\n        \r\n        setConversations(prev => {\r\n          const updated = { ...prev };\r\n          if (updated[activeConversation.id]) {\r\n            updated[activeConversation.id] = {\r\n              ...updated[activeConversation.id],\r\n              messages: [...updated[activeConversation.id].messages, summaryMessage],\r\n              updatedAt: Date.now()\r\n            };\r\n          }\r\n          return updated;\r\n        });\r\n        \r\n        await ConversationService.addMessage(activeConversation.id, summaryMessage);\r\n      } catch (error) {\r\n        console.error('Failed to create playing session summary:', error);\r\n        toastService.error('Failed to create session summary.');\r\n      }\r\n    } else if (willBePlaying) {\r\n      // Switching from Planning to Playing - create planning session summary\r\n      console.log(' [MainApp] Creating Planning session summary for Playing mode');\r\n      try {\r\n        const planningSummary = await sessionSummaryService.generatePlanningSessionSummary(activeConversation);\r\n        await sessionSummaryService.storeSessionSummary(activeConversation.id, planningSummary);\r\n        \r\n        // Add summary message to conversation\r\n        const summaryMessage = {\r\n          id: `msg_${Date.now()}`,\r\n          content: `**Session Summary - Switching to Playing Mode**\\n\\n${planningSummary.summary}`,\r\n          role: 'assistant' as const,\r\n          timestamp: Date.now(),\r\n        };\r\n        \r\n        setConversations(prev => {\r\n          const updated = { ...prev };\r\n          if (updated[activeConversation.id]) {\r\n            updated[activeConversation.id] = {\r\n              ...updated[activeConversation.id],\r\n              messages: [...updated[activeConversation.id].messages, summaryMessage],\r\n              updatedAt: Date.now()\r\n            };\r\n          }\r\n          return updated;\r\n        });\r\n        \r\n        await ConversationService.addMessage(activeConversation.id, summaryMessage);\r\n      } catch (error) {\r\n        console.error('Failed to create planning session summary:', error);\r\n        toastService.error('Failed to create session summary.');\r\n      }\r\n    }\r\n\r\n    // Toggle the session\r\n    toggleSession(activeConversation.id);\r\n  };\r\n\r\n  // Handle stop AI request\r\n  const handleStopAI = () => {\r\n    if (abortController) {\r\n      abortController.abort();\r\n      setAbortController(null);\r\n      setIsLoading(false);\r\n      setSuggestedPrompts([]);\r\n    }\r\n  };\r\n\r\n  // Poll for subtab updates when background insights are being generated\r\n  const pollForSubtabUpdates = async (conversationId: string, attempts = 0, maxAttempts = 30) => {\r\n    // Stop after 30 attempts (30 seconds)\r\n    if (attempts >= maxAttempts) {\r\n      console.error(' [MainApp]  Stopped polling for subtab updates after', attempts, 'attempts');\r\n      return;\r\n    }\r\n\r\n    // Wait 1 second before checking\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n    try {\r\n      //  FIX: Aggressively clear cache before every poll to prevent stale reads\r\n      ConversationService.clearCache();\r\n      \r\n      //  CRITICAL FIX: Skip cache to ensure we get fresh data after Supabase sync\r\n      const updatedConversations = await ConversationService.getConversations(true); // skipCache = true\r\n      const targetConv = updatedConversations[conversationId];\r\n\r\n      if (!targetConv) {\r\n        console.error(' [MainApp]  Conversation not found:', conversationId);\r\n        return;\r\n      }\r\n\r\n      //  CRITICAL FIX: Check if conversation even HAS subtabs\r\n      if (!targetConv.subtabs || targetConv.subtabs.length === 0) {\r\n        console.error(` [MainApp]  Conversation \"${targetConv.title}\" has no subtabs, stopping poll`);\r\n        return;\r\n      }\r\n\r\n      const loadingSubtabs = targetConv.subtabs.filter(tab => tab.status === 'loading');\r\n      const loadedSubtabs = targetConv.subtabs.filter(tab => tab.status === 'loaded');\r\n      const stillLoading = loadingSubtabs.length > 0;\r\n      \r\n      if (attempts === 0) {\r\n        console.error(` [MainApp]  Starting poll for \"${targetConv.title}\" (${targetConv.subtabs.length} subtabs, ${loadingSubtabs.length} loading)`);\r\n      }\r\n      \r\n      if (!stillLoading) {\r\n        // Subtabs have finished loading!\r\n        console.error(` [MainApp]  All subtabs loaded for \"${targetConv.title}\" after ${attempts} attempts`);\r\n        console.error(` [MainApp]  Final status: ${loadedSubtabs.length} loaded, ${loadingSubtabs.length} loading`);\r\n        \r\n        //  FIX: Deep clone to ensure React detects changes\r\n        const freshConversations = deepCloneConversations(updatedConversations);\r\n        \r\n        //  FIX: Force update conversations state with new reference\r\n        setConversations(freshConversations);\r\n        \r\n        //  FIX: CRITICAL - ALWAYS update active conversation if this is the active tab\r\n        console.error(' [MainApp]  Active conversation check:', {\r\n          activeConvId: activeConversation?.id,\r\n          targetConvId: conversationId,\r\n          matches: activeConversation?.id === conversationId\r\n        });\r\n        \r\n        //  CRITICAL FIX: Update active conversation to force React re-render\r\n        // Add timestamp to guarantee object reference change\r\n        const updatedActiveConv = {\r\n          ...freshConversations[conversationId],\r\n          subtabs: freshConversations[conversationId].subtabs?.map(st => ({ ...st })) || [],\r\n          _updateTimestamp: Date.now() // Force new object reference\r\n        };\r\n        \r\n        console.error(' [MainApp]  FORCE-UPDATING active conversation with loaded subtabs');\r\n        console.error(' [MainApp]  Subtab statuses:', updatedActiveConv.subtabs.map(s => ({ title: s.title, status: s.status })));\r\n        console.error(' [MainApp]  Setting active conversation to trigger re-render...');\r\n        console.error(' [MainApp]  Old active conv ID:', activeConversation?.id);\r\n        console.error(' [MainApp]  New active conv ID:', updatedActiveConv.id);\r\n        \r\n        //  First update conversations dict\r\n        setConversations({\r\n          ...freshConversations\r\n        });\r\n        \r\n        //  Then update active conversation (this should trigger ChatInterface re-render)\r\n        setActiveConversation(updatedActiveConv);\r\n        return;\r\n      }\r\n\r\n      // Still loading, continue polling\r\n      if (attempts % 5 === 0 || attempts === 1) {\r\n        console.error(` [MainApp]  \"${targetConv.title}\": ${loadingSubtabs.length} subtabs still loading... (attempt ${attempts + 1})`);\r\n      }\r\n      pollForSubtabUpdates(conversationId, attempts + 1, maxAttempts);\r\n    } catch (error) {\r\n      console.error(' [MainApp]  Error polling for subtab updates:', error);\r\n    }\r\n  };\r\n\r\n  // Placeholder for game tab creation - will be implemented in Week 3\r\n  const handleCreateGameTab = async (gameInfo: { gameTitle: string; genre?: string; aiResponse?: any; isUnreleased?: boolean }): Promise<Conversation | null> => {\r\n    console.log(' [MainApp] Game tab creation requested:', gameInfo);\r\n    \r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) {\r\n        console.error('User not authenticated for game tab creation');\r\n        toastService.error('Please sign in to create game tabs.');\r\n        return null;\r\n      }\r\n\r\n      // Generate unique conversation ID based on game title (without timestamp for consistency)\r\n      const sanitizedTitle = gameInfo.gameTitle.toLowerCase().replace(/[^a-z0-9\\s-]/g, '').replace(/\\s+/g, '-');\r\n      const conversationId = `game-${sanitizedTitle}`;\r\n      \r\n      // Check if game tab already exists\r\n      const existingConversation = conversations[conversationId];\r\n      if (existingConversation) {\r\n        console.log(' [MainApp] Game tab already exists, returning it');\r\n        return existingConversation;\r\n      }\r\n\r\n      // Create new game tab with AI response data\r\n      const newGameTab = await gameTabService.createGameTab({\r\n        gameTitle: gameInfo.gameTitle,\r\n        genre: gameInfo.genre || 'Action RPG',\r\n        conversationId,\r\n        userId: user.id,\r\n        aiResponse: gameInfo.aiResponse, // Pass AI response for subtab population\r\n        isUnreleased: gameInfo.isUnreleased || false // Pass unreleased status\r\n      });\r\n\r\n      // Add to conversations state\r\n      setConversations(prev => ({\r\n        ...prev,\r\n        [conversationId]: newGameTab\r\n      }));\r\n\r\n      console.log(' [MainApp] Game tab created successfully:', newGameTab.title);\r\n      toastService.success(`Game tab \"${gameInfo.gameTitle}\" created!`);\r\n      return newGameTab;\r\n    } catch (error) {\r\n      console.error('Failed to create game tab:', error);\r\n      toastService.error('Failed to create game tab. Please try again.');\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  const handleSendMessage = async (message: string, imageUrl?: string) => {\r\n    if (!activeConversation || isLoading) {\r\n      return;\r\n    }\r\n\r\n    console.log(' [MainApp] Sending message with image:', { message, hasImage: !!imageUrl, imageUrl: imageUrl?.substring(0, 50) + '...' });\r\n\r\n    // Auto-switch to Playing mode for game help requests (not in Game Hub)\r\n    const isGameHelpRequest = imageUrl || \r\n      (message && (\r\n        message.toLowerCase().includes('help') ||\r\n        message.toLowerCase().includes('how to') ||\r\n        message.toLowerCase().includes('what should') ||\r\n        message.toLowerCase().includes('stuck') ||\r\n        message.toLowerCase().includes('tutorial') ||\r\n        message.toLowerCase().includes('guide')\r\n      ));\r\n\r\n    if (isGameHelpRequest && !activeConversation.isGameHub) {\r\n      // Switch to Playing mode if not already active\r\n      if (!session.isActive || session.currentGameId !== activeConversation.id) {\r\n        console.log(' [MainApp] Auto-switching to Playing mode for game help request');\r\n        setActiveSession(activeConversation.id, true);\r\n      }\r\n    }\r\n\r\n    const newMessage = {\r\n      id: `msg_${Date.now()}`,\r\n      content: message,\r\n      role: 'user' as const,\r\n      timestamp: Date.now(),\r\n      imageUrl,\r\n    };\r\n\r\n    // Optimized: Update state immediately without re-fetching\r\n    setConversations(prev => {\r\n      const updated = { ...prev };\r\n      if (updated[activeConversation.id]) {\r\n        updated[activeConversation.id] = {\r\n          ...updated[activeConversation.id],\r\n          messages: [...updated[activeConversation.id].messages, newMessage],\r\n          updatedAt: Date.now()\r\n        };\r\n        // Update activeConversation immediately so UI reflects the new message\r\n        setActiveConversation(updated[activeConversation.id]);\r\n      }\r\n      return updated;\r\n    });\r\n\r\n    // Add message to service - MUST await to ensure it's saved before potential migration\r\n    await ConversationService.addMessage(activeConversation.id, newMessage);\r\n\r\n    // Clear the input message after sending\r\n    setCurrentInputMessage('');\r\n\r\n    // Check if message contains a tab command (for Command Centre)\r\n    if (tabManagementService.hasTabCommand(message)) {\r\n      const command = tabManagementService.parseTabCommand(message, activeConversation);\r\n      if (command) {\r\n        console.log(' [MainApp] Tab command detected:', command);\r\n        console.log(' [MainApp] Command description:', tabManagementService.describeCommand(command));\r\n      }\r\n    }\r\n\r\n    // Track credit usage based on query type\r\n    const hasImage = !!imageUrl;\r\n    \r\n    // Determine query type: image+text or image-only = image query, text-only = text query\r\n    const queryType = hasImage ? 'image' : 'text';\r\n    \r\n    // Check if user can make the request\r\n    if (!UserService.canMakeRequest(queryType)) {\r\n      const errorMessage = {\r\n        id: `msg_${Date.now() + 1}`,\r\n        content: `You've reached your ${queryType} query limit for this month. Upgrade to Pro for more queries.`,\r\n        role: 'assistant' as const,\r\n        timestamp: Date.now(),\r\n      };\r\n      \r\n      // Add error message to conversation\r\n      setConversations(prev => {\r\n        const updated = { ...prev };\r\n        if (updated[activeConversation.id]) {\r\n          updated[activeConversation.id] = {\r\n            ...updated[activeConversation.id],\r\n            messages: [...updated[activeConversation.id].messages, errorMessage],\r\n            updatedAt: Date.now()\r\n          };\r\n          // Update activeConversation immediately so UI reflects the error message\r\n          setActiveConversation(updated[activeConversation.id]);\r\n        }\r\n        return updated;\r\n      });\r\n      \r\n      // Save error message (non-blocking)\r\n      ConversationService.addMessage(activeConversation.id, errorMessage)\r\n        .catch(error => console.error('Failed to save error message:', error));\r\n      return;\r\n    }\r\n\r\n    // Increment usage count\r\n    UserService.incrementUsage(queryType);\r\n    \r\n    // Update in Supabase (non-blocking - fire and forget)\r\n    if (user?.authUserId) {\r\n      const supabaseService = new SupabaseService();\r\n      supabaseService.incrementUsage(user.authUserId, queryType)\r\n        .then(() => {\r\n          console.log(` [MainApp] Credit usage updated: ${queryType} query`);\r\n          // Refresh user data in background to update credit indicator\r\n          return refreshUserData();\r\n        })\r\n        .catch(error => console.warn('Failed to update usage in Supabase:', error));\r\n    }\r\n\r\n    // Clear previous suggestions and start loading\r\n    setSuggestedPrompts([]);\r\n    setIsLoading(true);\r\n    \r\n    // Create abort controller for stop functionality\r\n    const controller = new AbortController();\r\n    setAbortController(controller);\r\n    \r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) {\r\n        throw new Error('User not authenticated');\r\n      }\r\n\r\n      // Apply context summarization before sending to AI (keeps context manageable)\r\n      let conversationWithOptimizedContext = activeConversation;\r\n      if (activeConversation.messages.length > 10) {\r\n        const { contextSummarizationService } = await import('../services/contextSummarizationService');\r\n        \r\n        if (contextSummarizationService.shouldSummarize(activeConversation)) {\r\n          console.log(' [MainApp] Applying context summarization...');\r\n          const summarizedConversation = await contextSummarizationService.applyContextSummarization(activeConversation);\r\n          \r\n          // Update conversation with summarized context\r\n          await ConversationService.updateConversation(activeConversation.id, summarizedConversation);\r\n          conversationWithOptimizedContext = summarizedConversation;\r\n          \r\n          // Update local state\r\n          setConversations(prev => ({\r\n            ...prev,\r\n            [activeConversation.id]: summarizedConversation\r\n          }));\r\n          setActiveConversation(summarizedConversation);\r\n          \r\n          console.log(' [MainApp] Context summarized successfully');\r\n        }\r\n      }\r\n\r\n      const response = await aiService.getChatResponseWithStructure(\r\n        conversationWithOptimizedContext,\r\n        user,\r\n        message,\r\n        session.isActive && session.currentGameId === activeConversation.id,\r\n        !!imageUrl,\r\n        imageUrl,\r\n        controller.signal\r\n      );\r\n\r\n      // Check if request was aborted before adding response to conversation\r\n      if (controller.signal.aborted) {\r\n        console.log('AI request was aborted, skipping response');\r\n        return;\r\n      }\r\n\r\n      const aiMessage = {\r\n        id: `msg_${Date.now() + 1}`,\r\n        content: response.content,\r\n        role: 'assistant' as const,\r\n        timestamp: Date.now(),\r\n      };\r\n\r\n      // Optimized: Update state immediately\r\n      setConversations(prev => {\r\n        const updated = { ...prev };\r\n        if (updated[activeConversation.id]) {\r\n          updated[activeConversation.id] = {\r\n            ...updated[activeConversation.id],\r\n            messages: [...updated[activeConversation.id].messages, aiMessage],\r\n            updatedAt: Date.now()\r\n          };\r\n          // Update activeConversation immediately so UI reflects the new message\r\n          setActiveConversation(updated[activeConversation.id]);\r\n        }\r\n        return updated;\r\n      });\r\n\r\n      // Add message to service - MUST await to ensure it's saved before potential migration\r\n      await ConversationService.addMessage(activeConversation.id, aiMessage);\r\n\r\n      //  Hands-Free Mode: Read AI response aloud if enabled\r\n      if (isHandsFreeMode && response.content) {\r\n        try {\r\n          // Extract only the Hint section for TTS - more precise matching\r\n          const hintMatch = response.content.match(/Hint:\\s*\\n*\\s*([\\s\\S]*?)(?=\\n\\s*(?:Lore:|Places of Interest:|Strategy:)|$)/i);\r\n          let textToSpeak = '';\r\n          \r\n          if (hintMatch && hintMatch[1]) {\r\n            // Found a hint section, extract only that part\r\n            textToSpeak = hintMatch[1]\r\n              .trim()\r\n              // Stop at first occurrence of section headers (case insensitive)\r\n              .split(/\\n\\s*(?:Lore:|Places of Interest:|Strategy:)/i)[0]\r\n              .trim();\r\n          } else if (!response.content.includes('Lore:') && !response.content.includes('Places of Interest:')) {\r\n            // No structured sections detected, read the entire content\r\n            textToSpeak = response.content;\r\n          }\r\n          \r\n          if (textToSpeak) {\r\n            // Strip markdown and special formatting for better TTS\r\n            const cleanText = textToSpeak\r\n              .replace(/[*_~`]/g, '') // Remove markdown formatting\r\n              .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1') // Convert [text](url) to text\r\n              .replace(/#{1,6}\\s/g, '') // Remove heading markers\r\n              .replace(/```[\\s\\S]*?```/g, '') // Remove code blocks\r\n              .replace(/`([^`]+)`/g, '$1') // Remove inline code markers\r\n              .trim();\r\n            \r\n            if (cleanText) {\r\n              // Don't await - let TTS run in background without blocking chat flow\r\n              ttsService.speak(cleanText).catch(err => console.error('TTS Error:', err));\r\n            }\r\n          }\r\n        } catch (ttsError) {\r\n          console.error('TTS Error:', ttsError);\r\n          // Don't block the flow if TTS fails\r\n        }\r\n      } else if (!isHandsFreeMode && response.content) {\r\n        //  Show notification if TTS is OFF and screen is locked\r\n        try {\r\n          const { showAINotification, isScreenLockedOrHidden } = await import('../services/toastService');\r\n          \r\n          if (isScreenLockedOrHidden()) {\r\n            // Extract hint for notification\r\n            const hintMatch = response.content.match(/Hint:\\s*\\n*\\s*([\\s\\S]*?)(?=\\n\\s*(?:Lore:|Places of Interest:|Strategy:)|$)/i);\r\n            let notificationText = '';\r\n            \r\n            if (hintMatch && hintMatch[1]) {\r\n              notificationText = hintMatch[1].trim().split(/\\n\\s*(?:Lore:|Places of Interest:|Strategy:)/i)[0].trim();\r\n            } else if (!response.content.includes('Lore:') && !response.content.includes('Places of Interest:')) {\r\n              notificationText = response.content;\r\n            }\r\n            \r\n            if (notificationText) {\r\n              // Clean markdown for notification\r\n              const cleanText = notificationText\r\n                .replace(/[*_~`]/g, '')\r\n                .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1')\r\n                .replace(/#{1,6}\\s/g, '')\r\n                .replace(/```[\\s\\S]*?```/g, '')\r\n                .replace(/`([^`]+)`/g, '$1')\r\n                .trim();\r\n              \r\n              if (cleanText) {\r\n                showAINotification(\r\n                  cleanText,\r\n                  activeConversation.title || 'Otagon AI'\r\n                );\r\n              }\r\n            }\r\n          }\r\n        } catch (notificationError) {\r\n          console.error('Notification Error:', notificationError);\r\n        }\r\n      }\r\n\r\n      //  DEFERRED: Process suggested prompts AFTER tab migration (moved to after tab switch)\r\n      // This ensures prompts are based on the FINAL active tab, not the intermediate Game Hub state\r\n      console.log(' [MainApp] Raw suggestions from AI:', response.suggestions);\r\n      const suggestionsToUse = response.followUpPrompts || response.suggestions;\r\n      const processedSuggestions = suggestedPromptsService.processAISuggestions(suggestionsToUse);\r\n      console.log(' [MainApp] Processed suggestions:', processedSuggestions);\r\n\r\n      // Handle state update tags (game progress, objectives, etc.)\r\n      if (response.stateUpdateTags && response.stateUpdateTags.length > 0) {\r\n        console.error(' [MainApp] Processing state update tags:', response.stateUpdateTags);\r\n        \r\n        for (const tag of response.stateUpdateTags) {\r\n          // Extract progress updates (e.g., \"PROGRESS: 45\")\r\n          if (tag.startsWith('PROGRESS:')) {\r\n            const progress = parseInt(tag.split(':')[1]?.trim() || '0', 10);\r\n            if (!isNaN(progress) && progress >= 0 && progress <= 100) {\r\n              console.error(` [MainApp] Updating game progress to ${progress}%`);\r\n              \r\n              // Update conversation with new progress\r\n              const updatedConv = {\r\n                ...activeConversation,\r\n                gameProgress: progress,\r\n                updatedAt: Date.now()\r\n              };\r\n              \r\n              // Update local state immediately\r\n              setConversations(prev => ({\r\n                ...prev,\r\n                [activeConversation.id]: updatedConv\r\n              }));\r\n              setActiveConversation(updatedConv);\r\n              \r\n              // Persist to storage (non-blocking)\r\n              ConversationService.updateConversation(activeConversation.id, {\r\n                gameProgress: progress,\r\n                updatedAt: Date.now()\r\n              }).catch(error => console.error('Failed to update game progress:', error));\r\n            }\r\n          }\r\n          \r\n          // Extract objective updates (e.g., \"OBJECTIVE: Defeat the boss\")\r\n          if (tag.startsWith('OBJECTIVE:')) {\r\n            const objective = tag.split(':')[1]?.trim();\r\n            if (objective) {\r\n              console.error(` [MainApp] Updating active objective: ${objective}`);\r\n              \r\n              // Update conversation with new objective\r\n              const updatedConv = {\r\n                ...activeConversation,\r\n                activeObjective: objective,\r\n                updatedAt: Date.now()\r\n              };\r\n              \r\n              // Update local state immediately\r\n              setConversations(prev => ({\r\n                ...prev,\r\n                [activeConversation.id]: updatedConv\r\n              }));\r\n              setActiveConversation(updatedConv);\r\n              \r\n              // Persist to storage (non-blocking)\r\n              ConversationService.updateConversation(activeConversation.id, {\r\n                activeObjective: objective,\r\n                updatedAt: Date.now()\r\n              }).catch(error => console.error('Failed to update objective:', error));\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Handle progressive insight updates (if AI provided updates to existing subtabs)\r\n      if (response.progressiveInsightUpdates && response.progressiveInsightUpdates.length > 0) {\r\n        console.log(' [MainApp] AI provided progressive insight updates:', response.progressiveInsightUpdates.length);\r\n        \r\n        // Update subtabs in background (non-blocking)\r\n        gameTabService.updateSubTabsFromAIResponse(\r\n          activeConversation.id,\r\n          response.progressiveInsightUpdates\r\n        ).then(() => {\r\n          console.log(' [MainApp] Subtabs updated successfully');\r\n          \r\n          // Refresh conversations to show updated subtabs\r\n          ConversationService.getConversations().then(updatedConversations => {\r\n            const freshConversations = deepCloneConversations(updatedConversations);\r\n            setConversations(freshConversations);\r\n            \r\n            // Update active conversation to reflect changes\r\n            const refreshedConversation = freshConversations[activeConversation.id];\r\n            if (refreshedConversation) {\r\n              setActiveConversation(refreshedConversation);\r\n            }\r\n          });\r\n        }).catch(error => {\r\n          console.error(' [MainApp] Failed to update subtabs:', error);\r\n        });\r\n      }\r\n\r\n      // Handle tab management commands (Command Centre)\r\n      if (response.otakonTags.has('OTAKON_INSIGHT_UPDATE') || \r\n          response.otakonTags.has('OTAKON_INSIGHT_MODIFY_PENDING') || \r\n          response.otakonTags.has('OTAKON_INSIGHT_DELETE_REQUEST')) {\r\n        \r\n        console.log(' [MainApp] Processing tab management commands from AI');\r\n\r\n        // Handle INSIGHT_UPDATE (update content of existing tab)\r\n        if (response.otakonTags.has('OTAKON_INSIGHT_UPDATE')) {\r\n          const updateData = response.otakonTags.get('OTAKON_INSIGHT_UPDATE');\r\n          console.log(' [MainApp] INSIGHT_UPDATE:', updateData);\r\n          \r\n          if (typeof updateData === 'string') {\r\n            try {\r\n              const parsed = JSON.parse(updateData);\r\n              if (parsed.id && parsed.content) {\r\n                gameTabService.updateSubTabsFromAIResponse(\r\n                  activeConversation.id,\r\n                  [{ tabId: parsed.id, title: '', content: parsed.content }]\r\n                ).then(() => {\r\n                  console.log(' [MainApp] Tab updated via command:', parsed.id);\r\n                  // Refresh UI\r\n                  ConversationService.getConversations().then(updatedConversations => {\r\n                    const freshConversations = deepCloneConversations(updatedConversations);\r\n                    setConversations(freshConversations);\r\n                    const refreshedConversation = freshConversations[activeConversation.id];\r\n                    if (refreshedConversation) {\r\n                      setActiveConversation(refreshedConversation);\r\n                    }\r\n                  });\r\n                }).catch(error => console.error('Failed to update tab:', error));\r\n              }\r\n            } catch (error) {\r\n              console.error('Failed to parse INSIGHT_UPDATE:', error);\r\n            }\r\n          }\r\n        }\r\n\r\n        // Handle INSIGHT_MODIFY_PENDING (modify/rename tab)\r\n        if (response.otakonTags.has('OTAKON_INSIGHT_MODIFY_PENDING')) {\r\n          const modifyData = response.otakonTags.get('OTAKON_INSIGHT_MODIFY_PENDING');\r\n          console.log(' [MainApp] INSIGHT_MODIFY_PENDING:', modifyData);\r\n          \r\n          if (typeof modifyData === 'string') {\r\n            try {\r\n              const parsed = JSON.parse(modifyData);\r\n              if (parsed.id && (parsed.title || parsed.content)) {\r\n                gameTabService.updateSubTabsFromAIResponse(\r\n                  activeConversation.id,\r\n                  [{ tabId: parsed.id, title: parsed.title || '', content: parsed.content || '' }]\r\n                ).then(() => {\r\n                  console.log(' [MainApp] Tab modified via command:', parsed.id);\r\n                  // Refresh UI\r\n                  ConversationService.getConversations().then(updatedConversations => {\r\n                    const freshConversations = deepCloneConversations(updatedConversations);\r\n                    setConversations(freshConversations);\r\n                    const refreshedConversation = freshConversations[activeConversation.id];\r\n                    if (refreshedConversation) {\r\n                      setActiveConversation(refreshedConversation);\r\n                    }\r\n                  });\r\n                }).catch(error => console.error('Failed to modify tab:', error));\r\n              }\r\n            } catch (error) {\r\n              console.error('Failed to parse INSIGHT_MODIFY_PENDING:', error);\r\n            }\r\n          }\r\n        }\r\n\r\n        // Handle INSIGHT_DELETE_REQUEST (delete tab)\r\n        if (response.otakonTags.has('OTAKON_INSIGHT_DELETE_REQUEST')) {\r\n          const deleteData = response.otakonTags.get('OTAKON_INSIGHT_DELETE_REQUEST');\r\n          console.log(' [MainApp] INSIGHT_DELETE_REQUEST:', deleteData);\r\n          \r\n          if (typeof deleteData === 'string') {\r\n            try {\r\n              const parsed = JSON.parse(deleteData);\r\n              if (parsed.id) {\r\n                // Remove the subtab from conversation\r\n                const updatedSubtabs = activeConversation.subtabs?.filter(tab => tab.id !== parsed.id) || [];\r\n                ConversationService.updateConversation(activeConversation.id, {\r\n                  subtabs: updatedSubtabs\r\n                }).then(() => {\r\n                  console.log(' [MainApp] Tab deleted via command:', parsed.id);\r\n                  // Refresh UI\r\n                  ConversationService.getConversations().then(updatedConversations => {\r\n                    setConversations(updatedConversations);\r\n                    const refreshedConversation = updatedConversations[activeConversation.id];\r\n                    if (refreshedConversation) {\r\n                      setActiveConversation(refreshedConversation);\r\n                    }\r\n                  });\r\n                }).catch(error => console.error('Failed to delete tab:', error));\r\n              }\r\n            } catch (error) {\r\n              console.error('Failed to parse INSIGHT_DELETE_REQUEST:', error);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Handle game tab creation if game is identified\r\n      if (response.otakonTags.has('GAME_ID')) {\r\n        const gameTitle = response.otakonTags.get('GAME_ID');\r\n        const confidence = response.otakonTags.get('CONFIDENCE');\r\n        const isUnreleased = response.otakonTags.get('GAME_STATUS') === 'unreleased';\r\n        const genre = response.otakonTags.get('GENRE') || 'Default';\r\n\r\n        console.log(' [MainApp] Game detection:', { \r\n          gameTitle, \r\n          confidence, \r\n          isUnreleased, \r\n          genre,\r\n          currentTab: activeConversation.id,\r\n          messageIds: { user: newMessage.id, ai: aiMessage.id }\r\n        });\r\n\r\n        // Create game tab if:\r\n        // 1. Confidence is high (game is valid)\r\n        // 2. IS_FULLSCREEN is true (actual gameplay, not launcher/menu)\r\n        // 3. Game can be unreleased OR released - both get tabs\r\n        // Invalid games (low confidence, no GAME_ID, menus/launchers) stay in Game Hub\r\n        const isFullscreen = response.otakonTags.get('IS_FULLSCREEN') === 'true';\r\n        const shouldCreateTab = confidence === 'high' && isFullscreen;\r\n\r\n        if (!shouldCreateTab) {\r\n          console.log(' [MainApp] Tab creation blocked:', {\r\n            confidence,\r\n            isFullscreen,\r\n            reason: !isFullscreen ? 'Not gameplay (launcher/menu/desktop)' : \r\n                    confidence !== 'high' ? 'Low confidence' : \r\n                    'Generic detection'\r\n          });\r\n        }\r\n\r\n        if (shouldCreateTab) {\r\n          //  Check if game tab already exists using service (not stale state)\r\n          const targetConvId = gameTabService.generateGameConversationId(gameTitle);\r\n          const existingGameTab = await ConversationService.getConversation(targetConvId);\r\n\r\n          let targetConversationId: string;\r\n          \r\n          if (existingGameTab) {\r\n            console.log(' [MainApp] Found existing game tab:', existingGameTab.title);\r\n            targetConversationId = existingGameTab.id;\r\n          } else {\r\n            console.log(' [MainApp] Creating new game tab for:', gameTitle, isUnreleased ? '(unreleased)' : '(released)');\r\n            const gameInfo = { gameTitle, genre, aiResponse: response, isUnreleased };\r\n            const newGameTab = await handleCreateGameTab(gameInfo);\r\n            targetConversationId = newGameTab?.id || '';\r\n            \r\n            //  CRITICAL: Refresh conversations immediately after creating new tab\r\n            // This ensures the new tab is available for message migration\r\n            const refreshedConversations = await ConversationService.getConversations();\r\n            setConversations(refreshedConversations);\r\n            console.log(' [MainApp] Conversations refreshed, new tab available for migration');\r\n          }\r\n\r\n          // Move the user message and AI response to the game tab if we detected a DIFFERENT game\r\n          // Allow migration from Game Hub OR from a different game tab\r\n          const shouldMigrateMessages = targetConversationId && targetConversationId !== activeConversation.id;\r\n          console.log(' [MainApp] Should migrate messages?', shouldMigrateMessages);\r\n          console.log(' [MainApp] Migration check details:', {\r\n            hasTargetConversation: !!targetConversationId,\r\n            currentConversation: {\r\n              id: activeConversation.id,\r\n              title: activeConversation.title,\r\n              isGameHub: activeConversation.isGameHub\r\n            },\r\n            targetConversation: {\r\n              id: targetConversationId,\r\n              title: conversations[targetConversationId]?.title || 'NOT IN STATE YET'\r\n            },\r\n            isDifferentTab: targetConversationId !== activeConversation.id,\r\n            messagesInCurrentTab: activeConversation.messages.length\r\n          });\r\n          \r\n          if (shouldMigrateMessages) {\r\n            console.log(' [MainApp]  Starting ATOMIC message migration to game tab');\r\n            console.log(' [MainApp] From:', activeConversation.title, ' To:', targetConversationId);\r\n            console.log(' [MainApp] Message IDs to move:', { userMsgId: newMessage.id, aiMsgId: aiMessage.id });\r\n            \r\n            //  Use atomic migration service to prevent race conditions\r\n            await MessageRoutingService.migrateMessagesAtomic(\r\n              [newMessage.id, aiMessage.id],\r\n              activeConversation.id,\r\n              targetConversationId\r\n            );\r\n            console.log(' [MainApp]  Atomic migration complete');\r\n            \r\n            // Update state to reflect the changes\r\n            const updatedConversations = await ConversationService.getConversations();\r\n            setConversations(updatedConversations);\r\n            \r\n            // Switch to the game tab\r\n            const gameTab = updatedConversations[targetConversationId];\r\n            if (gameTab) {\r\n              console.log(' [MainApp]  Switching to game tab:', gameTab.title, 'with', gameTab.messages.length, 'messages');\r\n              await ConversationService.setActiveConversation(targetConversationId);\r\n              setActiveConversation(gameTab);\r\n              // Auto-switch to Playing mode for new/existing game tabs\r\n              setActiveSession(targetConversationId, true);\r\n              // Close sidebar on mobile\r\n              setSidebarOpen(false);\r\n              \r\n              //  Set suggested prompts AFTER tab switch (based on FINAL active tab)\r\n              if (processedSuggestions.length > 0) {\r\n                setSuggestedPrompts(processedSuggestions);\r\n              } else {\r\n                // Use fallback suggestions based on the GAME TAB, not Game Hub\r\n                const fallbackSuggestions = suggestedPromptsService.getFallbackSuggestions(gameTab.id, false);\r\n                console.log(' [MainApp] Using fallback suggestions for game tab:', fallbackSuggestions);\r\n                setSuggestedPrompts(fallbackSuggestions);\r\n              }\r\n              \r\n              // Poll for subtab updates if they're still loading\r\n              const hasLoadingSubtabs = gameTab.subtabs?.some(tab => tab.status === 'loading');\r\n              console.error(` [MainApp]  Checking if polling needed for \"${gameTab.title}\" (ID: ${targetConversationId})`);\r\n              console.error(` [MainApp]  Subtabs status: ${gameTab.subtabs?.length || 0} total, ${hasLoadingSubtabs ? 'HAS LOADING' : 'all loaded or none'}`);\r\n              \r\n              if (hasLoadingSubtabs) {\r\n                console.error(' [MainApp]  Starting background refresh for loading subtabs');\r\n                //  FIX: Increase delay to 8 seconds to give background AI task time to complete\r\n                // Background insight generation takes ~5-7 seconds, so we wait 8 to be safe.\r\n                // This prevents excessive polling when subtabs haven't been generated yet.\r\n                setTimeout(() => {\r\n                  console.error(` [MainApp]  Delay complete, starting poll for conversation: ${targetConversationId}`);\r\n                  pollForSubtabUpdates(targetConversationId);\r\n                }, 8000); // Wait 8 seconds before first poll (was 2 seconds)\r\n              } else {\r\n                console.error(` [MainApp]  No loading subtabs for \"${gameTab.title}\", skipping poll`);\r\n              }\r\n            }\r\n          } else {\r\n            console.log(' [MainApp]  Skipping message migration - already in target game tab or no target detected');\r\n            \r\n            //  No migration - set prompts for current tab (Game Hub or existing game tab)\r\n            if (processedSuggestions.length > 0) {\r\n              setSuggestedPrompts(processedSuggestions);\r\n            } else {\r\n              const fallbackSuggestions = suggestedPromptsService.getFallbackSuggestions(activeConversation.id, activeConversation.isGameHub);\r\n              console.log(' [MainApp] Using fallback suggestions:', fallbackSuggestions);\r\n              setSuggestedPrompts(fallbackSuggestions);\r\n            }\r\n          }\r\n        } else {\r\n          console.log(' [MainApp] Not creating game tab:', { \r\n            reason: !confidence ? 'no confidence' : confidence !== 'high' ? 'low confidence' : 'unreleased game'\r\n          });\r\n        }\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Failed to get AI response:\", error);\r\n      \r\n      // Check if it was aborted\r\n      if (error instanceof Error && error.name === 'AbortError') {\r\n        console.log('AI request was aborted by user');\r\n        return;\r\n      }\r\n      \r\n      // Use error recovery service\r\n      const recoveryAction = await errorRecoveryService.handleAIError(\r\n        error as Error,\r\n        {\r\n          operation: 'handleSendMessage',\r\n          conversationId: activeConversation.id,\r\n          userId: user?.id,\r\n          timestamp: Date.now(),\r\n          retryCount: 0\r\n        }\r\n      );\r\n      \r\n      // Add error message to chat\r\n      const errorMessage = {\r\n        id: `msg_${Date.now() + 1}`,\r\n        content: recoveryAction.message || \"Sorry, I'm having trouble thinking right now. Please try again.\",\r\n        role: 'assistant' as const,\r\n        timestamp: Date.now(),\r\n      };\r\n      \r\n      // Optimized: Update state immediately\r\n      setConversations(prev => {\r\n        const updated = { ...prev };\r\n        if (updated[activeConversation.id]) {\r\n          updated[activeConversation.id] = {\r\n            ...updated[activeConversation.id],\r\n            messages: [...updated[activeConversation.id].messages, errorMessage],\r\n            updatedAt: Date.now()\r\n          };\r\n          // Update activeConversation immediately so UI reflects the error message\r\n          setActiveConversation(updated[activeConversation.id]);\r\n        }\r\n        return updated;\r\n      });\r\n\r\n      await ConversationService.addMessage(activeConversation.id, errorMessage);\r\n      \r\n      // Display user notification if needed\r\n      if (recoveryAction.type === 'user_notification') {\r\n        errorRecoveryService.displayError(recoveryAction.message || 'An error occurred', 'error');\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n      setAbortController(null);\r\n    }\r\n  };\r\n\r\n  // Update ref whenever handleSendMessage changes\r\n  useEffect(() => {\r\n    handleSendMessageRef.current = handleSendMessage;\r\n  }, [handleSendMessage]);\r\n\r\n  if (isInitializing && (!user || Object.keys(conversations).length === 0)) {\r\n    return (\r\n      <div className=\"h-screen bg-background flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <LoadingSpinner size=\"lg\" className=\"mx-auto mb-4\" />\r\n          <p className=\"text-text-muted\">{!user ? 'Loading...' : 'Initializing chat...'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // If no user but we have initialization done, still show error or redirect\r\n  if (!user && !isInitializing) {\r\n    return (\r\n      <div className=\"h-screen bg-background flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-text-muted\">User not found. Please refresh the page.</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-screen bg-background flex overflow-hidden\">\r\n      {/* Sidebar */}\r\n        <Sidebar\r\n          isOpen={sidebarOpen}\r\n          onClose={() => setSidebarOpen(false)}\r\n          conversations={conversations}\r\n          activeConversation={activeConversation}\r\n          onConversationSelect={handleConversationSelect}\r\n          onDeleteConversation={handleDeleteConversation}\r\n          onPinConversation={handlePinConversation}\r\n          onUnpinConversation={handleUnpinConversation}\r\n          onClearConversation={handleClearConversation}\r\n          onAddGame={handleAddGame}\r\n        />\r\n\r\n      {/* Main Content */}\r\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n        {/* Header */}\r\n        <header className=\"chat-header-fixed bg-gradient-to-r from-surface/50 to-background/50 backdrop-blur-sm border-b border-surface-light/20 px-3 py-3 sm:px-4 sm:py-4 lg:px-6 lg:py-6 flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-1\">\r\n            <button\r\n              onClick={() => setSidebarOpen(true)}\r\n              className=\"lg:hidden btn-icon p-3 text-text-muted hover:text-text-primary min-h-[44px] min-w-[44px] flex items-center justify-center\"\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\r\n              </svg>\r\n            </button>\r\n            \r\n            <Logo size=\"sm\" bounce={false} />\r\n          </div>\r\n\r\n          <div className=\"flex items-center space-x-2 sm:space-x-3 lg:space-x-4\">\r\n            <div className=\"mr-1 sm:mr-2\">\r\n              <CreditIndicator \r\n                user={currentUser} \r\n                onClick={handleCreditModalOpen}\r\n              />\r\n            </div>\r\n\r\n            <HandsFreeToggle\r\n              isHandsFree={isHandsFreeMode}\r\n              onToggle={handleHandsFreeToggle}\r\n            />\r\n            \r\n            <button\r\n              onClick={handleConnectionModalOpen}\r\n              className={`btn-icon p-3 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center ${\r\n                connectionStatus === ConnectionStatus.CONNECTED \r\n                  ? 'text-green-400 hover:text-green-300' \r\n                  : 'text-text-muted hover:text-text-primary'\r\n              }`}\r\n              title={connectionStatus === ConnectionStatus.CONNECTED ? 'PC Connected - Click to manage' : 'Connect to PC'}\r\n            >\r\n              <svg className=\"w-5 h-5 sm:w-6 sm:h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 12h.01M12 12h.01M16 12h.01\" />\r\n              </svg>\r\n            </button>\r\n            \r\n            <button\r\n              onClick={handleSettingsContextMenu}\r\n              className=\"btn-icon p-3 text-text-muted hover:text-text-primary transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center\"\r\n            >\r\n              <svg className=\"w-5 h-5 sm:w-6 sm:h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n              </svg>\r\n            </button>\r\n            \r\n          </div>\r\n        </header>\r\n\r\n        {/* Chat Area */}\r\n        <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n          {/* Profile Setup Banner - Show if user hasn't set up profile */}\r\n          {showProfileSetupBanner && onProfileSetupComplete && onProfileSetupDismiss && (\r\n            <div className=\"flex-shrink-0 pt-3 sm:pt-4 lg:pt-6\">\r\n              <ProfileSetupBanner\r\n                onComplete={onProfileSetupComplete}\r\n                onDismiss={onProfileSetupDismiss}\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* AdSense Placeholder Banner - Always show for free users */}\r\n          {currentUser.tier === 'free' && (\r\n            <div className=\"px-3 sm:px-4 lg:px-6 pt-0 sm:pt-1 flex-shrink-0\">\r\n              <div className=\"bg-gradient-to-r from-gray-100/10 to-gray-200/10 border border-gray-300/20 rounded-xl p-3 sm:p-4 mb-4 sm:mb-6\">\r\n                <div className=\"flex items-center justify-center h-16 sm:h-20 lg:h-24 bg-gray-100/20 rounded-lg border-2 border-dashed border-gray-300/40\">\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-gray-400 text-xs sm:text-sm font-medium mb-1\">Advertisement</div>\r\n                    <div className=\"text-gray-300 text-xs\">AdSense Placeholder</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Game Progress Bar - Show for game conversations (not Game Hub) */}\r\n          {activeConversation && !activeConversation.isGameHub && activeConversation.gameTitle && (\r\n            <div className=\"px-3 sm:px-4 lg:px-6 pb-3 sm:pb-4 flex-shrink-0\">\r\n              <GameProgressBar \r\n                progress={activeConversation.gameProgress || 0}\r\n                className=\"px-3 sm:px-4\"\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* Chat Thread Name - Show on mobile when sidebar is collapsed */}\r\n          {activeConversation && (\r\n            <div className=\"lg:hidden px-3 sm:px-4 mb-3 sm:mb-4 flex-shrink-0\">\r\n              <div className=\"bg-gradient-to-r from-surface/30 to-background/30 backdrop-blur-sm border border-surface-light/20 rounded-lg px-4 py-3\">\r\n                <h2 className=\"text-sm sm:text-base font-semibold bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] bg-clip-text text-transparent text-center\">\r\n                  {activeConversation.title}\r\n                </h2>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          \r\n            {/* Chat Interface - Takes remaining space */}\r\n            <div className=\"flex-1 min-h-0\">\r\n              <ChatInterface\r\n                conversation={activeConversation}\r\n                onSendMessage={handleSendMessage}\r\n                isLoading={isLoading}\r\n                isPCConnected={connectionStatus === ConnectionStatus.CONNECTED}\r\n                onRequestConnect={handleConnectionModalOpen}\r\n                userTier={currentUser.tier}\r\n                onStop={handleStopAI}\r\n                isManualUploadMode={isManualUploadMode}\r\n                onToggleManualUploadMode={() => setIsManualUploadMode(!isManualUploadMode)}\r\n                suggestedPrompts={suggestedPrompts}\r\n                onSuggestedPromptClick={handleSuggestedPromptClick}\r\n                activeSession={session}\r\n                onToggleActiveSession={handleToggleActiveSession}\r\n                initialMessage={currentInputMessage}\r\n                onMessageChange={handleInputMessageChange}\r\n                queuedImage={queuedScreenshot}\r\n                onImageQueued={handleScreenshotQueued}\r\n              />\r\n            </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Settings Modal */}\r\n      <SettingsModal\r\n        isOpen={settingsOpen}\r\n        onClose={() => setSettingsOpen(false)}\r\n        user={currentUser}\r\n      />\r\n\r\n      {/* Credit Modal */}\r\n      <CreditModal\r\n        isOpen={creditModalOpen}\r\n        onClose={handleCreditModalClose}\r\n        onUpgrade={handleUpgrade}\r\n        user={currentUser}\r\n      />\r\n\r\n      {/* Connection Modal */}\r\n      <ConnectionModal\r\n        isOpen={connectionModalOpen}\r\n        onClose={handleConnectionModalClose}\r\n        onConnect={handleConnect}\r\n        onDisconnect={handleDisconnect}\r\n        onClearError={handleClearConnectionError}\r\n        status={connectionStatus}\r\n        error={connectionError}\r\n        connectionCode={connectionCode}\r\n        lastSuccessfulConnection={lastSuccessfulConnection}\r\n      />\r\n\r\n      {/* Hands-Free Modal */}\r\n      <HandsFreeModal\r\n        isOpen={handsFreeModalOpen}\r\n        onClose={handleHandsFreeModalClose}\r\n        isHandsFree={isHandsFreeMode}\r\n        onToggleHandsFree={handleToggleHandsFreeFromModal}\r\n      />\r\n\r\n      {/* Add Game Modal */}\r\n      <AddGameModal\r\n        isOpen={addGameModalOpen}\r\n        onClose={() => setAddGameModalOpen(false)}\r\n        onCreateGame={handleCreateGame}\r\n      />\r\n\r\n      {/* Settings Context Menu */}\r\n      <SettingsContextMenu\r\n        isOpen={settingsContextMenu.isOpen}\r\n        position={settingsContextMenu.position}\r\n        onClose={closeSettingsContextMenu}\r\n        onOpenSettings={handleOpenSettings}\r\n        onOpenGuide={handleOpenGuide}\r\n        onLogout={handleLogout}\r\n        userTier={currentUser.tier}\r\n        onTrialStart={async () => {\r\n          // Refresh user data after trial starts\r\n          await authService.refreshUser();\r\n          const refreshedUser = authService.getCurrentUser();\r\n          if (refreshedUser) {\r\n            setUser(refreshedUser);\r\n          }\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MainApp;\r\n","import React from 'react';\r\nimport { AuthState, AppState, ActiveModal, ConnectionStatus } from '../types';\r\nimport LandingPage from './LandingPageFresh';\r\nimport LoginSplashScreen from './splash/LoginSplashScreen';\r\nimport InitialSplashScreen from './splash/InitialSplashScreen';\r\nimport HowToUseSplashScreen from './splash/HowToUseSplashScreen';\r\nimport ProFeaturesSplashScreen from './splash/ProFeaturesSplashScreen';\r\nimport SplashScreen from './splash/SplashScreen';\r\nimport MainApp from './MainApp';\r\nimport AuthCallback from './auth/AuthCallback';\r\nimport AboutModal from './modals/AboutModal';\r\nimport PrivacyModal from './modals/PrivacyModal';\r\nimport TermsModal from './modals/TermsModal';\r\nimport RefundPolicyModal from './modals/RefundPolicyModal';\r\nimport ContactUsModal from './modals/ContactUsModal';\r\nimport SettingsModal from './modals/SettingsModal';\r\nimport { authService } from '../services/authService';\r\nimport { onboardingService } from '../services/onboardingService';\r\n\r\ninterface AppRouterProps {\r\n  appState: AppState;\r\n  authState: AuthState;\r\n  activeModal: ActiveModal;\r\n  settingsOpen: boolean;\r\n  showLogoutConfirm: boolean;\r\n  isInitializing: boolean;\r\n  hasEverLoggedIn: boolean;\r\n  connectionStatus: ConnectionStatus;\r\n  connectionError: string | null;\r\n  handleGetStarted: () => void;\r\n  handleLoginComplete: () => void;\r\n  handleBackToLanding: () => void;\r\n  handleOAuthSuccess: () => void;\r\n  handleOAuthError: (_error: string) => void;\r\n  handleLogout: () => void;\r\n  confirmLogout: () => void;\r\n  openModal: (_modal: ActiveModal) => void;\r\n  closeModal: () => void;\r\n  handleOnboardingComplete: (_step: string) => void;\r\n  handleConnect: (_code: string) => void;\r\n  handleConnectionSuccess: () => void;\r\n  handleDisconnect: () => void;\r\n  handleClearConnectionError: () => void;\r\n  handleSkipConnection: () => void;\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  handleProfileSetupComplete: (_profileData: any) => void;\r\n  handleProfileSetupSkip: () => void;\r\n  setSettingsOpen: (_isOpen: boolean) => void;\r\n  setShowLogoutConfirm: (_isOpen: boolean) => void;\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  mainAppMessageHandlerRef: React.MutableRefObject<((_data: any) => void) | null>;\r\n  isManualNavigationRef: React.MutableRefObject<boolean>;\r\n}\r\n\r\nconst AppRouter: React.FC<AppRouterProps> = ({\r\n  appState,\r\n  authState,\r\n  activeModal,\r\n  settingsOpen,\r\n  showLogoutConfirm,\r\n  isInitializing,\r\n  hasEverLoggedIn,\r\n  connectionStatus,\r\n  connectionError,\r\n  handleGetStarted,\r\n  handleLoginComplete,\r\n  handleBackToLanding,\r\n  handleOAuthSuccess,\r\n  handleOAuthError,\r\n  handleLogout,\r\n  confirmLogout,\r\n  openModal,\r\n  closeModal,\r\n  handleOnboardingComplete,\r\n  handleConnect,\r\n  handleConnectionSuccess,\r\n  handleDisconnect,\r\n  handleClearConnectionError,\r\n  handleSkipConnection,\r\n  handleProfileSetupComplete,\r\n  handleProfileSetupSkip,\r\n  setSettingsOpen,\r\n  setShowLogoutConfirm,\r\n  mainAppMessageHandlerRef,\r\n  isManualNavigationRef,\r\n}) => {\r\n  // Check for auth callback route (works for both dev and production)\r\n  const isAuthCallback = window.location.pathname === '/auth/callback' || \r\n                         window.location.pathname === '/Otagon/auth/callback';\r\n  \r\n  if (isAuthCallback) {\r\n    return (\r\n      <AuthCallback\r\n        onAuthSuccess={handleOAuthSuccess}\r\n        onAuthError={handleOAuthError}\r\n      />\r\n    );\r\n  }\r\n\r\n  const shouldShowLoading = (isInitializing || authState.isLoading) &&\r\n    !(appState.view === 'landing' && !hasEverLoggedIn && !authState.isLoading);\r\n\r\n  console.log(' AppRouter:', { \r\n    view: appState.view, \r\n    onboardingStatus: appState.onboardingStatus,\r\n    hasUser: !!authState.user,\r\n    isInitializing,\r\n    isLoading: authState.isLoading,\r\n    shouldShowLoading,\r\n    shouldShowLanding: appState.view === 'landing' && !authState.user\r\n  });\r\n\r\n  if (shouldShowLoading) {\r\n    return (\r\n      <div className=\"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-[#FF4D4D] mx-auto mb-4\"></div>\r\n          <p className=\"text-[#CFCFCF] text-lg\">Loading Otagon...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (appState.view === 'landing' && !authState.user && !authState.isLoading) {\r\n    console.log(' RENDERING LANDINGPAGE NOW!');\r\n    console.log(' ABOUT TO RENDER LANDINGPAGE COMPONENT ');\r\n    console.log(' LandingPage import:', LandingPage);\r\n    console.log(' LandingPage type:', typeof LandingPage);\r\n    return (\r\n      <>\r\n        <LandingPage\r\n          onGetStarted={handleGetStarted}\r\n          onOpenAbout={() => openModal('about')}\r\n          onOpenPrivacy={() => openModal('privacy')}\r\n          onOpenRefund={() => openModal('refund')}\r\n          onOpenTerms={() => openModal('terms')}\r\n          onDirectNavigation={() => {\r\n            // Direct navigation handler for landing page links\r\n          }}\r\n        />\r\n        <AboutModal isOpen={activeModal === 'about'} onClose={closeModal} />\r\n        <PrivacyModal isOpen={activeModal === 'privacy'} onClose={closeModal} />\r\n        <TermsModal isOpen={activeModal === 'terms'} onClose={closeModal} />\r\n        <RefundPolicyModal isOpen={activeModal === 'refund'} onClose={closeModal} />\r\n        <ContactUsModal isOpen={activeModal === 'contact'} onClose={closeModal} />\r\n      </>\r\n    );\r\n  }\r\n\r\n  if (appState.onboardingStatus === 'login') {\r\n    return (\r\n      <LoginSplashScreen\r\n        onComplete={handleLoginComplete}\r\n        onBackToLanding={handleBackToLanding}\r\n        onSetAppState={() => {}}\r\n      />\r\n    );\r\n  }\r\n\r\n  if (appState.onboardingStatus === 'loading') {\r\n    return (\r\n      <div className=\"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-[#FF4D4D] mx-auto mb-4\"></div>\r\n          <p className=\"text-[#CFCFCF] text-lg\">Signing you in...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (authState.user && appState.view === 'app') {\r\n    if (appState.onboardingStatus === 'initial' && !isInitializing) {\r\n      return <InitialSplashScreen onComplete={() => handleOnboardingComplete('initial')} user={authState.user} />;\r\n    }\r\n\r\n    if (appState.onboardingStatus === 'how-to-use') {\r\n      return (\r\n        <SplashScreen\r\n          onSkipConnection={handleSkipConnection}\r\n          onConnect={handleConnect}\r\n          status={connectionStatus}\r\n          error={connectionError}\r\n          connectionCode={null}\r\n          onConnectionSuccess={handleConnectionSuccess}\r\n        />\r\n      );\r\n    }\r\n\r\n    if (appState.onboardingStatus === 'features-connected') {\r\n      return (\r\n        <HowToUseSplashScreen\r\n          onComplete={async () => {\r\n            if (authState.user) {\r\n              try {\r\n                await onboardingService.updateOnboardingStatus(authState.user.authUserId, 'features-connected', {\r\n                  has_seen_features_connected: true,\r\n                });\r\n                // Prevent auth subscription from overriding navigation\r\n                isManualNavigationRef.current = true;\r\n                await authService.refreshUser();\r\n              } catch (error) {\r\n                console.error(' [AppRouter] Error updating features-connected status:', error);\r\n                isManualNavigationRef.current = false;\r\n              }\r\n            }\r\n            handleOnboardingComplete('features-connected');\r\n          }}\r\n        />\r\n      );\r\n    }\r\n\r\n    if (appState.onboardingStatus === 'pro-features') {\r\n      return (\r\n        <ProFeaturesSplashScreen\r\n          onComplete={async () => {\r\n            if (authState.user) {\r\n              try {\r\n                await onboardingService.updateOnboardingStatus(authState.user.authUserId, 'pro-features', {\r\n                  has_seen_pro_features: true,\r\n                  onboarding_completed: true,\r\n                });\r\n                // Prevent auth subscription from overriding navigation\r\n                isManualNavigationRef.current = true;\r\n                await authService.refreshUser();\r\n              } catch (error) {\r\n                console.error(' [AppRouter] Error updating pro-features status:', error);\r\n                isManualNavigationRef.current = false;\r\n              }\r\n            }\r\n            handleOnboardingComplete('pro-features');\r\n          }}\r\n          onUpgrade={() => {\r\n            // Upgrade functionality coming soon\r\n          }}\r\n          onUpgradeToVanguard={() => {\r\n            // Vanguard upgrade functionality coming soon\r\n          }}\r\n        />\r\n      );\r\n    }\r\n\r\n    if (appState.onboardingStatus === 'complete') {\r\n      return (\r\n        <>\r\n          <MainApp\r\n            onLogout={handleLogout}\r\n            onOpenSettings={() => setSettingsOpen(true)}\r\n            onOpenAbout={() => openModal('about')}\r\n            onOpenPrivacy={() => openModal('privacy')}\r\n            onOpenRefund={() => openModal('refund')}\r\n            onOpenContact={() => openModal('contact')}\r\n            onOpenTerms={() => openModal('terms')}\r\n            connectionStatus={connectionStatus}\r\n            connectionError={connectionError}\r\n            onConnect={handleConnect}\r\n            onDisconnect={handleDisconnect}\r\n            onClearConnectionError={handleClearConnectionError}\r\n            onWebSocketMessage={(handler) => {\r\n              mainAppMessageHandlerRef.current = handler;\r\n            }}\r\n            showProfileSetupBanner={authState.user ? !authState.user.hasProfileSetup : false}\r\n            onProfileSetupComplete={handleProfileSetupComplete}\r\n            onProfileSetupDismiss={handleProfileSetupSkip}\r\n          />\r\n          <AboutModal isOpen={activeModal === 'about'} onClose={closeModal} />\r\n          <PrivacyModal isOpen={activeModal === 'privacy'} onClose={closeModal} />\r\n          <TermsModal isOpen={activeModal === 'terms'} onClose={closeModal} />\r\n          <RefundPolicyModal isOpen={activeModal === 'refund'} onClose={closeModal} />\r\n          <ContactUsModal isOpen={activeModal === 'contact'} onClose={closeModal} />\r\n          <SettingsModal isOpen={settingsOpen} onClose={() => setSettingsOpen(false)} user={authState.user} />\r\n          {showLogoutConfirm && (\r\n            <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n              <div className=\"bg-surface border border-surface-light/20 rounded-xl p-6 max-w-md mx-4\">\r\n                <h3 className=\"text-lg font-semibold text-text-primary mb-4\">Confirm Logout</h3>\r\n                <p className=\"text-text-secondary mb-6\">\r\n                  Are you sure you want to sign out? You'll need to log in again to access your account.\r\n                </p>\r\n                <div className=\"flex space-x-3\">\r\n                  <button\r\n                    onClick={() => setShowLogoutConfirm(false)}\r\n                    className=\"flex-1 px-4 py-2 text-text-muted hover:text-text-primary transition-colors\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    onClick={confirmLogout}\r\n                    className=\"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors\"\r\n                  >\r\n                    Sign Out\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </>\r\n      );\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-screen bg-gradient-to-br from-background via-[#0F0F0F] to-background flex items-center justify-center\">\r\n      <div className=\"text-center\">\r\n        <p className=\"text-text-muted\">Something went wrong. Please refresh the page.</p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AppRouter;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Toast, toastService } from '../../services/toastService';\r\nimport { \r\n  CheckCircleIcon,\r\n  XCircleIcon,\r\n  ExclamationTriangleIcon,\r\n  InformationCircleIcon,\r\n  XMarkIcon\r\n} from '@heroicons/react/24/solid';\r\n\r\nconst ToastIcon: React.FC<{ type: Toast['type'] }> = ({ type }) => {\r\n  const className = \"w-5 h-5 flex-shrink-0\";\r\n  \r\n  switch (type) {\r\n    case 'success':\r\n      return <CheckCircleIcon className={`${className} text-green-500`} />;\r\n    case 'error':\r\n      return <XCircleIcon className={`${className} text-red-500`} />;\r\n    case 'warning':\r\n      return <ExclamationTriangleIcon className={`${className} text-yellow-500`} />;\r\n    case 'info':\r\n      return <InformationCircleIcon className={`${className} text-blue-500`} />;\r\n  }\r\n};\r\n\r\nconst ToastItem: React.FC<{ toast: Toast }> = ({ toast }) => {\r\n  const getBackgroundColor = () => {\r\n    switch (toast.type) {\r\n      case 'success':\r\n        return 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800';\r\n      case 'error':\r\n        return 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800';\r\n      case 'warning':\r\n        return 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800';\r\n      case 'info':\r\n        return 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800';\r\n    }\r\n  };\r\n\r\n  const getTextColor = () => {\r\n    switch (toast.type) {\r\n      case 'success':\r\n        return 'text-green-900 dark:text-green-100';\r\n      case 'error':\r\n        return 'text-red-900 dark:text-red-100';\r\n      case 'warning':\r\n        return 'text-yellow-900 dark:text-yellow-100';\r\n      case 'info':\r\n        return 'text-blue-900 dark:text-blue-100';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={`\r\n        ${getBackgroundColor()}\r\n        ${getTextColor()}\r\n        p-4 rounded-lg shadow-lg border\r\n        max-w-md w-full\r\n        pointer-events-auto\r\n        animate-slide-in\r\n      `}\r\n    >\r\n      <div className=\"flex items-start gap-3\">\r\n        <ToastIcon type={toast.type} />\r\n        \r\n        <div className=\"flex-1 min-w-0\">\r\n          <p className=\"text-sm font-medium break-words\">\r\n            {toast.message}\r\n          </p>\r\n          \r\n          {toast.action && (\r\n            <button\r\n              onClick={async () => {\r\n                await toast.action?.onClick();\r\n                toastService.dismiss(toast.id);\r\n              }}\r\n              className=\"\r\n                text-xs mt-2 font-semibold underline\r\n                hover:no-underline\r\n                transition-all\r\n                focus:outline-none focus:ring-2 focus:ring-offset-2\r\n              \"\r\n            >\r\n              {toast.action.label}\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        {toast.dismissible && (\r\n          <button\r\n            onClick={() => toastService.dismiss(toast.id)}\r\n            className=\"\r\n              flex-shrink-0\r\n              text-current opacity-50 hover:opacity-100\r\n              transition-opacity\r\n              focus:outline-none focus:ring-2 focus:ring-offset-2\r\n              rounded\r\n              p-1\r\n            \"\r\n            aria-label=\"Dismiss\"\r\n          >\r\n            <XMarkIcon className=\"w-4 h-4\" />\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const ToastContainer: React.FC = () => {\r\n  const [toasts, setToasts] = useState<Toast[]>([]);\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = toastService.subscribe(setToasts);\r\n    return unsubscribe;\r\n  }, []);\r\n\r\n  return (\r\n    <div \r\n      className=\"\r\n        fixed bottom-4 right-4 z-50\r\n        flex flex-col gap-2\r\n        pointer-events-none\r\n        max-h-screen overflow-hidden\r\n      \"\r\n      aria-live=\"polite\"\r\n      aria-atomic=\"true\"\r\n    >\r\n      {toasts.map(toast => (\r\n        <ToastItem key={toast.id} toast={toast} />\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n","import { useState, useEffect, useRef } from 'react';\r\nimport { AuthState, ConnectionStatus, AppState, ActiveModal } from './types';\r\nimport { authService } from './services/authService';\r\nimport { onboardingService } from './services/onboardingService';\r\nimport { connect, disconnect } from './services/websocketService';\r\nimport { supabase } from './lib/supabase';\r\nimport AppRouter from './components/AppRouter';\r\nimport { ToastContainer } from './components/ui/ToastContainer';\r\n\r\nfunction App() {\r\n  const [authState, setAuthState] = useState<AuthState>({\r\n    user: null,\r\n    isLoading: true,\r\n    error: null,\r\n  });\r\n  const [hasEverLoggedIn, setHasEverLoggedIn] = useState(false);\r\n  const [appState, setAppState] = useState<AppState>({\r\n    view: 'landing', // Will be updated once auth state is checked\r\n    onboardingStatus: 'initial',\r\n    activeSubView: 'chat',\r\n    isConnectionModalOpen: false,\r\n    isHandsFreeModalOpen: false,\r\n    isSettingsModalOpen: false,\r\n    isCreditModalOpen: false,\r\n    isOtakuDiaryModalOpen: false,\r\n    isWishlistModalOpen: false,\r\n    activeModal: null,\r\n    isHandsFreeMode: false,\r\n    showUpgradeScreen: false,\r\n    showDailyCheckin: false,\r\n    currentAchievement: null,\r\n    loadingMessages: [],\r\n    isCooldownActive: false,\r\n    isFirstTime: true,\r\n    contextMenu: null,\r\n    feedbackModalState: null,\r\n    confirmationModal: null,\r\n    trialEligibility: null,\r\n  });\r\n  const [activeModal, setActiveModal] = useState<ActiveModal>(null);\r\n  const [settingsOpen, setSettingsOpen] = useState(false);\r\n  const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);\r\n  const [isInitializing, setIsInitializing] = useState(true);\r\n  const [connectionStatus, setConnectionStatus] = useState<ConnectionStatus>(() => {\r\n    // Restore connection status if we have a stored code\r\n    const storedCode = localStorage.getItem('otakon_connection_code');\r\n    return storedCode ? ConnectionStatus.CONNECTING : ConnectionStatus.DISCONNECTED;\r\n  });\r\n  const [connectionError, setConnectionError] = useState<string | null>(null);\r\n\r\n  const mainAppMessageHandlerRef = useRef<((_data: any) => void) | null>(null);\r\n  const authSubscriptionRef = useRef<(() => void) | null>(null);\r\n  const isProcessingAuthRef = useRef(false);\r\n  const isManualNavigationRef = useRef(false); // Track manual onboarding navigation\r\n  const lastHotkeyRequestTimestamp = useRef<number>(0); // Track last hotkey screenshot request to prevent duplicates\r\n  const hasReceivedPCMessage = useRef<boolean>(false); // Track if we've received any message from PC client\r\n  const connectionTimeoutRef = useRef<NodeJS.Timeout | null>(null); // Timeout for connection verification\r\n\r\n  useEffect(() => {\r\n    console.log(' [App] App state changed:', {\r\n      view: appState.view,\r\n      onboardingStatus: appState.onboardingStatus,\r\n      hasUser: !!authState.user,\r\n      userEmail: authState.user?.email\r\n    });\r\n  }, [appState.view, appState.onboardingStatus, authState.user]);\r\n\r\n  useEffect(() => {\r\n    if (authState.user && !authState.isLoading) {\r\n      const updateAppState = async () => {\r\n        try {\r\n          const { error } = await supabase\r\n            .from('users')\r\n            .update({\r\n              app_state: {\r\n                view: appState.view,\r\n                onboardingStatus: appState.onboardingStatus,\r\n                activeSubView: appState.activeSubView,\r\n                isHandsFreeMode: appState.isHandsFreeMode,\r\n                showUpgradeScreen: appState.showUpgradeScreen,\r\n                showDailyCheckin: appState.showDailyCheckin,\r\n                isFirstTime: appState.isFirstTime,\r\n                lastActivity: Date.now()\r\n              }\r\n            })\r\n            .eq('auth_user_id', authState.user!.authUserId);\r\n          if (error) {\r\n            console.error('Failed to update app state in Supabase:', error);\r\n          }\r\n        } catch (error) {\r\n          console.error('Error updating app state:', error);\r\n        }\r\n      };\r\n      updateAppState();\r\n    }\r\n  }, [appState.view, appState.onboardingStatus, appState.activeSubView, appState.isHandsFreeMode, appState.showUpgradeScreen, appState.showDailyCheckin, appState.isFirstTime, authState.user]);\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    const processAuthState = async (newAuthState: AuthState) => {\r\n      if (isProcessingAuthRef.current || newAuthState.isLoading) {\r\n        return;\r\n      }\r\n      \r\n      // Skip auto-navigation if we're manually navigating through onboarding\r\n      if (isManualNavigationRef.current) {\r\n        console.log(' [App] Skipping auto-navigation due to manual navigation flag');\r\n        isManualNavigationRef.current = false; // Reset the flag\r\n        return;\r\n      }\r\n      \r\n      isProcessingAuthRef.current = true;\r\n      console.log(' [App] Processing auth state:', {\r\n        hasUser: !!newAuthState.user,\r\n        userEmail: newAuthState.user?.email,\r\n        onboardingCompleted: newAuthState.user?.onboardingCompleted\r\n      });\r\n      try {\r\n        if (newAuthState.user) {\r\n          setHasEverLoggedIn(true);\r\n          const savedAppState = newAuthState.user.appState || {};\r\n          const nextStep = await onboardingService.getNextOnboardingStep(newAuthState.user.authUserId);\r\n          console.log(' [App] Next onboarding step:', nextStep);\r\n          \r\n          // Returning users: Skip onboarding if they've completed it before\r\n          // This ensures users go straight to chat on login/refresh\r\n          const isReturningUser = nextStep === 'complete';\r\n          \r\n          if (isMounted) {\r\n            if (isReturningUser) {\r\n              // Returning user - skip all onboarding, go to main app\r\n              console.log(' [App] Returning user detected - skipping onboarding');\r\n              setAppState((prev: AppState) => ({\r\n                ...prev,\r\n                ...savedAppState,\r\n                view: 'app',\r\n                onboardingStatus: 'complete',\r\n              }));\r\n            } else {\r\n              // New user or incomplete onboarding - continue onboarding flow\r\n              console.log(' [App] New user or incomplete onboarding - continuing from:', nextStep);\r\n              setAppState((prev: AppState) => ({\r\n                ...prev,\r\n                ...savedAppState,\r\n                view: 'app',\r\n                onboardingStatus: nextStep,\r\n              }));\r\n            }\r\n            setIsInitializing(false);\r\n          }\r\n        } else {\r\n          if (isMounted) {\r\n            // Check if running as PWA (standalone mode)\r\n            const isPWA = window.matchMedia('(display-mode: standalone)').matches || \r\n                         (window.navigator as any).standalone === true;\r\n            \r\n            // If PWA, always show login page instead of landing page\r\n            setAppState((prev: AppState) => ({\r\n              ...prev,\r\n              view: (hasEverLoggedIn || isPWA) ? 'app' : 'landing',\r\n              onboardingStatus: (hasEverLoggedIn || isPWA) ? 'login' : 'initial'\r\n            }));\r\n            setIsInitializing(false);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(' [App] Error during auth processing:', error);\r\n        if (isMounted) {\r\n          setIsInitializing(false);\r\n        }\r\n      } finally {\r\n        isProcessingAuthRef.current = false;\r\n      }\r\n    };\r\n    const unsubscribe = authService.subscribe((newAuthState) => {\r\n      setAuthState(newAuthState);\r\n      if (isMounted && !newAuthState.isLoading) {\r\n        processAuthState(newAuthState);\r\n      }\r\n    });\r\n    authSubscriptionRef.current = unsubscribe;\r\n    return () => {\r\n      isMounted = false;\r\n      if (authSubscriptionRef.current) {\r\n        authSubscriptionRef.current();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const timeout = setTimeout(() => {\r\n      if (isInitializing) {\r\n        setIsInitializing(false);\r\n      }\r\n    }, 10000);\r\n    return () => clearTimeout(timeout);\r\n  }, [isInitializing]);\r\n\r\n  useEffect(() => {\r\n    const isAuthCallback = window.location.pathname === '/auth/callback' || \r\n                           window.location.pathname === '/Otagon/auth/callback';\r\n    if (isAuthCallback) {\r\n      // The AuthCallback component will handle the authentication\r\n    }\r\n  }, []);\r\n\r\n  // Restore WebSocket connection on page load if there's a stored code\r\n  useEffect(() => {\r\n    const storedCode = localStorage.getItem('otakon_connection_code');\r\n    if (storedCode && connectionStatus === ConnectionStatus.CONNECTING) {\r\n      // Set up a timeout to verify the connection\r\n      const timeout = setTimeout(() => {\r\n        if (connectionStatus === ConnectionStatus.CONNECTING) {\r\n          // If still connecting after 3 seconds, consider it connected\r\n          // The websocket service will handle the actual connection state\r\n          setConnectionStatus(ConnectionStatus.CONNECTED);\r\n        }\r\n      }, 3000);\r\n      \r\n      return () => clearTimeout(timeout);\r\n    }\r\n  }, []);\r\n\r\n  const handleGetStarted = () => {\r\n    setAppState((prev: AppState) => ({ ...prev, view: 'app', onboardingStatus: 'login' }));\r\n  };\r\n\r\n  const handleLoginComplete = async () => {\r\n    console.log(' [App] Email login completed, setting view to app');\r\n    setAppState((prev: AppState) => {\r\n      const newState: AppState = { ...prev, view: 'app', onboardingStatus: 'loading' };\r\n      console.log(' [App] Setting view to app with loading status:', newState);\r\n      return newState;\r\n    });\r\n  };\r\n\r\n  const handleBackToLanding = () => {\r\n    console.log(' [App] Back to landing clicked, resetting to landing page');\r\n    setAppState((prev: AppState) => ({\r\n      ...prev,\r\n      view: 'landing',\r\n      onboardingStatus: 'initial'\r\n    }));\r\n  };\r\n\r\n  const handleOAuthSuccess = () => {\r\n    window.history.replaceState({}, document.title, '/');\r\n    setAppState((prev: AppState) => ({ ...prev, view: 'app' }));\r\n  };\r\n\r\n  const handleOAuthError = (error: string) => {\r\n    console.error(' [App] OAuth authentication error:', error);\r\n    setAppState((prev: AppState) => ({ ...prev, view: 'landing' }));\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    setShowLogoutConfirm(true);\r\n  };\r\n\r\n  const confirmLogout = async () => {\r\n    console.log(' [App] Starting logout process...');\r\n    setShowLogoutConfirm(false);\r\n    \r\n    // Preserve welcome screen flag (user has seen it once, don't show again)\r\n    const welcomeShown = localStorage.getItem('otakon_welcome_shown');\r\n    \r\n    // Sign out (clears Supabase session and localStorage)\r\n    await authService.signOut();\r\n    \r\n    // Restore welcome screen flag after signOut cleared localStorage\r\n    if (welcomeShown) {\r\n      localStorage.setItem('otakon_welcome_shown', welcomeShown);\r\n    }\r\n    \r\n    setAppState((prev: AppState) => ({\r\n      ...prev,\r\n      view: 'app', // Set to app view so landing page check doesn't trigger\r\n      onboardingStatus: 'login' // This will show login screen\r\n    }));\r\n    setAuthState({ user: null, isLoading: false, error: null });\r\n    isProcessingAuthRef.current = false;\r\n    console.log(' [App] Logout completed, showing login screen');\r\n  };\r\n\r\n  const openModal = (modal: ActiveModal) => {\r\n    setActiveModal(modal);\r\n  };\r\n\r\n  const closeModal = () => {\r\n    setActiveModal(null);\r\n  };\r\n\r\n  const handleOnboardingComplete = async (step: string) => {\r\n    console.log(' [App] Onboarding step completed:', step);\r\n    if (authState.user) {\r\n      const nextStep = await onboardingService.getNextOnboardingStep(authState.user.authUserId);\r\n      \r\n      //  FIX: If onboarding is complete, set the flag BEFORE MainApp renders\r\n      // This ensures Game Hub is properly activated for first-time users\r\n      if (nextStep === 'complete') {\r\n        console.log(' [App] Onboarding fully complete - setting first-run flag');\r\n        localStorage.setItem('otakon_has_used_app', 'true');\r\n      }\r\n      \r\n      setAppState((prev: AppState) => ({\r\n        ...prev,\r\n        onboardingStatus: nextStep\r\n      }));\r\n      onboardingService.updateOnboardingStatus(authState.user.authUserId, step as any)\r\n        .catch(error => console.error(' [App] Error updating onboarding status:', error));\r\n    }\r\n  };\r\n\r\n  const handleConnect = async (code: string) => {\r\n    console.log(' [App] Connecting with code:', code);\r\n    \r\n    // Disconnect any existing connection first\r\n    if (connectionStatus === ConnectionStatus.CONNECTED || connectionStatus === ConnectionStatus.CONNECTING) {\r\n      console.log(' [App] Disconnecting existing connection before reconnecting');\r\n      disconnect();\r\n      // Wait briefly for cleanup to complete\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n    \r\n    setConnectionError(null);\r\n    setConnectionStatus(ConnectionStatus.CONNECTING);\r\n    hasReceivedPCMessage.current = false; // Reset flag\r\n    \r\n    // Clear any existing timeout\r\n    if (connectionTimeoutRef.current) {\r\n      clearTimeout(connectionTimeoutRef.current);\r\n      connectionTimeoutRef.current = null;\r\n    }\r\n    \r\n    // Set timeout: if we don't receive a message from PC client within 5 seconds, show error\r\n    connectionTimeoutRef.current = setTimeout(() => {\r\n      if (!hasReceivedPCMessage.current) {\r\n        console.error(' [App] Connection timeout - no response from PC client within 5 seconds');\r\n        setConnectionError('No PC client found on this code. Please check the 6-digit code and ensure the PC client is running.');\r\n        setConnectionStatus(ConnectionStatus.ERROR);\r\n      }\r\n    }, 5000);\r\n    \r\n    connect(\r\n      code,\r\n      () => {\r\n        // WebSocket opened - but DON'T set as connected yet\r\n        // Wait for actual message from PC client\r\n        console.log(' [App] WebSocket connection opened, waiting for PC client response...');\r\n        console.log(' [App] hasReceivedPCMessage:', hasReceivedPCMessage.current);\r\n        console.log(' [App] Timeout will fire in 5 seconds if no message received');\r\n      },\r\n      (data) => {\r\n        console.log(' [App] Message received:', data);\r\n        console.log(' [App] hasReceivedPCMessage before:', hasReceivedPCMessage.current);\r\n        \r\n        // First message from PC client confirms the connection is real\r\n        if (!hasReceivedPCMessage.current) {\r\n          hasReceivedPCMessage.current = true;\r\n          console.log(' [App] hasReceivedPCMessage set to:', hasReceivedPCMessage.current);\r\n          setConnectionStatus(ConnectionStatus.CONNECTED);\r\n          if (connectionTimeoutRef.current) {\r\n            clearTimeout(connectionTimeoutRef.current);\r\n            connectionTimeoutRef.current = null;\r\n            console.log(' [App] Timeout cleared successfully');\r\n          }\r\n          console.log(' [App]  PC client confirmed - connection established');\r\n        }\r\n        \r\n        handleWebSocketMessage(data);\r\n      },\r\n      (error) => {\r\n        console.error(' [App] Connection error:', error);\r\n        setConnectionError(error);\r\n        setConnectionStatus(ConnectionStatus.ERROR);\r\n        if (connectionTimeoutRef.current) {\r\n          clearTimeout(connectionTimeoutRef.current);\r\n          connectionTimeoutRef.current = null;\r\n        }\r\n      },\r\n      () => {\r\n        console.log(' [App] Connection closed');\r\n        setConnectionStatus(ConnectionStatus.DISCONNECTED);\r\n        hasReceivedPCMessage.current = false;\r\n        if (connectionTimeoutRef.current) {\r\n          clearTimeout(connectionTimeoutRef.current);\r\n          connectionTimeoutRef.current = null;\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  const handleConnectionSuccess = async () => {\r\n    console.log(' [App] Connection success callback triggered');\r\n    setConnectionStatus(ConnectionStatus.CONNECTED);\r\n    setConnectionError(null);\r\n    if (authState.user) {\r\n      try {\r\n        // Wait for the database update to complete\r\n        await onboardingService.updateOnboardingStatus(authState.user.authUserId, 'how-to-use', {\r\n          has_seen_how_to_use: true,\r\n          pc_connected: true,\r\n          pc_connection_skipped: false\r\n        });\r\n        console.log(' [App] Database updated successfully');\r\n        \r\n        // Set flag to prevent auth subscription from overriding navigation\r\n        isManualNavigationRef.current = true;\r\n        \r\n        // Then refresh user data from database\r\n        await authService.refreshUser();\r\n        console.log(' [App] User data refreshed');\r\n        \r\n        // Finally, navigate to the next screen\r\n        console.log(' [App] Navigating to features-connected splash screen after connection success');\r\n        setAppState((prev: AppState) => ({\r\n          ...prev,\r\n          onboardingStatus: 'features-connected'\r\n        }));\r\n      } catch (error) {\r\n        console.error(' [App] Failed to update onboarding status:', error);\r\n        isManualNavigationRef.current = false; // Reset flag on error\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDisconnect = () => {\r\n    console.log(' [App] Disconnecting...');\r\n    disconnect();\r\n    setConnectionStatus(ConnectionStatus.DISCONNECTED);\r\n    setConnectionError(null);\r\n  };\r\n\r\n  const handleClearConnectionError = () => {\r\n    setConnectionError(null);\r\n  };\r\n\r\n  const handleWebSocketMessage = (data: any) => {\r\n    console.log(' [App] Processing WebSocket message:', data);\r\n    if (data.type === 'screenshot_batch') {\r\n      console.log(\" Processing screenshot batch:\", data);\r\n      const batchData = data.payload || data;\r\n      if (batchData.images && batchData.images.length > 0) {\r\n        batchData.images.forEach((imgSrc: string, index: number) => {\r\n          const properDataUrl = imgSrc.startsWith('data:') ? imgSrc : `data:image/png;base64,${imgSrc}`;\r\n          if (mainAppMessageHandlerRef.current) {\r\n            mainAppMessageHandlerRef.current({\r\n              type: 'screenshot',\r\n              dataUrl: properDataUrl,\r\n              index: index\r\n            });\r\n          }\r\n        });\r\n      }\r\n    } else if (data.type === 'screenshot_success') {\r\n      console.log(\" [App] Screenshot success message received:\", data);\r\n      console.log(\" [App] Success object:\", data.success);\r\n      console.log(\" [App] Has dataUrl?\", !!data.success?.dataUrl);\r\n      console.log(\" [App] Success keys:\", data.success ? Object.keys(data.success) : 'no success object');\r\n      console.log(\" [App] Details object:\", data.success?.details);\r\n      console.log(\" [App] Details keys:\", data.success?.details ? Object.keys(data.success.details) : 'no details');\r\n      \r\n      // Check if dataUrl is in the details object\r\n      const dataUrl = data.success?.dataUrl || data.success?.details?.dataUrl;\r\n      \r\n      if (dataUrl) {\r\n        console.log(\" [App] Processing individual screenshot with dataUrl\");\r\n        const properDataUrl = dataUrl.startsWith('data:')\r\n          ? dataUrl\r\n          : `data:image/png;base64,${dataUrl}`;\r\n        if (mainAppMessageHandlerRef.current) {\r\n          console.log(\" [App] Forwarding to MainApp via ref\");\r\n          mainAppMessageHandlerRef.current({\r\n            type: 'screenshot',\r\n            dataUrl: properDataUrl\r\n          });\r\n        } else {\r\n          console.warn(\" [App] mainAppMessageHandlerRef.current is null!\");\r\n        }\r\n      } else if (data.success?.details?.addedToBuffer) {\r\n        // Screenshot was added to buffer by F1/F2 hotkey\r\n        // Only send screenshot_request if we haven't sent one in the last 2 seconds (prevent feedback loop)\r\n        const now = Date.now();\r\n        const timeSinceLastRequest = now - lastHotkeyRequestTimestamp.current;\r\n        \r\n        if (timeSinceLastRequest > 2000) {\r\n          console.log(\" [App] Screenshot buffered by hotkey, sending screenshot_request to trigger batch send\");\r\n          lastHotkeyRequestTimestamp.current = now;\r\n          \r\n          import('./services/websocketService').then(({ send }) => {\r\n            send({\r\n              type: 'screenshot_request',\r\n              mode: data.success.mode || 'single',\r\n              processImmediate: true,\r\n              triggeredByHotkey: true\r\n            });\r\n          });\r\n        } else {\r\n          console.log(\" [App] Ignoring duplicate screenshot_success (within 2s of last request) - preventing feedback loop\");\r\n        }\r\n      } else {\r\n        console.warn(\" [App] screenshot_success received but no dataUrl found and not buffered\");\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleSkipConnection = async () => {\r\n    console.log(' [App] Skipping PC connection, going to pro-features');\r\n    if (authState.user) {\r\n      try {\r\n        // Wait for the database update to complete\r\n        await onboardingService.updateOnboardingStatus(authState.user.authUserId, 'how-to-use', {\r\n          has_seen_how_to_use: true,\r\n          pc_connected: false,\r\n          pc_connection_skipped: true\r\n        });\r\n        console.log(' [App] Database updated successfully (skipped)');\r\n        \r\n        // Set flag to prevent auth subscription from overriding navigation\r\n        isManualNavigationRef.current = true;\r\n        \r\n        // Then refresh user data from database\r\n        await authService.refreshUser();\r\n        console.log(' [App] User data refreshed');\r\n        \r\n        // Finally, navigate to the next screen\r\n        setAppState((prev: AppState) => ({\r\n          ...prev,\r\n          onboardingStatus: 'pro-features'\r\n        }));\r\n      } catch (error) {\r\n        console.error(' [App] Failed to update onboarding status:', error);\r\n        isManualNavigationRef.current = false; // Reset flag on error\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleProfileSetupComplete = async (profileData: any) => {\r\n    console.log(' [App] Profile setup completed');\r\n    if (authState.user) {\r\n      try {\r\n        // Use 'profile-setup' step to properly set has_profile_setup flag\r\n        await onboardingService.updateOnboardingStatus(authState.user.authUserId, 'profile-setup', profileData);\r\n        console.log(' [App] Profile setup data saved');\r\n        \r\n        // Set flag to prevent auth subscription from overriding\r\n        isManualNavigationRef.current = true;\r\n        \r\n        // Refresh user data to update hasProfileSetup flag\r\n        await authService.refreshUser();\r\n        console.log(' [App] User data refreshed after profile setup');\r\n      } catch (error) {\r\n        console.error(' [App] Failed to save profile setup:', error);\r\n        isManualNavigationRef.current = false;\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleProfileSetupSkip = async () => {\r\n    console.log(' [App] Profile setup skipped');\r\n    if (authState.user) {\r\n      try {\r\n        // Use 'profile-setup' step to properly set has_profile_setup flag\r\n        await onboardingService.updateOnboardingStatus(authState.user.authUserId, 'profile-setup', {\r\n          profile_setup_skipped: true\r\n        });\r\n        console.log(' [App] Profile setup skipped, flag saved');\r\n        \r\n        // Set flag to prevent auth subscription from overriding\r\n        isManualNavigationRef.current = true;\r\n        \r\n        // Refresh user data to update hasProfileSetup flag\r\n        await authService.refreshUser();\r\n        console.log(' [App] User data refreshed after skipping profile setup');\r\n      } catch (error) {\r\n        console.error(' [App] Failed to skip profile setup:', error);\r\n        isManualNavigationRef.current = false;\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <AppRouter\r\n        appState={appState}\r\n        authState={authState}\r\n        activeModal={activeModal}\r\n        settingsOpen={settingsOpen}\r\n        showLogoutConfirm={showLogoutConfirm}\r\n        isInitializing={isInitializing}\r\n        hasEverLoggedIn={hasEverLoggedIn}\r\n        connectionStatus={connectionStatus}\r\n        connectionError={connectionError}\r\n        handleGetStarted={handleGetStarted}\r\n        handleLoginComplete={handleLoginComplete}\r\n        handleBackToLanding={handleBackToLanding}\r\n        handleOAuthSuccess={handleOAuthSuccess}\r\n        handleOAuthError={handleOAuthError}\r\n        handleLogout={handleLogout}\r\n        confirmLogout={confirmLogout}\r\n        openModal={openModal}\r\n        closeModal={closeModal}\r\n        handleOnboardingComplete={handleOnboardingComplete}\r\n        handleConnect={handleConnect}\r\n        handleConnectionSuccess={handleConnectionSuccess}\r\n        handleDisconnect={handleDisconnect}\r\n        handleClearConnectionError={handleClearConnectionError}\r\n        handleSkipConnection={handleSkipConnection}\r\n        handleProfileSetupComplete={handleProfileSetupComplete}\r\n        handleProfileSetupSkip={handleProfileSetupSkip}\r\n        setSettingsOpen={setSettingsOpen}\r\n        setShowLogoutConfirm={setShowLogoutConfirm}\r\n        mainAppMessageHandlerRef={mainAppMessageHandlerRef}\r\n        isManualNavigationRef={isManualNavigationRef}\r\n      />\r\n      <ToastContainer />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { Component, ErrorInfo, ReactNode } from 'react';\r\n\r\ninterface Props {\r\n  children: ReactNode;\r\n  fallback?: ReactNode;\r\n}\r\n\r\ninterface State {\r\n  hasError: boolean;\r\n  error: Error | null;\r\n  errorInfo: ErrorInfo | null;\r\n}\r\n\r\nclass ErrorBoundary extends Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null,\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): State {\r\n    // Update state so the next render will show the fallback UI\r\n    return {\r\n      hasError: true,\r\n      error,\r\n      errorInfo: null,\r\n    };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    // Log error details\r\n    console.error(' [ErrorBoundary] Caught error:', error);\r\n    console.error(' [ErrorBoundary] Error info:', errorInfo);\r\n    \r\n    // Update state with error info\r\n    this.setState({\r\n      error,\r\n      errorInfo,\r\n    });\r\n    \r\n    // You can also log to an error reporting service here\r\n    // Example: errorReportingService.logError(error, errorInfo);\r\n  }\r\n\r\n  handleReset = () => {\r\n    this.setState({\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // Custom fallback UI\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      // Default fallback UI\r\n      return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center p-4\">\r\n          <div className=\"max-w-md w-full bg-[#1C1C1C] border border-[#424242] rounded-xl p-6 text-center\">\r\n            <div className=\"text-6xl mb-4\"></div>\r\n            <h1 className=\"text-2xl font-bold text-[#F5F5F5] mb-2\">Something Went Wrong</h1>\r\n            <p className=\"text-[#CFCFCF] mb-4\">\r\n              We encountered an unexpected error. Don't worry, your data is safe.\r\n            </p>\r\n            \r\n            {this.state.error && (\r\n              <div className=\"bg-[#2E2E2E] rounded-lg p-4 mb-4 text-left\">\r\n                <p className=\"text-xs font-mono text-[#FF4D4D] mb-2\">\r\n                  {this.state.error.toString()}\r\n                </p>\r\n                {this.state.errorInfo && (\r\n                  <details className=\"text-xs text-[#A3A3A3]\">\r\n                    <summary className=\"cursor-pointer hover:text-[#CFCFCF] transition-colors\">\r\n                      Error Details\r\n                    </summary>\r\n                    <pre className=\"mt-2 overflow-auto max-h-40\">\r\n                      {this.state.errorInfo.componentStack}\r\n                    </pre>\r\n                  </details>\r\n                )}\r\n              </div>\r\n            )}\r\n            \r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={this.handleReset}\r\n                className=\"flex-1 px-4 py-2 bg-gradient-to-r from-[#FF4D4D] to-[#FFAB40] text-white rounded-lg font-semibold hover:scale-105 transition-transform\"\r\n              >\r\n                Try Again\r\n              </button>\r\n              <button\r\n                onClick={() => window.location.reload()}\r\n                className=\"flex-1 px-4 py-2 bg-[#2E2E2E] text-[#CFCFCF] rounded-lg font-semibold hover:bg-[#424242] transition-colors\"\r\n              >\r\n                Reload Page\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nexport default ErrorBoundary;\r\n\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom/client'\r\nimport App from './App.tsx'\r\nimport ErrorBoundary from './components/ErrorBoundary.tsx'\r\nimport './styles/globals.css'\r\n\r\nReactDOM.createRoot(document.getElementById('root')!).render(\r\n  <React.StrictMode>\r\n    <ErrorBoundary>\r\n      <App />\r\n    </ErrorBoundary>\r\n  </React.StrictMode>,\r\n)"],"file":"assets/index-4Sg64Epn.js"}