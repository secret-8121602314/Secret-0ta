import{j as s,r as b}from"./react-vendor-B0uBZZ1y.js";import{c as F}from"./supabase-vendor-KXjrFrzu.js";import{a as v}from"./core-services-qVjRZ8qQ.js";import{t as U,c as z}from"./vendor-wxVLlg0y.js";import{m as f}from"./framer-vendor-LkZgebms.js";const M="https://qajcxgkqloumogioomiz.supabase.co",q="sb_publishable_GoW6G_umt1lFF-KPbbm-Ow_D2PYxPLw",g=F(M,q,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});if(typeof window<"u"){g.auth.onAuthStateChange((e,r)=>{if(e==="SIGNED_IN"){if(r!=null&&r.access_token){document.body.style.cssText="",document.documentElement.style.cssText="";const a=document.getElementById("root");a&&(a.style.cssText=""),document.body.offsetHeight,console.log("ðŸ” [Supabase] DOM styles cleaned on SIGNED_IN"),localStorage.setItem("otakon_session_refreshed",Date.now().toString()),localStorage.setItem("otakon_last_session_check",Date.now().toString()),window.dispatchEvent(new CustomEvent("otakon:session-refreshed",{detail:{event:e,session:r}}))}}else if(e==="TOKEN_REFRESHED")r!=null&&r.access_token?(localStorage.setItem("otakon_session_refreshed",Date.now().toString()),localStorage.setItem("otakon_last_session_check",Date.now().toString()),window.dispatchEvent(new CustomEvent("otakon:session-refreshed",{detail:{event:e,session:r}}))):(console.error("ðŸ” [Supabase] Token refresh failed - session expired"),localStorage.removeItem("otakon_session_refreshed"),localStorage.removeItem("otakon_last_session_check"),window.dispatchEvent(new CustomEvent("otakon:session-expired",{detail:{reason:"token_refresh_failed",timestamp:Date.now()}})));else if(e==="SIGNED_OUT"){document.body.style.cssText="",document.documentElement.style.cssText="";const a=document.getElementById("root");a&&(a.style.cssText=""),document.body.offsetHeight,console.log("ðŸ” [Supabase] DOM styles cleaned on SIGNED_OUT"),localStorage.removeItem("otakon_session_refreshed"),localStorage.removeItem("otakon_last_session_check"),window.dispatchEvent(new CustomEvent("otakon:signed-out"))}else e==="USER_UPDATED"&&window.dispatchEvent(new CustomEvent("otakon:user-updated",{detail:{session:r}}))});const o=300*1e3;setInterval(async()=>{try{const{data:{session:e},error:r}=await g.auth.getSession();if(r||!e){const a=localStorage.getItem("otakon_last_session_check");a&&Date.now()-parseInt(a)<o*2&&(console.warn("ðŸ” [Supabase] Session expired during health check"),window.dispatchEvent(new CustomEvent("otakon:session-expired",{detail:{reason:"health_check_failed",timestamp:Date.now()}})))}else localStorage.setItem("otakon_last_session_check",Date.now().toString())}catch(e){console.error("ðŸ” [Supabase] Session health check error:",e)}},o)}function E(...o){return U(z(o))}const O=({size:o="md",className:e="",fullScreen:r=!0})=>{const m={sm:{container:"size-10"},md:{container:"size-16"},lg:{container:"size-20"}}[o],l=s.jsxs(f.div,{className:E("relative",m.container),animate:{scale:[1,1.02,1]},transition:{duration:4,repeat:1/0,ease:[.4,0,.6,1]},children:[s.jsx(f.div,{className:"absolute inset-0 rounded-full",style:{background:"conic-gradient(from 0deg, transparent 0deg, rgb(255, 77, 77) 90deg, transparent 180deg)",mask:"radial-gradient(circle at 50% 50%, transparent 35%, black 37%, black 39%, transparent 41%)",WebkitMask:"radial-gradient(circle at 50% 50%, transparent 35%, black 37%, black 39%, transparent 41%)",opacity:.8},animate:{rotate:[0,360]},transition:{duration:3,repeat:1/0,ease:"linear"}}),s.jsx(f.div,{className:"absolute inset-0 rounded-full",style:{background:"conic-gradient(from 0deg, transparent 0deg, rgb(255, 77, 77) 120deg, rgba(217, 140, 31, 0.7) 240deg, transparent 360deg)",mask:"radial-gradient(circle at 50% 50%, transparent 42%, black 44%, black 48%, transparent 50%)",WebkitMask:"radial-gradient(circle at 50% 50%, transparent 42%, black 44%, black 48%, transparent 50%)",opacity:.9},animate:{rotate:[0,360]},transition:{duration:2.5,repeat:1/0,ease:[.4,0,.6,1]}}),s.jsx(f.div,{className:"absolute inset-0 rounded-full",style:{background:"conic-gradient(from 180deg, transparent 0deg, rgba(217, 140, 31, 0.8) 45deg, transparent 90deg)",mask:"radial-gradient(circle at 50% 50%, transparent 52%, black 54%, black 56%, transparent 58%)",WebkitMask:"radial-gradient(circle at 50% 50%, transparent 52%, black 54%, black 56%, transparent 58%)",opacity:.5},animate:{rotate:[0,-360]},transition:{duration:4,repeat:1/0,ease:[.4,0,.6,1]}}),s.jsx(f.div,{className:"absolute inset-0 rounded-full",style:{background:"conic-gradient(from 270deg, transparent 0deg, rgba(229, 58, 58, 0.6) 20deg, transparent 40deg)",mask:"radial-gradient(circle at 50% 50%, transparent 61%, black 62%, black 63%, transparent 64%)",WebkitMask:"radial-gradient(circle at 50% 50%, transparent 61%, black 62%, black 63%, transparent 64%)",opacity:.6},animate:{rotate:[0,360]},transition:{duration:3.5,repeat:1/0,ease:"linear"}}),s.jsx(f.div,{className:"absolute inset-[30%] rounded-full",style:{background:"radial-gradient(circle, rgba(255, 77, 77, 0.15) 0%, transparent 70%)"},animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]});return r?s.jsx("div",{className:E("h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",e),children:l}):s.jsx("div",{className:E("h-full bg-background flex items-center justify-center",e),children:l})},B=({onAuthSuccess:o,onAuthError:e})=>{const[r,a]=b.useState("loading"),[m,l]=b.useState(null),A=b.useRef(!1),_=b.useRef(null);return b.useEffect(()=>A.current?void 0:(A.current=!0,(async()=>{var C,I;try{if(!(window.location.search.includes("code")||window.location.hash.includes("access_token"))&&(await g.auth.getSession()).data.session){const i=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,i),a("success"),o();return}const d=new URLSearchParams(window.location.search),k=new URLSearchParams(window.location.hash.substring(1)),n=d.get("error")||k.get("error"),c=d.get("error_description")||k.get("error_description"),x=d.get("error_code")||k.get("error_code");if(console.log("ðŸ” [AuthCallback] OAuth parameters:",{oauthError:n,errorDescription:c,errorCode:x,urlParams:Object.fromEntries(d.entries()),hashParams:Object.fromEntries(k.entries())}),n){console.error("ðŸ” [AuthCallback] OAuth error detected:",{oauthError:n,errorDescription:c,errorCode:x});let t="Authentication failed";n==="access_denied"&&x==="otp_expired"?t="Email confirmation link has expired. Please request a new confirmation email.":n==="access_denied"&&(c!=null&&c.includes("Email link is invalid"))?t="Email confirmation link is invalid. Please request a new confirmation email.":n==="access_denied"&&(c!=null&&c.includes("expired"))?t="Email confirmation link has expired. Please request a new confirmation email.":n==="server_error"?t="Authentication server error. This may be due to Supabase configuration. Please try again.":n==="access_denied"?t="Authentication was cancelled. Please try again.":n==="invalid_request"?t="Invalid authentication request. Please check configuration.":n==="unauthorized_client"?t="Authentication client is not authorized. Please check Supabase configuration.":n==="unsupported_response_type"?t="Authentication response type not supported. Please check Supabase configuration.":n==="invalid_scope"?t="Authentication scope is invalid. Please check Supabase configuration.":c&&(t=decodeURIComponent(c)),l(t),a("error"),e(t);return}const{data:{subscription:u}}=g.auth.onAuthStateChange(async(t,i)=>{var p,h,j,D,T;if(t==="SIGNED_IN"&&(i!=null&&i.user)){const R=((p=i.user.app_metadata)==null?void 0:p.provider)||((j=(h=i.user.app_metadata)==null?void 0:h.providers)==null?void 0:j[0])||((T=(D=i.user.identities)==null?void 0:D[0])==null?void 0:T.provider)||"unknown";await new Promise(y=>setTimeout(y,1500));try{await v.loadUserFromSupabase(i.user.id),a("success"),o()}catch(y){console.error("ðŸ” [AuthCallback] Error loading user data:",y),l("Failed to load user data. Please try again."),a("error"),e("Failed to load user data")}u.unsubscribe()}else t==="SIGNED_OUT"&&(l("Authentication failed"),a("error"),e("Authentication failed"),u.unsubscribe())});_.current=u;const{data:N,error:w}=await g.auth.getSession();if(w){console.error("ðŸ” [AuthCallback] Auth callback error:",w),l(w.message),a("error"),e(w.message),u.unsubscribe();return}if((C=N.session)!=null&&C.user)await new Promise(t=>setTimeout(t,1e3)),await v.loadUserFromSupabase(N.session.user.id),a("success"),o(),u.unsubscribe();else{const t=new URLSearchParams(window.location.search),i=new URLSearchParams(window.location.hash.substring(1));if(t.has("code")||t.has("error")||i.has("access_token")){await new Promise(h=>setTimeout(h,1e3));const p=await g.auth.getSession();if((I=p.data.session)!=null&&I.user){await new Promise(h=>setTimeout(h,500)),await v.loadUserFromSupabase(p.data.session.user.id),a("success"),o(),u.unsubscribe();return}}setTimeout(()=>{r==="loading"&&(l("Authentication timeout"),a("error"),e("Authentication timeout"),u.unsubscribe())},1e4)}}catch(P){console.error("ðŸ” [AuthCallback] Auth callback error:",P);const d="An unexpected error occurred";l(d),a("error"),e(d)}})(),()=>{_.current&&_.current.unsubscribe()}),[]),r==="loading"?s.jsx(O,{size:"md"}):r==="error"?s.jsx("div",{className:"h-screen bg-gradient-to-br from-[#111111] to-[#0A0A0A] flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âš ï¸"}),s.jsx("h2",{className:"text-2xl font-bold text-[#F5F5F5] mb-2",children:"Authentication Error"}),s.jsx("p",{className:"text-[#CFCFCF] mb-6",children:m}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:()=>{const S=window.location.hostname==="localhost"?"/":"/Otagon/";window.history.replaceState({},document.title,S),e("User cancelled authentication")},className:"bg-gradient-to-r from-[#E53A3A] to-[#D98C1F] md:hover:from-[#D42A2A] md:hover:to-[#C87A1A] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 md:hover:scale-105 active:scale-95",children:"Return to Login"}),m&&m.includes("Email confirmation link")&&s.jsx("button",{onClick:()=>{window.history.replaceState({},document.title,"/"),e("Email confirmation expired - show resend option")},className:"bg-gradient-to-r from-[#4F46E5] to-[#7C3AED] md:hover:from-[#4338CA] md:hover:to-[#6D28D9] text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 md:hover:scale-105 active:scale-95",children:"Request New Confirmation Email"})]})]})}):s.jsx(O,{size:"md"})};export{O as A,B as a,E as c,g as s};
