<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    
    <!-- Preload ALL mascot images for faster first-run loading -->
    <link rel="preload" href="/images/mascot/1.png" as="image" />
    <link rel="preload" href="/images/mascot/2.png" as="image" />
    <link rel="preload" href="/images/mascot/4.png" as="image" />
    <link rel="preload" href="/images/mascot/5.1.png" as="image" />
    <link rel="preload" href="/images/mascot/5.2.png" as="image" />
    <link rel="preload" href="/images/mascot/6.png" as="image" />
    <link rel="preload" href="/images/mascot/8.png" as="image" />
    <link rel="preload" href="/images/mascot/9.png" as="image" />
    <link rel="preload" href="/images/mascot/10.png" as="image" />
    <link rel="preload" href="/images/mascot/11.png" as="image" />
    <link rel="preload" href="/images/mascot/pro-user.png" as="image" />
    <link rel="preload" href="/images/mascot/vanguard-user.png" as="image" />
    
    <!-- LemonSqueezy Checkout -->
    <script src="https://app.lemonsqueezy.com/js/lemon.js" defer></script>
    
    <link rel="icon" type="image/png" href="/images/otagon-logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
    
    <!-- Primary Meta Tags -->
    <title>Otagon - AI-Powered Gaming Companion | Spoiler-Free Hints & Guides</title>
    <meta name="title" content="Otagon - AI-Powered Gaming Companion | Spoiler-Free Hints & Guides" />
    <meta name="description" content="Get spoiler-free gaming hints and AI-powered assistance with Google Gemini. Track progress, discover secrets, and enhance your gaming experience." />
    <meta name="keywords" content="gaming assistant, AI gaming companion, game hints, spoiler-free walkthrough, game guide, gaming AI, video game help, game progress tracker, gaming tips" />
    <meta name="author" content="Otagon" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <link rel="canonical" href="https://otagon.app/" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://otagon.app/" />
    <meta property="og:title" content="Otagon - AI-Powered Gaming Companion | Spoiler-Free Hints & Guides" />
    <meta property="og:description" content="Get spoiler-free gaming hints and AI-powered assistance with Google Gemini. Track progress, discover secrets, and enhance your gaming experience." />
    <meta property="og:image" content="https://otagon.app/images/screenshots/screenshot-wide.png" />
    <meta property="og:image:width" content="1280" />
    <meta property="og:image:height" content="720" />
    <meta property="og:site_name" content="Otagon" />
    <meta property="og:locale" content="en_US" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://otagon.app/" />
    <meta name="twitter:title" content="Otagon - AI-Powered Gaming Companion | Spoiler-Free Hints & Guides" />
    <meta name="twitter:description" content="Get spoiler-free gaming hints and AI-powered assistance with Google Gemini. Track progress, discover secrets, and enhance your gaming experience." />
    <meta name="twitter:image" content="https://otagon.app/images/screenshots/screenshot-wide.png" />
    <meta name="twitter:creator" content="@otagon" />
    
    <!-- Additional SEO -->
    <meta name="application-name" content="Otagon" />
    <meta name="apple-mobile-web-app-title" content="Otagon" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#0B0B0B" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#050505" />
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#111111" />
    
    <!-- Google AdSense -->
    <meta name="google-adsense-account" content="ca-pub-4482938310886744" />
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4482938310886744" crossorigin="anonymous"></script>
    
    <!-- Structured Data - Organization & Software Application -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Otagon",
      "alternateName": "Otagon AI Gaming Companion",
      "applicationCategory": "GameApplication",
      "operatingSystem": ["Web", "iOS", "Android", "Windows", "macOS", "Linux"],
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "description": "AI-powered gaming companion with Google Gemini integration that provides spoiler-free hints, walkthroughs, and progress tracking for all your favorite games.",
      "url": "https://otagon.app",
      "image": "https://otagon.app/images/otagon-logo.png",
      "logo": {
        "@type": "ImageObject",
        "url": "https://otagon.app/images/otagon-logo.png",
        "width": "512",
        "height": "512"
      },
      "screenshot": [
        {
          "@type": "ImageObject",
          "url": "https://otagon.app/images/screenshots/screenshot-wide.png",
          "caption": "Otagon AI Gaming Companion Interface"
        },
        {
          "@type": "ImageObject",
          "url": "https://otagon.app/images/screenshots/screenshot-narrow.png",
          "caption": "Otagon Mobile Gaming Assistant"
        }
      ],
      "author": {
        "@type": "Organization",
        "name": "Otagon",
        "url": "https://otagon.app",
        "logo": "https://otagon.app/images/otagon-logo.png",
        "sameAs": [
          "https://twitter.com/otagon",
          "https://github.com/readmet3xt/Otagon"
        ]
      },
      "publisher": {
        "@type": "Organization",
        "name": "Otagon",
        "url": "https://otagon.app",
        "logo": {
          "@type": "ImageObject",
          "url": "https://otagon.app/images/otagon-logo.png"
        }
      },
      "offers": {
        "@type": "AggregateOffer",
        "priceCurrency": "USD",
        "lowPrice": "0",
        "highPrice": "20",
        "offerCount": "3",
        "availability": "https://schema.org/InStock",
        "offers": [
          {
            "@type": "Offer",
            "name": "Free Tier",
            "description": "Basic AI gaming assistance with limited daily queries",
            "price": "0",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock",
            "url": "https://otagon.app/earlyaccess"
          },
          {
            "@type": "Offer",
            "name": "Pro Tier",
            "description": "Unlimited AI queries, advanced features, and priority support",
            "price": "3.99",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock",
            "priceSpecification": {
              "@type": "UnitPriceSpecification",
              "price": "3.99",
              "priceCurrency": "USD",
              "billingDuration": "P1M",
              "billingIncrement": 1
            },
            "url": "https://otagon.app/earlyaccess"
          },
          {
            "@type": "Offer",
            "name": "Pro Vanguard Tier",
            "description": "Annual subscription with all Pro features at discounted rate",
            "price": "20",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock",
            "priceSpecification": {
              "@type": "UnitPriceSpecification",
              "price": "20",
              "priceCurrency": "USD",
              "billingDuration": "P1Y",
              "billingIncrement": 1
            },
            "url": "https://otagon.app/earlyaccess"
          }
        ]
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "bestRating": "5",
        "worstRating": "1",
        "ratingCount": "1247",
        "reviewCount": "892"
      },
      "featureList": [
        "Spoiler-free gaming hints and walkthroughs",
        "Google Gemini AI integration for intelligent game assistance",
        "Real-time screenshot analysis and context-aware responses",
        "Multi-game support across all platforms and genres",
        "Voice commands and hands-free gaming support",
        "Game progress tracking and achievement monitoring",
        "Personalized gaming experience with profile customization",
        "Cross-platform synchronization",
        "Offline mode with cached game data"
      ],
      "softwareVersion": "1.3.5",
      "datePublished": "2024-11-01",
      "dateModified": "2025-11-26",
      "inLanguage": "en-US",
      "keywords": "gaming assistant, AI gaming companion, game hints, spoiler-free walkthrough, game guide, gaming AI, video game help, game progress tracker, gaming tips, Google Gemini AI, screenshot analysis"
    }
    </script>
    
    <!-- Structured Data - Organization -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Otagon",
      "alternateName": "Otagon AI",
      "url": "https://otagon.app",
      "logo": {
        "@type": "ImageObject",
        "url": "https://otagon.app/images/otagon-logo.png",
        "width": "512",
        "height": "512",
        "caption": "Otagon Logo"
      },
      "description": "Otagon is an AI-powered gaming companion that provides spoiler-free hints, walkthroughs, and assistance for gamers worldwide.",
      "foundingDate": "2024",
      "sameAs": [
        "https://twitter.com/otagon",
        "https://github.com/readmet3xt/Otagon"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "Customer Support",
        "url": "https://otagon.app/earlyaccess",
        "availableLanguage": ["English"]
      }
    }
    </script>
    
    <!-- Structured Data - WebApplication -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Otagon",
      "url": "https://otagon.app",
      "description": "AI-powered gaming companion providing spoiler-free hints and assistance",
      "applicationCategory": "GameApplication",
      "operatingSystem": "Any (Web-based)",
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": "AI-powered hints, Screenshot analysis, Voice commands, Progress tracking"
    }
    </script>
    
    <!-- Structured Data - BreadcrumbList -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://otagon.app/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Early Access",
          "item": "https://otagon.app/earlyaccess"
        }
      ]
    }
    </script>
    
    <!-- Structured Data - FAQPage -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What is Otagon?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Otagon is an AI-powered gaming companion that provides spoiler-free hints, walkthroughs, and intelligent assistance for video games. Using Google Gemini AI, it analyzes your gameplay and provides contextual help without revealing story spoilers."
          }
        },
        {
          "@type": "Question",
          "name": "Is Otagon free to use?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes! Otagon offers a free tier with basic AI gaming assistance. Pro tiers ($3.99/month or $20/year) provide unlimited queries, advanced features, and priority support."
          }
        },
        {
          "@type": "Question",
          "name": "What games does Otagon support?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Otagon supports all games across all platforms and genres. Whether you're playing AAA titles, indie games, RPGs, FPS, strategy games, or puzzle games, Otagon can provide intelligent assistance."
          }
        },
        {
          "@type": "Question",
          "name": "How does Otagon avoid spoilers?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Otagon uses advanced AI to understand your current game progress and only provides hints relevant to where you are in the game. It avoids revealing story elements, plot twists, or future content you haven't experienced yet."
          }
        },
        {
          "@type": "Question",
          "name": "Can I use Otagon on mobile devices?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes! Otagon is a Progressive Web App (PWA) that works seamlessly on iOS, Android, and all mobile devices. You can install it directly from your browser for a native app-like experience."
          }
        }
      ]
    }
    </script>
    
    <!-- PWA Meta Tags - Manifest loaded dynamically on /earlyaccess or when authenticated -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Otagon" />
    
    <!-- Apple Touch Icons - Multiple Sizes for Better iOS Support -->
    <link rel="apple-touch-icon" href="/icon-192.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icon-192.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/icon-192.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icon-192.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="/icon-192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/icon-512.png" />
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LJWNXPBRYT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-LJWNXPBRYT');
      console.log('‚úÖ [Analytics] Google Analytics 4 initialized');
    </script>
    
    <!-- Microsoft Clarity -->
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
        try {
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
          console.log('‚úÖ [Analytics] Microsoft Clarity initialized');
        } catch (error) {
          console.log('‚ÑπÔ∏è [Analytics] Clarity blocked by extension (expected with ad blockers)');
        }
      })(window, document, "clarity", "script", "u9sbvr97qi");
    </script>
    
    <!-- CRITICAL: Inline loading screen for PWA cold start (only for PWA/earlyaccess, not landing page) -->
    <style id="pwa-loading-styles">
      /* Show loading screen immediately before React loads */
      html, body {
        margin: 0;
        padding: 0;
        background-color: #0B0B0B !important;
        min-height: 100vh;
        min-height: 100dvh;
      }
      
      #pwa-loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #0B0B0B;
        display: none; /* Hidden by default */
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 99999;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
      
      /* Only show loading screen on PWA/earlyaccess pages */
      body.show-pwa-loading #pwa-loading-screen {
        display: flex;
      }
      
      #pwa-loading-screen img {
        width: 80px;
        height: 80px;
        margin-bottom: 16px;
      }
      
      #pwa-loading-screen .loading-spinner {
        display: none;
      }
      
      @keyframes pwa-spin {
        to { transform: rotate(360deg); }
      }
      
      /* Hide loading screen once React mounts */
      .react-mounted #pwa-loading-screen {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease-out;
      }
      
      /* Completely remove after transition */
      .react-mounted.loading-complete #pwa-loading-screen {
        display: none;
      }
    </style>
    <script type="module" crossorigin src="/assets/index-CAbiXsGA.js"></script>
    <link rel="modulepreload" crossorigin href="/assets/vendor-wxVLlg0y.js">
    <link rel="modulepreload" crossorigin href="/assets/carousel-vendor-DbqMuwPS.js">
    <link rel="modulepreload" crossorigin href="/assets/react-vendor-B0uBZZ1y.js">
    <link rel="modulepreload" crossorigin href="/assets/ai-vendor-DDPwdD9r.js">
    <link rel="modulepreload" crossorigin href="/assets/supabase-realtime-8-W1bgUD.js">
    <link rel="modulepreload" crossorigin href="/assets/supabase-vendor-KXjrFrzu.js">
    <link rel="modulepreload" crossorigin href="/assets/framer-vendor-LkZgebms.js">
    <link rel="modulepreload" crossorigin href="/assets/auth-BReucsSt.js">
    <link rel="modulepreload" crossorigin href="/assets/gaming-services-_x3E7y3p.js">
    <link rel="modulepreload" crossorigin href="/assets/storage-services-COCLFyGk.js">
    <link rel="modulepreload" crossorigin href="/assets/services-B1s7OmeP.js">
    <link rel="modulepreload" crossorigin href="/assets/chat-services-DRIKJpd7.js">
    <link rel="modulepreload" crossorigin href="/assets/core-services-eqg6j7y-.js">
    <link rel="modulepreload" crossorigin href="/assets/modals-DEHzzoHa.js">
    <link rel="modulepreload" crossorigin href="/assets/markdown-utils-Dqe530h3.js">
    <link rel="modulepreload" crossorigin href="/assets/markdown-vendor-BNW_XjvD.js">
    <link rel="modulepreload" crossorigin href="/assets/features-MRKdBAw7.js">
    <link rel="modulepreload" crossorigin href="/assets/gaming-explorer-DtfVRO5Q.js">
    <link rel="modulepreload" crossorigin href="/assets/router-vendor-_0HXVey8.js">
    <link rel="modulepreload" crossorigin href="/assets/layout-DVpOM8RH.js">
    <link rel="stylesheet" crossorigin href="/assets/index-B_cFPH1s.css">
  </head>
  <body>
    <!-- Inline loading screen - visible immediately before React loads (only on PWA/earlyaccess) -->
    <div id="pwa-loading-screen">
      <img src="/images/otagon-logo.png" alt="Otagon" />
      <div class="loading-spinner"></div>
    </div>
    
    <div id="root"></div>
    
    <!-- Script to conditionally show loading screen and hide once React mounts -->
    <script>
      // Only show loading screen on PWA/earlyaccess pages, not landing page
      (function() {
        var currentPath = window.location.pathname;
        var isLoginPage = currentPath === '/earlyaccess' || currentPath.includes('/earlyaccess');
        var hasAuthToken = localStorage.getItem('supabase.auth.token');
        var isPWA = window.matchMedia('(display-mode: standalone)').matches || 
                    window.navigator.standalone === true;
        
        // Show loading screen only if: PWA mode OR on earlyaccess page OR has auth
        if (isPWA || isLoginPage || hasAuthToken) {
          document.body.classList.add('show-pwa-loading');
        }
        
        // Mark when React has mounted
        var observer = new MutationObserver(function(mutations) {
          var root = document.getElementById('root');
          if (root && root.children.length > 0) {
            document.body.classList.add('react-mounted');
            setTimeout(function() {
              document.body.classList.add('loading-complete');
            }, 300);
            observer.disconnect();
          }
        });
        
        observer.observe(document.getElementById('root'), { childList: true, subtree: true });
        
        // Fallback: hide loading screen after 5 seconds even if React doesn't mount
        setTimeout(function() {
          document.body.classList.add('react-mounted');
          document.body.classList.add('loading-complete');
        }, 5000);
      })();
    </script>
    
    <script>
      // Conditionally load PWA manifest - only on /earlyaccess or when authenticated
      (function() {
        const currentPath = window.location.pathname;
        const isLoginPage = currentPath === '/earlyaccess' || currentPath.includes('/earlyaccess');
        const hasAuthToken = localStorage.getItem('supabase.auth.token');
        
        // Also check if we're showing login based on app state
        const shouldShowPWA = isLoginPage || hasAuthToken;
        
        console.log('[PWA] Current path:', currentPath);
        console.log('[PWA] Has auth token:', !!hasAuthToken);
        console.log('[PWA] Should show PWA:', shouldShowPWA);
        
        if (shouldShowPWA) {
          console.log('‚úÖ [PWA] Loading manifest');
          const manifestLink = document.createElement('link');
          manifestLink.rel = 'manifest';
          manifestLink.href = '/manifest.json';
          document.head.appendChild(manifestLink);
        } else {
          console.log('üö´ [PWA] Skipping manifest - landing page without auth');
          
          // Check again after 1 second in case React router changes state
          setTimeout(function() {
            const updatedAuthToken = localStorage.getItem('supabase.auth.token');
            if (updatedAuthToken && !document.querySelector('link[rel="manifest"]')) {
              console.log('‚úÖ [PWA] Loading manifest after state update');
              const manifestLink = document.createElement('link');
              manifestLink.rel = 'manifest';
              manifestLink.href = '/manifest.json';
              document.head.appendChild(manifestLink);
            }
          }, 1000);
        }
      })();
      
      // GitHub Pages OAuth callback handler
      (function() {
        // Check if this is an OAuth callback redirect from 404.html
        var isOAuthCallback = sessionStorage.getItem('oauth_callback');
        var oauthHash = sessionStorage.getItem('oauth_hash');
        
        if (isOAuthCallback && oauthHash) {
          sessionStorage.removeItem('oauth_callback');
          sessionStorage.removeItem('oauth_hash');
          
          // Update URL to /auth/callback with hash params
          history.replaceState(null, null, '/auth/callback' + oauthHash);
        } else {
          // Handle regular SPA redirects
          var redirect = sessionStorage.getItem('spa_redirect');
          if (redirect && redirect !== '/' && redirect !== '') {
            sessionStorage.removeItem('spa_redirect');
            // Use redirect path directly for custom domain
            if (redirect && redirect !== '/') {
              history.replaceState(null, null, redirect);
            }
          }
        }
      })();
    </script>
    <script>
      // Service Worker Registration for both Dev and Production
      // VERSION: 1.3.5 - PWA only on /earlyaccess and authenticated pages
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          // Only register service worker on login page or when authenticated
          const currentPath = window.location.pathname;
          const isLoginPage = currentPath === '/earlyaccess' || currentPath.includes('/earlyaccess');
          const hasAuthToken = localStorage.getItem('supabase.auth.token');
          
          if (!isLoginPage && !hasAuthToken) {
            console.log('üö´ [SW] Skipping service worker - not on login page or authenticated');
            // Unregister any existing service workers
            try {
              const registrations = await navigator.serviceWorker.getRegistrations();
              for (const registration of registrations) {
                await registration.unregister();
                console.log('Unregistered SW');
              }
            } catch (error) {
              console.log('Error unregistering SW:', error);
            }
            return;
          }
          
          const isDev = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
          const swPath = '/sw.js'; // Always use root path for custom domain
          
          // Force clear old broken service workers and caches
          const oldCacheVersion = 'v1.3.0';
          try {
            const registrations = await navigator.serviceWorker.getRegistrations();
            const cacheNames = await caches.keys();
            
            // Delete old caches from v1.3.0 that had the auth bug and old otakon-prefixed caches
            const deleteCachePromises = cacheNames
              .filter(name => name.includes('v1.3.0') || name.includes('pwa-fixes') || name.includes('otakon'))
              .map(name => {
                console.log('Deleting old cache:', name);
                return caches.delete(name);
              });
            
            await Promise.all(deleteCachePromises);
            
            // Unregister and re-register to get fresh SW
            for (const registration of registrations) {
              await registration.unregister();
              console.log('Unregistered old SW');
            }
          } catch (error) {
            console.log('Error cleaning up old SW:', error);
          }
          
          console.log('‚úÖ [SW] Registering service worker (login/app page)');
          // Register new service worker
          navigator.serviceWorker.register(swPath)
            .then((registration) => {
              console.log('‚úÖ SW v1.3.5 registered:', registration);
              
              // Prevent infinite reload loops
              const lastReloadTime = sessionStorage.getItem('sw_last_reload');
              const now = Date.now();
              
              // Check for updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                if (newWorker) {
                  newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                      // New content is available, auto-update
                      console.log('New SW version detected, updating...');
                      
                      // Only reload if last reload was more than 5 seconds ago
                      if (!lastReloadTime || now - parseInt(lastReloadTime) > 5000) {
                        sessionStorage.setItem('sw_last_reload', now.toString());
                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                        // Auto-reload after 1 second
                        setTimeout(() => {
                          window.location.reload();
                        }, 1000);
                      } else {
                        console.log('Skipping reload - too soon after last reload');
                      }
                    }
                  });
                }
              });
              
              // Handle controller change
              navigator.serviceWorker.addEventListener('controllerchange', () => {
                console.log('SW controller changed');
              });
            })
            .catch((registrationError) => {
              console.log('‚ùå SW registration failed:', registrationError);
            });
        });
      }
    </script>
  </body>
</html>
